<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.30">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Differential Expression Explorer – Blog</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../assets/logo_Bruker_black.png" rel="icon" type="image/png">
<script src="../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-3a01e2046221230fdceeea94b1ec5d67.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-a4a11d514c7d463668e07712114998e6.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-af213591e084c97bf384adea636fbb33.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script src="../../site_libs/quarto-dashboard/quarto-dashboard.js"></script>
<script src="../../site_libs/quarto-dashboard/stickythead.js"></script>
<script src="../../site_libs/quarto-dashboard/datatables.min.js" kdttablesentinel="true"></script>
<script src="../../site_libs/quarto-dashboard/pdfmake.min.js" kdttablesentinel="true"></script>
<script src="../../site_libs/quarto-dashboard/vfs_fonts.js" kdttablesentinel="true"></script>
<script src="../../site_libs/quarto-dashboard/web-components.js" type="module"></script>
<script src="../../site_libs/quarto-dashboard/components.js"></script>
<link href="../../site_libs/quarto-dashboard/datatables.min.css" rel="stylesheet" kdttablesentinel="true">
<script src="../../site_libs/quarto-contrib/live-runtime/live-runtime.js" type="module"></script>
<link href="../../site_libs/quarto-contrib/live-runtime/live-runtime.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-29W4MW0Y2W"></script>

<script type="text/plain" cookie-consent="tracking">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-29W4MW0Y2W', { 'anonymize_ip': true});
</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"implied",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary","functionality","tracking","targeting"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  ,
"language":"en"
  });
});
</script> 
  
<script type="module" src="../../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="../../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">


</head>

<body class="quarto-dashboard nav-fixed dashboard-fill dashboard-sidebar fullcontent">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../.././assets/logo_Bruker_white.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">Topics</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../guides/index.html"> 
<span class="menu-text">Guides (new!)</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../bbytes/index.html"> 
<span class="menu-text">Browser Bytes (new!)</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../link-to-code.html"> 
<span class="menu-text">Source Code</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Nanostring-Biostats/CosMx-Analysis-Scratch-Space"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/company/bruker-spatial"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
<header id="quarto-dashboard-header">
<nav class="navbar navbar-expand-md slim" data-bs-theme="dark">
  <div class="navbar-container container-fluid">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#dashboard-collapse" aria-controls="dashboard-collapse" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>    


    <div class="navbar-brand-container">       

      <div class="navbar-title">
        <div class="navbar-title-text"><a href="#">Differential Expression Explorer</a></div>
        
        
      </div>
    </div>
<div id="dashboard-collapse" class="navbar-collapse collapse"><ul class="navbar-nav navbar-nav-scroll me-auto" role="tablist"><li class="nav-item" role="presentation"><a id="tab-volcano-plots" class="nav-link active" data-bs-toggle="tab" role="tab" data-bs-target="#volcano-plots" data-scrolling="false" href="#volcano-plots" aria-controls="volcano-plots" aria-selected="true"><span class="nav-link-text">Volcano Plots</span></a></li><li class="nav-item" role="presentation"><a id="tab-marginal-means" class="nav-link" data-bs-toggle="tab" role="tab" data-bs-target="#marginal-means" data-scrolling="false" href="#marginal-means" aria-controls="marginal-means" aria-selected="false"><span class="nav-link-text">Marginal Means</span></a></li><li class="nav-item" role="presentation"><a id="tab-spatial-plots" class="nav-link" data-bs-toggle="tab" role="tab" data-bs-target="#spatial-plots" data-scrolling="false" href="#spatial-plots" aria-controls="spatial-plots" aria-selected="false"><span class="nav-link-text">Spatial Plots</span></a></li><li class="nav-item" role="presentation"><a id="tab-sec-convert-atomx" class="nav-link" data-bs-toggle="tab" role="tab" data-bs-target="#sec-convert-atomx" data-scrolling="true" href="#sec-convert-atomx" aria-controls="sec-convert-atomx" aria-selected="false"><span class="nav-link-text">Convert Your AtoMx SIP Results</span></a></li><li class="nav-item" role="presentation"><a id="tab-sec-convert-smide" class="nav-link" data-bs-toggle="tab" role="tab" data-bs-target="#sec-convert-smide" data-scrolling="true" href="#sec-convert-smide" aria-controls="sec-convert-smide" aria-selected="false"><span class="nav-link-text">Convert Your smiDE Results</span></a></li><li class="nav-item" role="presentation"><a id="tab-advanced" class="nav-link" data-bs-toggle="tab" role="tab" data-bs-target="#advanced" data-scrolling="false" href="#advanced" aria-controls="advanced" aria-selected="false"><span class="nav-link-text">Advanced</span></a></li><li class="nav-item" role="presentation"><a id="tab-webr-console" class="nav-link" data-bs-toggle="tab" role="tab" data-bs-target="#webr-console" data-scrolling="false" href="#webr-console" aria-controls="webr-console" aria-selected="false"><span class="nav-link-text">webR Console</span></a></li><li class="nav-item" role="presentation"><a id="tab-sec-testing" class="nav-link" data-bs-toggle="tab" role="tab" data-bs-target="#sec-testing" data-scrolling="false" href="#sec-testing" aria-controls="sec-testing" aria-selected="false"><span class="nav-link-text">Testing: The Living Volcano</span></a></li></ul></div></div>
</nav>
</header></header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-layout-custom page-navbar quarto-dashboard-content bslib-gap-spacing html-fill-container bslib-page-fill quarto-dashboard-pages dashboard-sidebar-container">
<!-- sidebar -->
<!-- margin-sidebar -->
<!-- main -->

<!-- Note: do not remove the following line. It is used when rendering. -->
<!-- This line is for debugging.  -->
<!-- {{< include ../../_extensions/r-wasm/live/_knitr.qmd >}} -->
<p>Welcome to the <strong>Differential Expression Explorer</strong>, a serverless dashboard for interactive analysis of CosMx SMI differential expression results. This tool utilizes WebAssembly <a href="https://docs.r-wasm.org/webr/latest/" target="_blank">(WebR)</a> and <a href="https://quarto.org/docs/interactive/ojs/" target="_blank">ObservableJS</a> to run entirely in your web browser, allowing you to visualize <strong>Volcano Plots</strong>, <strong>Marginal Means</strong>, and <strong>Spatial Mappings</strong> without uploading data to a remote server. You can explore existing DE results that we’ve added or load your own results. Advanced users should check out the <code>Advanced</code> tab if they want to customize their volcano plot even further.</p>
<div class="callout callout-style-simple callout-warning bslib-grid-item">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Beta Notice:</strong> This dashboard is currently in an <strong>experimental / beta testing phase</strong>. Features, performance, and data formats are subject to change. When you first load the site, you will see temporary <code>OJS Runtime Error</code> messages displayed until data are initialized. Please report any issues you encounter.</p>
</div>
</div>
</div>
<div class="bslib-sidebar-layout html-fill-item html-fill-container" data-bslib-sidebar-open="desktop" data-bslib-sidebar-init="true" style=" --bslib-sidebar-width: 500px" data-bslib-sidebar-border="false" data-bslib-sidebar-border-radius="false"><div class="main html-fill-container html-fill-item"><div class="sidebar-content html-fill-item html-fill-container">
<div class="tab-content bslib-grid html-fill-item html-fill-container" style="display: grid; grid-template-columns: minmax(3em, 1fr);
grid-auto-rows: minmax(0, 1fr);">
<div id="volcano-plots" class="dashboard-page tab-pane show active html-fill-item html-fill-container" data-orientation="rows" aria-labelledby="tab-volcano-plots">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, 100fr); grid-auto-columns: minmax(0, 1fr);">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-columns: minmax(3em, 60fr) minmax(3em, 40fr);
grid-auto-rows: minmax(0, 1fr);">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, 50fr) minmax(3em, 50fr); grid-auto-columns: minmax(0, 1fr);">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-columns: minmax(3em, 50fr) minmax(3em, 50fr);
grid-auto-rows: minmax(0, 1fr);">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, 100fr); grid-auto-columns: minmax(0, 1fr);">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-columns: minmax(3em, 1fr);
grid-auto-rows: minmax(0, 1fr);">
<div class="card html-fill-item html-fill-container bslib-card" data-title="SUMMARY STATISTICS" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-header"><div class="card-title html-fill-item html-fill-container"><span style="display: inline">
SUMMARY STATISTICS
</span></div></div>
<div class="cell card-body html-fill-item html-fill-container" data-autorun="true" data-input="vplot_stats">
<div class="html-fill-item html-fill-container">
<div id="webr-6" class="exercise-cell html-fill-item html-fill-container">

</div>
<script type="webr-6-contents">
eyJhdHRyIjp7ImF1dG9ydW4iOnRydWUsImVjaG8iOmZhbHNlLCJlZGl0IjpmYWxzZSwiZXZhbCI6dHJ1ZSwiaW5wdXQiOlsidnBsb3Rfc3RhdHMiXSwicmVzdWx0cyI6ImFzaXMifSwiY29kZSI6IlxuaWYgKGluaGVyaXRzKHZwbG90X3N0YXRzLCBcImRhdGEuZnJhbWVcIikpIHtcbiAga25pdHI6OmthYmxlKHZwbG90X3N0YXRzLCBmb3JtYXQgPSBcImh0bWxcIiwgXG4gICAgICAgICAgICAgICBjb2wubmFtZXMgPSBjKFwiXCIsIFwiXCIpLCAjIEhpZGUgaGVhZGVycyBpZiBzZWxmLWV4cGxhbmF0b3J5XG4gICAgICAgICAgICAgICB0YWJsZS5hdHRyID0gXCJzdHlsZT0nd2lkdGg6MTAwJTsgZm9udC1zaXplOiAwLjllbTsgYm9yZGVyLWNvbGxhcHNlOiBjb2xsYXBzZTsnXCIpXG59IGVsc2Uge1xuICBjYXQoXCI8c3BhbiBzdHlsZT0nY29sb3I6I2NjYyc+V2FpdGluZyBmb3IgZGF0YS4uLjwvc3Bhbj5cIilcbn0ifQ==
</script>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div>
</div><div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, 1fr); grid-auto-columns: minmax(0, 1fr);">
<div class="card cell html-fill-item html-fill-container bslib-card" data-title="ADJUST IMAGE AESTHETICS" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-header"><div class="card-title html-fill-item html-fill-container"><span style="display: inline">
ADJUST IMAGE AESTHETICS
</span></div></div>
<div class="card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb14" data-startfrom="675" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 674;"><span id="cb14-675"><a href="#cb14-675" aria-hidden="true" tabindex="-1"></a>viewof aesthetics_raw <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">form</span>({</span>
<span id="cb14-676"><a href="#cb14-676" aria-hidden="true" tabindex="-1"></a>  <span class="dt">volcano_fc_range</span><span class="op">:</span>      Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>]<span class="op">,</span> {<span class="dt">step</span><span class="op">:</span> <span class="fl">0.001</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Abs. log2FC"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">1</span>})<span class="op">,</span></span>
<span id="cb14-677"><a href="#cb14-677" aria-hidden="true" tabindex="-1"></a>  <span class="dt">volcano_pval_threshold</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {<span class="dt">step</span><span class="op">:</span> <span class="fl">0.00001</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"P-value threshold"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">0.05</span>})<span class="op">,</span></span>
<span id="cb14-678"><a href="#cb14-678" aria-hidden="true" tabindex="-1"></a>  <span class="dt">volcano_pt_size</span><span class="op">:</span>       Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.1</span><span class="op">,</span> <span class="dv">5</span>]<span class="op">,</span> {<span class="dt">step</span><span class="op">:</span> <span class="fl">0.1</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Pt. Size"</span>})<span class="op">,</span></span>
<span id="cb14-679"><a href="#cb14-679" aria-hidden="true" tabindex="-1"></a>  <span class="dt">volcano_alpha</span><span class="op">:</span>         Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {<span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Pt. Alpha"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">1.0</span>})<span class="op">,</span></span>
<span id="cb14-680"><a href="#cb14-680" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-681"><a href="#cb14-681" aria-hidden="true" tabindex="-1"></a>  <span class="dt">volcano_pt_color</span><span class="op">:</span>      Inputs<span class="op">.</span><span class="fu">color</span>({<span class="dt">label</span><span class="op">:</span> <span class="st">"Pt. Color"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="st">"#3C3F40"</span>})<span class="op">,</span></span>
<span id="cb14-682"><a href="#cb14-682" aria-hidden="true" tabindex="-1"></a>  <span class="dt">volcano_sig_color</span><span class="op">:</span>     Inputs<span class="op">.</span><span class="fu">color</span>({<span class="dt">label</span><span class="op">:</span> <span class="st">"Significant targets"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="st">"#b44697"</span>})<span class="op">,</span></span>
<span id="cb14-683"><a href="#cb14-683" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-684"><a href="#cb14-684" aria-hidden="true" tabindex="-1"></a>  <span class="dt">volcano_high_fc_label</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>]<span class="op">,</span> {<span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Label high FC"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">3</span>})<span class="op">,</span></span>
<span id="cb14-685"><a href="#cb14-685" aria-hidden="true" tabindex="-1"></a>  <span class="dt">volcano_low_fc_label</span><span class="op">:</span>  Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>]<span class="op">,</span> {<span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Label low FC"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">3</span>})<span class="op">,</span></span>
<span id="cb14-686"><a href="#cb14-686" aria-hidden="true" tabindex="-1"></a>  <span class="dt">volcano_pval_label</span><span class="op">:</span>    Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>]<span class="op">,</span> {<span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Label Sig."</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">3</span>})<span class="op">,</span></span>
<span id="cb14-687"><a href="#cb14-687" aria-hidden="true" tabindex="-1"></a>  <span class="dt">volcano_include_selected_genes</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">radio</span>([<span class="st">"Yes"</span><span class="op">,</span> <span class="st">"No"</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Label selected?"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="st">"Yes"</span>})</span>
<span id="cb14-688"><a href="#cb14-688" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb14-689"><a href="#cb14-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-690"><a href="#cb14-690" aria-hidden="true" tabindex="-1"></a>aesthetics_debounced <span class="op">=</span> {</span>
<span id="cb14-691"><a href="#cb14-691" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> raw <span class="op">=</span> aesthetics_raw<span class="op">;</span></span>
<span id="cb14-692"><a href="#cb14-692" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="kw">new</span> <span class="bu">Promise</span>(resolve <span class="kw">=&gt;</span> {</span>
<span id="cb14-693"><a href="#cb14-693" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> timer <span class="op">=</span> <span class="pp">setTimeout</span>(() <span class="kw">=&gt;</span> <span class="fu">resolve</span>(raw)<span class="op">,</span> <span class="dv">600</span>)<span class="op">;</span> </span>
<span id="cb14-694"><a href="#cb14-694" aria-hidden="true" tabindex="-1"></a>    invalidation<span class="op">.</span><span class="fu">then</span>(() <span class="kw">=&gt;</span> <span class="pp">clearTimeout</span>(timer))<span class="op">;</span></span>
<span id="cb14-695"><a href="#cb14-695" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb14-696"><a href="#cb14-696" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-697"><a href="#cb14-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-698"><a href="#cb14-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-699"><a href="#cb14-699" aria-hidden="true" tabindex="-1"></a>aesthetics <span class="op">=</span> aesthetics_debounced</span>
<span id="cb14-700"><a href="#cb14-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-701"><a href="#cb14-701" aria-hidden="true" tabindex="-1"></a>volcano_fc_range               <span class="op">=</span> aesthetics<span class="op">.</span><span class="at">volcano_fc_range</span></span>
<span id="cb14-702"><a href="#cb14-702" aria-hidden="true" tabindex="-1"></a>volcano_pval_threshold         <span class="op">=</span> aesthetics<span class="op">.</span><span class="at">volcano_pval_threshold</span></span>
<span id="cb14-703"><a href="#cb14-703" aria-hidden="true" tabindex="-1"></a>volcano_pt_size                <span class="op">=</span> aesthetics<span class="op">.</span><span class="at">volcano_pt_size</span></span>
<span id="cb14-704"><a href="#cb14-704" aria-hidden="true" tabindex="-1"></a>volcano_alpha                  <span class="op">=</span> aesthetics<span class="op">.</span><span class="at">volcano_alpha</span></span>
<span id="cb14-705"><a href="#cb14-705" aria-hidden="true" tabindex="-1"></a>volcano_pt_color               <span class="op">=</span> aesthetics<span class="op">.</span><span class="at">volcano_pt_color</span></span>
<span id="cb14-706"><a href="#cb14-706" aria-hidden="true" tabindex="-1"></a>volcano_sig_color              <span class="op">=</span> aesthetics<span class="op">.</span><span class="at">volcano_sig_color</span></span>
<span id="cb14-707"><a href="#cb14-707" aria-hidden="true" tabindex="-1"></a>volcano_high_fc_label          <span class="op">=</span> aesthetics<span class="op">.</span><span class="at">volcano_high_fc_label</span></span>
<span id="cb14-708"><a href="#cb14-708" aria-hidden="true" tabindex="-1"></a>volcano_low_fc_label           <span class="op">=</span> aesthetics<span class="op">.</span><span class="at">volcano_low_fc_label</span></span>
<span id="cb14-709"><a href="#cb14-709" aria-hidden="true" tabindex="-1"></a>volcano_pval_label             <span class="op">=</span> aesthetics<span class="op">.</span><span class="at">volcano_pval_label</span></span>
<span id="cb14-710"><a href="#cb14-710" aria-hidden="true" tabindex="-1"></a>volcano_include_selected_genes <span class="op">=</span> aesthetics<span class="op">.</span><span class="at">volcano_include_selected_genes</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-1" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-2" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-3" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-4" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-5" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-6" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-7" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-8" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-9" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-10" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-11" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-12" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-13" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div>
</div>
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-columns: minmax(3em, 100fr);
grid-auto-rows: minmax(0, 1fr);">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, 1fr); grid-auto-columns: minmax(0, 1fr);">
<div class="card hidden html-fill-item html-fill-container bslib-card" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="cell hidden card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb15" data-startfrom="723" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 722;"><span id="cb15-723"><a href="#cb15-723" aria-hidden="true" tabindex="-1"></a>volcano_data_js <span class="op">=</span> {</span>
<span id="cb15-724"><a href="#cb15-724" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> payload <span class="op">=</span> study_data_payload<span class="op">;</span></span>
<span id="cb15-725"><a href="#cb15-725" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> contrast <span class="op">=</span> contrast_selection<span class="op">;</span></span>
<span id="cb15-726"><a href="#cb15-726" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> term <span class="op">=</span> term_selection<span class="op">;</span></span>
<span id="cb15-727"><a href="#cb15-727" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-728"><a href="#cb15-728" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 1. DONT PROCEED if essential selections are missing</span></span>
<span id="cb15-729"><a href="#cb15-729" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>payload <span class="op">||</span> <span class="op">!</span>contrast <span class="op">||</span> <span class="op">!</span>term <span class="op">||</span> payload<span class="op">.</span><span class="at">mode</span> <span class="op">===</span> <span class="st">"local"</span>) <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb15-730"><a href="#cb15-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-731"><a href="#cb15-731" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (payload<span class="op">.</span><span class="at">mode</span> <span class="op">===</span> <span class="st">"remote_js_bridge"</span>) {</span>
<span id="cb15-732"><a href="#cb15-732" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb15-733"><a href="#cb15-733" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> conn <span class="op">=</span> <span class="cf">await</span> duck_db_client<span class="op">;</span></span>
<span id="cb15-734"><a href="#cb15-734" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> tableSource <span class="op">=</span> payload<span class="op">.</span><span class="at">isAtoMx</span> <span class="op">?</span> <span class="vs">`pairwise_harmonized`</span> <span class="op">:</span> <span class="vs">`"</span><span class="sc">${</span>payload<span class="op">.</span><span class="at">url_pairwise</span><span class="sc">}</span><span class="vs">"`</span><span class="op">;</span></span>
<span id="cb15-735"><a href="#cb15-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-736"><a href="#cb15-736" aria-hidden="true" tabindex="-1"></a>      <span class="co">// 2. CHECK IF VIEW EXISTS (For AtoMx)</span></span>
<span id="cb15-737"><a href="#cb15-737" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (payload<span class="op">.</span><span class="at">isAtoMx</span>) {</span>
<span id="cb15-738"><a href="#cb15-738" aria-hidden="true" tabindex="-1"></a>         <span class="kw">const</span> viewCheck <span class="op">=</span> <span class="cf">await</span> conn<span class="op">.</span><span class="fu">query</span>(<span class="vs">`SELECT count(*) as n FROM </span><span class="sc">${</span>tableSource<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb15-739"><a href="#cb15-739" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> (viewCheck<span class="op">.</span><span class="fu">toArray</span>()[<span class="dv">0</span>]<span class="op">.</span><span class="at">n</span> <span class="op">===</span> <span class="dv">0</span>) <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span> <span class="co">// Wait for data</span></span>
<span id="cb15-740"><a href="#cb15-740" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb15-741"><a href="#cb15-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-742"><a href="#cb15-742" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> query <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb15-743"><a href="#cb15-743" aria-hidden="true" tabindex="-1"></a><span class="vs">        SELECT term, contrast, target, log2fc, "p.value", ncells_1, ncells_2</span></span>
<span id="cb15-744"><a href="#cb15-744" aria-hidden="true" tabindex="-1"></a><span class="vs">        FROM </span><span class="sc">${</span>tableSource<span class="sc">}</span></span>
<span id="cb15-745"><a href="#cb15-745" aria-hidden="true" tabindex="-1"></a><span class="vs">        WHERE contrast = '</span><span class="sc">${</span>contrast<span class="sc">}</span><span class="vs">' AND term = '</span><span class="sc">${</span>term<span class="sc">}</span><span class="vs">'</span></span>
<span id="cb15-746"><a href="#cb15-746" aria-hidden="true" tabindex="-1"></a><span class="vs">      `</span><span class="op">;</span></span>
<span id="cb15-747"><a href="#cb15-747" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb15-748"><a href="#cb15-748" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> result <span class="op">=</span> <span class="cf">await</span> conn<span class="op">.</span><span class="fu">query</span>(query)<span class="op">;</span></span>
<span id="cb15-749"><a href="#cb15-749" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> data <span class="op">=</span> result<span class="op">.</span><span class="fu">toArray</span>()<span class="op">.</span><span class="fu">map</span>(row <span class="kw">=&gt;</span> row<span class="op">.</span><span class="fu">toJSON</span>())<span class="op">;</span></span>
<span id="cb15-750"><a href="#cb15-750" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb15-751"><a href="#cb15-751" aria-hidden="true" tabindex="-1"></a>      <span class="co">// 3. ONLY RETURN IF WE HAVE DATA</span></span>
<span id="cb15-752"><a href="#cb15-752" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (data<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span> </span>
<span id="cb15-753"><a href="#cb15-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-754"><a href="#cb15-754" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="vs">`✅ Pairwise data fetched from </span><span class="sc">${</span>tableSource<span class="sc">}</span><span class="vs"> (</span><span class="sc">${</span>data<span class="op">.</span><span class="at">length</span><span class="sc">}</span><span class="vs"> rows)`</span>)<span class="op">;</span></span>
<span id="cb15-755"><a href="#cb15-755" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> data<span class="op">;</span></span>
<span id="cb15-756"><a href="#cb15-756" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb15-757"><a href="#cb15-757" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (e) {</span>
<span id="cb15-758"><a href="#cb15-758" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(<span class="st">"❌ Failed to fetch pairwise data:"</span><span class="op">,</span> e)<span class="op">;</span></span>
<span id="cb15-759"><a href="#cb15-759" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span> <span class="co">// Return null so webR doesn't try to process an error</span></span>
<span id="cb15-760"><a href="#cb15-760" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-761"><a href="#cb15-761" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-762"><a href="#cb15-762" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div id="ojs-cell-15" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell card-body html-fill-item html-fill-container" data-autorun="true" data-input="[&quot;study_data_payload&quot;,&quot;volcano_data_js&quot;,&quot;contrast_selection&quot;,&quot;term_selection&quot;]" data-define="current_volcano_data">
<div class="html-fill-item html-fill-container">
<div id="webr-7" class="exercise-cell html-fill-item html-fill-container">

</div>
<script type="webr-7-contents">
eyJhdHRyIjp7ImF1dG9ydW4iOnRydWUsImRlZmluZSI6WyJjdXJyZW50X3ZvbGNhbm9fZGF0YSJdLCJlY2hvIjpmYWxzZSwiZWRpdCI6ZmFsc2UsImV2YWwiOnRydWUsImlucHV0IjpbInN0dWR5X2RhdGFfcGF5bG9hZCIsInZvbGNhbm9fZGF0YV9qcyIsImNvbnRyYXN0X3NlbGVjdGlvbiIsInRlcm1fc2VsZWN0aW9uIl0sIm91dHB1dCI6ZmFsc2V9LCJjb2RlIjoiXG5jdXJyZW50X3ZvbGNhbm9fZGF0YSA8LSBkYXRhLmZyYW1lKCd0ZXJtJz0ndW5rbm93bicsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY29udHJhc3QnID0gJ0IgLyBBJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3RhcmdldCcgPSAnTkEnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbG9nMmZjJyA9IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwLnZhbHVlJyA9IDEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICduY2VsbHNfMScgPSAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbmNlbGxzXzInID0gMClcblxuaWYgKCFpcy5udWxsKHN0dWR5X2RhdGFfcGF5bG9hZCkgJiYgIWlzLm51bGwoY29udHJhc3Rfc2VsZWN0aW9uKSkge1xuXG4gIGlmIChzdHVkeV9kYXRhX3BheWxvYWQkbW9kZSA9PSBcInJlbW90ZV9qc19icmlkZ2VcIikge1xuICAgIGlmICghaXMubnVsbCh2b2xjYW5vX2RhdGFfanMpKSB7XG4gICAgICAganNvbl9zdHIgPC0ganNvbmxpdGU6OnRvSlNPTih2b2xjYW5vX2RhdGFfanMpXG4gICAgICAgY3VycmVudF92b2xjYW5vX2RhdGEgPC0ganNvbmxpdGU6OmZyb21KU09OKGpzb25fc3RyKVxuICAgICAgIFxuICAgICAgIGNhdChwYXN0ZTAoXCJSOiBSZWNlaXZlZCBcIiwgbnJvdyhjdXJyZW50X3ZvbGNhbm9fZGF0YSksIFwiIHJvd3MgZnJvbSBSZW1vdGUuXFxuXCIpKVxuICAgIH1cbiAgICBcbiAgfSBlbHNlIHtcbiAgICBcbiAgICBjYXQocGFzdGUwKFwiUjogUXVlcnlpbmcgTG9jYWwgREIgZm9yOiBcIiwgY29udHJhc3Rfc2VsZWN0aW9uLCBcIlxcblwiKSlcblxuICAgIGlmIChkYkV4aXN0c1RhYmxlKGNvbiwgXCJkZV9yZXN1bHRzXCIpKSB7XG4gICAgICAgIHF1ZXJ5IDwtIHNwcmludGYoXG4gICAgICAgICAgXCJTRUxFQ1QgdGVybSwgY29udHJhc3QsIHRhcmdldCwgbG9nMmZjLCBcXFwicC52YWx1ZVxcXCIsIG5jZWxsc18xLCBuY2VsbHNfMiBcbiAgICAgICAgICAgRlJPTSBkZV9yZXN1bHRzIFxuICAgICAgICAgICBXSEVSRSBjb250cmFzdCA9ICclcycgQU5EIHRlcm0gPSAnJXMnXCIsIFxuICAgICAgICAgIGNvbnRyYXN0X3NlbGVjdGlvbiwgXG4gICAgICAgICAgdGVybV9zZWxlY3Rpb25cbiAgICAgICAgKVxuXG4gICAgICAgY3VycmVudF92b2xjYW5vX2RhdGEgPC0gZGJHZXRRdWVyeShjb24sIHF1ZXJ5KVxuICAgICAgIGNhdChwYXN0ZTAoXCJSOiBMb2FkZWQgXCIsIG5yb3coY3VycmVudF92b2xjYW5vX2RhdGEpLCBcIiByb3dzIGZyb20gTG9jYWwuXFxuXCIpKVxuICAgIH1cbiAgfVxuICBcbiAgY3VycmVudF92b2xjYW5vX2RhdGEgPC0gY3VycmVudF92b2xjYW5vX2RhdGEgJT4lIG11dGF0ZShsb2cyZmMgPSBsb2cyKGZvbGRfY2hhbmdlKSwgcGFkaiA9IHAuYWRqdXN0KHAudmFsdWUsIG1ldGhvZD1cIkJIXCIpKSAlPiVcbiAgICBzZWxlY3QodGFyZ2V0LCBsb2cyZmMsIHAudmFsdWUsIHBhZGosIG5jZWxsc18xLCBuY2VsbHNfMiwgdGVybSwgY29udHJhc3QpXG59In0=
</script>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
<div class="card html-fill-item html-fill-container bslib-card" data-title="PAIRWISE DETAILS" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-header"><div class="card-toolbar html-fill-item html-fill-container" data-target-position="header" data-target-element="next"><div class="card-title html-fill-item html-fill-container"><span style="display: inline">
PAIRWISE DETAILS

</span></div>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb16" data-startfrom="825" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 824;"><span id="cb16-825"><a href="#cb16-825" aria-hidden="true" tabindex="-1"></a>viewof pairwise_search <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">search</span>(current_volcano_data<span class="op">,</span> {<span class="dt">placeholder</span><span class="op">:</span> <span class="st">"Search Results"</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div id="ojs-cell-16" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div></div>
<div class="cell card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb17" data-startfrom="834" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 833;"><span id="cb17-834"><a href="#cb17-834" aria-hidden="true" tabindex="-1"></a>viewof pairwise_table <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">table</span>(pairwise_search<span class="op">,</span> {</span>
<span id="cb17-835"><a href="#cb17-835" aria-hidden="true" tabindex="-1"></a>  <span class="dt">multiple</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb17-836"><a href="#cb17-836" aria-hidden="true" tabindex="-1"></a>  <span class="dt">rows</span><span class="op">:</span> <span class="dv">20</span><span class="op">,</span></span>
<span id="cb17-837"><a href="#cb17-837" aria-hidden="true" tabindex="-1"></a>  <span class="dt">format</span><span class="op">:</span> {</span>
<span id="cb17-838"><a href="#cb17-838" aria-hidden="true" tabindex="-1"></a>    <span class="dt">log2fc</span><span class="op">:</span> <span class="fu">sparkbar</span>(d3<span class="op">.</span><span class="fu">max</span>(pairwise_search<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">log2fc</span>))</span>
<span id="cb17-839"><a href="#cb17-839" aria-hidden="true" tabindex="-1"></a>  }})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div id="ojs-cell-17" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
<!-- ```{ojs} -->
<!-- selected_genes -->
<!-- ``` -->
</div>
<div class="cell hidden card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb18" data-startfrom="855" data-source-offset="-43"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 854;"><span id="cb18-855"><a href="#cb18-855" aria-hidden="true" tabindex="-1"></a>selected_genes <span class="op">=</span> {</span>
<span id="cb18-856"><a href="#cb18-856" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>current_volcano_data <span class="op">||</span> <span class="op">!</span>pairwise_table) <span class="cf">return</span> [<span class="st">'notagene'</span>]<span class="op">;</span></span>
<span id="cb18-857"><a href="#cb18-857" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (pairwise_table<span class="op">.</span><span class="at">length</span> <span class="op">===</span> current_volcano_data) {</span>
<span id="cb18-858"><a href="#cb18-858" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [<span class="st">'notagene'</span>]<span class="op">;</span></span>
<span id="cb18-859"><a href="#cb18-859" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-860"><a href="#cb18-860" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (pairwise_table<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">30</span>) {</span>
<span id="cb18-861"><a href="#cb18-861" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [<span class="st">'notagene'</span>]<span class="op">;</span></span>
<span id="cb18-862"><a href="#cb18-862" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-863"><a href="#cb18-863" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> pairwise_table<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">target</span>)<span class="op">;</span></span>
<span id="cb18-864"><a href="#cb18-864" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-865"><a href="#cb18-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-866"><a href="#cb18-866" aria-hidden="true" tabindex="-1"></a>selectionWarning <span class="op">=</span> {</span>
<span id="cb18-867"><a href="#cb18-867" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 1. Wait for data</span></span>
<span id="cb18-868"><a href="#cb18-868" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>pairwise_table <span class="op">||</span> <span class="op">!</span>current_volcano_data) <span class="cf">return</span> <span class="vs">`Select between 1 and 30 genes to label.`</span><span class="op">;</span></span>
<span id="cb18-869"><a href="#cb18-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-870"><a href="#cb18-870" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> count <span class="op">=</span> pairwise_table<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb18-871"><a href="#cb18-871" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> total <span class="op">=</span> current_volcano_data<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb18-872"><a href="#cb18-872" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> isSelectAll <span class="op">=</span> (count <span class="op">===</span> total)<span class="op">;</span></span>
<span id="cb18-873"><a href="#cb18-873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-874"><a href="#cb18-874" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(isSelectAll){</span>
<span id="cb18-875"><a href="#cb18-875" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="vs">`Select up to 30 genes to label in the volcano plot.`</span><span class="op">;</span></span>
<span id="cb18-876"><a href="#cb18-876" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-877"><a href="#cb18-877" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (count <span class="op">&gt;</span> <span class="dv">30</span>) {</span>
<span id="cb18-878"><a href="#cb18-878" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="vs">`⚠️ Too many targets selected (</span><span class="sc">${</span>count<span class="sc">}</span><span class="vs">). Limit is 30.`</span><span class="op">;</span></span>
<span id="cb18-879"><a href="#cb18-879" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-880"><a href="#cb18-880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-881"><a href="#cb18-881" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="vs">`Currently selected: </span><span class="sc">${</span>count<span class="sc">}</span><span class="vs"> gene</span><span class="sc">${</span>count <span class="op">===</span> <span class="dv">1</span> <span class="op">?</span> <span class="st">''</span> <span class="op">:</span> <span class="st">'s'</span><span class="sc">}</span><span class="vs">.`</span><span class="op">;</span></span>
<span id="cb18-882"><a href="#cb18-882" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-18-1" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-18-2" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
</div>
<div class="card-body html-fill-item html-fill-container">
<span><span id="ojs-element-id-1"></span></span>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div>
</div>
</div><div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-columns: minmax(3em, 1fr);
grid-auto-rows: minmax(0, 1fr);">
<div class="card html-fill-item html-fill-container bslib-card" data-title="VOLCANO PLOT" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-header"><div class="card-toolbar html-fill-item html-fill-container" data-target-position="header" data-target-element="next"><div class="card-title html-fill-item html-fill-container"><span style="display: inline">
VOLCANO PLOT

</span></div>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb19" data-startfrom="898" data-source-offset="-40"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 897;"><span id="cb19-898"><a href="#cb19-898" aria-hidden="true" tabindex="-1"></a>viewof term_selection <span class="op">=</span> {</span>
<span id="cb19-899"><a href="#cb19-899" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>available_terms <span class="op">||</span> available_terms<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) <span class="cf">return</span> <span class="fu">md</span><span class="vs">`_Loading terms..._`</span><span class="op">;</span></span>
<span id="cb19-900"><a href="#cb19-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-901"><a href="#cb19-901" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">select</span>(available_terms<span class="op">,</span> {</span>
<span id="cb19-902"><a href="#cb19-902" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Available Terms:"</span><span class="op">,</span></span>
<span id="cb19-903"><a href="#cb19-903" aria-hidden="true" tabindex="-1"></a>    <span class="dt">multiple</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb19-904"><a href="#cb19-904" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size</span><span class="op">:</span> <span class="dv">3</span></span>
<span id="cb19-905"><a href="#cb19-905" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb19-906"><a href="#cb19-906" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-907"><a href="#cb19-907" aria-hidden="true" tabindex="-1"></a>viewof contrast_selection <span class="op">=</span> {</span>
<span id="cb19-908"><a href="#cb19-908" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>available_contrasts <span class="op">||</span> available_contrasts<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) <span class="cf">return</span> <span class="fu">md</span><span class="vs">`_Loading contrasts..._`</span><span class="op">;</span></span>
<span id="cb19-909"><a href="#cb19-909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-910"><a href="#cb19-910" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">select</span>(available_contrasts<span class="op">,</span> {</span>
<span id="cb19-911"><a href="#cb19-911" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Available Contrasts:"</span><span class="op">,</span></span>
<span id="cb19-912"><a href="#cb19-912" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="fu">replace</span>(<span class="st">" / "</span><span class="op">,</span> <span class="st">" vs. "</span>)<span class="op">,</span></span>
<span id="cb19-913"><a href="#cb19-913" aria-hidden="true" tabindex="-1"></a>    <span class="dt">multiple</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb19-914"><a href="#cb19-914" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size</span><span class="op">:</span> <span class="dv">3</span></span>
<span id="cb19-915"><a href="#cb19-915" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb19-916"><a href="#cb19-916" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-19-1" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-19-2" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
</div></div>
<div class="cell card-body html-fill-item html-fill-container" data-autorun="true" data-input="[&quot;volcano_plot_emit&quot;,&quot;argsVolcano&quot;,&quot;current_volcano_data&quot;]" data-define="[&quot;vplot_stats&quot;,&quot;vplot_plot&quot;,&quot;vplot_labels&quot;]">
<div class="html-fill-item html-fill-container">
<div id="webr-8" class="exercise-cell html-fill-item html-fill-container">

</div>
<script type="webr-8-contents">
eyJhdHRyIjp7ImF1dG9ydW4iOnRydWUsImRlZmluZSI6WyJ2cGxvdF9zdGF0cyIsInZwbG90X3Bsb3QiLCJ2cGxvdF9sYWJlbHMiXSwiZWNobyI6ZmFsc2UsImVkaXQiOmZhbHNlLCJldmFsIjp0cnVlLCJpbnB1dCI6WyJ2b2xjYW5vX3Bsb3RfZW1pdCIsImFyZ3NWb2xjYW5vIiwiY3VycmVudF92b2xjYW5vX2RhdGEiXSwid2FybmluZyI6ZmFsc2V9LCJjb2RlIjoiXG5pZighaW5oZXJpdHMoY3VycmVudF92b2xjYW5vX2RhdGEsIFwiZGF0YS5mcmFtZVwiKSAmJiBpcy5uYShjdXJyZW50X3ZvbGNhbm9fZGF0YSkpe1xuICAgIGNhdChcIldhaXRpbmcgb24gY29udHJhc3Qgc2VsZWN0aW9uLlwiKVxuICB2cGxvdF9zdGF0cyA8LSBcIlwiXG4gIHZwbG90X2xhYmVscyA8LSBjKClcbn0gZWxzZSB7XG4gIGFyZ3NDb21iaW5lZCA8LSBjKGxpc3QoZGY9Y3VycmVudF92b2xjYW5vX2RhdGEgJT4lIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0KGNvbnRyYXN0LCB0YXJnZXQsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZzJmYywgcC52YWx1ZSwgYW55X29mKGMoXCJuY2VsbHNfMVwiLCBcIm5jZWxsc18yXCIpKSkpLCBhcmdzVm9sY2FubylcbiAgdnBsb3RfcmVzdWx0IDwtIHJsYW5nOjpleGVjKFwicGxvdFZvbGNhbm9cIiwgISEhYXJnc0NvbWJpbmVkKVxuICB2cGxvdF9zdGF0cyA8LSB2cGxvdF9yZXN1bHRbWzJdXVxuICB2cGxvdF9wbG90IDwtIHZwbG90X3Jlc3VsdFtbMV1dXG4gIHZwbG90X2xhYmVscyA8LSB2cGxvdF9yZXN1bHRbWzNdXVxuICB2cGxvdF9wbG90XG59XG5cbiMgcHJpbnQoU3lzLnRpbWUoKSkifQ==
</script>
</div>
<!-- Save Image -->
</div>
<div class="cell card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb20" data-startfrom="960" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 959;"><span id="cb20-960"><a href="#cb20-960" aria-hidden="true" tabindex="-1"></a>viewof save_settings <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">form</span>({</span>
<span id="cb20-961"><a href="#cb20-961" aria-hidden="true" tabindex="-1"></a>  <span class="dt">width</span><span class="op">:</span>  Inputs<span class="op">.</span><span class="fu">number</span>({<span class="dt">label</span><span class="op">:</span> <span class="st">"Width"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">6</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="fl">0.5</span>})<span class="op">,</span></span>
<span id="cb20-962"><a href="#cb20-962" aria-hidden="true" tabindex="-1"></a>  <span class="dt">height</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">number</span>({<span class="dt">label</span><span class="op">:</span> <span class="st">"Height"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="fl">0.5</span>})<span class="op">,</span></span>
<span id="cb20-963"><a href="#cb20-963" aria-hidden="true" tabindex="-1"></a>  <span class="dt">units</span><span class="op">:</span>  Inputs<span class="op">.</span><span class="fu">select</span>([<span class="st">"in"</span><span class="op">,</span> <span class="st">"cm"</span><span class="op">,</span> <span class="st">"mm"</span><span class="op">,</span> <span class="st">"px"</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Units"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="st">"in"</span>})<span class="op">,</span></span>
<span id="cb20-964"><a href="#cb20-964" aria-hidden="true" tabindex="-1"></a>  <span class="dt">format</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">select</span>([<span class="st">"png"</span><span class="op">,</span> <span class="st">"svg"</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Format"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="st">"png"</span>})</span>
<span id="cb20-965"><a href="#cb20-965" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb20-966"><a href="#cb20-966" aria-hidden="true" tabindex="-1"></a>viewof save_btn <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">button</span>(<span class="st">"Download Plot"</span><span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">color</span><span class="op">:</span> <span class="st">"#2C3E50"</span>})</span>
<span id="cb20-967"><a href="#cb20-967" aria-hidden="true" tabindex="-1"></a>save_request <span class="op">=</span> {</span>
<span id="cb20-968"><a href="#cb20-968" aria-hidden="true" tabindex="-1"></a>  save_btn<span class="op">;</span> </span>
<span id="cb20-969"><a href="#cb20-969" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> save_settings<span class="op">;</span></span>
<span id="cb20-970"><a href="#cb20-970" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-20-1" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-20-2" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-20-3" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
</div>
<div class="cell card-body html-fill-item html-fill-container" data-autorun="true" data-input="[&quot;save_btn&quot;,&quot;save_request&quot;]" data-define="downloaded_file">
<div class="html-fill-item html-fill-container">
<div id="webr-9" class="exercise-cell html-fill-item html-fill-container">

</div>
<script type="webr-9-contents">
eyJhdHRyIjp7ImF1dG9ydW4iOnRydWUsImRlZmluZSI6WyJkb3dubG9hZGVkX2ZpbGUiXSwiZWNobyI6ZmFsc2UsImVkaXQiOmZhbHNlLCJldmFsIjp0cnVlLCJpbnB1dCI6WyJzYXZlX2J0biIsInNhdmVfcmVxdWVzdCJdfSwiY29kZSI6IlxuaWYoc2F2ZV9idG4+MCl7XG4gIGNhdCgnc2F2aW5nJylcbiAgZm5hbWUgPC0gcGFzdGUwKFwidm9sY2Fub19wbG90LlwiLCBzYXZlX3JlcXVlc3QkZm9ybWF0KVxuICBnZ3NhdmUoXG4gICAgZmlsZW5hbWUgPSBmbmFtZSwgXG4gICAgcGxvdCA9IHZwbG90X3Bsb3QsIFxuICAgIGRldmljZSA9IHNhdmVfcmVxdWVzdCRmb3JtYXQsXG4gICAgd2lkdGggPSBhcy5udW1lcmljKHNhdmVfcmVxdWVzdCR3aWR0aCksXG4gICAgaGVpZ2h0ID0gYXMubnVtZXJpYyhzYXZlX3JlcXVlc3QkaGVpZ2h0KSxcbiAgICB1bml0cyA9IHNhdmVfcmVxdWVzdCR1bml0c1xuICApXG4gIGlmKGZpbGUuZXhpc3RzKGZuYW1lKSl7XG4gICAgIyBjYXQocGFzdGUwKFwiZmlsZSBjcmVhdGVkOiBcIiwgZm5hbWUpKVxuICAgIGZpbGVfYnl0ZXMgPC0gcmVhZEJpbihmbmFtZSwgXCJyYXdcIiwgbiA9IGZpbGUuaW5mbyhmbmFtZSkkc2l6ZSlcbiAgICBkb3dubG9hZGVkX2ZpbGUgPC0gbGlzdChcbiAgICAgIGRhdGEgPSBmaWxlX2J5dGVzLFxuICAgICAgZmlsZW5hbWUgPSBmbmFtZSxcbiAgICAgIG1pbWUgPSBpZmVsc2Uoc2F2ZV9yZXF1ZXN0JGZvcm1hdCA9PSBcInN2Z1wiLCBcImltYWdlL3N2Zyt4bWxcIiwgXCJpbWFnZS9wbmdcIiksXG4gICAgICB0cyA9IGFzLmNoYXJhY3RlcihTeXMudGltZSgpKSAjIFRpbWVzdGFtcCB0byBmb3JjZSBPSlMgdXBkYXRlXG4gICAgKVxuICB9XG59In0=
</script>
</div>
</div>
<div class="cell hidden card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb21" data-startfrom="1009" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1008;"><span id="cb21-1009"><a href="#cb21-1009" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb21-1010"><a href="#cb21-1010" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (downloaded_file) {</span>
<span id="cb21-1011"><a href="#cb21-1011" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> blob <span class="op">=</span> <span class="kw">new</span> <span class="bu">Blob</span>([<span class="kw">new</span> <span class="bu">Uint8Array</span>(downloaded_file<span class="op">.</span><span class="at">data</span>)]<span class="op">,</span> { <span class="dt">type</span><span class="op">:</span> downloaded_file<span class="op">.</span><span class="at">mime</span> })<span class="op">;</span></span>
<span id="cb21-1012"><a href="#cb21-1012" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-1013"><a href="#cb21-1013" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> url <span class="op">=</span> URL<span class="op">.</span><span class="fu">createObjectURL</span>(blob)<span class="op">;</span></span>
<span id="cb21-1014"><a href="#cb21-1014" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> a <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"a"</span>)<span class="op">;</span></span>
<span id="cb21-1015"><a href="#cb21-1015" aria-hidden="true" tabindex="-1"></a>    a<span class="op">.</span><span class="at">href</span> <span class="op">=</span> url<span class="op">;</span></span>
<span id="cb21-1016"><a href="#cb21-1016" aria-hidden="true" tabindex="-1"></a>    a<span class="op">.</span><span class="at">download</span> <span class="op">=</span> downloaded_file<span class="op">.</span><span class="at">filename</span><span class="op">;</span></span>
<span id="cb21-1017"><a href="#cb21-1017" aria-hidden="true" tabindex="-1"></a>    <span class="bu">document</span><span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="fu">appendChild</span>(a)<span class="op">;</span></span>
<span id="cb21-1018"><a href="#cb21-1018" aria-hidden="true" tabindex="-1"></a>    a<span class="op">.</span><span class="fu">click</span>()<span class="op">;</span></span>
<span id="cb21-1019"><a href="#cb21-1019" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-1020"><a href="#cb21-1020" aria-hidden="true" tabindex="-1"></a>    <span class="bu">document</span><span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="fu">removeChild</span>(a)<span class="op">;</span></span>
<span id="cb21-1021"><a href="#cb21-1021" aria-hidden="true" tabindex="-1"></a>    URL<span class="op">.</span><span class="fu">revokeObjectURL</span>(url)<span class="op">;</span></span>
<span id="cb21-1022"><a href="#cb21-1022" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-1023"><a href="#cb21-1023" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div id="ojs-cell-21" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div>
</div>
</div>
</div><div id="marginal-means" class="dashboard-page tab-pane grid-skip html-fill-item html-fill-container" data-orientation="rows" aria-labelledby="tab-marginal-means">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, 40fr) minmax(3em, 60fr); grid-auto-columns: minmax(0, 1fr);">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-columns: minmax(3em, 50fr) minmax(3em, 50fr);
grid-auto-rows: minmax(0, 1fr);">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, 1fr); grid-auto-columns: minmax(0, 1fr);">
<div class="card html-fill-item html-fill-container bslib-card" data-title="Description" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-header"><div class="card-title html-fill-item html-fill-container"><span style="display: inline">
Description
</span></div></div>
<div class="card-body html-fill-item html-fill-container">
<p>This plot shows the estimated mean expression of a gene (<em>i.e.</em>, marginal means) between the pairwise contrast that is currently selected. This can help you gauge the magnitude of the difference between the two groups after accounting for any other variables in the model.</p>
<p>Like the volcano plot, the x-axis shows the log2 fold change. The y-axis shows marginal mean response (log2 transformed). Each gene is represented by up to two points (one for each level of the contrast) with error bars. When “vs rest” or “vs all” is selected, only a single level is shown.</p>
</div>
<div class="cell hidden card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb22" data-startfrom="1048" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1047;"><span id="cb22-1048"><a href="#cb22-1048" aria-hidden="true" tabindex="-1"></a>available_levels <span class="op">=</span> {</span>
<span id="cb22-1049"><a href="#cb22-1049" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> payload <span class="op">=</span> study_data_payload<span class="op">;</span></span>
<span id="cb22-1050"><a href="#cb22-1050" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Prevents OJS from crashing on local VFS paths</span></span>
<span id="cb22-1051"><a href="#cb22-1051" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>payload <span class="op">||</span> payload<span class="op">.</span><span class="at">type</span> <span class="op">===</span> <span class="st">"local"</span>) <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb22-1052"><a href="#cb22-1052" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-1053"><a href="#cb22-1053" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (payload<span class="op">.</span><span class="at">mode</span> <span class="op">===</span> <span class="st">"remote_js_bridge"</span>) {</span>
<span id="cb22-1054"><a href="#cb22-1054" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb22-1055"><a href="#cb22-1055" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> conn <span class="op">=</span> <span class="cf">await</span> duck_db_client<span class="op">;</span></span>
<span id="cb22-1056"><a href="#cb22-1056" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> query <span class="op">=</span> <span class="vs">`SELECT DISTINCT level FROM '</span><span class="sc">${</span>payload<span class="op">.</span><span class="at">url_emmeans</span><span class="sc">}</span><span class="vs">' ORDER BY level`</span><span class="op">;</span></span>
<span id="cb22-1057"><a href="#cb22-1057" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> result <span class="op">=</span> <span class="cf">await</span> conn<span class="op">.</span><span class="fu">query</span>(query)<span class="op">;</span></span>
<span id="cb22-1058"><a href="#cb22-1058" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> result<span class="op">.</span><span class="fu">toArray</span>()<span class="op">.</span><span class="fu">map</span>(row <span class="kw">=&gt;</span> row<span class="op">.</span><span class="at">level</span>)<span class="op">.</span><span class="fu">filter</span>(t <span class="kw">=&gt;</span> <span class="op">!</span>t<span class="op">.</span><span class="fu">startsWith</span>(<span class="st">"otherct_"</span>))<span class="op">;</span></span>
<span id="cb22-1059"><a href="#cb22-1059" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (e) {</span>
<span id="cb22-1060"><a href="#cb22-1060" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(<span class="st">"❌ Available Levels Fetch Error:"</span><span class="op">,</span> e)<span class="op">;</span></span>
<span id="cb22-1061"><a href="#cb22-1061" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> []<span class="op">;</span></span>
<span id="cb22-1062"><a href="#cb22-1062" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb22-1063"><a href="#cb22-1063" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb22-1064"><a href="#cb22-1064" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div id="ojs-cell-22" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell card-body html-fill-item html-fill-container" data-autorun="true" data-input="[&quot;study_data_payload&quot;,&quot;available_levels&quot;]" data-define="r_available_levels">
<div class="html-fill-item html-fill-container">
<div id="webr-10" class="exercise-cell html-fill-item html-fill-container">

</div>
<script type="webr-10-contents">
eyJhdHRyIjp7ImF1dG9ydW4iOnRydWUsImRlZmluZSI6WyJyX2F2YWlsYWJsZV9sZXZlbHMiXSwiZWNobyI6ZmFsc2UsImVkaXQiOmZhbHNlLCJldmFsIjp0cnVlLCJpbnB1dCI6WyJzdHVkeV9kYXRhX3BheWxvYWQiLCJhdmFpbGFibGVfbGV2ZWxzIl19LCJjb2RlIjoiXG5yX2F2YWlsYWJsZV9sZXZlbHMgPC0gTlVMTFxuaWYgKCFpcy5udWxsKHN0dWR5X2RhdGFfcGF5bG9hZCkpIHtcbiAgaWYgKHN0dWR5X2RhdGFfcGF5bG9hZCRtb2RlID09IFwicmVtb3RlX2pzX2JyaWRnZVwiKSB7XG4gICAgcl9hdmFpbGFibGVfbGV2ZWxzIDwtIGF2YWlsYWJsZV9sZXZlbHNcbiAgfSBlbHNlIHtcbiAgICBpZiAoZGJFeGlzdHNUYWJsZShjb24sIFwiZW1tZWFuc19kYXRhXCIpKSB7XG4gICAgICAgIGRmIDwtIGRiR2V0UXVlcnkoY29uLCBcIlNFTEVDVCBESVNUSU5DVCBsZXZlbCBGUk9NIGVtbWVhbnNfZGF0YSBPUkRFUiBCWSBsZXZlbFwiKVxuICAgICAgICByX2F2YWlsYWJsZV9sZXZlbHMgPC0gZGYkbGV2ZWxbIWdyZXBsKFwiXm90aGVyY3RfXCIsIGRmJGxldmVsKV1cbiAgICB9XG4gIH1cbn0ifQ==
</script>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div><div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, 1fr); grid-auto-columns: minmax(0, 1fr);">
<div class="card html-fill-item html-fill-container bslib-card" data-title="Controls" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-header"><div class="card-toolbar html-fill-item html-fill-container" data-target-position="header" data-target-element="next"><div class="card-title html-fill-item html-fill-container"><span style="display: inline">
Controls

</span></div>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb23" data-startfrom="1098" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1097;"><span id="cb23-1098"><a href="#cb23-1098" aria-hidden="true" tabindex="-1"></a>viewof term_copy <span class="op">=</span> {</span>
<span id="cb23-1099"><a href="#cb23-1099" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-1100"><a href="#cb23-1100" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>available_terms <span class="op">||</span> available_terms<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) <span class="cf">return</span> <span class="fu">md</span><span class="vs">`_Loading..._`</span><span class="op">;</span></span>
<span id="cb23-1101"><a href="#cb23-1101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-1102"><a href="#cb23-1102" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> mirror_input <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(available_terms<span class="op">,</span> {</span>
<span id="cb23-1103"><a href="#cb23-1103" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Available Terms:"</span><span class="op">,</span></span>
<span id="cb23-1104"><a href="#cb23-1104" aria-hidden="true" tabindex="-1"></a>    <span class="dt">multiple</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb23-1105"><a href="#cb23-1105" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size</span><span class="op">:</span> <span class="dv">3</span></span>
<span id="cb23-1106"><a href="#cb23-1106" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb23-1107"><a href="#cb23-1107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-1108"><a href="#cb23-1108" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">bind</span>(mirror_input<span class="op">,</span> viewof term_selection)<span class="op">;</span></span>
<span id="cb23-1109"><a href="#cb23-1109" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-1110"><a href="#cb23-1110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-1111"><a href="#cb23-1111" aria-hidden="true" tabindex="-1"></a>viewof contrast_copy <span class="op">=</span> {</span>
<span id="cb23-1112"><a href="#cb23-1112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-1113"><a href="#cb23-1113" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>available_contrasts <span class="op">||</span> available_contrasts<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) <span class="cf">return</span> <span class="fu">md</span><span class="vs">`_Loading..._`</span><span class="op">;</span></span>
<span id="cb23-1114"><a href="#cb23-1114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-1115"><a href="#cb23-1115" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> mirror_input <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(available_contrasts<span class="op">,</span> {</span>
<span id="cb23-1116"><a href="#cb23-1116" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Available Contrasts:"</span><span class="op">,</span></span>
<span id="cb23-1117"><a href="#cb23-1117" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="fu">replace</span>(<span class="st">" / "</span><span class="op">,</span> <span class="st">" vs. "</span>)<span class="op">,</span></span>
<span id="cb23-1118"><a href="#cb23-1118" aria-hidden="true" tabindex="-1"></a>    <span class="dt">multiple</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb23-1119"><a href="#cb23-1119" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size</span><span class="op">:</span> <span class="dv">3</span></span>
<span id="cb23-1120"><a href="#cb23-1120" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb23-1121"><a href="#cb23-1121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-1122"><a href="#cb23-1122" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">bind</span>(mirror_input<span class="op">,</span> viewof contrast_selection)<span class="op">;</span></span>
<span id="cb23-1123"><a href="#cb23-1123" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-23-1" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-23-2" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
</div></div>
<div class="cell card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb24" data-startfrom="1131" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1130;"><span id="cb24-1131"><a href="#cb24-1131" aria-hidden="true" tabindex="-1"></a>viewof means_raw <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">form</span>({</span>
<span id="cb24-1132"><a href="#cb24-1132" aria-hidden="true" tabindex="-1"></a>  <span class="dt">means_highlight</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">text</span>({<span class="dt">label</span><span class="op">:</span> <span class="st">"Highlight Target:"</span><span class="op">,</span> <span class="dt">placeholder</span><span class="op">:</span> <span class="st">"e.g. A1BG,A1CF"</span>})<span class="op">,</span></span>
<span id="cb24-1133"><a href="#cb24-1133" aria-hidden="true" tabindex="-1"></a>  <span class="dt">means_show_labeled</span><span class="op">:</span>       Inputs<span class="op">.</span><span class="fu">toggle</span>({<span class="dt">label</span><span class="op">:</span> <span class="st">"Also highlight Volcano-labeled Genes"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="kw">true</span>})<span class="op">,</span></span>
<span id="cb24-1134"><a href="#cb24-1134" aria-hidden="true" tabindex="-1"></a>  <span class="dt">means_alpha</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.1</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="fl">0.8</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="fl">0.1</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Dot Transparency"</span>})<span class="op">,</span></span>
<span id="cb24-1135"><a href="#cb24-1135" aria-hidden="true" tabindex="-1"></a>  <span class="dt">means_color_1</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">color</span>({<span class="dt">label</span><span class="op">:</span> <span class="st">"Level 1 Color"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="st">"#e15759"</span>})<span class="op">,</span></span>
<span id="cb24-1136"><a href="#cb24-1136" aria-hidden="true" tabindex="-1"></a>  <span class="dt">means_color_2</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">color</span>({<span class="dt">label</span><span class="op">:</span> <span class="st">"Level 2 Color"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="st">"#4e79a7"</span>})</span>
<span id="cb24-1137"><a href="#cb24-1137" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb24-1138"><a href="#cb24-1138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1139"><a href="#cb24-1139" aria-hidden="true" tabindex="-1"></a>means_debounced <span class="op">=</span> {</span>
<span id="cb24-1140"><a href="#cb24-1140" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> raw <span class="op">=</span> means_raw<span class="op">;</span></span>
<span id="cb24-1141"><a href="#cb24-1141" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="kw">new</span> <span class="bu">Promise</span>(resolve <span class="kw">=&gt;</span> {</span>
<span id="cb24-1142"><a href="#cb24-1142" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> timer <span class="op">=</span> <span class="pp">setTimeout</span>(() <span class="kw">=&gt;</span> <span class="fu">resolve</span>(raw)<span class="op">,</span> <span class="dv">600</span>)<span class="op">;</span> </span>
<span id="cb24-1143"><a href="#cb24-1143" aria-hidden="true" tabindex="-1"></a>    invalidation<span class="op">.</span><span class="fu">then</span>(() <span class="kw">=&gt;</span> <span class="pp">clearTimeout</span>(timer))<span class="op">;</span></span>
<span id="cb24-1144"><a href="#cb24-1144" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb24-1145"><a href="#cb24-1145" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-1146"><a href="#cb24-1146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1147"><a href="#cb24-1147" aria-hidden="true" tabindex="-1"></a>means_highlight       <span class="op">=</span> means_debounced<span class="op">.</span><span class="at">means_highlight</span></span>
<span id="cb24-1148"><a href="#cb24-1148" aria-hidden="true" tabindex="-1"></a>means_show_labeled    <span class="op">=</span> means_debounced<span class="op">.</span><span class="at">means_show_labeled</span></span>
<span id="cb24-1149"><a href="#cb24-1149" aria-hidden="true" tabindex="-1"></a>means_alpha           <span class="op">=</span> means_debounced<span class="op">.</span><span class="at">means_alpha</span></span>
<span id="cb24-1150"><a href="#cb24-1150" aria-hidden="true" tabindex="-1"></a>means_color_1         <span class="op">=</span> means_debounced<span class="op">.</span><span class="at">means_color_1</span></span>
<span id="cb24-1151"><a href="#cb24-1151" aria-hidden="true" tabindex="-1"></a>means_color_2         <span class="op">=</span> means_debounced<span class="op">.</span><span class="at">means_color_2</span></span>
<span id="cb24-1152"><a href="#cb24-1152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1153"><a href="#cb24-1153" aria-hidden="true" tabindex="-1"></a>combined_selection <span class="op">=</span> {</span>
<span id="cb24-1154"><a href="#cb24-1154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1155"><a href="#cb24-1155" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> manual <span class="op">=</span> means_highlight </span>
<span id="cb24-1156"><a href="#cb24-1156" aria-hidden="true" tabindex="-1"></a>    <span class="op">?</span> means_highlight<span class="op">.</span><span class="fu">toUpperCase</span>()<span class="op">.</span><span class="fu">split</span>(<span class="st">','</span>)<span class="op">.</span><span class="fu">map</span>(s <span class="kw">=&gt;</span> s<span class="op">.</span><span class="fu">trim</span>())<span class="op">.</span><span class="fu">filter</span>(s <span class="kw">=&gt;</span> s<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span>) </span>
<span id="cb24-1157"><a href="#cb24-1157" aria-hidden="true" tabindex="-1"></a>    <span class="op">:</span> []<span class="op">;</span></span>
<span id="cb24-1158"><a href="#cb24-1158" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-1159"><a href="#cb24-1159" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> from_volcano <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb24-1160"><a href="#cb24-1160" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (means_show_labeled <span class="op">&amp;&amp;</span> <span class="kw">typeof</span> vplot_labels <span class="op">!==</span> <span class="st">"undefined"</span>) {</span>
<span id="cb24-1161"><a href="#cb24-1161" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="bu">Array</span><span class="op">.</span><span class="fu">isArray</span>(vplot_labels)) {</span>
<span id="cb24-1162"><a href="#cb24-1162" aria-hidden="true" tabindex="-1"></a>        from_volcano <span class="op">=</span> vplot_labels<span class="op">;</span></span>
<span id="cb24-1163"><a href="#cb24-1163" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (<span class="kw">typeof</span> vplot_labels <span class="op">===</span> <span class="st">'string'</span>) {</span>
<span id="cb24-1164"><a href="#cb24-1164" aria-hidden="true" tabindex="-1"></a>        from_volcano <span class="op">=</span> [vplot_labels]<span class="op">;</span></span>
<span id="cb24-1165"><a href="#cb24-1165" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb24-1166"><a href="#cb24-1166" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-1167"><a href="#cb24-1167" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-1168"><a href="#cb24-1168" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(<span class="kw">new</span> <span class="bu">Set</span>([<span class="op">...</span>manual<span class="op">,</span> <span class="op">...</span>from_volcano]))<span class="op">;</span></span>
<span id="cb24-1169"><a href="#cb24-1169" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-1170"><a href="#cb24-1170" aria-hidden="true" tabindex="-1"></a>means_level <span class="op">=</span> {</span>
<span id="cb24-1171"><a href="#cb24-1171" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> contrast <span class="op">=</span> contrast_selection<span class="op">;</span></span>
<span id="cb24-1172"><a href="#cb24-1172" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>contrast) <span class="cf">return</span> []<span class="op">;</span></span>
<span id="cb24-1173"><a href="#cb24-1173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1174"><a href="#cb24-1174" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> contrast<span class="op">.</span><span class="fu">split</span>(<span class="ss">/</span><span class="sc">\/|</span><span class="ss">vs</span><span class="sc">\.</span><span class="ss">/</span>)<span class="op">.</span><span class="fu">map</span>(s <span class="kw">=&gt;</span> s<span class="op">.</span><span class="fu">trim</span>())<span class="op">;</span></span>
<span id="cb24-1175"><a href="#cb24-1175" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-24-1" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-24-2" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-24-3" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-24-4" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-24-5" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-24-6" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-24-7" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-24-8" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-24-9" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div>
</div>
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-columns: minmax(3em, 50fr) minmax(3em, 50fr);
grid-auto-rows: minmax(0, 1fr);">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, 1fr); grid-auto-columns: minmax(0, 1fr);">
<div class="card html-fill-item html-fill-container bslib-card" data-title="Marginal Means Plot" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-header"><div class="card-title html-fill-item html-fill-container"><span style="display: inline">
Marginal Means Plot
</span></div></div>
<div class="cell card-body html-fill-item html-fill-container" data-input="means_search">
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb25" data-startfrom="1188" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1187;"><span id="cb25-1188"><a href="#cb25-1188" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb25-1189"><a href="#cb25-1189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1190"><a href="#cb25-1190" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>means_search <span class="op">||</span> means_search<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb25-1191"><a href="#cb25-1191" aria-hidden="true" tabindex="-1"></a>    <span class="kw">yield</span> <span class="fu">html</span><span class="vs">`&lt;div style="height:400px; display:flex; align-items:center; justify-content:center; background:#f9f9f9; border:1px border-radius:8px;"&gt;</span></span>
<span id="cb25-1192"><a href="#cb25-1192" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;p style="color:#888;"&gt;Select levels in the sidebar to visualize...&lt;/p&gt;</span></span>
<span id="cb25-1193"><a href="#cb25-1193" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/div&gt;`</span><span class="op">;</span></span>
<span id="cb25-1194"><a href="#cb25-1194" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb25-1195"><a href="#cb25-1195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1196"><a href="#cb25-1196" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> colorScale <span class="op">=</span> d3<span class="op">.</span><span class="at">schemeTableau10</span><span class="op">;</span></span>
<span id="cb25-1197"><a href="#cb25-1197" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-1198"><a href="#cb25-1198" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> table_targets <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb25-1199"><a href="#cb25-1199" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-1200"><a href="#cb25-1200" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="kw">typeof</span> means_table <span class="op">!==</span> <span class="st">"undefined"</span> <span class="op">&amp;&amp;</span> means_table <span class="op">&amp;&amp;</span> means_search) {</span>
<span id="cb25-1201"><a href="#cb25-1201" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (means_table<span class="op">.</span><span class="at">length</span> <span class="op">!==</span> means_search<span class="op">.</span><span class="at">length</span>) {</span>
<span id="cb25-1202"><a href="#cb25-1202" aria-hidden="true" tabindex="-1"></a>          table_targets <span class="op">=</span> means_table<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">target</span>)<span class="op">;</span></span>
<span id="cb25-1203"><a href="#cb25-1203" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb25-1204"><a href="#cb25-1204" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb25-1205"><a href="#cb25-1205" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-1206"><a href="#cb25-1206" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> manual_targets <span class="op">=</span> combined_selection <span class="op">||</span> []<span class="op">;</span></span>
<span id="cb25-1207"><a href="#cb25-1207" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-1208"><a href="#cb25-1208" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> highlight_list <span class="op">=</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(<span class="kw">new</span> <span class="bu">Set</span>([<span class="op">...</span>table_targets<span class="op">,</span> <span class="op">...</span>manual_targets]))<span class="op">;</span></span>
<span id="cb25-1209"><a href="#cb25-1209" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-1210"><a href="#cb25-1210" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> targetGroups <span class="op">=</span> d3<span class="op">.</span><span class="fu">groups</span>(means_search<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">target</span>)<span class="op">;</span></span>
<span id="cb25-1211"><a href="#cb25-1211" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-1212"><a href="#cb25-1212" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> levels <span class="op">=</span> [<span class="op">...</span><span class="kw">new</span> <span class="bu">Set</span>(means_search<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">level</span>))]<span class="op">.</span><span class="fu">sort</span>()<span class="op">;</span></span>
<span id="cb25-1213"><a href="#cb25-1213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1214"><a href="#cb25-1214" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> traces <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb25-1215"><a href="#cb25-1215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1216"><a href="#cb25-1216" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> alpha_scaler <span class="op">=</span> means_alpha<span class="op">;</span></span>
<span id="cb25-1217"><a href="#cb25-1217" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> line_segments_high <span class="op">=</span> { <span class="dt">x</span><span class="op">:</span> []<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> []<span class="op">,</span> <span class="dt">hoverinfo</span><span class="op">:</span> <span class="st">'skip'</span><span class="op">,</span> <span class="dt">showlegend</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span> <span class="dt">mode</span><span class="op">:</span> <span class="st">'lines'</span><span class="op">,</span> <span class="dt">line</span><span class="op">:</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">'#888'</span><span class="op">,</span> <span class="dt">width</span><span class="op">:</span> <span class="fl">1.5</span>}<span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> <span class="fl">0.8</span> <span class="op">*</span> alpha_scaler<span class="op">,</span> <span class="dt">type</span><span class="op">:</span> <span class="st">'scatter'</span> }<span class="op">;</span> </span>
<span id="cb25-1218"><a href="#cb25-1218" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> line_segments_med  <span class="op">=</span> { <span class="dt">x</span><span class="op">:</span> []<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> []<span class="op">,</span> <span class="dt">hoverinfo</span><span class="op">:</span> <span class="st">'skip'</span><span class="op">,</span> <span class="dt">showlegend</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span> <span class="dt">mode</span><span class="op">:</span> <span class="st">'lines'</span><span class="op">,</span> <span class="dt">line</span><span class="op">:</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">'#888'</span><span class="op">,</span> <span class="dt">width</span><span class="op">:</span> <span class="dv">1</span>}<span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> <span class="fl">0.4</span> <span class="op">*</span> alpha_scaler<span class="op">,</span> <span class="dt">type</span><span class="op">:</span> <span class="st">'scatter'</span> }<span class="op">;</span></span>
<span id="cb25-1219"><a href="#cb25-1219" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> line_segments_low  <span class="op">=</span> { <span class="dt">x</span><span class="op">:</span> []<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> []<span class="op">,</span> <span class="dt">hoverinfo</span><span class="op">:</span> <span class="st">'skip'</span><span class="op">,</span> <span class="dt">showlegend</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span> <span class="dt">mode</span><span class="op">:</span> <span class="st">'lines'</span><span class="op">,</span> <span class="dt">line</span><span class="op">:</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">'#ccc'</span><span class="op">,</span> <span class="dt">width</span><span class="op">:</span> <span class="dv">1</span>}<span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> <span class="fl">0.3</span> <span class="op">*</span> alpha_scaler<span class="op">,</span> <span class="dt">type</span><span class="op">:</span> <span class="st">'scatter'</span> }<span class="op">;</span></span>
<span id="cb25-1220"><a href="#cb25-1220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1221"><a href="#cb25-1221" aria-hidden="true" tabindex="-1"></a>    targetGroups<span class="op">.</span><span class="fu">forEach</span>(([target<span class="op">,</span> values]) <span class="kw">=&gt;</span> {</span>
<span id="cb25-1222"><a href="#cb25-1222" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(values<span class="op">.</span><span class="at">length</span> <span class="op">&lt;</span> <span class="dv">2</span>) <span class="cf">return</span><span class="op">;</span></span>
<span id="cb25-1223"><a href="#cb25-1223" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb25-1224"><a href="#cb25-1224" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> v1 <span class="op">=</span> values[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb25-1225"><a href="#cb25-1225" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> x <span class="op">=</span> v1<span class="op">.</span><span class="at">log2fc</span><span class="op">;</span></span>
<span id="cb25-1226"><a href="#cb25-1226" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(x <span class="op">==</span> <span class="kw">null</span> <span class="op">||</span> <span class="pp">isNaN</span>(x)) <span class="cf">return</span><span class="op">;</span></span>
<span id="cb25-1227"><a href="#cb25-1227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1228"><a href="#cb25-1228" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Transform Response to Log2 for Y-axis</span></span>
<span id="cb25-1229"><a href="#cb25-1229" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> ys <span class="op">=</span> values<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log2</span>(d<span class="op">.</span><span class="at">response</span>))<span class="op">;</span> </span>
<span id="cb25-1230"><a href="#cb25-1230" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb25-1231"><a href="#cb25-1231" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> min_y <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="op">...</span>ys)<span class="op">;</span></span>
<span id="cb25-1232"><a href="#cb25-1232" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> max_y <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="op">...</span>ys)<span class="op">;</span></span>
<span id="cb25-1233"><a href="#cb25-1233" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb25-1234"><a href="#cb25-1234" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> val_p <span class="op">=</span> v1[<span class="st">"p.value"</span>]<span class="op">;</span></span>
<span id="cb25-1235"><a href="#cb25-1235" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> p <span class="op">=</span> val_p <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> val_p <span class="op">:</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb25-1236"><a href="#cb25-1236" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb25-1237"><a href="#cb25-1237" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> seg <span class="op">=</span> line_segments_low<span class="op">;</span></span>
<span id="cb25-1238"><a href="#cb25-1238" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(p <span class="op">&lt;</span> <span class="fl">0.001</span>) seg <span class="op">=</span> line_segments_high<span class="op">;</span></span>
<span id="cb25-1239"><a href="#cb25-1239" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> <span class="cf">if</span>(p <span class="op">&lt;</span> <span class="fl">0.05</span>) seg <span class="op">=</span> line_segments_med<span class="op">;</span></span>
<span id="cb25-1240"><a href="#cb25-1240" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb25-1241"><a href="#cb25-1241" aria-hidden="true" tabindex="-1"></a>      seg<span class="op">.</span><span class="at">x</span><span class="op">.</span><span class="fu">push</span>(x<span class="op">,</span> x<span class="op">,</span> <span class="kw">null</span>)<span class="op">;</span></span>
<span id="cb25-1242"><a href="#cb25-1242" aria-hidden="true" tabindex="-1"></a>      seg<span class="op">.</span><span class="at">y</span><span class="op">.</span><span class="fu">push</span>(min_y<span class="op">,</span> max_y<span class="op">,</span> <span class="kw">null</span>)<span class="op">;</span></span>
<span id="cb25-1243"><a href="#cb25-1243" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb25-1244"><a href="#cb25-1244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1245"><a href="#cb25-1245" aria-hidden="true" tabindex="-1"></a>    traces<span class="op">.</span><span class="fu">push</span>(line_segments_low<span class="op">,</span> line_segments_med<span class="op">,</span> line_segments_high)<span class="op">;</span></span>
<span id="cb25-1246"><a href="#cb25-1246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1247"><a href="#cb25-1247" aria-hidden="true" tabindex="-1"></a>    levels<span class="op">.</span><span class="fu">forEach</span>((lvl<span class="op">,</span> i) <span class="kw">=&gt;</span> {</span>
<span id="cb25-1248"><a href="#cb25-1248" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> color <span class="op">=</span> (i <span class="op">===</span> <span class="dv">0</span>) <span class="op">?</span> means_color_1 <span class="op">:</span> means_color_2<span class="op">;</span> </span>
<span id="cb25-1249"><a href="#cb25-1249" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-1250"><a href="#cb25-1250" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> lvl_trace <span class="op">=</span> {</span>
<span id="cb25-1251"><a href="#cb25-1251" aria-hidden="true" tabindex="-1"></a>          <span class="dt">x</span><span class="op">:</span> []<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> []<span class="op">,</span> <span class="dt">text</span><span class="op">:</span> []<span class="op">,</span> <span class="dt">ids</span><span class="op">:</span> []<span class="op">,</span></span>
<span id="cb25-1252"><a href="#cb25-1252" aria-hidden="true" tabindex="-1"></a>          <span class="dt">mode</span><span class="op">:</span> <span class="st">'markers'</span><span class="op">,</span></span>
<span id="cb25-1253"><a href="#cb25-1253" aria-hidden="true" tabindex="-1"></a>          <span class="dt">type</span><span class="op">:</span> <span class="st">'scatter'</span><span class="op">,</span></span>
<span id="cb25-1254"><a href="#cb25-1254" aria-hidden="true" tabindex="-1"></a>          <span class="dt">name</span><span class="op">:</span> lvl<span class="op">,</span> </span>
<span id="cb25-1255"><a href="#cb25-1255" aria-hidden="true" tabindex="-1"></a>          <span class="dt">marker</span><span class="op">:</span> { <span class="dt">color</span><span class="op">:</span> color<span class="op">,</span> <span class="dt">size</span><span class="op">:</span> <span class="dv">6</span><span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> means_alpha }<span class="op">,</span></span>
<span id="cb25-1256"><a href="#cb25-1256" aria-hidden="true" tabindex="-1"></a>          <span class="dt">error_y</span><span class="op">:</span> {</span>
<span id="cb25-1257"><a href="#cb25-1257" aria-hidden="true" tabindex="-1"></a>            <span class="dt">type</span><span class="op">:</span> <span class="st">'data'</span><span class="op">,</span> <span class="dt">symmetric</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span> <span class="dt">array</span><span class="op">:</span> []<span class="op">,</span> <span class="dt">arrayminus</span><span class="op">:</span> []<span class="op">,</span></span>
<span id="cb25-1258"><a href="#cb25-1258" aria-hidden="true" tabindex="-1"></a>            <span class="dt">visible</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">color</span><span class="op">:</span> color<span class="op">,</span> <span class="dt">thickness</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">width</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> <span class="fl">0.6</span></span>
<span id="cb25-1259"><a href="#cb25-1259" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb25-1260"><a href="#cb25-1260" aria-hidden="true" tabindex="-1"></a>        }<span class="op">;</span></span>
<span id="cb25-1261"><a href="#cb25-1261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1262"><a href="#cb25-1262" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> lvlData <span class="op">=</span> means_search<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">level</span> <span class="op">===</span> lvl)<span class="op">;</span></span>
<span id="cb25-1263"><a href="#cb25-1263" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-1264"><a href="#cb25-1264" aria-hidden="true" tabindex="-1"></a>        lvlData<span class="op">.</span><span class="fu">forEach</span>(d <span class="kw">=&gt;</span> {</span>
<span id="cb25-1265"><a href="#cb25-1265" aria-hidden="true" tabindex="-1"></a>           <span class="cf">if</span> (d<span class="op">.</span><span class="at">log2fc</span> <span class="op">==</span> <span class="kw">null</span> <span class="op">||</span> <span class="pp">isNaN</span>(d<span class="op">.</span><span class="at">log2fc</span>)) <span class="cf">return</span><span class="op">;</span></span>
<span id="cb25-1266"><a href="#cb25-1266" aria-hidden="true" tabindex="-1"></a>           </span>
<span id="cb25-1267"><a href="#cb25-1267" aria-hidden="true" tabindex="-1"></a>           <span class="co">// Log2 Transformation</span></span>
<span id="cb25-1268"><a href="#cb25-1268" aria-hidden="true" tabindex="-1"></a>           <span class="kw">const</span> y_log <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log2</span>(d<span class="op">.</span><span class="at">response</span>)<span class="op">;</span></span>
<span id="cb25-1269"><a href="#cb25-1269" aria-hidden="true" tabindex="-1"></a>           <span class="kw">const</span> ucl_log <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log2</span>(d<span class="op">.</span><span class="at">UCL</span>)<span class="op">;</span></span>
<span id="cb25-1270"><a href="#cb25-1270" aria-hidden="true" tabindex="-1"></a>           <span class="kw">const</span> lcl_log <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log2</span>(d<span class="op">.</span><span class="at">LCL</span>)<span class="op">;</span></span>
<span id="cb25-1271"><a href="#cb25-1271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1272"><a href="#cb25-1272" aria-hidden="true" tabindex="-1"></a>           lvl_trace<span class="op">.</span><span class="at">x</span><span class="op">.</span><span class="fu">push</span>(d<span class="op">.</span><span class="at">log2fc</span>)<span class="op">;</span></span>
<span id="cb25-1273"><a href="#cb25-1273" aria-hidden="true" tabindex="-1"></a>           lvl_trace<span class="op">.</span><span class="at">y</span><span class="op">.</span><span class="fu">push</span>(y_log)<span class="op">;</span></span>
<span id="cb25-1274"><a href="#cb25-1274" aria-hidden="true" tabindex="-1"></a>           lvl_trace<span class="op">.</span><span class="at">text</span><span class="op">.</span><span class="fu">push</span>(<span class="vs">`&lt;b&gt;</span><span class="sc">${</span>d<span class="op">.</span><span class="at">target</span><span class="sc">}</span><span class="vs">&lt;/b&gt;&lt;br&gt;Level: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">level</span><span class="sc">}</span><span class="vs">&lt;br&gt;Log2 Resp: </span><span class="sc">${</span>y_log<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs">&lt;br&gt;FC: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">log2fc</span><span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb25-1275"><a href="#cb25-1275" aria-hidden="true" tabindex="-1"></a>           lvl_trace<span class="op">.</span><span class="at">ids</span><span class="op">.</span><span class="fu">push</span>(<span class="vs">`</span><span class="sc">${</span>d<span class="op">.</span><span class="at">target</span><span class="sc">}</span><span class="vs">_</span><span class="sc">${</span>d<span class="op">.</span><span class="at">level</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb25-1276"><a href="#cb25-1276" aria-hidden="true" tabindex="-1"></a>           </span>
<span id="cb25-1277"><a href="#cb25-1277" aria-hidden="true" tabindex="-1"></a>           lvl_trace<span class="op">.</span><span class="at">error_y</span><span class="op">.</span><span class="at">array</span><span class="op">.</span><span class="fu">push</span>(ucl_log <span class="op">-</span> y_log)<span class="op">;</span></span>
<span id="cb25-1278"><a href="#cb25-1278" aria-hidden="true" tabindex="-1"></a>           lvl_trace<span class="op">.</span><span class="at">error_y</span><span class="op">.</span><span class="at">arrayminus</span><span class="op">.</span><span class="fu">push</span>(y_log <span class="op">-</span> lcl_log)<span class="op">;</span></span>
<span id="cb25-1279"><a href="#cb25-1279" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb25-1280"><a href="#cb25-1280" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-1281"><a href="#cb25-1281" aria-hidden="true" tabindex="-1"></a>        traces<span class="op">.</span><span class="fu">push</span>(lvl_trace)<span class="op">;</span></span>
<span id="cb25-1282"><a href="#cb25-1282" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb25-1283"><a href="#cb25-1283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1284"><a href="#cb25-1284" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(highlight_list<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb25-1285"><a href="#cb25-1285" aria-hidden="true" tabindex="-1"></a>       <span class="kw">const</span> highlightData <span class="op">=</span> means_search<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> highlight_list<span class="op">.</span><span class="fu">includes</span>(d<span class="op">.</span><span class="at">target</span>) <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">log2fc</span> <span class="op">!=</span> <span class="kw">null</span>)<span class="op">;</span></span>
<span id="cb25-1286"><a href="#cb25-1286" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb25-1287"><a href="#cb25-1287" aria-hidden="true" tabindex="-1"></a>        traces<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb25-1288"><a href="#cb25-1288" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> highlightData<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">log2fc</span>)<span class="op">,</span></span>
<span id="cb25-1289"><a href="#cb25-1289" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> highlightData<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log2</span>(d<span class="op">.</span><span class="at">response</span>))<span class="op">,</span></span>
<span id="cb25-1290"><a href="#cb25-1290" aria-hidden="true" tabindex="-1"></a>        <span class="dt">mode</span><span class="op">:</span> <span class="st">'markers+text'</span><span class="op">,</span></span>
<span id="cb25-1291"><a href="#cb25-1291" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">'scatter'</span><span class="op">,</span> </span>
<span id="cb25-1292"><a href="#cb25-1292" aria-hidden="true" tabindex="-1"></a>        <span class="dt">name</span><span class="op">:</span> <span class="st">'Highlights'</span><span class="op">,</span></span>
<span id="cb25-1293"><a href="#cb25-1293" aria-hidden="true" tabindex="-1"></a>        <span class="dt">text</span><span class="op">:</span> highlightData<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">target</span>)<span class="op">,</span></span>
<span id="cb25-1294"><a href="#cb25-1294" aria-hidden="true" tabindex="-1"></a>        <span class="dt">textposition</span><span class="op">:</span> <span class="st">'top center'</span><span class="op">,</span></span>
<span id="cb25-1295"><a href="#cb25-1295" aria-hidden="true" tabindex="-1"></a>        <span class="dt">textfont</span><span class="op">:</span> { <span class="dt">color</span><span class="op">:</span> <span class="st">'black'</span><span class="op">,</span> <span class="dt">size</span><span class="op">:</span> <span class="dv">11</span><span class="op">,</span> <span class="dt">weight</span><span class="op">:</span> <span class="st">'bold'</span> }<span class="op">,</span></span>
<span id="cb25-1296"><a href="#cb25-1296" aria-hidden="true" tabindex="-1"></a>        <span class="dt">marker</span><span class="op">:</span> { <span class="dt">color</span><span class="op">:</span> <span class="st">'black'</span><span class="op">,</span> <span class="dt">size</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dt">symbol</span><span class="op">:</span> <span class="st">'circle-open'</span><span class="op">,</span> <span class="dt">line</span><span class="op">:</span> {<span class="dt">width</span><span class="op">:</span> <span class="dv">2</span>} }<span class="op">,</span></span>
<span id="cb25-1297"><a href="#cb25-1297" aria-hidden="true" tabindex="-1"></a>        <span class="dt">hoverinfo</span><span class="op">:</span> <span class="st">'skip'</span><span class="op">,</span></span>
<span id="cb25-1298"><a href="#cb25-1298" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cliponaxis</span><span class="op">:</span> <span class="kw">false</span></span>
<span id="cb25-1299"><a href="#cb25-1299" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb25-1300"><a href="#cb25-1300" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb25-1301"><a href="#cb25-1301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1302"><a href="#cb25-1302" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> layout <span class="op">=</span> {</span>
<span id="cb25-1303"><a href="#cb25-1303" aria-hidden="true" tabindex="-1"></a>      <span class="dt">height</span><span class="op">:</span> <span class="dv">500</span><span class="op">,</span></span>
<span id="cb25-1304"><a href="#cb25-1304" aria-hidden="true" tabindex="-1"></a>      <span class="dt">margin</span><span class="op">:</span> { <span class="dt">t</span><span class="op">:</span> <span class="dv">30</span><span class="op">,</span> <span class="dt">b</span><span class="op">:</span> <span class="dv">50</span><span class="op">,</span> <span class="dt">l</span><span class="op">:</span> <span class="dv">60</span><span class="op">,</span> <span class="dt">r</span><span class="op">:</span> <span class="dv">20</span> }<span class="op">,</span></span>
<span id="cb25-1305"><a href="#cb25-1305" aria-hidden="true" tabindex="-1"></a>      <span class="dt">hovermode</span><span class="op">:</span> <span class="st">'closest'</span><span class="op">,</span></span>
<span id="cb25-1306"><a href="#cb25-1306" aria-hidden="true" tabindex="-1"></a>      <span class="dt">title</span><span class="op">:</span> { <span class="dt">text</span><span class="op">:</span> <span class="st">'Marginal Means vs Fold Change'</span><span class="op">,</span> <span class="dt">font</span><span class="op">:</span> {<span class="dt">size</span><span class="op">:</span> <span class="dv">14</span>} }<span class="op">,</span></span>
<span id="cb25-1307"><a href="#cb25-1307" aria-hidden="true" tabindex="-1"></a>      <span class="dt">xaxis</span><span class="op">:</span> { </span>
<span id="cb25-1308"><a href="#cb25-1308" aria-hidden="true" tabindex="-1"></a>        <span class="dt">title</span><span class="op">:</span> <span class="st">'Log2 Fold Change (Contrast)'</span><span class="op">,</span> </span>
<span id="cb25-1309"><a href="#cb25-1309" aria-hidden="true" tabindex="-1"></a>        <span class="dt">zeroline</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> </span>
<span id="cb25-1310"><a href="#cb25-1310" aria-hidden="true" tabindex="-1"></a>        <span class="dt">zerolinecolor</span><span class="op">:</span> <span class="st">'#eee'</span><span class="op">,</span></span>
<span id="cb25-1311"><a href="#cb25-1311" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gridcolor</span><span class="op">:</span> <span class="st">'#f9f9f9'</span></span>
<span id="cb25-1312"><a href="#cb25-1312" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb25-1313"><a href="#cb25-1313" aria-hidden="true" tabindex="-1"></a>      <span class="dt">yaxis</span><span class="op">:</span> { </span>
<span id="cb25-1314"><a href="#cb25-1314" aria-hidden="true" tabindex="-1"></a>        <span class="dt">title</span><span class="op">:</span> <span class="st">'Log2 Expression (Response)'</span><span class="op">,</span> </span>
<span id="cb25-1315"><a href="#cb25-1315" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gridcolor</span><span class="op">:</span> <span class="st">'#f9f9f9'</span><span class="op">,</span></span>
<span id="cb25-1316"><a href="#cb25-1316" aria-hidden="true" tabindex="-1"></a>        <span class="dt">zeroline</span><span class="op">:</span> <span class="kw">false</span></span>
<span id="cb25-1317"><a href="#cb25-1317" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb25-1318"><a href="#cb25-1318" aria-hidden="true" tabindex="-1"></a>      <span class="dt">legend</span><span class="op">:</span> { <span class="dt">orientation</span><span class="op">:</span> <span class="st">'h'</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="op">-</span><span class="fl">0.15</span> }<span class="op">,</span></span>
<span id="cb25-1319"><a href="#cb25-1319" aria-hidden="true" tabindex="-1"></a>      <span class="dt">showlegend</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb25-1320"><a href="#cb25-1320" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb25-1321"><a href="#cb25-1321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1322"><a href="#cb25-1322" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> div <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb25-1323"><a href="#cb25-1323" aria-hidden="true" tabindex="-1"></a>    Plotly<span class="op">.</span><span class="fu">newPlot</span>(div<span class="op">,</span> traces<span class="op">,</span> layout<span class="op">,</span> { <span class="dt">responsive</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">displayModeBar</span><span class="op">:</span> <span class="kw">true</span> })<span class="op">;</span></span>
<span id="cb25-1324"><a href="#cb25-1324" aria-hidden="true" tabindex="-1"></a>    <span class="kw">yield</span> div<span class="op">;</span></span>
<span id="cb25-1325"><a href="#cb25-1325" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb25-1326"><a href="#cb25-1326" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div id="ojs-cell-25" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div><div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, 1fr); grid-auto-columns: minmax(0, 1fr);">
<div class="card html-fill-item html-fill-container bslib-card" data-title="Details" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-header"><div class="card-toolbar html-fill-item html-fill-container" data-target-position="header" data-target-element="next"><div class="card-title html-fill-item html-fill-container"><span style="display: inline">
Details

</span></div>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb26" data-startfrom="1339" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1338;"><span id="cb26-1339"><a href="#cb26-1339" aria-hidden="true" tabindex="-1"></a>viewof means_search <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">search</span>(current_means_data<span class="op">,</span> {<span class="dt">placeholder</span><span class="op">:</span> <span class="st">"Additional Target Filtering"</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div id="ojs-cell-26" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div></div>
<div class="cell card-body html-fill-item html-fill-container" data-input="current_means_data">
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb27" data-startfrom="1348" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1347;"><span id="cb27-1348"><a href="#cb27-1348" aria-hidden="true" tabindex="-1"></a>viewof means_table <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">table</span>(means_search<span class="op">,</span> {</span>
<span id="cb27-1349"><a href="#cb27-1349" aria-hidden="true" tabindex="-1"></a>  <span class="dt">multiple</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb27-1350"><a href="#cb27-1350" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> combined_selection<span class="op">,</span> <span class="co">// Pre-check the combined selection</span></span>
<span id="cb27-1351"><a href="#cb27-1351" aria-hidden="true" tabindex="-1"></a>  <span class="dt">rows</span><span class="op">:</span> <span class="dv">20</span><span class="op">,</span></span>
<span id="cb27-1352"><a href="#cb27-1352" aria-hidden="true" tabindex="-1"></a>  <span class="dt">format</span><span class="op">:</span> {</span>
<span id="cb27-1353"><a href="#cb27-1353" aria-hidden="true" tabindex="-1"></a>    <span class="dt">response</span><span class="op">:</span> <span class="fu">sparkbar</span>(d3<span class="op">.</span><span class="fu">max</span>(means_search<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">response</span>))</span>
<span id="cb27-1354"><a href="#cb27-1354" aria-hidden="true" tabindex="-1"></a>  }})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div id="ojs-cell-27" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell hidden card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb28" data-startfrom="1363" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1362;"><span id="cb28-1363"><a href="#cb28-1363" aria-hidden="true" tabindex="-1"></a>means_data_js <span class="op">=</span> {</span>
<span id="cb28-1364"><a href="#cb28-1364" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> payload <span class="op">=</span> study_data_payload<span class="op">;</span></span>
<span id="cb28-1365"><a href="#cb28-1365" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> lvl <span class="op">=</span> means_level<span class="op">;</span> </span>
<span id="cb28-1366"><a href="#cb28-1366" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-1367"><a href="#cb28-1367" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>payload <span class="op">||</span> <span class="op">!</span>lvl <span class="op">||</span> lvl<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span> <span class="op">||</span> payload<span class="op">.</span><span class="at">mode</span> <span class="op">===</span> <span class="st">"local"</span>) <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb28-1368"><a href="#cb28-1368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-1369"><a href="#cb28-1369" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (payload<span class="op">.</span><span class="at">mode</span> <span class="op">===</span> <span class="st">"remote_js_bridge"</span>) {</span>
<span id="cb28-1370"><a href="#cb28-1370" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb28-1371"><a href="#cb28-1371" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> conn <span class="op">=</span> <span class="cf">await</span> duck_db_client<span class="op">;</span></span>
<span id="cb28-1372"><a href="#cb28-1372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-1373"><a href="#cb28-1373" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> formattedLevels <span class="op">=</span> lvl<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> <span class="vs">`'</span><span class="sc">${</span>d<span class="sc">}</span><span class="vs">'`</span>)<span class="op">.</span><span class="fu">join</span>(<span class="st">','</span>)<span class="op">;</span></span>
<span id="cb28-1374"><a href="#cb28-1374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-1375"><a href="#cb28-1375" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> query <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb28-1376"><a href="#cb28-1376" aria-hidden="true" tabindex="-1"></a><span class="vs">        SELECT level, target, response, "asymp.LCL" as LCL, "asymp.UCL" as UCL</span></span>
<span id="cb28-1377"><a href="#cb28-1377" aria-hidden="true" tabindex="-1"></a><span class="vs">        FROM '</span><span class="sc">${</span>payload<span class="op">.</span><span class="at">url_emmeans</span><span class="sc">}</span><span class="vs">' </span></span>
<span id="cb28-1378"><a href="#cb28-1378" aria-hidden="true" tabindex="-1"></a><span class="vs">        WHERE level IN (</span><span class="sc">${</span>formattedLevels<span class="sc">}</span><span class="vs">)</span></span>
<span id="cb28-1379"><a href="#cb28-1379" aria-hidden="true" tabindex="-1"></a><span class="vs">      `</span><span class="op">;</span></span>
<span id="cb28-1380"><a href="#cb28-1380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-1381"><a href="#cb28-1381" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> result <span class="op">=</span> <span class="cf">await</span> conn<span class="op">.</span><span class="fu">query</span>(query)<span class="op">;</span></span>
<span id="cb28-1382"><a href="#cb28-1382" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> result<span class="op">.</span><span class="fu">toArray</span>()<span class="op">.</span><span class="fu">map</span>(row <span class="kw">=&gt;</span> row<span class="op">.</span><span class="fu">toJSON</span>())<span class="op">;</span></span>
<span id="cb28-1383"><a href="#cb28-1383" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (e) {</span>
<span id="cb28-1384"><a href="#cb28-1384" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(<span class="st">"Mean Fetch Error:"</span><span class="op">,</span> e)<span class="op">;</span></span>
<span id="cb28-1385"><a href="#cb28-1385" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> []<span class="op">;</span></span>
<span id="cb28-1386"><a href="#cb28-1386" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb28-1387"><a href="#cb28-1387" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-1388"><a href="#cb28-1388" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div id="ojs-cell-28" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell card-body html-fill-item html-fill-container" data-autorun="true" data-input="[&quot;study_data_payload&quot;,&quot;means_data_js&quot;,&quot;means_level&quot;,&quot;means_highlight&quot;,&quot;means_show_labeled&quot;,&quot;selected_genes&quot;]" data-define="current_means_data">
<div class="html-fill-item html-fill-container">
<div id="webr-11" class="exercise-cell html-fill-item html-fill-container">

</div>
<script type="webr-11-contents">
eyJhdHRyIjp7ImF1dG9ydW4iOnRydWUsImRlZmluZSI6WyJjdXJyZW50X21lYW5zX2RhdGEiXSwiZWNobyI6ZmFsc2UsImVkaXQiOmZhbHNlLCJldmFsIjp0cnVlLCJpbnB1dCI6WyJzdHVkeV9kYXRhX3BheWxvYWQiLCJtZWFuc19kYXRhX2pzIiwibWVhbnNfbGV2ZWwiLCJtZWFuc19oaWdobGlnaHQiLCJtZWFuc19zaG93X2xhYmVsZWQiLCJzZWxlY3RlZF9nZW5lcyJdfSwiY29kZSI6IlxuaWYgKCFpcy5udWxsKHN0dWR5X2RhdGFfcGF5bG9hZCkgJiYgIWlzLm51bGwobWVhbnNfbGV2ZWwpKSB7XG4gIGN1cnJlbnRfbWVhbnNfZGF0YSA8LSBOVUxMXG4gIFxuICBpZiAoc3R1ZHlfZGF0YV9wYXlsb2FkJG1vZGUgPT0gXCJyZW1vdGVfanNfYnJpZGdlXCIpIHtcbiAgICAgaWYoIWlzLm51bGwobWVhbnNfZGF0YV9qcykpe1xuICAgICAgIGN1cnJlbnRfbWVhbnNfZGF0YSA8LSBqc29ubGl0ZTo6ZnJvbUpTT04oanNvbmxpdGU6OnRvSlNPTihtZWFuc19kYXRhX2pzKSlcbiAgICAgICBjdXJyZW50X21lYW5zX2RhdGEgPC0gYXMuZGF0YS5mcmFtZShjdXJyZW50X21lYW5zX2RhdGEpXG4gICAgIH1cbiAgfSBlbHNlIHtcbiAgICBpZiAoZGJFeGlzdHNUYWJsZShjb24sIFwiZW1tZWFuc19kYXRhXCIpKSB7XG5cbiAgICAgICAgbHZsX2luX2NsYXVzZSA8LSBwYXN0ZTAoXCInXCIsIG1lYW5zX2xldmVsLCBcIidcIiwgY29sbGFwc2UgPSBcIiwgXCIpXG4gICAgICAgIFxuICAgICAgICBxdWVyeSA8LSBwYXN0ZTAoXG4gICAgICAgICAgXCJTRUxFQ1QgbGV2ZWwsIHRhcmdldCwgcmVzcG9uc2UsIFxcXCJhc3ltcC5MQ0xcXFwiIGFzIExDTCwgXFxcImFzeW1wLlVDTFxcXCIgYXMgVUNMIFwiLFxuICAgICAgICAgIFwiRlJPTSBlbW1lYW5zX2RhdGEgV0hFUkUgbGV2ZWwgSU4gKFwiLCBsdmxfaW5fY2xhdXNlLCBcIilcIlxuICAgICAgICApXG4gICAgICAgIFxuICAgICAgICBjdXJyZW50X21lYW5zX2RhdGEgPC0gZGJHZXRRdWVyeShjb24sIHF1ZXJ5KVxuICAgICAgfVxuICB9XG4gIFxuICBpZighaXMubnVsbChjdXJyZW50X21lYW5zX2RhdGEpKXtcbiAgICAjIDEuIEpvaW4gd2l0aCBWb2xjYW5vIERhdGEgdG8gZ2V0IGxvZzJmYyBBTkQgcC52YWx1ZSAoRklYRUQ6IFVzZSBwLnZhbHVlKVxuICAgIGlmKGV4aXN0cyhcImN1cnJlbnRfdm9sY2Fub19kYXRhXCIpICYmICFpcy5udWxsKGN1cnJlbnRfdm9sY2Fub19kYXRhKSAmJiBucm93KGN1cnJlbnRfdm9sY2Fub19kYXRhKSA+IDApe1xuXG4gICAgICAgdm9sY2Fub19jb2xzIDwtIGN1cnJlbnRfdm9sY2Fub19kYXRhICU+JSBcbiAgICAgICAgICBzZWxlY3QodGFyZ2V0LCBsb2cyZmMsIHAudmFsdWUpICU+JSBcbiAgICAgICAgICBkaXN0aW5jdCh0YXJnZXQsIC5rZWVwX2FsbCA9IFRSVUUpXG4gICAgICAgICAgXG4gICAgICAgY3VycmVudF9tZWFuc19kYXRhIDwtIGN1cnJlbnRfbWVhbnNfZGF0YSAlPiUgXG4gICAgICAgICAgbGVmdF9qb2luKHZvbGNhbm9fY29scywgYnk9XCJ0YXJnZXRcIilcbiAgICB9IGVsc2Uge1xuICAgICAgIGN1cnJlbnRfbWVhbnNfZGF0YSRsb2cyZmMgPC0gTkFfcmVhbF9cbiAgICAgICBjdXJyZW50X21lYW5zX2RhdGEkcC52YWx1ZSA8LSBOQV9yZWFsX1xuICAgIH1cblxuICAgIHRhcmdldF9vcmRlciA8LSBjdXJyZW50X21lYW5zX2RhdGEgJT4lXG4gICAgICBncm91cF9ieSh0YXJnZXQpICU+JVxuICAgICAgc3VtbWFyaXNlKGF2Z19yZXNwID0gbWVhbihyZXNwb25zZSwgbmEucm0gPSBUUlVFKSkgJT4lXG4gICAgICBhcnJhbmdlKGF2Z19yZXNwKSAlPiVcbiAgICAgIG11dGF0ZShpZHggPSByb3dfbnVtYmVyKCkpICU+JVxuICAgICAgc2VsZWN0KHRhcmdldCwgaWR4KVxuXG4gICAgY3VycmVudF9tZWFuc19kYXRhIDwtIGN1cnJlbnRfbWVhbnNfZGF0YSAlPiVcbiAgICAgIGxlZnRfam9pbih0YXJnZXRfb3JkZXIsIGJ5ID0gXCJ0YXJnZXRcIilcbiAgXG4gIH1cbn0ifQ==
</script>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div>
</div>
</div>
</div><div id="spatial-plots" class="dashboard-page tab-pane grid-skip html-fill-item html-fill-container" data-orientation="rows" aria-labelledby="tab-spatial-plots">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, 100fr); grid-auto-columns: minmax(0, 1fr);">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-columns: minmax(3em, 25fr) minmax(3em, 75fr);
grid-auto-rows: minmax(0, 1fr);">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, 1fr); grid-auto-columns: minmax(0, 1fr);">
<div class="card html-fill-item html-fill-container bslib-card" data-title="Spatial Controls" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-header"><div class="card-title html-fill-item html-fill-container"><span style="display: inline">
Spatial Controls
</span></div></div>
<div class="cell card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb29" data-startfrom="1470" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1469;"><span id="cb29-1470"><a href="#cb29-1470" aria-hidden="true" tabindex="-1"></a>viewof spatial_options <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">form</span>({</span>
<span id="cb29-1471"><a href="#cb29-1471" aria-hidden="true" tabindex="-1"></a>  <span class="dt">pt_size</span><span class="op">:</span>    Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.5</span><span class="op">,</span> <span class="dv">10</span>]<span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Point Size"</span>})<span class="op">,</span></span>
<span id="cb29-1472"><a href="#cb29-1472" aria-hidden="true" tabindex="-1"></a>  <span class="dt">pt_opacity</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.1</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="fl">0.7</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="fl">0.1</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Opacity"</span>})<span class="op">,</span></span>
<span id="cb29-1473"><a href="#cb29-1473" aria-hidden="true" tabindex="-1"></a>  <span class="dt">bg_color</span><span class="op">:</span>   Inputs<span class="op">.</span><span class="fu">color</span>({<span class="dt">label</span><span class="op">:</span> <span class="st">"Background Color"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="st">"#e0e0e0"</span>})<span class="op">,</span></span>
<span id="cb29-1474"><a href="#cb29-1474" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-1475"><a href="#cb29-1475" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Scale Bar</span></span>
<span id="cb29-1476"><a href="#cb29-1476" aria-hidden="true" tabindex="-1"></a>  <span class="dt">scale_len</span><span class="op">:</span>   Inputs<span class="op">.</span><span class="fu">number</span>({<span class="dt">label</span><span class="op">:</span> <span class="st">"Scale Bar (mm)"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="fl">0.1</span>})<span class="op">,</span></span>
<span id="cb29-1477"><a href="#cb29-1477" aria-hidden="true" tabindex="-1"></a>  <span class="dt">scale_color</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">color</span>({<span class="dt">label</span><span class="op">:</span> <span class="st">"Scale Color"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="st">"#000000"</span>})<span class="op">,</span></span>
<span id="cb29-1478"><a href="#cb29-1478" aria-hidden="true" tabindex="-1"></a>  <span class="dt">show_scale</span><span class="op">:</span>  Inputs<span class="op">.</span><span class="fu">toggle</span>({<span class="dt">label</span><span class="op">:</span> <span class="st">"Show Scale Bar"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="kw">true</span>})</span>
<span id="cb29-1479"><a href="#cb29-1479" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb29-1480"><a href="#cb29-1480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1481"><a href="#cb29-1481" aria-hidden="true" tabindex="-1"></a>viewof log_scale_opt <span class="op">=</span> {</span>
<span id="cb29-1482"><a href="#cb29-1482" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="op">!</span>spatial_data <span class="op">||</span> spatial_data<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) <span class="cf">return</span> <span class="fu">md</span><span class="vs">``</span><span class="op">;</span></span>
<span id="cb29-1483"><a href="#cb29-1483" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-1484"><a href="#cb29-1484" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> val <span class="op">=</span> spatial_data[<span class="dv">0</span>]<span class="op">.</span><span class="at">group_id</span><span class="op">;</span></span>
<span id="cb29-1485"><a href="#cb29-1485" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-1486"><a href="#cb29-1486" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="kw">typeof</span> val <span class="op">===</span> <span class="st">'number'</span>) {</span>
<span id="cb29-1487"><a href="#cb29-1487" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">toggle</span>({<span class="dt">label</span><span class="op">:</span> <span class="st">"Log Scale Color (n+1)"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="kw">false</span>})<span class="op">;</span></span>
<span id="cb29-1488"><a href="#cb29-1488" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb29-1489"><a href="#cb29-1489" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">toggle</span>({<span class="dt">label</span><span class="op">:</span> <span class="st">"Log Scale Color (n+1)"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span> <span class="dt">disabled</span><span class="op">:</span> <span class="kw">true</span>})<span class="op">;</span></span>
<span id="cb29-1490"><a href="#cb29-1490" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb29-1491"><a href="#cb29-1491" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-1492"><a href="#cb29-1492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1493"><a href="#cb29-1493" aria-hidden="true" tabindex="-1"></a>spatial_colors <span class="op">=</span> {</span>
<span id="cb29-1494"><a href="#cb29-1494" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> {</span>
<span id="cb29-1495"><a href="#cb29-1495" aria-hidden="true" tabindex="-1"></a>     <span class="dt">l1</span><span class="op">:</span> means_color_1 <span class="op">||</span> <span class="st">"#e15759"</span><span class="op">,</span></span>
<span id="cb29-1496"><a href="#cb29-1496" aria-hidden="true" tabindex="-1"></a>     <span class="dt">l2</span><span class="op">:</span> means_color_2 <span class="op">||</span> <span class="st">"#4e79a7"</span><span class="op">,</span></span>
<span id="cb29-1497"><a href="#cb29-1497" aria-hidden="true" tabindex="-1"></a>     <span class="dt">other</span><span class="op">:</span> spatial_options<span class="op">.</span><span class="at">bg_color</span></span>
<span id="cb29-1498"><a href="#cb29-1498" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb29-1499"><a href="#cb29-1499" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-29-1" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-29-2" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-29-3" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
</div>
<div class="card-body html-fill-item html-fill-container">
<br>
<strong>Metadata Filtering</strong>
</div>
<div class="cell card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb30" data-startfrom="1508" data-source-offset="-23"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1507;"><span id="cb30-1508"><a href="#cb30-1508" aria-hidden="true" tabindex="-1"></a>viewof filter_col <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(spatial_meta_columns<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Filter By:"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">multiple</span><span class="op">:</span> <span class="kw">false</span>})</span>
<span id="cb30-1509"><a href="#cb30-1509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1510"><a href="#cb30-1510" aria-hidden="true" tabindex="-1"></a>is_numeric_filter <span class="op">=</span> {</span>
<span id="cb30-1511"><a href="#cb30-1511" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="op">!</span>spatial_data <span class="op">||</span> <span class="op">!</span>filter_col) <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb30-1512"><a href="#cb30-1512" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> val <span class="op">=</span> spatial_data[<span class="dv">0</span>][filter_col]<span class="op">;</span></span>
<span id="cb30-1513"><a href="#cb30-1513" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="kw">typeof</span> val <span class="op">===</span> <span class="st">'number'</span><span class="op">;</span></span>
<span id="cb30-1514"><a href="#cb30-1514" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-1515"><a href="#cb30-1515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1516"><a href="#cb30-1516" aria-hidden="true" tabindex="-1"></a>viewof filter_vals <span class="op">=</span> {</span>
<span id="cb30-1517"><a href="#cb30-1517" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="op">!</span>filter_col <span class="op">||</span> <span class="op">!</span>spatial_data) <span class="cf">return</span> <span class="fu">md</span><span class="vs">`_Select a column..._`</span><span class="op">;</span></span>
<span id="cb30-1518"><a href="#cb30-1518" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-1519"><a href="#cb30-1519" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (is_numeric_filter) {</span>
<span id="cb30-1520"><a href="#cb30-1520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1521"><a href="#cb30-1521" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> extent <span class="op">=</span> d3<span class="op">.</span><span class="fu">extent</span>(spatial_data<span class="op">,</span> d <span class="kw">=&gt;</span> d[filter_col])<span class="op">;</span></span>
<span id="cb30-1522"><a href="#cb30-1522" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-1523"><a href="#cb30-1523" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">form</span>({</span>
<span id="cb30-1524"><a href="#cb30-1524" aria-hidden="true" tabindex="-1"></a>      <span class="dt">min</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">number</span>({<span class="dt">label</span><span class="op">:</span> <span class="st">"Min"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> extent[<span class="dv">0</span>]})<span class="op">,</span></span>
<span id="cb30-1525"><a href="#cb30-1525" aria-hidden="true" tabindex="-1"></a>      <span class="dt">max</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">number</span>({<span class="dt">label</span><span class="op">:</span> <span class="st">"Max"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> extent[<span class="dv">1</span>]})</span>
<span id="cb30-1526"><a href="#cb30-1526" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb30-1527"><a href="#cb30-1527" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-1528"><a href="#cb30-1528" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb30-1529"><a href="#cb30-1529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1530"><a href="#cb30-1530" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> unique_vals <span class="op">=</span> [<span class="op">...</span><span class="kw">new</span> <span class="bu">Set</span>(spatial_data<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d[filter_col]))]<span class="op">.</span><span class="fu">sort</span>()<span class="op">;</span></span>
<span id="cb30-1531"><a href="#cb30-1531" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-1532"><a href="#cb30-1532" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">select</span>(unique_vals<span class="op">,</span> {</span>
<span id="cb30-1533"><a href="#cb30-1533" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"Include Values:"</span><span class="op">,</span> </span>
<span id="cb30-1534"><a href="#cb30-1534" aria-hidden="true" tabindex="-1"></a>      <span class="dt">multiple</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb30-1535"><a href="#cb30-1535" aria-hidden="true" tabindex="-1"></a>      <span class="dt">sort</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb30-1536"><a href="#cb30-1536" aria-hidden="true" tabindex="-1"></a>      <span class="dt">unique</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb30-1537"><a href="#cb30-1537" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb30-1538"><a href="#cb30-1538" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb30-1539"><a href="#cb30-1539" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-30-1" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-30-2" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-30-3" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
</div>
<div class="card-body html-fill-item html-fill-container">
<p><br> <strong>Stats</strong></p>
</div>
<div class="cell card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb31" data-startfrom="1545" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1544;"><span id="cb31-1545"><a href="#cb31-1545" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`</span></span>
<span id="cb31-1546"><a href="#cb31-1546" aria-hidden="true" tabindex="-1"></a><span class="vs">- **Total Loaded**: </span><span class="sc">${</span>spatial_data <span class="op">?</span> spatial_data<span class="op">.</span><span class="at">length</span><span class="op">.</span><span class="fu">toLocaleString</span>() <span class="op">:</span> <span class="st">"..."</span><span class="sc">}</span></span>
<span id="cb31-1547"><a href="#cb31-1547" aria-hidden="true" tabindex="-1"></a><span class="vs">- **Visible**: </span><span class="sc">${</span>spatial_filtered <span class="op">?</span> spatial_filtered<span class="op">.</span><span class="at">length</span><span class="op">.</span><span class="fu">toLocaleString</span>() <span class="op">:</span> <span class="st">"..."</span><span class="sc">}</span></span>
<span id="cb31-1548"><a href="#cb31-1548" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div id="ojs-cell-31" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div><div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, 1fr); grid-auto-columns: minmax(0, 1fr);">
<div class="cell hidden html-fill-item html-fill-container">
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb32" data-startfrom="1604" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1603;"><span id="cb32-1604"><a href="#cb32-1604" aria-hidden="true" tabindex="-1"></a>spatial_data <span class="op">=</span> {</span>
<span id="cb32-1605"><a href="#cb32-1605" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> payload <span class="op">=</span> study_data_payload<span class="op">;</span></span>
<span id="cb32-1606"><a href="#cb32-1606" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> r_push <span class="op">=</span> r_spatial_data_export<span class="op">;</span> <span class="co">// Reactive link to the webR block above</span></span>
<span id="cb32-1607"><a href="#cb32-1607" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-1608"><a href="#cb32-1608" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>payload) <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb32-1609"><a href="#cb32-1609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-1610"><a href="#cb32-1610" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 1. LOCAL MODE: Always use the R-side DuckDB data</span></span>
<span id="cb32-1611"><a href="#cb32-1611" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (payload<span class="op">.</span><span class="at">type</span> <span class="op">===</span> <span class="st">"local"</span>) {</span>
<span id="cb32-1612"><a href="#cb32-1612" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (r_push <span class="op">&amp;&amp;</span> r_push<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb32-1613"><a href="#cb32-1613" aria-hidden="true" tabindex="-1"></a>       <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"📍 Spatial Data: Received via R-Side DuckDB Bridge"</span>)<span class="op">;</span></span>
<span id="cb32-1614"><a href="#cb32-1614" aria-hidden="true" tabindex="-1"></a>       <span class="cf">return</span> r_push<span class="op">;</span></span>
<span id="cb32-1615"><a href="#cb32-1615" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb32-1616"><a href="#cb32-1616" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Return empty array to clear the canvas during transitions</span></span>
<span id="cb32-1617"><a href="#cb32-1617" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> []<span class="op">;</span> </span>
<span id="cb32-1618"><a href="#cb32-1618" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb32-1619"><a href="#cb32-1619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-1620"><a href="#cb32-1620" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 2. REMOTE MODE: Keep the URL-based JS-bridge for manifest studies</span></span>
<span id="cb32-1621"><a href="#cb32-1621" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> term <span class="op">=</span> term_selection<span class="op">;</span></span>
<span id="cb32-1622"><a href="#cb32-1622" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> slide <span class="op">=</span> slide_selection<span class="op">;</span></span>
<span id="cb32-1623"><a href="#cb32-1623" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>term <span class="op">||</span> slide <span class="op">===</span> <span class="kw">null</span>) <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb32-1624"><a href="#cb32-1624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-1625"><a href="#cb32-1625" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span> {</span>
<span id="cb32-1626"><a href="#cb32-1626" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> conn <span class="op">=</span> <span class="cf">await</span> duck_db_client<span class="op">;</span></span>
<span id="cb32-1627"><a href="#cb32-1627" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> result <span class="op">=</span> <span class="cf">await</span> conn<span class="op">.</span><span class="fu">query</span>(<span class="vs">`SELECT * FROM "</span><span class="sc">${</span>payload<span class="op">.</span><span class="at">url_meta</span><span class="sc">}</span><span class="vs">" WHERE slide_id_numeric = </span><span class="sc">${</span>slide<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb32-1628"><a href="#cb32-1628" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> rows <span class="op">=</span> result<span class="op">.</span><span class="fu">toArray</span>()<span class="op">.</span><span class="fu">map</span>(row <span class="kw">=&gt;</span> row<span class="op">.</span><span class="fu">toJSON</span>())<span class="op">;</span></span>
<span id="cb32-1629"><a href="#cb32-1629" aria-hidden="true" tabindex="-1"></a>    rows<span class="op">.</span><span class="fu">forEach</span>(r <span class="kw">=&gt;</span> { r<span class="op">.</span><span class="at">group_id</span> <span class="op">=</span> r[term]<span class="op">;</span> })<span class="op">;</span></span>
<span id="cb32-1630"><a href="#cb32-1630" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> rows<span class="op">;</span></span>
<span id="cb32-1631"><a href="#cb32-1631" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">catch</span> (e) {</span>
<span id="cb32-1632"><a href="#cb32-1632" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(<span class="st">"❌ Remote Spatial Fetch Error:"</span><span class="op">,</span> e)<span class="op">;</span></span>
<span id="cb32-1633"><a href="#cb32-1633" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> []<span class="op">;</span></span>
<span id="cb32-1634"><a href="#cb32-1634" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb32-1635"><a href="#cb32-1635" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-1636"><a href="#cb32-1636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-1637"><a href="#cb32-1637" aria-hidden="true" tabindex="-1"></a>spatial_meta_columns <span class="op">=</span> {</span>
<span id="cb32-1638"><a href="#cb32-1638" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>spatial_data <span class="op">||</span> spatial_data<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) <span class="cf">return</span> []<span class="op">;</span></span>
<span id="cb32-1639"><a href="#cb32-1639" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-1640"><a href="#cb32-1640" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Dynamically grab columns from whatever study is currently loaded</span></span>
<span id="cb32-1641"><a href="#cb32-1641" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> keys <span class="op">=</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">keys</span>(spatial_data[<span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb32-1642"><a href="#cb32-1642" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-1643"><a href="#cb32-1643" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> keys<span class="op">.</span><span class="fu">filter</span>(k <span class="kw">=&gt;</span> </span>
<span id="cb32-1644"><a href="#cb32-1644" aria-hidden="true" tabindex="-1"></a>    <span class="op">!</span>[<span class="st">"x_slide_mm"</span><span class="op">,</span> <span class="st">"y_slide_mm"</span><span class="op">,</span> <span class="st">"group_id"</span><span class="op">,</span> <span class="st">"__index_level_0__"</span><span class="op">,</span> <span class="st">"slide_id_numeric"</span>]<span class="op">.</span><span class="fu">includes</span>(k)</span>
<span id="cb32-1645"><a href="#cb32-1645" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb32-1646"><a href="#cb32-1646" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-1647"><a href="#cb32-1647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-1648"><a href="#cb32-1648" aria-hidden="true" tabindex="-1"></a>spatial_filtered <span class="op">=</span> {</span>
<span id="cb32-1649"><a href="#cb32-1649" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="op">!</span>spatial_data) <span class="cf">return</span> []<span class="op">;</span></span>
<span id="cb32-1650"><a href="#cb32-1650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-1651"><a href="#cb32-1651" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="op">!</span>filter_col <span class="op">||</span> <span class="op">!</span>filter_vals) <span class="cf">return</span> spatial_data<span class="op">;</span></span>
<span id="cb32-1652"><a href="#cb32-1652" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-1653"><a href="#cb32-1653" aria-hidden="true" tabindex="-1"></a>  <span class="co">// LOGIC SWITCH:</span></span>
<span id="cb32-1654"><a href="#cb32-1654" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(is_numeric_filter) {</span>
<span id="cb32-1655"><a href="#cb32-1655" aria-hidden="true" tabindex="-1"></a>     <span class="co">// Numeric Filter: filter_vals is an object {min: x, max: y}</span></span>
<span id="cb32-1656"><a href="#cb32-1656" aria-hidden="true" tabindex="-1"></a>     <span class="kw">const</span> { min<span class="op">,</span> max } <span class="op">=</span> filter_vals<span class="op">;</span></span>
<span id="cb32-1657"><a href="#cb32-1657" aria-hidden="true" tabindex="-1"></a>     <span class="cf">return</span> spatial_data<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d[filter_col] <span class="op">&gt;=</span> min <span class="op">&amp;&amp;</span> d[filter_col] <span class="op">&lt;=</span> max)<span class="op">;</span></span>
<span id="cb32-1658"><a href="#cb32-1658" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb32-1659"><a href="#cb32-1659" aria-hidden="true" tabindex="-1"></a>     <span class="co">// Categorical Filter: filter_vals is an array of selected strings</span></span>
<span id="cb32-1660"><a href="#cb32-1660" aria-hidden="true" tabindex="-1"></a>     <span class="cf">if</span>(filter_vals<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) <span class="cf">return</span> spatial_data<span class="op">;</span></span>
<span id="cb32-1661"><a href="#cb32-1661" aria-hidden="true" tabindex="-1"></a>     <span class="cf">return</span> spatial_data<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> filter_vals<span class="op">.</span><span class="fu">includes</span>(d[filter_col]))<span class="op">;</span></span>
<span id="cb32-1662"><a href="#cb32-1662" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb32-1663"><a href="#cb32-1663" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-33-1" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-33-2" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-33-3" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
</div>
<div class="card cell html-fill-item html-fill-container bslib-card" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-header"><div class="card-toolbar html-fill-item html-fill-container" data-target-position="header" data-target-element="next"><div class="card-title html-fill-item html-fill-container"><span style="display: inline">

</span></div>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb33" data-startfrom="1562" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1561;"><span id="cb33-1562"><a href="#cb33-1562" aria-hidden="true" tabindex="-1"></a>viewof slide_selection <span class="op">=</span> {</span>
<span id="cb33-1563"><a href="#cb33-1563" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>available_slides <span class="op">||</span> available_slides<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) <span class="cf">return</span> <span class="fu">md</span><span class="vs">`_Loading slides..._`</span><span class="op">;</span></span>
<span id="cb33-1564"><a href="#cb33-1564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1565"><a href="#cb33-1565" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">select</span>(available_slides<span class="op">,</span> {</span>
<span id="cb33-1566"><a href="#cb33-1566" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Available Slides:"</span><span class="op">,</span></span>
<span id="cb33-1567"><a href="#cb33-1567" aria-hidden="true" tabindex="-1"></a>    <span class="dt">multiple</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb33-1568"><a href="#cb33-1568" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size</span><span class="op">:</span> <span class="dv">3</span></span>
<span id="cb33-1569"><a href="#cb33-1569" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb33-1570"><a href="#cb33-1570" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-1571"><a href="#cb33-1571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1572"><a href="#cb33-1572" aria-hidden="true" tabindex="-1"></a>viewof term_copy2 <span class="op">=</span> {</span>
<span id="cb33-1573"><a href="#cb33-1573" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-1574"><a href="#cb33-1574" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>available_terms <span class="op">||</span> available_terms<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) <span class="cf">return</span> <span class="fu">md</span><span class="vs">`_Loading..._`</span><span class="op">;</span></span>
<span id="cb33-1575"><a href="#cb33-1575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1576"><a href="#cb33-1576" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> mirror_input3 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(available_terms<span class="op">,</span> {</span>
<span id="cb33-1577"><a href="#cb33-1577" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Available Terms:"</span><span class="op">,</span></span>
<span id="cb33-1578"><a href="#cb33-1578" aria-hidden="true" tabindex="-1"></a>    <span class="dt">multiple</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb33-1579"><a href="#cb33-1579" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size</span><span class="op">:</span> <span class="dv">3</span></span>
<span id="cb33-1580"><a href="#cb33-1580" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb33-1581"><a href="#cb33-1581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1582"><a href="#cb33-1582" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">bind</span>(mirror_input3<span class="op">,</span> viewof term_selection)<span class="op">;</span></span>
<span id="cb33-1583"><a href="#cb33-1583" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-1584"><a href="#cb33-1584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1585"><a href="#cb33-1585" aria-hidden="true" tabindex="-1"></a>viewof contrast_copy2 <span class="op">=</span> {</span>
<span id="cb33-1586"><a href="#cb33-1586" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>available_contrasts <span class="op">||</span> available_contrasts<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) <span class="cf">return</span> <span class="fu">md</span><span class="vs">`_Loading..._`</span><span class="op">;</span></span>
<span id="cb33-1587"><a href="#cb33-1587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1588"><a href="#cb33-1588" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> mirror_input2 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(available_contrasts<span class="op">,</span> {</span>
<span id="cb33-1589"><a href="#cb33-1589" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Available Contrasts:"</span><span class="op">,</span></span>
<span id="cb33-1590"><a href="#cb33-1590" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="fu">replace</span>(<span class="st">" / "</span><span class="op">,</span> <span class="st">" vs. "</span>)<span class="op">,</span></span>
<span id="cb33-1591"><a href="#cb33-1591" aria-hidden="true" tabindex="-1"></a>    <span class="dt">multiple</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb33-1592"><a href="#cb33-1592" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size</span><span class="op">:</span> <span class="dv">3</span></span>
<span id="cb33-1593"><a href="#cb33-1593" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb33-1594"><a href="#cb33-1594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1595"><a href="#cb33-1595" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">bind</span>(mirror_input2<span class="op">,</span> viewof contrast_selection)<span class="op">;</span></span>
<span id="cb33-1596"><a href="#cb33-1596" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-32-1" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-32-2" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-32-3" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
</div></div>
<div class="card-body html-fill-item html-fill-container" style="padding: 0px;">
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb34" data-startfrom="1669" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1668;"><span id="cb34-1669"><a href="#cb34-1669" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb34-1670"><a href="#cb34-1670" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> spatial_filtered<span class="op">;</span></span>
<span id="cb34-1671"><a href="#cb34-1671" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> levels <span class="op">=</span> means_level<span class="op">;</span> </span>
<span id="cb34-1672"><a href="#cb34-1672" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> opts <span class="op">=</span> spatial_options<span class="op">;</span></span>
<span id="cb34-1673"><a href="#cb34-1673" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> colors <span class="op">=</span> spatial_colors<span class="op">;</span></span>
<span id="cb34-1674"><a href="#cb34-1674" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> width <span class="op">=</span> <span class="dv">1200</span><span class="op">;</span> </span>
<span id="cb34-1675"><a href="#cb34-1675" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> height <span class="op">=</span> <span class="dv">900</span><span class="op">;</span> </span>
<span id="cb34-1676"><a href="#cb34-1676" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-1677"><a href="#cb34-1677" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> useLog <span class="op">=</span> log_scale_opt <span class="op">===</span> <span class="kw">true</span><span class="op">;</span> </span>
<span id="cb34-1678"><a href="#cb34-1678" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-1679"><a href="#cb34-1679" aria-hidden="true" tabindex="-1"></a>  <span class="co">//if (!data || data.length === 0) return md`_Loading spatial data..._`;</span></span>
<span id="cb34-1680"><a href="#cb34-1680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1681"><a href="#cb34-1681" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> isMock <span class="op">=</span> <span class="op">!</span>data <span class="op">||</span> data<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span> <span class="op">||</span> </span>
<span id="cb34-1682"><a href="#cb34-1682" aria-hidden="true" tabindex="-1"></a>                 (data<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">4</span> <span class="op">&amp;&amp;</span> d3<span class="op">.</span><span class="fu">max</span>(data<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x_slide_mm</span>) <span class="op">&lt;=</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb34-1683"><a href="#cb34-1683" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-1684"><a href="#cb34-1684" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (isMock) {</span>
<span id="cb34-1685"><a href="#cb34-1685" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">html</span><span class="vs">`</span></span>
<span id="cb34-1686"><a href="#cb34-1686" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div style="height: 600px; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #fdfdfd; border: 2px dashed #dee2e6; border-radius: 12px; text-align: center; padding: 40px;"&gt;</span></span>
<span id="cb34-1687"><a href="#cb34-1687" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;div style="font-size: 3em; opacity: 0.4;"&gt;📍&lt;/div&gt;</span></span>
<span id="cb34-1688"><a href="#cb34-1688" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;h3 style="color: #3C3F40; margin-top: 15px;"&gt;Spatial Plot Unavailable&lt;/h3&gt;</span></span>
<span id="cb34-1689"><a href="#cb34-1689" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;p style="max-width: 440px; color: #888; font-size: 0.9em; line-height: 1.6;"&gt;</span></span>
<span id="cb34-1690"><a href="#cb34-1690" aria-hidden="true" tabindex="-1"></a><span class="vs">          This study (AtoMx SIP or smiDE) does not contain any cell-level spatial metadata to display.</span></span>
<span id="cb34-1691"><a href="#cb34-1691" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;/p&gt;</span></span>
<span id="cb34-1692"><a href="#cb34-1692" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;div style="margin-top: 20px; font-size: 0.75em; border-top: 1px solid #eee; padding-top: 15px; font-style: italic; color: #b44697;"&gt;</span></span>
<span id="cb34-1693"><a href="#cb34-1693" aria-hidden="true" tabindex="-1"></a><span class="vs">          R users: Use &lt;code&gt;create_mock_sp_data()&lt;/code&gt; to generate placeholder coordinates.</span></span>
<span id="cb34-1694"><a href="#cb34-1694" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;/div&gt;</span></span>
<span id="cb34-1695"><a href="#cb34-1695" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/div&gt;</span></span>
<span id="cb34-1696"><a href="#cb34-1696" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb34-1697"><a href="#cb34-1697" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-1698"><a href="#cb34-1698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1699"><a href="#cb34-1699" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> isContinuous <span class="op">=</span> <span class="kw">typeof</span> data[<span class="dv">0</span>]<span class="op">.</span><span class="at">group_id</span> <span class="op">===</span> <span class="st">'number'</span><span class="op">;</span></span>
<span id="cb34-1700"><a href="#cb34-1700" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-1701"><a href="#cb34-1701" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> colorScale <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb34-1702"><a href="#cb34-1702" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> termExtent <span class="op">=</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb34-1703"><a href="#cb34-1703" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-1704"><a href="#cb34-1704" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(isContinuous) {</span>
<span id="cb34-1705"><a href="#cb34-1705" aria-hidden="true" tabindex="-1"></a>     termExtent <span class="op">=</span> d3<span class="op">.</span><span class="fu">extent</span>(data<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">group_id</span>)<span class="op">;</span></span>
<span id="cb34-1706"><a href="#cb34-1706" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb34-1707"><a href="#cb34-1707" aria-hidden="true" tabindex="-1"></a>     <span class="cf">if</span> (useLog) {</span>
<span id="cb34-1708"><a href="#cb34-1708" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Log Scale: Map Log(Min+1) -&gt; Log(Max+1)</span></span>
<span id="cb34-1709"><a href="#cb34-1709" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> logMin <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(termExtent[<span class="dv">0</span>] <span class="op">+</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb34-1710"><a href="#cb34-1710" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> logMax <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(termExtent[<span class="dv">1</span>] <span class="op">+</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb34-1711"><a href="#cb34-1711" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb34-1712"><a href="#cb34-1712" aria-hidden="true" tabindex="-1"></a>        colorScale <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleSequential</span>(d3<span class="op">.</span><span class="fu">interpolateRgb</span>(colors<span class="op">.</span><span class="at">l2</span><span class="op">,</span> colors<span class="op">.</span><span class="at">l1</span>))</span>
<span id="cb34-1713"><a href="#cb34-1713" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">domain</span>([logMin<span class="op">,</span> logMax])<span class="op">;</span></span>
<span id="cb34-1714"><a href="#cb34-1714" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb34-1715"><a href="#cb34-1715" aria-hidden="true" tabindex="-1"></a>     } <span class="cf">else</span> {</span>
<span id="cb34-1716"><a href="#cb34-1716" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Linear Scale</span></span>
<span id="cb34-1717"><a href="#cb34-1717" aria-hidden="true" tabindex="-1"></a>        colorScale <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb34-1718"><a href="#cb34-1718" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">domain</span>(termExtent)</span>
<span id="cb34-1719"><a href="#cb34-1719" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">range</span>([colors<span class="op">.</span><span class="at">l2</span><span class="op">,</span> colors<span class="op">.</span><span class="at">l1</span>])<span class="op">;</span></span>
<span id="cb34-1720"><a href="#cb34-1720" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb34-1721"><a href="#cb34-1721" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-1722"><a href="#cb34-1722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1723"><a href="#cb34-1723" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xExtent <span class="op">=</span> d3<span class="op">.</span><span class="fu">extent</span>(data<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x_slide_mm</span>)<span class="op">;</span></span>
<span id="cb34-1724"><a href="#cb34-1724" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yExtent <span class="op">=</span> d3<span class="op">.</span><span class="fu">extent</span>(data<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">y_slide_mm</span>)<span class="op">;</span></span>
<span id="cb34-1725"><a href="#cb34-1725" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-1726"><a href="#cb34-1726" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xMin <span class="op">=</span> xExtent[<span class="dv">0</span>]<span class="op">,</span> xMax <span class="op">=</span> xExtent[<span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb34-1727"><a href="#cb34-1727" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yMin <span class="op">=</span> yExtent[<span class="dv">0</span>]<span class="op">,</span> yMax <span class="op">=</span> yExtent[<span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb34-1728"><a href="#cb34-1728" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-1729"><a href="#cb34-1729" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dataWidth <span class="op">=</span> xMax <span class="op">-</span> xMin<span class="op">;</span></span>
<span id="cb34-1730"><a href="#cb34-1730" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dataHeight <span class="op">=</span> yMax <span class="op">-</span> yMin<span class="op">;</span></span>
<span id="cb34-1731"><a href="#cb34-1731" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-1732"><a href="#cb34-1732" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xScaleFactor <span class="op">=</span> width <span class="op">/</span> dataWidth<span class="op">;</span></span>
<span id="cb34-1733"><a href="#cb34-1733" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScaleFactor <span class="op">=</span> height <span class="op">/</span> dataHeight<span class="op">;</span></span>
<span id="cb34-1734"><a href="#cb34-1734" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> scale <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(xScaleFactor<span class="op">,</span> yScaleFactor) <span class="op">*</span> <span class="fl">0.95</span><span class="op">;</span> </span>
<span id="cb34-1735"><a href="#cb34-1735" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-1736"><a href="#cb34-1736" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cx <span class="op">=</span> width <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb34-1737"><a href="#cb34-1737" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cy <span class="op">=</span> height <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb34-1738"><a href="#cb34-1738" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dx <span class="op">=</span> (xMin <span class="op">+</span> xMax) <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb34-1739"><a href="#cb34-1739" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dy <span class="op">=</span> (yMin <span class="op">+</span> yMax) <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb34-1740"><a href="#cb34-1740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1741"><a href="#cb34-1741" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> project <span class="op">=</span> (x<span class="op">,</span> y) <span class="kw">=&gt;</span> {</span>
<span id="cb34-1742"><a href="#cb34-1742" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [</span>
<span id="cb34-1743"><a href="#cb34-1743" aria-hidden="true" tabindex="-1"></a>      cx <span class="op">+</span> (x <span class="op">-</span> dx) <span class="op">*</span> scale<span class="op">,</span></span>
<span id="cb34-1744"><a href="#cb34-1744" aria-hidden="true" tabindex="-1"></a>      cy <span class="op">-</span> (y <span class="op">-</span> dy) <span class="op">*</span> scale </span>
<span id="cb34-1745"><a href="#cb34-1745" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">;</span></span>
<span id="cb34-1746"><a href="#cb34-1746" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-1747"><a href="#cb34-1747" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-1748"><a href="#cb34-1748" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pixelsPerMm <span class="op">=</span> scale<span class="op">;</span></span>
<span id="cb34-1749"><a href="#cb34-1749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1750"><a href="#cb34-1750" aria-hidden="true" tabindex="-1"></a>  <span class="co">// --- 3. DOM Setup ---</span></span>
<span id="cb34-1751"><a href="#cb34-1751" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> div <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb34-1752"><a href="#cb34-1752" aria-hidden="true" tabindex="-1"></a>  div<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">position</span> <span class="op">=</span> <span class="st">"relative"</span><span class="op">;</span></span>
<span id="cb34-1753"><a href="#cb34-1753" aria-hidden="true" tabindex="-1"></a>  div<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">width</span> <span class="op">=</span> <span class="st">"100%"</span><span class="op">;</span></span>
<span id="cb34-1754"><a href="#cb34-1754" aria-hidden="true" tabindex="-1"></a>  div<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">maxWidth</span> <span class="op">=</span> <span class="st">"100%"</span><span class="op">;</span></span>
<span id="cb34-1755"><a href="#cb34-1755" aria-hidden="true" tabindex="-1"></a>  div<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">height</span> <span class="op">=</span> <span class="st">"auto"</span><span class="op">;</span></span>
<span id="cb34-1756"><a href="#cb34-1756" aria-hidden="true" tabindex="-1"></a>  div<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">border</span> <span class="op">=</span> <span class="st">"1px solid #eee"</span><span class="op">;</span></span>
<span id="cb34-1757"><a href="#cb34-1757" aria-hidden="true" tabindex="-1"></a>  div<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">background</span> <span class="op">=</span> <span class="st">"#fff"</span><span class="op">;</span></span>
<span id="cb34-1758"><a href="#cb34-1758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1759"><a href="#cb34-1759" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> canvas <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"canvas"</span>)<span class="op">;</span></span>
<span id="cb34-1760"><a href="#cb34-1760" aria-hidden="true" tabindex="-1"></a>  canvas<span class="op">.</span><span class="at">width</span> <span class="op">=</span> width<span class="op">;</span></span>
<span id="cb34-1761"><a href="#cb34-1761" aria-hidden="true" tabindex="-1"></a>  canvas<span class="op">.</span><span class="at">height</span> <span class="op">=</span> height<span class="op">;</span></span>
<span id="cb34-1762"><a href="#cb34-1762" aria-hidden="true" tabindex="-1"></a>  canvas<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">width</span> <span class="op">=</span> <span class="st">"100%"</span><span class="op">;</span> <span class="co">// Responsive CSS</span></span>
<span id="cb34-1763"><a href="#cb34-1763" aria-hidden="true" tabindex="-1"></a>  canvas<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">height</span> <span class="op">=</span> <span class="st">"auto"</span><span class="op">;</span></span>
<span id="cb34-1764"><a href="#cb34-1764" aria-hidden="true" tabindex="-1"></a>  canvas<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">"block"</span><span class="op">;</span></span>
<span id="cb34-1765"><a href="#cb34-1765" aria-hidden="true" tabindex="-1"></a>  div<span class="op">.</span><span class="fu">appendChild</span>(canvas)<span class="op">;</span></span>
<span id="cb34-1766"><a href="#cb34-1766" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-1767"><a href="#cb34-1767" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Legend </span></span>
<span id="cb34-1768"><a href="#cb34-1768" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> legend <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb34-1769"><a href="#cb34-1769" aria-hidden="true" tabindex="-1"></a>  legend<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">position</span> <span class="op">=</span> <span class="st">"absolute"</span><span class="op">;</span></span>
<span id="cb34-1770"><a href="#cb34-1770" aria-hidden="true" tabindex="-1"></a>  legend<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">top</span> <span class="op">=</span> <span class="st">"10px"</span><span class="op">;</span></span>
<span id="cb34-1771"><a href="#cb34-1771" aria-hidden="true" tabindex="-1"></a>  legend<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">right</span> <span class="op">=</span> <span class="st">"10px"</span><span class="op">;</span></span>
<span id="cb34-1772"><a href="#cb34-1772" aria-hidden="true" tabindex="-1"></a>  legend<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">background</span> <span class="op">=</span> <span class="st">"rgba(255, 255, 255, 0.9)"</span><span class="op">;</span></span>
<span id="cb34-1773"><a href="#cb34-1773" aria-hidden="true" tabindex="-1"></a>  legend<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">padding</span> <span class="op">=</span> <span class="st">"8px"</span><span class="op">;</span></span>
<span id="cb34-1774"><a href="#cb34-1774" aria-hidden="true" tabindex="-1"></a>  legend<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">borderRadius</span> <span class="op">=</span> <span class="st">"4px"</span><span class="op">;</span></span>
<span id="cb34-1775"><a href="#cb34-1775" aria-hidden="true" tabindex="-1"></a>  legend<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">border</span> <span class="op">=</span> <span class="st">"1px solid #ccc"</span><span class="op">;</span></span>
<span id="cb34-1776"><a href="#cb34-1776" aria-hidden="true" tabindex="-1"></a>  legend<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">fontSize</span> <span class="op">=</span> <span class="st">"12px"</span><span class="op">;</span></span>
<span id="cb34-1777"><a href="#cb34-1777" aria-hidden="true" tabindex="-1"></a>  legend<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">fontFamily</span> <span class="op">=</span> <span class="st">"sans-serif"</span><span class="op">;</span></span>
<span id="cb34-1778"><a href="#cb34-1778" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-1779"><a href="#cb34-1779" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (isContinuous) {</span>
<span id="cb34-1780"><a href="#cb34-1780" aria-hidden="true" tabindex="-1"></a>     <span class="kw">const</span> label <span class="op">=</span> useLog <span class="op">?</span> <span class="vs">`Log(</span><span class="sc">${</span>term_selection<span class="sc">}</span><span class="vs"> + 1)`</span> <span class="op">:</span> term_selection<span class="op">;</span></span>
<span id="cb34-1781"><a href="#cb34-1781" aria-hidden="true" tabindex="-1"></a>     <span class="kw">const</span> minLabel <span class="op">=</span> useLog <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(termExtent[<span class="dv">0</span>] <span class="op">+</span> <span class="dv">1</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>) <span class="op">:</span> termExtent[<span class="dv">0</span>]<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb34-1782"><a href="#cb34-1782" aria-hidden="true" tabindex="-1"></a>     <span class="kw">const</span> maxLabel <span class="op">=</span> useLog <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(termExtent[<span class="dv">1</span>] <span class="op">+</span> <span class="dv">1</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>) <span class="op">:</span> termExtent[<span class="dv">1</span>]<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb34-1783"><a href="#cb34-1783" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb34-1784"><a href="#cb34-1784" aria-hidden="true" tabindex="-1"></a>     legend<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb34-1785"><a href="#cb34-1785" aria-hidden="true" tabindex="-1"></a><span class="vs">       &lt;strong&gt;</span><span class="sc">${</span>label<span class="sc">}</span><span class="vs">&lt;/strong&gt;&lt;br&gt;</span></span>
<span id="cb34-1786"><a href="#cb34-1786" aria-hidden="true" tabindex="-1"></a><span class="vs">       &lt;div style="display:flex; align-items:center; gap:5px; margin-top:4px;"&gt;</span></span>
<span id="cb34-1787"><a href="#cb34-1787" aria-hidden="true" tabindex="-1"></a><span class="vs">         &lt;span&gt;</span><span class="sc">${</span>minLabel<span class="sc">}</span><span class="vs">&lt;/span&gt;</span></span>
<span id="cb34-1788"><a href="#cb34-1788" aria-hidden="true" tabindex="-1"></a><span class="vs">         &lt;div style="width:60px; height:10px; background: linear-gradient(to right, </span><span class="sc">${</span>colors<span class="op">.</span><span class="at">l2</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>colors<span class="op">.</span><span class="at">l1</span><span class="sc">}</span><span class="vs">);"&gt;&lt;/div&gt;</span></span>
<span id="cb34-1789"><a href="#cb34-1789" aria-hidden="true" tabindex="-1"></a><span class="vs">         &lt;span&gt;</span><span class="sc">${</span>maxLabel<span class="sc">}</span><span class="vs">&lt;/span&gt;</span></span>
<span id="cb34-1790"><a href="#cb34-1790" aria-hidden="true" tabindex="-1"></a><span class="vs">       &lt;/div&gt;</span></span>
<span id="cb34-1791"><a href="#cb34-1791" aria-hidden="true" tabindex="-1"></a><span class="vs">     `</span><span class="op">;</span></span>
<span id="cb34-1792"><a href="#cb34-1792" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb34-1793"><a href="#cb34-1793" aria-hidden="true" tabindex="-1"></a>     <span class="kw">const</span> L1 <span class="op">=</span> (levels <span class="op">&amp;&amp;</span> levels<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">?</span> levels[<span class="dv">0</span>] <span class="op">:</span> <span class="st">"Level 1"</span><span class="op">;</span></span>
<span id="cb34-1794"><a href="#cb34-1794" aria-hidden="true" tabindex="-1"></a>     <span class="kw">const</span> L2 <span class="op">=</span> (levels <span class="op">&amp;&amp;</span> levels<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">1</span>) <span class="op">?</span> levels[<span class="dv">1</span>] <span class="op">:</span> <span class="st">"Level 2"</span><span class="op">;</span></span>
<span id="cb34-1795"><a href="#cb34-1795" aria-hidden="true" tabindex="-1"></a>     legend<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb34-1796"><a href="#cb34-1796" aria-hidden="true" tabindex="-1"></a><span class="vs">       &lt;strong&gt;</span><span class="sc">${</span>term_selection<span class="sc">}</span><span class="vs">&lt;/strong&gt;&lt;br&gt;</span></span>
<span id="cb34-1797"><a href="#cb34-1797" aria-hidden="true" tabindex="-1"></a><span class="vs">       &lt;div style="display:flex; align-items:center; gap:5px; margin-top:2px;"&gt;</span></span>
<span id="cb34-1798"><a href="#cb34-1798" aria-hidden="true" tabindex="-1"></a><span class="vs">         &lt;span style="display:inline-block; width:10px; height:10px; background:</span><span class="sc">${</span>colors<span class="op">.</span><span class="at">l1</span><span class="sc">}</span><span class="vs">;"&gt;&lt;/span&gt; </span><span class="sc">${</span>L1<span class="sc">}</span><span class="vs">&lt;br&gt;</span></span>
<span id="cb34-1799"><a href="#cb34-1799" aria-hidden="true" tabindex="-1"></a><span class="vs">       &lt;/div&gt;</span></span>
<span id="cb34-1800"><a href="#cb34-1800" aria-hidden="true" tabindex="-1"></a><span class="vs">       &lt;div style="display:flex; align-items:center; gap:5px; margin-top:2px;"&gt;</span></span>
<span id="cb34-1801"><a href="#cb34-1801" aria-hidden="true" tabindex="-1"></a><span class="vs">         &lt;span style="display:inline-block; width:10px; height:10px; background:</span><span class="sc">${</span>colors<span class="op">.</span><span class="at">l2</span><span class="sc">}</span><span class="vs">;"&gt;&lt;/span&gt; </span><span class="sc">${</span>L2<span class="sc">}</span></span>
<span id="cb34-1802"><a href="#cb34-1802" aria-hidden="true" tabindex="-1"></a><span class="vs">       &lt;/div&gt;</span></span>
<span id="cb34-1803"><a href="#cb34-1803" aria-hidden="true" tabindex="-1"></a><span class="vs">     `</span><span class="op">;</span></span>
<span id="cb34-1804"><a href="#cb34-1804" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-1805"><a href="#cb34-1805" aria-hidden="true" tabindex="-1"></a>  div<span class="op">.</span><span class="fu">appendChild</span>(legend)<span class="op">;</span></span>
<span id="cb34-1806"><a href="#cb34-1806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1807"><a href="#cb34-1807" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ctx <span class="op">=</span> canvas<span class="op">.</span><span class="fu">getContext</span>(<span class="st">"2d"</span>)<span class="op">;</span></span>
<span id="cb34-1808"><a href="#cb34-1808" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> transform <span class="op">=</span> d3<span class="op">.</span><span class="at">zoomIdentity</span><span class="op">;</span></span>
<span id="cb34-1809"><a href="#cb34-1809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1810"><a href="#cb34-1810" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">draw</span>() {</span>
<span id="cb34-1811"><a href="#cb34-1811" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">save</span>()<span class="op">;</span></span>
<span id="cb34-1812"><a href="#cb34-1812" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">clearRect</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width<span class="op">,</span> height)<span class="op">;</span></span>
<span id="cb34-1813"><a href="#cb34-1813" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-1814"><a href="#cb34-1814" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">translate</span>(transform<span class="op">.</span><span class="at">x</span><span class="op">,</span> transform<span class="op">.</span><span class="at">y</span>)<span class="op">;</span></span>
<span id="cb34-1815"><a href="#cb34-1815" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">scale</span>(transform<span class="op">.</span><span class="at">k</span><span class="op">,</span> transform<span class="op">.</span><span class="at">k</span>)<span class="op">;</span></span>
<span id="cb34-1816"><a href="#cb34-1816" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-1817"><a href="#cb34-1817" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> radius <span class="op">=</span> opts<span class="op">.</span><span class="at">pt_size</span> <span class="op">/</span> transform<span class="op">.</span><span class="at">k</span><span class="op">;</span></span>
<span id="cb34-1818"><a href="#cb34-1818" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">globalAlpha</span> <span class="op">=</span> opts<span class="op">.</span><span class="at">pt_opacity</span><span class="op">;</span></span>
<span id="cb34-1819"><a href="#cb34-1819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1820"><a href="#cb34-1820" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> cOther <span class="op">=</span> colors<span class="op">.</span><span class="at">other</span><span class="op">;</span></span>
<span id="cb34-1821"><a href="#cb34-1821" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> cL1 <span class="op">=</span> colors<span class="op">.</span><span class="at">l1</span><span class="op">;</span></span>
<span id="cb34-1822"><a href="#cb34-1822" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> cL2 <span class="op">=</span> colors<span class="op">.</span><span class="at">l2</span><span class="op">;</span></span>
<span id="cb34-1823"><a href="#cb34-1823" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> L1 <span class="op">=</span> (levels <span class="op">&amp;&amp;</span> levels<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">?</span> levels[<span class="dv">0</span>] <span class="op">:</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb34-1824"><a href="#cb34-1824" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> L2 <span class="op">=</span> (levels <span class="op">&amp;&amp;</span> levels<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">1</span>) <span class="op">?</span> levels[<span class="dv">1</span>] <span class="op">:</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb34-1825"><a href="#cb34-1825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1826"><a href="#cb34-1826" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> data<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb34-1827"><a href="#cb34-1827" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> d <span class="op">=</span> data[i]<span class="op">;</span></span>
<span id="cb34-1828"><a href="#cb34-1828" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> fill <span class="op">=</span> cOther<span class="op">;</span></span>
<span id="cb34-1829"><a href="#cb34-1829" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb34-1830"><a href="#cb34-1830" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (isContinuous) {</span>
<span id="cb34-1831"><a href="#cb34-1831" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> (d<span class="op">.</span><span class="at">group_id</span> <span class="op">!=</span> <span class="kw">null</span>) {</span>
<span id="cb34-1832"><a href="#cb34-1832" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> val <span class="op">=</span> useLog <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(d<span class="op">.</span><span class="at">group_id</span> <span class="op">+</span> <span class="dv">1</span>) <span class="op">:</span> d<span class="op">.</span><span class="at">group_id</span><span class="op">;</span></span>
<span id="cb34-1833"><a href="#cb34-1833" aria-hidden="true" tabindex="-1"></a>            fill <span class="op">=</span> <span class="fu">colorScale</span>(val)<span class="op">;</span></span>
<span id="cb34-1834"><a href="#cb34-1834" aria-hidden="true" tabindex="-1"></a>         }</span>
<span id="cb34-1835"><a href="#cb34-1835" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb34-1836"><a href="#cb34-1836" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> (L1 <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">group_id</span> <span class="op">===</span> L1) fill <span class="op">=</span> cL1<span class="op">;</span></span>
<span id="cb34-1837"><a href="#cb34-1837" aria-hidden="true" tabindex="-1"></a>         <span class="cf">else</span> <span class="cf">if</span> (L2 <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">group_id</span> <span class="op">===</span> L2) fill <span class="op">=</span> cL2<span class="op">;</span></span>
<span id="cb34-1838"><a href="#cb34-1838" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb34-1839"><a href="#cb34-1839" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb34-1840"><a href="#cb34-1840" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> xy <span class="op">=</span> <span class="fu">project</span>(d<span class="op">.</span><span class="at">x_slide_mm</span><span class="op">,</span> d<span class="op">.</span><span class="at">y_slide_mm</span>)<span class="op">;</span></span>
<span id="cb34-1841"><a href="#cb34-1841" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb34-1842"><a href="#cb34-1842" aria-hidden="true" tabindex="-1"></a>      ctx<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb34-1843"><a href="#cb34-1843" aria-hidden="true" tabindex="-1"></a>      ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> fill<span class="op">;</span></span>
<span id="cb34-1844"><a href="#cb34-1844" aria-hidden="true" tabindex="-1"></a>      ctx<span class="op">.</span><span class="fu">fillRect</span>(xy[<span class="dv">0</span>] <span class="op">-</span> radius<span class="op">,</span> xy[<span class="dv">1</span>] <span class="op">-</span> radius<span class="op">,</span> radius<span class="op">*</span><span class="dv">2</span><span class="op">,</span> radius<span class="op">*</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb34-1845"><a href="#cb34-1845" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb34-1846"><a href="#cb34-1846" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-1847"><a href="#cb34-1847" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">restore</span>()<span class="op">;</span></span>
<span id="cb34-1848"><a href="#cb34-1848" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-1849"><a href="#cb34-1849" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (opts<span class="op">.</span><span class="at">show_scale</span>) {</span>
<span id="cb34-1850"><a href="#cb34-1850" aria-hidden="true" tabindex="-1"></a>       <span class="kw">const</span> barLenMm <span class="op">=</span> opts<span class="op">.</span><span class="at">scale_len</span><span class="op">;</span></span>
<span id="cb34-1851"><a href="#cb34-1851" aria-hidden="true" tabindex="-1"></a>       <span class="kw">const</span> barLenPx <span class="op">=</span> barLenMm <span class="op">*</span> pixelsPerMm <span class="op">*</span> transform<span class="op">.</span><span class="at">k</span><span class="op">;</span> </span>
<span id="cb34-1852"><a href="#cb34-1852" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb34-1853"><a href="#cb34-1853" aria-hidden="true" tabindex="-1"></a>       <span class="kw">const</span> margin <span class="op">=</span> <span class="dv">20</span><span class="op">;</span></span>
<span id="cb34-1854"><a href="#cb34-1854" aria-hidden="true" tabindex="-1"></a>       <span class="kw">const</span> barX <span class="op">=</span> width <span class="op">-</span> margin <span class="op">-</span> barLenPx<span class="op">;</span></span>
<span id="cb34-1855"><a href="#cb34-1855" aria-hidden="true" tabindex="-1"></a>       <span class="kw">const</span> barY <span class="op">=</span> height <span class="op">-</span> margin<span class="op">;</span></span>
<span id="cb34-1856"><a href="#cb34-1856" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb34-1857"><a href="#cb34-1857" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">save</span>()<span class="op">;</span></span>
<span id="cb34-1858"><a href="#cb34-1858" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb34-1859"><a href="#cb34-1859" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> opts<span class="op">.</span><span class="at">scale_color</span><span class="op">;</span></span>
<span id="cb34-1860"><a href="#cb34-1860" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="at">lineWidth</span> <span class="op">=</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="cb34-1861"><a href="#cb34-1861" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">moveTo</span>(barX<span class="op">,</span> barY)<span class="op">;</span></span>
<span id="cb34-1862"><a href="#cb34-1862" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">lineTo</span>(barX <span class="op">+</span> barLenPx<span class="op">,</span> barY)<span class="op">;</span></span>
<span id="cb34-1863"><a href="#cb34-1863" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb34-1864"><a href="#cb34-1864" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb34-1865"><a href="#cb34-1865" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> opts<span class="op">.</span><span class="at">scale_color</span><span class="op">;</span></span>
<span id="cb34-1866"><a href="#cb34-1866" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="at">font</span> <span class="op">=</span> <span class="st">"bold 14px sans-serif"</span><span class="op">;</span></span>
<span id="cb34-1867"><a href="#cb34-1867" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="at">textAlign</span> <span class="op">=</span> <span class="st">"center"</span><span class="op">;</span></span>
<span id="cb34-1868"><a href="#cb34-1868" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="at">textBaseline</span> <span class="op">=</span> <span class="st">"bottom"</span><span class="op">;</span></span>
<span id="cb34-1869"><a href="#cb34-1869" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">fillText</span>(<span class="vs">`</span><span class="sc">${</span>barLenMm<span class="sc">}</span><span class="vs"> mm`</span><span class="op">,</span> barX <span class="op">+</span> barLenPx<span class="op">/</span><span class="dv">2</span><span class="op">,</span> barY <span class="op">-</span> <span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb34-1870"><a href="#cb34-1870" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">restore</span>()<span class="op">;</span></span>
<span id="cb34-1871"><a href="#cb34-1871" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb34-1872"><a href="#cb34-1872" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-1873"><a href="#cb34-1873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1874"><a href="#cb34-1874" aria-hidden="true" tabindex="-1"></a>  <span class="fu">draw</span>()<span class="op">;</span></span>
<span id="cb34-1875"><a href="#cb34-1875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1876"><a href="#cb34-1876" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> zoom <span class="op">=</span> d3<span class="op">.</span><span class="fu">zoom</span>()</span>
<span id="cb34-1877"><a href="#cb34-1877" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">scaleExtent</span>([<span class="fl">0.5</span><span class="op">,</span> <span class="dv">50</span>]) </span>
<span id="cb34-1878"><a href="#cb34-1878" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"zoom"</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb34-1879"><a href="#cb34-1879" aria-hidden="true" tabindex="-1"></a>      transform <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">transform</span><span class="op">;</span></span>
<span id="cb34-1880"><a href="#cb34-1880" aria-hidden="true" tabindex="-1"></a>      <span class="fu">requestAnimationFrame</span>(draw)<span class="op">;</span></span>
<span id="cb34-1881"><a href="#cb34-1881" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb34-1882"><a href="#cb34-1882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1883"><a href="#cb34-1883" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">select</span>(canvas)<span class="op">.</span><span class="fu">call</span>(zoom)<span class="op">;</span></span>
<span id="cb34-1884"><a href="#cb34-1884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1885"><a href="#cb34-1885" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> div<span class="op">;</span></span>
<span id="cb34-1886"><a href="#cb34-1886" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div id="ojs-cell-34" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
<div class="card hidden html-fill-item html-fill-container bslib-card" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="cell card-body html-fill-item html-fill-container" data-autorun="true" data-input="[&quot;term_selection&quot;,&quot;slide_selection&quot;,&quot;db_ready&quot;]" data-define="r_spatial_data_export">
<div class="html-fill-item html-fill-container">
<div id="webr-12" class="exercise-cell html-fill-item html-fill-container">

</div>
<script type="webr-12-contents">
eyJhdHRyIjp7ImF1dG9ydW4iOnRydWUsImRlZmluZSI6WyJyX3NwYXRpYWxfZGF0YV9leHBvcnQiXSwiZWNobyI6ZmFsc2UsImVkaXQiOmZhbHNlLCJldmFsIjp0cnVlLCJpbnB1dCI6WyJ0ZXJtX3NlbGVjdGlvbiIsInNsaWRlX3NlbGVjdGlvbiIsImRiX3JlYWR5Il19LCJjb2RlIjoiXG5yX3NwYXRpYWxfZGF0YV9leHBvcnQgPC0gTlVMTFxuXG5pZiAoZGJfcmVhZHkgJiYgIWlzLm51bGwodGVybV9zZWxlY3Rpb24pICYmICFpcy5udWxsKHNsaWRlX3NlbGVjdGlvbikpIHtcbiAgIyBRdWVyeSB0aGUgdmlldyB3ZSBhbHJlYWR5IGVzdGFibGlzaGVkIGR1cmluZyBzdHVkeSBsb2FkaW5nXG4gIHF1ZXJ5IDwtIHBhc3RlMChcbiAgICBcIlNFTEVDVCAqLCBcIiwgdGVybV9zZWxlY3Rpb24sIFwiIGFzIGdyb3VwX2lkIFwiLFxuICAgIFwiRlJPTSBjZWxsX21ldGEgV0hFUkUgc2xpZGVfaWRfbnVtZXJpYyA9IFwiLCBzbGlkZV9zZWxlY3Rpb25cbiAgKVxuICBcbiAgdHJ5Q2F0Y2goe1xuICAgICMgRmV0Y2ggZnJvbSB0aGUgZXhpc3RpbmcgRHVja0RCIGNvbm5lY3Rpb25cbiAgICByX3NwYXRpYWxfZGF0YV9leHBvcnQgPC0gZGJHZXRRdWVyeShjb24sIHF1ZXJ5KVxuICB9LCBlcnJvciA9IGZ1bmN0aW9uKGUpIHtcbiAgICBjYXQoXCJTcGF0aWFsIHF1ZXJ5IHdhaXRpbmcgZm9yIHZpZXcgaW5pdGlhbGl6YXRpb24uLi5cXG5cIilcbiAgICByX3NwYXRpYWxfZGF0YV9leHBvcnQgPC0gTlVMTFxuICB9KVxufSJ9
</script>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div>
</div>
</div>
</div><div id="sec-convert-atomx" class="dashboard-page tab-pane grid-skip html-fill-item html-fill-container" data-scrolling="true" data-orientation="rows" aria-labelledby="tab-sec-convert-atomx">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, 20fr) minmax(3em, 30fr) minmax(3em, 50fr); grid-auto-columns: minmax(0, 1fr);">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-columns: minmax(3em, 1fr);
grid-auto-rows: minmax(0, 1fr);">
<div class="card html-fill-item html-fill-container bslib-card" data-title="How to use this dashboard with your results derived from AtoMx SIP" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-header"><div class="card-title html-fill-item html-fill-container"><span style="display: inline">
How to use this dashboard with your results derived from AtoMx SIP
</span></div></div>
<div class="card-body html-fill-item html-fill-container">
<p>In AtoMx SIP, when your differential expression (DE) results are ready you can download them. This download will be a zip file named something like <code>output_results.zip</code>. This file is relatively large but luckily for this “Byte-sized” dashboard we only need a few of the columns. You can use this section to format that large zip file into a dashboard-ready zip file that contains essential information. See the card below to load your AtoMx-derived DE zip file. You’ll be given the option to add optional study description and model formula that can be handy when you are comparing multiple studies at once. When the processing is finished, you will have the option to download the dashboard-ready and formatted zip file, load it directly into this dashboard, or both. One thing to note is that the DE zip file that is downloaded from AtoMx SIP does not contain cell-level metadata and so the Spatial Plots section will only contain a placeholder dataset (just four ‘cells’) and not actual data.</p>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div>
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-columns: minmax(3em, 50fr) minmax(3em, 50fr);
grid-auto-rows: minmax(0, 1fr);">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, 1fr); grid-auto-columns: minmax(0, 1fr);">
<div class="card html-fill-item html-fill-container bslib-card" data-title="Step 1: Load AtoMx SIP DE Results" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-header"><div class="card-title html-fill-item html-fill-container"><span style="display: inline">
Step 1: Load AtoMx SIP DE Results
</span></div></div>
<div class="cell card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb35" data-startfrom="1957" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1956;"><span id="cb35-1957"><a href="#cb35-1957" aria-hidden="true" tabindex="-1"></a>viewof atomx_zip_file <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">file</span>({</span>
<span id="cb35-1958"><a href="#cb35-1958" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">"Import AtoMx SIP DE Results (.zip):"</span><span class="op">,</span></span>
<span id="cb35-1959"><a href="#cb35-1959" aria-hidden="true" tabindex="-1"></a>  <span class="dt">accept</span><span class="op">:</span> <span class="st">".zip"</span></span>
<span id="cb35-1960"><a href="#cb35-1960" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb35-1961"><a href="#cb35-1961" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1962"><a href="#cb35-1962" aria-hidden="true" tabindex="-1"></a>atomx_surgical_ingestor <span class="op">=</span> {</span>
<span id="cb35-1963"><a href="#cb35-1963" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>atomx_zip_file) <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb35-1964"><a href="#cb35-1964" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-1965"><a href="#cb35-1965" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span> {</span>
<span id="cb35-1966"><a href="#cb35-1966" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"🛠️ INGESTOR START: Reading ArrayBuffer..."</span>)<span class="op">;</span></span>
<span id="cb35-1967"><a href="#cb35-1967" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> buffer <span class="op">=</span> <span class="cf">await</span> atomx_zip_file<span class="op">.</span><span class="fu">arrayBuffer</span>()<span class="op">;</span></span>
<span id="cb35-1968"><a href="#cb35-1968" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> z <span class="op">=</span> <span class="cf">await</span> <span class="im">import</span>(<span class="st">"https://cdn.jsdelivr.net/npm/@zip.js/zip.js@2.7.34/+esm"</span>)<span class="op">;</span></span>
<span id="cb35-1969"><a href="#cb35-1969" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-1970"><a href="#cb35-1970" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create the reader from the Uint8Array of the full zip</span></span>
<span id="cb35-1971"><a href="#cb35-1971" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> reader <span class="op">=</span> <span class="kw">new</span> z<span class="op">.</span><span class="fu">ZipReader</span>(<span class="kw">new</span> z<span class="op">.</span><span class="fu">Uint8ArrayReader</span>(<span class="kw">new</span> <span class="bu">Uint8Array</span>(buffer)))<span class="op">;</span></span>
<span id="cb35-1972"><a href="#cb35-1972" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> entries <span class="op">=</span> <span class="cf">await</span> reader<span class="op">.</span><span class="fu">getEntries</span>()<span class="op">;</span></span>
<span id="cb35-1973"><a href="#cb35-1973" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-1974"><a href="#cb35-1974" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> targets <span class="op">=</span> [<span class="st">"emmeans.csv"</span><span class="op">,</span> <span class="st">"pairwise.csv"</span><span class="op">,</span> <span class="st">"one.vs.rest.csv"</span><span class="op">,</span> <span class="st">"one.vs.all.csv"</span>]<span class="op">;</span></span>
<span id="cb35-1975"><a href="#cb35-1975" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> conn <span class="op">=</span> <span class="cf">await</span> duck_db_client<span class="op">;</span></span>
<span id="cb35-1976"><a href="#cb35-1976" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> db <span class="op">=</span> conn<span class="op">.</span><span class="at">instance</span> <span class="op">||</span> conn<span class="op">.</span><span class="at">db</span> <span class="op">||</span> conn<span class="op">;</span></span>
<span id="cb35-1977"><a href="#cb35-1977" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1978"><a href="#cb35-1978" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">const</span> entry <span class="kw">of</span> entries) {</span>
<span id="cb35-1979"><a href="#cb35-1979" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> match <span class="op">=</span> targets<span class="op">.</span><span class="fu">find</span>(t <span class="kw">=&gt;</span> entry<span class="op">.</span><span class="at">filename</span><span class="op">.</span><span class="fu">toLowerCase</span>()<span class="op">.</span><span class="fu">includes</span>(t))<span class="op">;</span></span>
<span id="cb35-1980"><a href="#cb35-1980" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (match) {</span>
<span id="cb35-1981"><a href="#cb35-1981" aria-hidden="true" tabindex="-1"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="vs">`📦 ZIP ENTRY FOUND: </span><span class="sc">${</span>entry<span class="op">.</span><span class="at">filename</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb35-1982"><a href="#cb35-1982" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb35-1983"><a href="#cb35-1983" aria-hidden="true" tabindex="-1"></a>        <span class="co">// FIX: Ensure we are awaiting the full data extraction</span></span>
<span id="cb35-1984"><a href="#cb35-1984" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> uint8 <span class="op">=</span> <span class="cf">await</span> entry<span class="op">.</span><span class="fu">getData</span>(<span class="kw">new</span> z<span class="op">.</span><span class="fu">Uint8ArrayWriter</span>())<span class="op">;</span></span>
<span id="cb35-1985"><a href="#cb35-1985" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb35-1986"><a href="#cb35-1986" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (uint8 <span class="op">&amp;&amp;</span> uint8<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb35-1987"><a href="#cb35-1987" aria-hidden="true" tabindex="-1"></a>          <span class="cf">await</span> db<span class="op">.</span><span class="fu">registerFileBuffer</span>(match<span class="op">,</span> uint8)<span class="op">;</span></span>
<span id="cb35-1988"><a href="#cb35-1988" aria-hidden="true" tabindex="-1"></a>          <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="vs">`✅ REGISTERED: </span><span class="sc">${</span>match<span class="sc">}</span><span class="vs"> (</span><span class="sc">${</span>uint8<span class="op">.</span><span class="at">length</span><span class="op">.</span><span class="fu">toLocaleString</span>()<span class="sc">}</span><span class="vs"> bytes)`</span>)<span class="op">;</span></span>
<span id="cb35-1989"><a href="#cb35-1989" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb35-1990"><a href="#cb35-1990" aria-hidden="true" tabindex="-1"></a>          <span class="bu">console</span><span class="op">.</span><span class="fu">warn</span>(<span class="vs">`⚠️ WARNING: </span><span class="sc">${</span>match<span class="sc">}</span><span class="vs"> extracted as 0 bytes!`</span>)<span class="op">;</span></span>
<span id="cb35-1991"><a href="#cb35-1991" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb35-1992"><a href="#cb35-1992" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb35-1993"><a href="#cb35-1993" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb35-1994"><a href="#cb35-1994" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-1995"><a href="#cb35-1995" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> reader<span class="op">.</span><span class="fu">close</span>()<span class="op">;</span></span>
<span id="cb35-1996"><a href="#cb35-1996" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> { <span class="dt">status</span><span class="op">:</span> <span class="st">"ready"</span><span class="op">,</span> <span class="dt">timestamp</span><span class="op">:</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>() }<span class="op">;</span></span>
<span id="cb35-1997"><a href="#cb35-1997" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">catch</span> (err) {</span>
<span id="cb35-1998"><a href="#cb35-1998" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(<span class="st">"❌ INGESTOR CRITICAL ERROR:"</span><span class="op">,</span> err)<span class="op">;</span></span>
<span id="cb35-1999"><a href="#cb35-1999" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> { <span class="dt">status</span><span class="op">:</span> <span class="st">"error"</span><span class="op">,</span> <span class="dt">message</span><span class="op">:</span> err<span class="op">.</span><span class="at">message</span> }<span class="op">;</span></span>
<span id="cb35-2000"><a href="#cb35-2000" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb35-2001"><a href="#cb35-2001" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-35-1" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-35-2" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
</div>
<div class="cell hidden card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb36" data-startfrom="2007" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2006;"><span id="cb36-2007"><a href="#cb36-2007" aria-hidden="true" tabindex="-1"></a>atomx_parquet_generator <span class="op">=</span> {</span>
<span id="cb36-2008"><a href="#cb36-2008" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>atomx_surgical_ingestor <span class="op">||</span> atomx_surgical_ingestor<span class="op">.</span><span class="at">status</span> <span class="op">!==</span> <span class="st">"ready"</span>) <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb36-2009"><a href="#cb36-2009" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>atomx_metadata <span class="op">||</span> atomx_metadata<span class="op">.</span><span class="at">process_btn</span> <span class="op">===</span> <span class="dv">0</span>) <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb36-2010"><a href="#cb36-2010" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-2011"><a href="#cb36-2011" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> conn <span class="op">=</span> <span class="cf">await</span> duck_db_client<span class="op">;</span></span>
<span id="cb36-2012"><a href="#cb36-2012" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"🪄 GENERATOR START: Building SQL Views..."</span>)<span class="op">;</span></span>
<span id="cb36-2013"><a href="#cb36-2013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-2014"><a href="#cb36-2014" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span> {</span>
<span id="cb36-2015"><a href="#cb36-2015" aria-hidden="true" tabindex="-1"></a>    <span class="co">// FIX: Use DuckDB's internal schema field mapping</span></span>
<span id="cb36-2016"><a href="#cb36-2016" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"🔍 Probing columns in pairwise.csv..."</span>)<span class="op">;</span></span>
<span id="cb36-2017"><a href="#cb36-2017" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> schemaRes <span class="op">=</span> <span class="cf">await</span> conn<span class="op">.</span><span class="fu">query</span>(<span class="st">"SELECT * FROM read_csv_auto('pairwise.csv') LIMIT 0"</span>)<span class="op">;</span></span>
<span id="cb36-2018"><a href="#cb36-2018" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> cols <span class="op">=</span> schemaRes<span class="op">.</span><span class="at">schema</span><span class="op">.</span><span class="at">fields</span><span class="op">.</span><span class="fu">map</span>(f <span class="kw">=&gt;</span> f<span class="op">.</span><span class="at">name</span>)<span class="op">;</span></span>
<span id="cb36-2019"><a href="#cb36-2019" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"📋 Detected Columns:"</span><span class="op">,</span> cols)<span class="op">;</span></span>
<span id="cb36-2020"><a href="#cb36-2020" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-2021"><a href="#cb36-2021" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> n1 <span class="op">=</span> cols<span class="op">.</span><span class="fu">includes</span>(<span class="st">"ncells_1"</span>) <span class="op">?</span> <span class="st">"ncells_1"</span> <span class="op">:</span> <span class="st">"NULL as ncells_1"</span><span class="op">;</span></span>
<span id="cb36-2022"><a href="#cb36-2022" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> n2 <span class="op">=</span> cols<span class="op">.</span><span class="fu">includes</span>(<span class="st">"ncells_2"</span>) <span class="op">?</span> <span class="st">"ncells_2"</span> <span class="op">:</span> <span class="st">"NULL as ncells_2"</span><span class="op">;</span></span>
<span id="cb36-2023"><a href="#cb36-2023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-2024"><a href="#cb36-2024" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 1. Harmonize EMMEANS</span></span>
<span id="cb36-2025"><a href="#cb36-2025" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> conn<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb36-2026"><a href="#cb36-2026" aria-hidden="true" tabindex="-1"></a><span class="vs">      CREATE OR REPLACE VIEW emmeans_final AS</span></span>
<span id="cb36-2027"><a href="#cb36-2027" aria-hidden="true" tabindex="-1"></a><span class="vs">      WITH base AS (</span></span>
<span id="cb36-2028"><a href="#cb36-2028" aria-hidden="true" tabindex="-1"></a><span class="vs">        SELECT *,</span></span>
<span id="cb36-2029"><a href="#cb36-2029" aria-hidden="true" tabindex="-1"></a><span class="vs">          regexp_replace(level, term, '') as suffix_str,</span></span>
<span id="cb36-2030"><a href="#cb36-2030" aria-hidden="true" tabindex="-1"></a><span class="vs">          TRY_CAST(regexp_replace(level, term, '') AS DOUBLE) as suffix_val,</span></span>
<span id="cb36-2031"><a href="#cb36-2031" aria-hidden="true" tabindex="-1"></a><span class="vs">          (level LIKE term || '%') AND (TRY_CAST(regexp_replace(level, term, '') AS DOUBLE) IS NOT NULL) as is_continuous</span></span>
<span id="cb36-2032"><a href="#cb36-2032" aria-hidden="true" tabindex="-1"></a><span class="vs">        FROM read_csv_auto('emmeans.csv')</span></span>
<span id="cb36-2033"><a href="#cb36-2033" aria-hidden="true" tabindex="-1"></a><span class="vs">        WHERE term != 'otherct_expr'</span></span>
<span id="cb36-2034"><a href="#cb36-2034" aria-hidden="true" tabindex="-1"></a><span class="vs">      )</span></span>
<span id="cb36-2035"><a href="#cb36-2035" aria-hidden="true" tabindex="-1"></a><span class="vs">      SELECT </span></span>
<span id="cb36-2036"><a href="#cb36-2036" aria-hidden="true" tabindex="-1"></a><span class="vs">        term,</span></span>
<span id="cb36-2037"><a href="#cb36-2037" aria-hidden="true" tabindex="-1"></a><span class="vs">        CASE </span></span>
<span id="cb36-2038"><a href="#cb36-2038" aria-hidden="true" tabindex="-1"></a><span class="vs">          WHEN is_continuous AND category = 'c1' THEN 'mean + 1SD (' || printf('%.2f', suffix_val) || ')'</span></span>
<span id="cb36-2039"><a href="#cb36-2039" aria-hidden="true" tabindex="-1"></a><span class="vs">          WHEN is_continuous AND category = 'c2' THEN 'mean  (' || printf('%.2f', suffix_val) || ')'</span></span>
<span id="cb36-2040"><a href="#cb36-2040" aria-hidden="true" tabindex="-1"></a><span class="vs">          ELSE level </span></span>
<span id="cb36-2041"><a href="#cb36-2041" aria-hidden="true" tabindex="-1"></a><span class="vs">        END as level,</span></span>
<span id="cb36-2042"><a href="#cb36-2042" aria-hidden="true" tabindex="-1"></a><span class="vs">        target, response, "asymp.LCL", "asymp.UCL"</span></span>
<span id="cb36-2043"><a href="#cb36-2043" aria-hidden="true" tabindex="-1"></a><span class="vs">      FROM base</span></span>
<span id="cb36-2044"><a href="#cb36-2044" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span>)<span class="op">;</span></span>
<span id="cb36-2045"><a href="#cb36-2045" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-2046"><a href="#cb36-2046" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 2. Build Master PAIRWISE Union</span></span>
<span id="cb36-2047"><a href="#cb36-2047" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> conn<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb36-2048"><a href="#cb36-2048" aria-hidden="true" tabindex="-1"></a><span class="vs">      CREATE OR REPLACE VIEW pairwise_final AS</span></span>
<span id="cb36-2049"><a href="#cb36-2049" aria-hidden="true" tabindex="-1"></a><span class="vs">      SELECT 'pairwise' as contrast_type, term, contrast, target, log2(fold_change) as log2fc, "p.value", </span><span class="sc">${</span>n1<span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>n2<span class="sc">}</span><span class="vs"> FROM read_csv_auto('pairwise.csv')</span></span>
<span id="cb36-2050"><a href="#cb36-2050" aria-hidden="true" tabindex="-1"></a><span class="vs">      UNION ALL</span></span>
<span id="cb36-2051"><a href="#cb36-2051" aria-hidden="true" tabindex="-1"></a><span class="vs">      SELECT 'one_vs_rest', term, contrast, target, log2(fold_change), "p.value", </span><span class="sc">${</span>n1<span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>n2<span class="sc">}</span><span class="vs"> FROM read_csv_auto('one.vs.rest.csv')</span></span>
<span id="cb36-2052"><a href="#cb36-2052" aria-hidden="true" tabindex="-1"></a><span class="vs">      UNION ALL</span></span>
<span id="cb36-2053"><a href="#cb36-2053" aria-hidden="true" tabindex="-1"></a><span class="vs">      SELECT 'one_vs_all', term, contrast, target, log2(fold_change), "p.value", </span><span class="sc">${</span>n1<span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>n2<span class="sc">}</span><span class="vs"> FROM read_csv_auto('one.vs.all.csv')</span></span>
<span id="cb36-2054"><a href="#cb36-2054" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span>)<span class="op">;</span></span>
<span id="cb36-2055"><a href="#cb36-2055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-2056"><a href="#cb36-2056" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"✅ GENERATOR SUCCESS!"</span>)<span class="op">;</span></span>
<span id="cb36-2057"><a href="#cb36-2057" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> { <span class="dt">ready</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">timestamp</span><span class="op">:</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>() }<span class="op">;</span></span>
<span id="cb36-2058"><a href="#cb36-2058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-2059"><a href="#cb36-2059" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">catch</span> (err) {</span>
<span id="cb36-2060"><a href="#cb36-2060" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(<span class="st">"❌ GENERATOR SQL ERROR:"</span><span class="op">,</span> err)<span class="op">;</span></span>
<span id="cb36-2061"><a href="#cb36-2061" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> { <span class="dt">ready</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span> <span class="dt">error</span><span class="op">:</span> err<span class="op">.</span><span class="at">message</span> }<span class="op">;</span></span>
<span id="cb36-2062"><a href="#cb36-2062" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-2063"><a href="#cb36-2063" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div id="ojs-cell-36" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div><div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, 1fr); grid-auto-columns: minmax(0, 1fr);">
<div class="card html-fill-item html-fill-container bslib-card" data-title="Step 2: Add Additional Information" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-header"><div class="card-title html-fill-item html-fill-container"><span style="display: inline">
Step 2: Add Additional Information
</span></div></div>
<div class="cell card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb37" data-startfrom="2077" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2076;"><span id="cb37-2077"><a href="#cb37-2077" aria-hidden="true" tabindex="-1"></a>viewof atomx_metadata <span class="op">=</span> {</span>
<span id="cb37-2078"><a href="#cb37-2078" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-2079"><a href="#cb37-2079" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>atomx_surgical_ingestor <span class="op">||</span> atomx_surgical_ingestor<span class="op">.</span><span class="at">status</span> <span class="op">!==</span> <span class="st">"ready"</span>) {</span>
<span id="cb37-2080"><a href="#cb37-2080" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">html</span><span class="vs">`</span></span>
<span id="cb37-2081"><a href="#cb37-2081" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div style="margin-top: 10px; padding: 15px; border: 1px dashed #ddd; border-radius: 8px; background: #fafafa; color: #666;"&gt;</span></span>
<span id="cb37-2082"><a href="#cb37-2082" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;h5 style="text-transform: uppercase; color: #888; font-size: 0.75em; margin-bottom: 8px;"&gt;AtoMx Ingestor Status&lt;/h5&gt;</span></span>
<span id="cb37-2083"><a href="#cb37-2083" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;div style="font-size: 0.9em; display: flex; align-items: center; gap: 10px;"&gt;</span></span>
<span id="cb37-2084"><a href="#cb37-2084" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;div class="spinner-border spinner-border-sm text-secondary" role="status"&gt;&lt;/div&gt;</span></span>
<span id="cb37-2085"><a href="#cb37-2085" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;span&gt;Waiting for AtoMx SIP results import from Step 1...&lt;/span&gt;</span></span>
<span id="cb37-2086"><a href="#cb37-2086" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;/div&gt;</span></span>
<span id="cb37-2087"><a href="#cb37-2087" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/div&gt;</span></span>
<span id="cb37-2088"><a href="#cb37-2088" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb37-2089"><a href="#cb37-2089" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb37-2090"><a href="#cb37-2090" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-2091"><a href="#cb37-2091" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-2092"><a href="#cb37-2092" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> form <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">form</span>({</span>
<span id="cb37-2093"><a href="#cb37-2093" aria-hidden="true" tabindex="-1"></a>    <span class="dt">study_name</span><span class="op">:</span>  Inputs<span class="op">.</span><span class="fu">text</span>({<span class="dt">label</span><span class="op">:</span> <span class="st">"Study Name"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="st">"AtoMx Analysis"</span>})<span class="op">,</span></span>
<span id="cb37-2094"><a href="#cb37-2094" aria-hidden="true" tabindex="-1"></a>    <span class="dt">description</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">text</span>({<span class="dt">label</span><span class="op">:</span> <span class="st">"Description"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="st">"AtoMx SIP Export"</span>})<span class="op">,</span></span>
<span id="cb37-2095"><a href="#cb37-2095" aria-hidden="true" tabindex="-1"></a>    <span class="dt">formula</span><span class="op">:</span>     Inputs<span class="op">.</span><span class="fu">text</span>({<span class="dt">label</span><span class="op">:</span> <span class="st">"Model Formula"</span><span class="op">,</span> <span class="dt">placeholder</span><span class="op">:</span> <span class="st">"e.g. ~annotated_domain"</span>})<span class="op">,</span></span>
<span id="cb37-2096"><a href="#cb37-2096" aria-hidden="true" tabindex="-1"></a>    <span class="dt">process_btn</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">button</span>(<span class="st">"🚀 Format Results"</span><span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="dv">0</span>})</span>
<span id="cb37-2097"><a href="#cb37-2097" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb37-2098"><a href="#cb37-2098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-2099"><a href="#cb37-2099" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-2100"><a href="#cb37-2100" aria-hidden="true" tabindex="-1"></a>  form<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">border</span> <span class="op">=</span> <span class="st">"1px solid #eee"</span><span class="op">;</span></span>
<span id="cb37-2101"><a href="#cb37-2101" aria-hidden="true" tabindex="-1"></a>  form<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">borderRadius</span> <span class="op">=</span> <span class="st">"8px"</span><span class="op">;</span></span>
<span id="cb37-2102"><a href="#cb37-2102" aria-hidden="true" tabindex="-1"></a>  form<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">padding</span> <span class="op">=</span> <span class="st">"20px"</span><span class="op">;</span></span>
<span id="cb37-2103"><a href="#cb37-2103" aria-hidden="true" tabindex="-1"></a>  form<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">background</span> <span class="op">=</span> <span class="st">"#fff"</span><span class="op">;</span></span>
<span id="cb37-2104"><a href="#cb37-2104" aria-hidden="true" tabindex="-1"></a>  form<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">marginTop</span> <span class="op">=</span> <span class="st">"10px"</span><span class="op">;</span></span>
<span id="cb37-2105"><a href="#cb37-2105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-2106"><a href="#cb37-2106" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Prepend the header inside the form card</span></span>
<span id="cb37-2107"><a href="#cb37-2107" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> header <span class="op">=</span> <span class="fu">html</span><span class="vs">`</span></span>
<span id="cb37-2108"><a href="#cb37-2108" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;h5 style="text-transform: uppercase; color: #888; font-size: 0.75em; margin-bottom: 12px; border-bottom: 1px solid #eee; padding-bottom: 8px;"&gt;</span></span>
<span id="cb37-2109"><a href="#cb37-2109" aria-hidden="true" tabindex="-1"></a><span class="vs">      Optional Study Metadata</span></span>
<span id="cb37-2110"><a href="#cb37-2110" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/h5&gt;</span></span>
<span id="cb37-2111"><a href="#cb37-2111" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span><span class="op">;</span></span>
<span id="cb37-2112"><a href="#cb37-2112" aria-hidden="true" tabindex="-1"></a>  form<span class="op">.</span><span class="fu">prepend</span>(header)<span class="op">;</span></span>
<span id="cb37-2113"><a href="#cb37-2113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-2114"><a href="#cb37-2114" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> form<span class="op">;</span></span>
<span id="cb37-2115"><a href="#cb37-2115" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div id="ojs-cell-37" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div>
</div>
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-columns: minmax(3em, 1fr);
grid-auto-rows: minmax(0, 1fr);">
<div class="card html-fill-item html-fill-container bslib-card" data-title="Step 3: Choose What To Do With Formatted Results" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-header"><div class="card-title html-fill-item html-fill-container"><span style="display: inline">
Step 3: Choose What To Do With Formatted Results
</span></div></div>
<div class="card-body html-fill-item html-fill-container">
<div id="atomx-download-container" style="margin-top: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 8px; background: #fafafa;" class="html-fill-item html-fill-container">

</div>
</div>
<div class="cell hidden card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb38" data-startfrom="2131" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2130;"><span id="cb38-2131"><a href="#cb38-2131" aria-hidden="true" tabindex="-1"></a>atomx_downloader_manager <span class="op">=</span> {</span>
<span id="cb38-2132"><a href="#cb38-2132" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> container <span class="op">=</span> d3<span class="op">.</span><span class="fu">select</span>(<span class="st">"#atomx-download-container"</span>)<span class="op">;</span></span>
<span id="cb38-2133"><a href="#cb38-2133" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-2134"><a href="#cb38-2134" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Guard: Hide container if data isn't processed yet</span></span>
<span id="cb38-2135"><a href="#cb38-2135" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>atomx_parquet_generator <span class="op">||</span> <span class="op">!</span>atomx_parquet_generator<span class="op">.</span><span class="at">ready</span>) {</span>
<span id="cb38-2136"><a href="#cb38-2136" aria-hidden="true" tabindex="-1"></a>    container<span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"none"</span>)<span class="op">;</span></span>
<span id="cb38-2137"><a href="#cb38-2137" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb38-2138"><a href="#cb38-2138" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-2139"><a href="#cb38-2139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-2140"><a href="#cb38-2140" aria-hidden="true" tabindex="-1"></a>  container<span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"block"</span>)<span class="op">.</span><span class="fu">html</span>(<span class="st">""</span>)<span class="op">;</span> <span class="co">// Clear and show</span></span>
<span id="cb38-2141"><a href="#cb38-2141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-2142"><a href="#cb38-2142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-2143"><a href="#cb38-2143" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ui <span class="op">=</span> <span class="fu">html</span><span class="vs">`</span></span>
<span id="cb38-2144"><a href="#cb38-2144" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;h5 style="margin-top: 0;"&gt;🚀 Formatting Complete&lt;/h5&gt;</span></span>
<span id="cb38-2145"><a href="#cb38-2145" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;p style="font-size: 0.9em; color: #555;"&gt;Choose how you would like to proceed with your harmonized study:&lt;/p&gt;</span></span>
<span id="cb38-2146"><a href="#cb38-2146" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span></span>
<span id="cb38-2147"><a href="#cb38-2147" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;div class="d-grid gap-2 d-md-block"&gt;</span></span>
<span id="cb38-2148"><a href="#cb38-2148" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;button id="btn-atomx-download-only" class="btn btn-outline-primary"&gt;💾 Download Only&lt;/button&gt;</span></span>
<span id="cb38-2149"><a href="#cb38-2149" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;button id="btn-atomx-launch-only" class="btn btn-outline-success"&gt;⚡ Launch Only&lt;/button&gt;</span></span>
<span id="cb38-2150"><a href="#cb38-2150" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;button id="btn-atomx-both" class="btn btn-primary"&gt;🚀 Download &amp; Launch&lt;/button&gt;</span></span>
<span id="cb38-2151"><a href="#cb38-2151" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/div&gt;</span></span>
<span id="cb38-2152"><a href="#cb38-2152" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span></span>
<span id="cb38-2153"><a href="#cb38-2153" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;div id="atomx-download-status" style="margin-top: 12px; font-weight: 500;"&gt;&lt;/div&gt;</span></span>
<span id="cb38-2154"><a href="#cb38-2154" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span><span class="op">;</span></span>
<span id="cb38-2155"><a href="#cb38-2155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-2156"><a href="#cb38-2156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-2157"><a href="#cb38-2157" aria-hidden="true" tabindex="-1"></a>  container<span class="op">.</span><span class="fu">node</span>()<span class="op">.</span><span class="fu">appendChild</span>(ui)<span class="op">;</span></span>
<span id="cb38-2158"><a href="#cb38-2158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-2159"><a href="#cb38-2159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-2160"><a href="#cb38-2160" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> status <span class="op">=</span> ui<span class="op">.</span><span class="fu">querySelector</span>(<span class="st">"#atomx-download-status"</span>)<span class="op">;</span></span>
<span id="cb38-2161"><a href="#cb38-2161" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> btnDownload <span class="op">=</span> ui<span class="op">.</span><span class="fu">querySelector</span>(<span class="st">"#btn-atomx-download-only"</span>)<span class="op">;</span></span>
<span id="cb38-2162"><a href="#cb38-2162" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> btnLaunch <span class="op">=</span> ui<span class="op">.</span><span class="fu">querySelector</span>(<span class="st">"#btn-atomx-launch-only"</span>)<span class="op">;</span></span>
<span id="cb38-2163"><a href="#cb38-2163" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> btnBoth <span class="op">=</span> ui<span class="op">.</span><span class="fu">querySelector</span>(<span class="st">"#btn-atomx-both"</span>)<span class="op">;</span></span>
<span id="cb38-2164"><a href="#cb38-2164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-2165"><a href="#cb38-2165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-2166"><a href="#cb38-2166" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> runConversion <span class="op">=</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb38-2167"><a href="#cb38-2167" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> conn <span class="op">=</span> <span class="cf">await</span> duck_db_client<span class="op">;</span></span>
<span id="cb38-2168"><a href="#cb38-2168" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> db <span class="op">=</span> conn<span class="op">.</span><span class="at">instance</span> <span class="op">||</span> conn<span class="op">.</span><span class="at">db</span> <span class="op">||</span> conn<span class="op">;</span></span>
<span id="cb38-2169"><a href="#cb38-2169" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb38-2170"><a href="#cb38-2170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-2171"><a href="#cb38-2171" aria-hidden="true" tabindex="-1"></a>      <span class="cf">await</span> conn<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb38-2172"><a href="#cb38-2172" aria-hidden="true" tabindex="-1"></a><span class="vs">        CREATE OR REPLACE VIEW pairwise_scrubbed AS </span></span>
<span id="cb38-2173"><a href="#cb38-2173" aria-hidden="true" tabindex="-1"></a><span class="vs">        SELECT * FROM pairwise_final WHERE term != 'otherct_expr'</span></span>
<span id="cb38-2174"><a href="#cb38-2174" aria-hidden="true" tabindex="-1"></a><span class="vs">      `</span>)<span class="op">;</span></span>
<span id="cb38-2175"><a href="#cb38-2175" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb38-2176"><a href="#cb38-2176" aria-hidden="true" tabindex="-1"></a>      <span class="cf">await</span> conn<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb38-2177"><a href="#cb38-2177" aria-hidden="true" tabindex="-1"></a><span class="vs">        CREATE OR REPLACE VIEW emmeans_scrubbed AS </span></span>
<span id="cb38-2178"><a href="#cb38-2178" aria-hidden="true" tabindex="-1"></a><span class="vs">        SELECT * FROM emmeans_final WHERE term != 'otherct_expr'</span></span>
<span id="cb38-2179"><a href="#cb38-2179" aria-hidden="true" tabindex="-1"></a><span class="vs">      `</span>)<span class="op">;</span></span>
<span id="cb38-2180"><a href="#cb38-2180" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-2181"><a href="#cb38-2181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-2182"><a href="#cb38-2182" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> termRes <span class="op">=</span> <span class="cf">await</span> conn<span class="op">.</span><span class="fu">query</span>(<span class="st">"SELECT DISTINCT term FROM pairwise_scrubbed LIMIT 1"</span>)<span class="op">;</span></span>
<span id="cb38-2183"><a href="#cb38-2183" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> activeTerm <span class="op">=</span> termRes<span class="op">.</span><span class="fu">toArray</span>()[<span class="dv">0</span>]<span class="op">?.</span><span class="at">term</span> <span class="op">||</span> <span class="st">"Term"</span><span class="op">;</span></span>
<span id="cb38-2184"><a href="#cb38-2184" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb38-2185"><a href="#cb38-2185" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> levelRes <span class="op">=</span> <span class="cf">await</span> conn<span class="op">.</span><span class="fu">query</span>(<span class="st">"SELECT DISTINCT level FROM emmeans_scrubbed LIMIT 2"</span>)<span class="op">;</span></span>
<span id="cb38-2186"><a href="#cb38-2186" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> levels <span class="op">=</span> levelRes<span class="op">.</span><span class="fu">toArray</span>()<span class="op">.</span><span class="fu">map</span>(row <span class="kw">=&gt;</span> row<span class="op">.</span><span class="at">level</span>)<span class="op">;</span></span>
<span id="cb38-2187"><a href="#cb38-2187" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> l1 <span class="op">=</span> levels[<span class="dv">0</span>] <span class="op">||</span> <span class="st">'Level_A'</span><span class="op">;</span></span>
<span id="cb38-2188"><a href="#cb38-2188" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> l2 <span class="op">=</span> levels[<span class="dv">1</span>] <span class="op">||</span> l1<span class="op">;</span></span>
<span id="cb38-2189"><a href="#cb38-2189" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-2190"><a href="#cb38-2190" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="vs">`🧼 FILTERING: Removed 'otherct_expr'. Active Term: </span><span class="sc">${</span>activeTerm<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb38-2191"><a href="#cb38-2191" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-2192"><a href="#cb38-2192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-2193"><a href="#cb38-2193" aria-hidden="true" tabindex="-1"></a>      <span class="cf">await</span> conn<span class="op">.</span><span class="fu">query</span>(<span class="st">"COPY (SELECT * FROM pairwise_scrubbed) TO 'pairwise.parquet' (FORMAT 'PARQUET')"</span>)<span class="op">;</span></span>
<span id="cb38-2194"><a href="#cb38-2194" aria-hidden="true" tabindex="-1"></a>      <span class="cf">await</span> conn<span class="op">.</span><span class="fu">query</span>(<span class="st">"COPY (SELECT * FROM emmeans_scrubbed) TO 'emmeans.parquet' (FORMAT 'PARQUET')"</span>)<span class="op">;</span></span>
<span id="cb38-2195"><a href="#cb38-2195" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-2196"><a href="#cb38-2196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-2197"><a href="#cb38-2197" aria-hidden="true" tabindex="-1"></a>      <span class="cf">await</span> conn<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb38-2198"><a href="#cb38-2198" aria-hidden="true" tabindex="-1"></a><span class="vs">        CREATE OR REPLACE VIEW spatial_smart_placeholder AS</span></span>
<span id="cb38-2199"><a href="#cb38-2199" aria-hidden="true" tabindex="-1"></a><span class="vs">        SELECT 0.0 as x_slide_mm, 0.0 as y_slide_mm, 1 as slide_id_numeric, '</span><span class="sc">${</span>l1<span class="sc">}</span><span class="vs">' as "</span><span class="sc">${</span>activeTerm<span class="sc">}</span><span class="vs">" UNION ALL</span></span>
<span id="cb38-2200"><a href="#cb38-2200" aria-hidden="true" tabindex="-1"></a><span class="vs">        SELECT 0.0, 1.0, 1, '</span><span class="sc">${</span>l1<span class="sc">}</span><span class="vs">' UNION ALL</span></span>
<span id="cb38-2201"><a href="#cb38-2201" aria-hidden="true" tabindex="-1"></a><span class="vs">        SELECT 1.0, 0.0, 1, '</span><span class="sc">${</span>l2<span class="sc">}</span><span class="vs">' UNION ALL</span></span>
<span id="cb38-2202"><a href="#cb38-2202" aria-hidden="true" tabindex="-1"></a><span class="vs">        SELECT 1.0, 1.0, 1, '</span><span class="sc">${</span>l2<span class="sc">}</span><span class="vs">'</span></span>
<span id="cb38-2203"><a href="#cb38-2203" aria-hidden="true" tabindex="-1"></a><span class="vs">      `</span>)<span class="op">;</span></span>
<span id="cb38-2204"><a href="#cb38-2204" aria-hidden="true" tabindex="-1"></a>      <span class="cf">await</span> conn<span class="op">.</span><span class="fu">query</span>(<span class="st">"COPY (SELECT * FROM spatial_smart_placeholder) TO 'cell_metadata.parquet' (FORMAT 'PARQUET')"</span>)<span class="op">;</span></span>
<span id="cb38-2205"><a href="#cb38-2205" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-2206"><a href="#cb38-2206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-2207"><a href="#cb38-2207" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> countRes <span class="op">=</span> <span class="cf">await</span> conn<span class="op">.</span><span class="fu">query</span>(<span class="st">"SELECT COUNT(DISTINCT target) as n FROM pairwise_scrubbed"</span>)<span class="op">;</span></span>
<span id="cb38-2208"><a href="#cb38-2208" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> targetCount <span class="op">=</span> <span class="bu">Number</span>(countRes<span class="op">.</span><span class="fu">toArray</span>()[<span class="dv">0</span>]<span class="op">.</span><span class="at">n</span>)<span class="op">;</span></span>
<span id="cb38-2209"><a href="#cb38-2209" aria-hidden="true" tabindex="-1"></a>      <span class="cf">await</span> conn<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb38-2210"><a href="#cb38-2210" aria-hidden="true" tabindex="-1"></a><span class="vs">        COPY (SELECT '</span><span class="sc">${</span>atomx_metadata<span class="op">.</span><span class="at">study_name</span><span class="sc">}</span><span class="vs">' as Name, '</span><span class="sc">${</span>atomx_metadata<span class="op">.</span><span class="at">description</span><span class="sc">}</span><span class="vs">' as Description, </span></span>
<span id="cb38-2211"><a href="#cb38-2211" aria-hidden="true" tabindex="-1"></a><span class="vs">              '</span><span class="sc">${</span>atomx_metadata<span class="op">.</span><span class="at">formula</span><span class="sc">}</span><span class="vs">' as Formala, </span><span class="sc">${</span>targetCount<span class="sc">}</span><span class="vs"> as "Targets tested") </span></span>
<span id="cb38-2212"><a href="#cb38-2212" aria-hidden="true" tabindex="-1"></a><span class="vs">        TO 'study_header.parquet' (FORMAT 'PARQUET')`</span>)<span class="op">;</span></span>
<span id="cb38-2213"><a href="#cb38-2213" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-2214"><a href="#cb38-2214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-2215"><a href="#cb38-2215" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> {</span>
<span id="cb38-2216"><a href="#cb38-2216" aria-hidden="true" tabindex="-1"></a>        <span class="dt">p</span><span class="op">:</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">copyFileToBuffer</span>(<span class="st">'pairwise.parquet'</span>)<span class="op">,</span></span>
<span id="cb38-2217"><a href="#cb38-2217" aria-hidden="true" tabindex="-1"></a>        <span class="dt">e</span><span class="op">:</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">copyFileToBuffer</span>(<span class="st">'emmeans.parquet'</span>)<span class="op">,</span></span>
<span id="cb38-2218"><a href="#cb38-2218" aria-hidden="true" tabindex="-1"></a>        <span class="dt">m</span><span class="op">:</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">copyFileToBuffer</span>(<span class="st">'cell_metadata.parquet'</span>)<span class="op">,</span></span>
<span id="cb38-2219"><a href="#cb38-2219" aria-hidden="true" tabindex="-1"></a>        <span class="dt">h</span><span class="op">:</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">copyFileToBuffer</span>(<span class="st">'study_header.parquet'</span>)</span>
<span id="cb38-2220"><a href="#cb38-2220" aria-hidden="true" tabindex="-1"></a>      }<span class="op">;</span></span>
<span id="cb38-2221"><a href="#cb38-2221" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb38-2222"><a href="#cb38-2222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-2223"><a href="#cb38-2223" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> createZipBlob <span class="op">=</span> <span class="kw">async</span> (buffers) <span class="kw">=&gt;</span> {</span>
<span id="cb38-2224"><a href="#cb38-2224" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> z <span class="op">=</span> <span class="cf">await</span> <span class="im">import</span>(<span class="st">"https://cdn.jsdelivr.net/npm/@zip.js/zip.js@2.7.34/+esm"</span>)<span class="op">;</span></span>
<span id="cb38-2225"><a href="#cb38-2225" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> zipWriter <span class="op">=</span> <span class="kw">new</span> z<span class="op">.</span><span class="fu">ZipWriter</span>(<span class="kw">new</span> z<span class="op">.</span><span class="fu">BlobWriter</span>(<span class="st">"application/zip"</span>))<span class="op">;</span></span>
<span id="cb38-2226"><a href="#cb38-2226" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> zipWriter<span class="op">.</span><span class="fu">add</span>(<span class="st">"pairwise.parquet"</span><span class="op">,</span> <span class="kw">new</span> z<span class="op">.</span><span class="fu">Uint8ArrayReader</span>(<span class="kw">new</span> <span class="bu">Uint8Array</span>(buffers<span class="op">.</span><span class="at">p</span>)))<span class="op">;</span></span>
<span id="cb38-2227"><a href="#cb38-2227" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> zipWriter<span class="op">.</span><span class="fu">add</span>(<span class="st">"emmeans.parquet"</span><span class="op">,</span> <span class="kw">new</span> z<span class="op">.</span><span class="fu">Uint8ArrayReader</span>(<span class="kw">new</span> <span class="bu">Uint8Array</span>(buffers<span class="op">.</span><span class="at">e</span>)))<span class="op">;</span></span>
<span id="cb38-2228"><a href="#cb38-2228" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> zipWriter<span class="op">.</span><span class="fu">add</span>(<span class="st">"cell_metadata.parquet"</span><span class="op">,</span> <span class="kw">new</span> z<span class="op">.</span><span class="fu">Uint8ArrayReader</span>(<span class="kw">new</span> <span class="bu">Uint8Array</span>(buffers<span class="op">.</span><span class="at">m</span>)))<span class="op">;</span></span>
<span id="cb38-2229"><a href="#cb38-2229" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> zipWriter<span class="op">.</span><span class="fu">add</span>(<span class="st">"study_header.parquet"</span><span class="op">,</span> <span class="kw">new</span> z<span class="op">.</span><span class="fu">Uint8ArrayReader</span>(<span class="kw">new</span> <span class="bu">Uint8Array</span>(buffers<span class="op">.</span><span class="at">h</span>)))<span class="op">;</span></span>
<span id="cb38-2230"><a href="#cb38-2230" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="cf">await</span> zipWriter<span class="op">.</span><span class="fu">close</span>()<span class="op">;</span></span>
<span id="cb38-2231"><a href="#cb38-2231" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb38-2232"><a href="#cb38-2232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-2233"><a href="#cb38-2233" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> triggerDownload <span class="op">=</span> (blob) <span class="kw">=&gt;</span> {</span>
<span id="cb38-2234"><a href="#cb38-2234" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> url <span class="op">=</span> URL<span class="op">.</span><span class="fu">createObjectURL</span>(blob)<span class="op">;</span></span>
<span id="cb38-2235"><a href="#cb38-2235" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> a <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"a"</span>)<span class="op">;</span></span>
<span id="cb38-2236"><a href="#cb38-2236" aria-hidden="true" tabindex="-1"></a>    a<span class="op">.</span><span class="at">href</span> <span class="op">=</span> url<span class="op">;</span> a<span class="op">.</span><span class="at">download</span> <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>atomx_metadata<span class="op">.</span><span class="at">study_name</span><span class="sc">}</span><span class="vs">_smiDE.zip`</span><span class="op">;</span></span>
<span id="cb38-2237"><a href="#cb38-2237" aria-hidden="true" tabindex="-1"></a>    <span class="bu">document</span><span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="fu">appendChild</span>(a)<span class="op">;</span></span>
<span id="cb38-2238"><a href="#cb38-2238" aria-hidden="true" tabindex="-1"></a>    a<span class="op">.</span><span class="fu">click</span>()<span class="op">;</span></span>
<span id="cb38-2239"><a href="#cb38-2239" aria-hidden="true" tabindex="-1"></a>    <span class="bu">document</span><span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="fu">removeChild</span>(a)<span class="op">;</span></span>
<span id="cb38-2240"><a href="#cb38-2240" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb38-2241"><a href="#cb38-2241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-2242"><a href="#cb38-2242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-2243"><a href="#cb38-2243" aria-hidden="true" tabindex="-1"></a>  btnDownload<span class="op">.</span><span class="at">onclick</span> <span class="op">=</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb38-2244"><a href="#cb38-2244" aria-hidden="true" tabindex="-1"></a>    status<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="st">"⚙️ Generating Zip..."</span><span class="op">;</span></span>
<span id="cb38-2245"><a href="#cb38-2245" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> buffers <span class="op">=</span> <span class="cf">await</span> <span class="fu">runConversion</span>()<span class="op">;</span></span>
<span id="cb38-2246"><a href="#cb38-2246" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> blob <span class="op">=</span> <span class="cf">await</span> <span class="fu">createZipBlob</span>(buffers)<span class="op">;</span></span>
<span id="cb38-2247"><a href="#cb38-2247" aria-hidden="true" tabindex="-1"></a>    <span class="fu">triggerDownload</span>(blob)<span class="op">;</span></span>
<span id="cb38-2248"><a href="#cb38-2248" aria-hidden="true" tabindex="-1"></a>    status<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="st">"✅ Download Complete."</span><span class="op">;</span></span>
<span id="cb38-2249"><a href="#cb38-2249" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb38-2250"><a href="#cb38-2250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-2251"><a href="#cb38-2251" aria-hidden="true" tabindex="-1"></a>  btnLaunch<span class="op">.</span><span class="at">onclick</span> <span class="op">=</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb38-2252"><a href="#cb38-2252" aria-hidden="true" tabindex="-1"></a>    status<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="st">"🚀 Launching Study..."</span><span class="op">;</span></span>
<span id="cb38-2253"><a href="#cb38-2253" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> buffers <span class="op">=</span> <span class="cf">await</span> <span class="fu">runConversion</span>()<span class="op">;</span></span>
<span id="cb38-2254"><a href="#cb38-2254" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> blob <span class="op">=</span> <span class="cf">await</span> <span class="fu">createZipBlob</span>(buffers)<span class="op">;</span></span>
<span id="cb38-2255"><a href="#cb38-2255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-2256"><a href="#cb38-2256" aria-hidden="true" tabindex="-1"></a>    mutable new_zip_data <span class="op">=</span> {</span>
<span id="cb38-2257"><a href="#cb38-2257" aria-hidden="true" tabindex="-1"></a>      <span class="dt">id</span><span class="op">:</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>()<span class="op">,</span></span>
<span id="cb38-2258"><a href="#cb38-2258" aria-hidden="true" tabindex="-1"></a>      <span class="dt">filename</span><span class="op">:</span> <span class="vs">`</span><span class="sc">${</span>atomx_metadata<span class="op">.</span><span class="at">study_name</span><span class="sc">}</span><span class="vs">_smiDE.zip`</span><span class="op">,</span></span>
<span id="cb38-2259"><a href="#cb38-2259" aria-hidden="true" tabindex="-1"></a>      <span class="dt">data</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Uint8Array</span>(<span class="cf">await</span> blob<span class="op">.</span><span class="fu">arrayBuffer</span>())</span>
<span id="cb38-2260"><a href="#cb38-2260" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb38-2261"><a href="#cb38-2261" aria-hidden="true" tabindex="-1"></a>    status<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="st">"✅ Study Launched! Check the sidebar."</span><span class="op">;</span></span>
<span id="cb38-2262"><a href="#cb38-2262" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb38-2263"><a href="#cb38-2263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-2264"><a href="#cb38-2264" aria-hidden="true" tabindex="-1"></a>  btnBoth<span class="op">.</span><span class="at">onclick</span> <span class="op">=</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb38-2265"><a href="#cb38-2265" aria-hidden="true" tabindex="-1"></a>    status<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="st">"⚙️ Processing Both..."</span><span class="op">;</span></span>
<span id="cb38-2266"><a href="#cb38-2266" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> buffers <span class="op">=</span> <span class="cf">await</span> <span class="fu">runConversion</span>()<span class="op">;</span></span>
<span id="cb38-2267"><a href="#cb38-2267" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> blob <span class="op">=</span> <span class="cf">await</span> <span class="fu">createZipBlob</span>(buffers)<span class="op">;</span></span>
<span id="cb38-2268"><a href="#cb38-2268" aria-hidden="true" tabindex="-1"></a>    <span class="fu">triggerDownload</span>(blob)<span class="op">;</span></span>
<span id="cb38-2269"><a href="#cb38-2269" aria-hidden="true" tabindex="-1"></a>    mutable new_zip_data <span class="op">=</span> {</span>
<span id="cb38-2270"><a href="#cb38-2270" aria-hidden="true" tabindex="-1"></a>      <span class="dt">id</span><span class="op">:</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>()<span class="op">,</span></span>
<span id="cb38-2271"><a href="#cb38-2271" aria-hidden="true" tabindex="-1"></a>      <span class="dt">filename</span><span class="op">:</span> <span class="vs">`</span><span class="sc">${</span>atomx_metadata<span class="op">.</span><span class="at">study_name</span><span class="sc">}</span><span class="vs">_smiDE.zip`</span><span class="op">,</span></span>
<span id="cb38-2272"><a href="#cb38-2272" aria-hidden="true" tabindex="-1"></a>      <span class="dt">data</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Uint8Array</span>(<span class="cf">await</span> blob<span class="op">.</span><span class="fu">arrayBuffer</span>())</span>
<span id="cb38-2273"><a href="#cb38-2273" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb38-2274"><a href="#cb38-2274" aria-hidden="true" tabindex="-1"></a>    status<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="st">"✅ Success! Zip downloaded and Study launched."</span><span class="op">;</span></span>
<span id="cb38-2275"><a href="#cb38-2275" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb38-2276"><a href="#cb38-2276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-2277"><a href="#cb38-2277" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> ui<span class="op">;</span></span>
<span id="cb38-2278"><a href="#cb38-2278" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div id="ojs-cell-38" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div>
</div>
</div><div id="sec-convert-smide" class="dashboard-page tab-pane grid-skip html-fill-item html-fill-container" data-scrolling="true" data-orientation="rows" aria-labelledby="tab-sec-convert-smide">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, 1fr); grid-auto-columns: minmax(0, 1fr);">
<div class="card html-fill-item html-fill-container bslib-card" data-title="How to use this dashboard with your results derived from smiDE" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-header"><div class="card-title html-fill-item html-fill-container"><span style="display: inline">
How to use this dashboard with your results derived from smiDE
</span></div></div>
<div class="card-body html-fill-item html-fill-container">
<p>You can use this dashboard to explore your own <code>smiDE</code> results. For now this dashboard only works using differential expression results obtained directly from the <code>smiDE</code> R package. So far I have tested it with two cases: a discrete/ categorical grouping variable and a continuous one.</p>
<p>Let’s say you have a differential expression object obtained from calling the <code>smiDE::smi_de</code> function:</p>
</div>
<div class="cell card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code html-fill-item html-fill-container" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(smiDE)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Example function call below that examines tumor cell expression across</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co"># different spatial domains (annotated_domains). </span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>de_obj <span class="ot">&lt;-</span> </span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">smi_de</span>(<span class="at">assay_matrix =</span> assay_matrix_use</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>          ,<span class="at">metadata =</span> meta_use</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>          ,<span class="at">formula =</span> <span class="sc">~</span><span class="fu">RankNorm</span>(otherct_expr) <span class="sc">+</span> annotated_domain <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(nCount_RNA)) </span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>          ,<span class="at">pre_de_obj =</span> pre_de_obj</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>          ,<span class="at">neighbor_expr_cell_type_metadata_colname =</span> <span class="st">"celltype_broad"</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>          ,<span class="at">neighbor_expr_overlap_weight_colname =</span> <span class="cn">NULL</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>          ,<span class="at">neighbor_expr_overlap_agg =</span><span class="st">"sum"</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>          ,<span class="at">neighbor_expr_totalcount_normalize =</span> <span class="cn">TRUE</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>          ,<span class="at">neighbor_expr_totalcount_scalefactor =</span>  tc_scalefactors </span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>          ,<span class="at">family=</span><span class="st">"nbinom2"</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>          ,<span class="at">cellid_colname =</span> <span class="st">"cell_id_numeric"</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>          ,<span class="at">targets=</span>genes_to_analyze,</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>          <span class="at">nCores=</span><span class="dv">30</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>   ) </span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>res_list <span class="ot">&lt;-</span> <span class="fu">results</span>(de_obj)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="card-body html-fill-item html-fill-container">
<p>Since the output structure differs slighlty depending on whether your DE results are based on discrete or continous terms, we’ll use this harmonizing function to format the results into a single format that the dashboard can understand. Specifically, the function below converts the <em>pairwise results</em> and the <em>emmeans results</em>.</p>
</div>
<div class="cell card-body html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="webr-13" class="exercise-cell html-fill-item html-fill-container">

</div>
<script type="webr-13-contents">
eyJhdHRyIjp7ImVjaG8iOnRydWUsImVkaXQiOmZhbHNlLCJldmFsIjpmYWxzZX0sImNvZGUiOiJcbmxpYnJhcnkoZGF0YS50YWJsZSlcbmxpYnJhcnkoZHBseXIpXG5saWJyYXJ5KHN0cmluZ3IpXG5cbiMnIEhhcm1vbml6ZSBzbWlERSBSZXN1bHRzIGZvciBEYXNoYm9hcmRcbiMnXG4jJyBAcGFyYW0gcmVzX2xpc3QgVGhlIG91dHB1dCBsaXN0IGRpcmVjdGx5IGZyb20gc21pREU6OnJlc3VsdHMoZGVfb2JqKVxuIycgQHJldHVybiBBIGxpc3QgY29udGFpbmluZyAncGFpcndpc2UnIGFuZCAnZW1tZWFucycgZGF0YS5mcmFtZXMgd2l0aCBzeW5jaHJvbml6ZWQgY29udGludW91cyBsYWJlbHNcbmhhcm1vbml6ZV9kZV9yZXN1bHRzIDwtIGZ1bmN0aW9uKHJlc19saXN0KSB7XG4gIFxuICBlbW1lYW5zX3JhdyA8LSByZXNfbGlzdCRlbW1lYW5zXG4gIGlmIChcInRlcm1cIiAlaW4lIG5hbWVzKGVtbWVhbnNfcmF3KSkge1xuICAgIGVtbWVhbnNfcmF3IDwtIGVtbWVhbnNfcmF3W3Rlcm0gIT0gXCJvdGhlcmN0X2V4cHJcIl1cbiAgfVxuICBcbiAgZW1tZWFuc19wcm9jZXNzZWQgPC0gZW1tZWFuc19yYXcgJT4lXG4gICAgbXV0YXRlKFxuICAgICAgIyBFeHRyYWN0IG51bWVyaWMgc3VmZml4IGZyb20gbGV2ZWwgKGUuZy4sIFwidGVybTQyLjY5N1wiIC0+IFwiNDIuNjk3XCIpXG4gICAgICBzdWZmaXhfc3RyID0gc3RyX3JlbW92ZShsZXZlbCwgZml4ZWQodGVybSkpLFxuICAgICAgc3VmZml4X3ZhbCA9IHN1cHByZXNzV2FybmluZ3MoYXMubnVtZXJpYyhzdWZmaXhfc3RyKSksXG4gICAgICBcbiAgICAgIGlzX2NvbnRpbnVvdXMgPSAhaXMubmEoc3VmZml4X3ZhbCkgJiBzdHJfc3RhcnRzKGxldmVsLCBmaXhlZCh0ZXJtKSlcbiAgICApICU+JVxuICAgIG11dGF0ZShcbiAgICAgIGNsZWFuX2xldmVsID0gY2FzZV93aGVuKFxuICAgICAgICBpc19jb250aW51b3VzIH4ge1xuICAgICAgICAgIGRpcmVjdGlvbiA8LSBjYXNlX3doZW4oXG4gICAgICAgICAgICBjYXRlZ29yeSA9PSBcImMxXCIgfiBcIisgMVNEXCIsXG4gICAgICAgICAgICBjYXRlZ29yeSA9PSBcImMyXCIgfiBcIlwiLFxuICAgICAgICAgICAgVFJVRSB+IFwiXCJcbiAgICAgICAgICApXG4gICAgICAgICAgcGFzdGUwKFwibWVhbiBcIiwgZGlyZWN0aW9uLCBcIiAoXCIsIHNwcmludGYoXCIlLjJmXCIsIHN1ZmZpeF92YWwpLCBcIilcIilcbiAgICAgICAgfSxcbiAgICAgICAgVFJVRSB+IGxldmVsXG4gICAgICApLFxuICAgICAgXG4gICAgICBsb29rdXBfa2V5ID0gaWZlbHNlKGlzX2NvbnRpbnVvdXMsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICBwYXN0ZTAodGVybSwgXCJfXCIsIHNwcmludGYoXCIlLjJmXCIsIHN1ZmZpeF92YWwpKSwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgIE5BX2NoYXJhY3Rlcl8pXG4gICAgKVxuICBcbiAgY29udGludW91c19tYXAgPC0gZW1tZWFuc19wcm9jZXNzZWQgJT4lXG4gICAgZmlsdGVyKGlzX2NvbnRpbnVvdXMpICU+JVxuICAgIHNlbGVjdChsb29rdXBfa2V5LCBjbGVhbl9sZXZlbCkgJT4lXG4gICAgZGlzdGluY3QoKSAlPiVcbiAgICB0aWJibGU6OmRlZnJhbWUoKSBcbiAgXG4gIGVtbWVhbnNfb3V0IDwtIGVtbWVhbnNfcHJvY2Vzc2VkICU+JVxuICAgIHNlbGVjdCh0ZXJtLCBsZXZlbCA9IGNsZWFuX2xldmVsLCB0YXJnZXQsIHJlc3BvbnNlLCBhc3ltcC5MQ0wsIGFzeW1wLlVDTCkgJT4lXG4gICAgYXMuZGF0YS5mcmFtZSgpXG4gIFxuICBwYWlyd2lzZV9jb21iaW5lZCA8LSByYmluZGxpc3QoXG4gICAgcmVzX2xpc3RbYyhcInBhaXJ3aXNlXCIsIFwib25lLnZzLnJlc3RcIiwgXCJvbmUudnMuYWxsXCIpXSwgXG4gICAgaWRjb2wgPSBcImNvbnRyYXN0X3R5cGVcIiwgXG4gICAgdXNlLm5hbWVzID0gVFJVRSwgXG4gICAgZmlsbCA9IFRSVUUgXG4gIClcbiAgXG4gIGlmIChcInRlcm1cIiAlaW4lIG5hbWVzKHBhaXJ3aXNlX2NvbWJpbmVkKSkge1xuICAgIHBhaXJ3aXNlX2NvbWJpbmVkIDwtIHBhaXJ3aXNlX2NvbWJpbmVkW3Rlcm0gIT0gXCJvdGhlcmN0X2V4cHJcIl1cbiAgfVxuICBcbiAgaWYgKCFcIm5jZWxsc18xXCIgJWluJSBuYW1lcyhwYWlyd2lzZV9jb21iaW5lZCkpIHBhaXJ3aXNlX2NvbWJpbmVkWywgbmNlbGxzXzEgOj0gTkFdXG4gIGlmICghXCJuY2VsbHNfMlwiICVpbiUgbmFtZXMocGFpcndpc2VfY29tYmluZWQpKSBwYWlyd2lzZV9jb21iaW5lZFssIG5jZWxsc18yIDo9IE5BXVxuICBcbiAgcGFpcndpc2Vfb3V0IDwtIHBhaXJ3aXNlX2NvbWJpbmVkICU+JVxuICAgIG11dGF0ZShcbiAgICAgIGxvZzJmYyA9IGxvZzIoZm9sZF9jaGFuZ2UpLFxuICAgICAgXG4gICAgICBpc19jb250aW51b3VzX3JvdyA9IGlzLm5hKG5jZWxsc18xKSAmIGlzLm5hKG5jZWxsc18yKVxuICAgICkgJT4lXG4gICAgcm93d2lzZSgpICU+JVxuICAgIG11dGF0ZShcbiAgICAgIGNvbnRyYXN0ID0gaWYgKGlzX2NvbnRpbnVvdXNfcm93KSB7XG4gICAgICAgIHBhcnRzIDwtIHN0cl9zcGxpdChjb250cmFzdCwgXCIgLyBcIiwgc2ltcGxpZnkgPSBUUlVFKVxuXG4gICAgICAgIHZhbDEgPC0gYXMubnVtZXJpYyhzdHJfcmVtb3ZlKHBhcnRzWzFdLCBmaXhlZCh0ZXJtKSkpXG4gICAgICAgIHZhbDIgPC0gYXMubnVtZXJpYyhzdHJfcmVtb3ZlKHBhcnRzWzJdLCBmaXhlZCh0ZXJtKSkpXG4gICAgICAgIFxuICAgICAgICBrZXkxIDwtIHBhc3RlMCh0ZXJtLCBcIl9cIiwgc3ByaW50ZihcIiUuMmZcIiwgdmFsMSkpXG4gICAgICAgIGtleTIgPC0gcGFzdGUwKHRlcm0sIFwiX1wiLCBzcHJpbnRmKFwiJS4yZlwiLCB2YWwyKSlcbiAgICAgICAgXG4gICAgICAgIGxhYmVsMSA8LSBpZmVsc2Uoa2V5MSAlaW4lIG5hbWVzKGNvbnRpbnVvdXNfbWFwKSwgY29udGludW91c19tYXBba2V5MV0sIHBhcnRzWzFdKVxuICAgICAgICBsYWJlbDIgPC0gaWZlbHNlKGtleTIgJWluJSBuYW1lcyhjb250aW51b3VzX21hcCksIGNvbnRpbnVvdXNfbWFwW2tleTJdLCBwYXJ0c1syXSlcbiAgICAgICAgXG4gICAgICAgIHBhc3RlMChsYWJlbDEsIFwiIC8gXCIsIGxhYmVsMilcbiAgICAgICAgXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb250cmFzdFxuICAgICAgfVxuICAgICkgJT4lXG4gICAgdW5ncm91cCgpICU+JVxuICAgIHNlbGVjdCh0ZXJtLCBjb250cmFzdCwgdGFyZ2V0LCBsb2cyZmMsIHAudmFsdWUsIG5jZWxsc18xLCBuY2VsbHNfMikgJT4lXG4gICAgYXMuZGF0YS5mcmFtZSgpXG4gIFxuICByZXR1cm4obGlzdChwYWlyd2lzZSA9IHBhaXJ3aXNlX291dCwgZW1tZWFucyA9IGVtbWVhbnNfb3V0KSlcbn0ifQ==
</script>
</div>
</div>
<div class="card-body html-fill-item html-fill-container">
<p>Now convert the <code>res_list</code> into the formatted parts.</p>
</div>
<div class="cell card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code html-fill-item html-fill-container" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>res_formatted <span class="ot">&lt;-</span> <span class="fu">harmonize_de_results</span>(res_list)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>pairwise <span class="ot">&lt;-</span> res_formatted<span class="sc">$</span>pairwise</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>emmeans <span class="ot">&lt;-</span> res_formatted<span class="sc">$</span>emmeans</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="card-body html-fill-item html-fill-container">
<p>The <code>pairwise</code> table and the <code>emmeans</code> table two of the four required components. To create the <code>study_header</code> – which is simply a description data set that helps provide a little more context to the data displayed on the dashboard itself, we’ll create it like this:</p>
</div>
<div class="cell card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code html-fill-item html-fill-container" id="annotated-cell-43"><pre class="sourceCode r code-annotation-code code-with-copy"><code class="sourceCode r"><span id="annotated-cell-43-1"><a href="#annotated-cell-43-1" aria-hidden="true" tabindex="-1"></a>study_header <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="annotated-cell-43-2"><a href="#annotated-cell-43-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Name</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Tumor cells across spatial domains"</span>,</span>
<span id="annotated-cell-43-3"><a href="#annotated-cell-43-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Description</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Colon Cancer WTX sample"</span>,</span>
<span id="annotated-cell-43-4"><a href="#annotated-cell-43-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Formala</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"~RankNorm(otherct_expr) + annotated_domain + offset(log(nCount_RNA))"</span>,</span>
<span id="annotated-cell-43-5"><a href="#annotated-cell-43-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Targets tested</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">length</span>(genes_to_analyze)</span>
<span id="annotated-cell-43-6"><a href="#annotated-cell-43-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="card-body html-fill-item html-fill-container">
<p>Note: The column names must <strong>match exactly</strong> as given.</p>
<p>And finally, it can be useful view the cells in space to get a sense of the spatial structure of groupings. We’ll do this by selecting columns within our cell-level metadata object. Keep in mind that this dataset is loaded fully in your browser’s memory and so very large dataframes might slow down or even crash your browser.</p>
<p>In the code snippet below, I’m interested in looking at the broad cell types and the annotated domain. Note that there are a minimum of four required columns that are expected in the dashboard. The first three are <code>x_slide_mm</code>, <code>y_slide_mm</code>, and <code>slide_id_numeric</code>. These are used to facet the spatial plot. The other required columns are the metadata columns used for your grouping variable. In the example above, that grouping column was named <code>annotated_domain</code> but this can vary based on the study. These columns are used to <em>color</em> the spatial plots when a given contrast is selected. Other columns can optionally be added. For example, <code>celltype_broad</code> is useful to include here is we used that column to filter our data and in the spatial plots section we can filter the cells to include only cells that have a <code>celltype_broad</code> value of <code>tumor</code> to match our DE analysis.</p>
</div>
<div class="cell card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code html-fill-item html-fill-container" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># meta_df == the full cell-level metadata (i.e., obs)</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>meta_display <span class="ot">&lt;-</span> <span class="fu">data.table</span>(meta_df)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>meta_display <span class="ot">&lt;-</span> meta_display[, .(</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x_slide_mm =</span> sdimx, </span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_slide_mm =</span> sdimy, </span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  celltype_broad,</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  annotated_domain</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>)]</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="st">'slide_id_numeric'</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(meta_df)){</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>  meta_display<span class="sc">$</span>slide_id_numeric <span class="ot">&lt;-</span> meta_df<span class="sc">$</span>slide_id_numeric</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>  meta_display<span class="sc">$</span>slide_id_numeric <span class="ot">&lt;-</span> <span class="dv">1</span>L</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="card-body html-fill-item html-fill-container">
<p>Alternatively, if you just want the volcano plots and emmeans and want to skip the spatial plotting together, just create and pass a placeholder data.frame like so:</p>
</div>
<div class="cell card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code html-fill-item html-fill-container" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>create_mock_sp_data <span class="ot">&lt;-</span> <span class="cf">function</span>(emmeans_formatted) {</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  terms <span class="ot">&lt;-</span> emmeans_formatted <span class="sc">%&gt;%</span> </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(term) <span class="sc">%&gt;%</span> </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>()</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  mock_template <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'x_slide_mm'</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'y_slide_mm'</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>), </span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'slide_id_numeric'</span> <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">1</span>L, <span class="dv">4</span>)</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">length</span>(terms))){</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>    mock_template[[terms[i]]] <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">4</span>)</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(mock_template)</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a><span class="co"># this will just add 4 rows data which the dashboard uses as a signature for</span></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a><span class="co"># "Not Applicable"</span></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>meta_display <span class="ot">&lt;-</span> <span class="fu">create_mock_sp_data</span>(emmeans)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="card-body html-fill-item html-fill-container">
<p>At this point we are ready to package these four components so they can be loaded in your browser’s tab (specifically, in the virtual file system [VFS] that webR uses). The two steps to this procedure is:</p>
<ol type="1">
<li>convert data to parquet.</li>
<li>zip up all parquet files into a single zip file.</li>
</ol>
<p>When converting data to parquet, we’ll use this <code>write_opt_parquet</code> function. It’s just a wrapper function for writing to parquet but, to save memory, one could reduce the numeric precision of columns from R’s float64 to either 32 bit or 16 bit, if desired. Keep in mind that things like p-values will likely need greater precision.</p>
</div>
<div class="cell card-body html-fill-item html-fill-container" data-autorun="true" data-edit="false">
<div class="html-fill-item html-fill-container">
<div id="webr-14" class="exercise-cell html-fill-item html-fill-container">

</div>
<script type="webr-14-contents">
eyJhdHRyIjp7ImF1dG9ydW4iOnRydWUsImVjaG8iOnRydWUsImVkaXQiOmZhbHNlLCJldmFsIjpmYWxzZX0sImNvZGUiOiJcbmxpYnJhcnkoYXJyb3cpXG53cml0ZV9vcHRfcGFycXVldCA8LSBmdW5jdGlvbihkZiwgZmlsZW5hbWUsIGYzMl9jb2xzID0gTlVMTCwgZjE2X2NvbHMgPSBOVUxMKSB7XG4gIFxuICAjIENvbnZlcnQgdG8gQXJyb3cgVGFibGVcbiAgYXJyb3dfdGFibGUgPC0gYXNfYXJyb3dfdGFibGUoZGYpXG4gIFxuICAjIENhc3QgRmxvYXQzMiBjb2x1bW5zXG4gIGlmICghaXMubnVsbChmMzJfY29scykpIHtcbiAgICAjIENoZWNrIHdoaWNoIHJlcXVlc3RlZCBjb2x1bW5zIGFjdHVhbGx5IGV4aXN0IGluIHRoaXMgZGF0YWZyYW1lXG4gICAgdmFsaWRfY29scyA8LSBpbnRlcnNlY3QobmFtZXMoZGYpLCBmMzJfY29scylcbiAgICBpZihsZW5ndGgodmFsaWRfY29scykgPiAwKSB7XG4gICAgICBhcnJvd190YWJsZSA8LSBhcnJvd190YWJsZSAlPiUgXG4gICAgICAgIG11dGF0ZShhY3Jvc3MoYWxsX29mKHZhbGlkX2NvbHMpLCB+IGNhc3QoLngsIGZsb2F0MzIoKSkpKVxuICAgIH1cbiAgfVxuXG4gICMgQ2FzdCBGbG9hdDE2IGNvbHVtbnNcbiAgaWYgKCFpcy5udWxsKGYxNl9jb2xzKSkge1xuICAgIHZhbGlkX2NvbHMgPC0gaW50ZXJzZWN0KG5hbWVzKGRmKSwgZjE2X2NvbHMpXG4gICAgaWYobGVuZ3RoKHZhbGlkX2NvbHMpID4gMCkge1xuICAgICAgYXJyb3dfdGFibGUgPC0gYXJyb3dfdGFibGUgJT4lIFxuICAgICAgICBtdXRhdGUoYWNyb3NzKGFsbF9vZih2YWxpZF9jb2xzKSwgfiBjYXN0KC54LCBmbG9hdDE2KCkpKSlcbiAgICB9XG4gIH1cblxuICAjIFdyaXRlIHRvIGRpc2tcbiAgd3JpdGVfcGFycXVldChhcnJvd190YWJsZSwgZmlsZW5hbWUpXG59In0=
</script>
</div>
</div>
<div class="card-body html-fill-item html-fill-container">
<p>Write the parquet files to disk. Note that the folder names can vary but the file names must match exactly.</p>
</div>
<div class="cell card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code html-fill-item html-fill-container" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>parquet_dir <span class="ot">&lt;-</span> <span class="st">"./your_parquet_folder"</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(parquet_dir)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="fu">write_opt_parquet</span>(study_header, <span class="fu">file.path</span>(parquet_dir, <span class="st">"study_header.parquet"</span>))</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="fu">write_opt_parquet</span>(</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  pairwise, </span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">file.path</span>(parquet_dir, <span class="st">"pairwise.parquet"</span>)</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="fu">write_opt_parquet</span>(</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>  emmeans, </span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">file.path</span>(parquet_dir, <span class="st">"emmeans.parquet"</span>)</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a><span class="fu">write_opt_parquet</span>(</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>  meta_display,</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">file.path</span>(parquet_dir, <span class="st">"cell_metadata.parquet"</span>),</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">f32_cols =</span> <span class="fu">c</span>(<span class="st">'x_slide_mm'</span>, <span class="st">'y_slide_mm'</span>),</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">f16_cols =</span> <span class="cn">NULL</span></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="card-body html-fill-item html-fill-container">
<p>And finally, zip it up! You can name the zip file whatever you like.</p>
</div>
<div class="cell card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code html-fill-item html-fill-container" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>files_to_zip <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"study_header.parquet"</span>, </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"pairwise.parquet"</span>, </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"emmeans.parquet"</span>, </span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"cell_metadata.parquet"</span>)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>zip<span class="sc">::</span><span class="fu">zip</span>(</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">zipfile =</span> <span class="st">"you_can_name_this_whatever_you_like.zip"</span>,</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">files =</span> files_to_zip, </span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">root =</span> parquet_dir </span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="card-body html-fill-item html-fill-container">
<p>And that should be it. You should be able to “upload” that zip file on the left side panel of the dashboard.</p>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div>
</div><div id="advanced" class="dashboard-page tab-pane grid-skip html-fill-item html-fill-container" data-orientation="rows" aria-labelledby="tab-advanced">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, 80fr); grid-auto-columns: minmax(0, 1fr);">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-columns: minmax(3em, 100fr);
grid-auto-rows: minmax(0, 1fr);">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, 1fr); grid-auto-columns: minmax(0, 1fr);">
<div class="card html-fill-item html-fill-container bslib-card" data-title="Description" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-header"><div class="card-title html-fill-item html-fill-container"><span style="display: inline">
Description
</span></div></div>
<div class="card-body html-fill-item html-fill-container">
<p>This is the code that generates the volcano plot. For advanced users who wish to modify the volcano plot aesthetics beyond what is available within <code>ADJUST IMAGE AESTHETICS</code>, you can adjust the code and click <code>Run Code</code>. This will, in turn, use your custom code reactively. If any errors occur, you can simply click <code>START OVER</code> or simply refresh your browser, to return the plotting function back to its original state. You can install and use additional R packages if you like if they are already <a href="https://repo.r-wasm.org/sembly" target="_blank">compiled to WebAssembly</a>.</p>
<p>. This is “living code” is used to generate the and adjustmentused to reactively generate the plots of the dashboard. You can modify them to generate completely custom aesthetics. If run into issues, you can always press ‘START OVER’ to return the plotting function back to its original form.</p>
</div>
<div class="cell card-body html-fill-item html-fill-container" data-edit="true" data-autorun="true" data-input="[&quot;volcano_fc_range&quot;,&quot;volcano_pval_threshold&quot;,&quot;volcano_pt_size&quot;,&quot;volcano_alpha&quot;,&quot;volcano_pt_color&quot;,&quot;volcano_sig_color&quot;,&quot;volcano_high_fc_label&quot;,&quot;volcano_low_fc_label&quot;,&quot;volcano_pval_label&quot;,&quot;volcano_include_selected_genes&quot;,&quot;selected_genes&quot;]" data-define="[&quot;volcano_plot_emit&quot;,&quot;plotVolcano&quot;,&quot;argsVolcano&quot;]" data-title="Volcano Plot Source Code">
<div class="html-fill-item html-fill-container">
<div id="webr-15" class="exercise-cell html-fill-item html-fill-container">

</div>
<script type="webr-15-contents">
eyJhdHRyIjp7ImF1dG9ydW4iOnRydWUsImRlZmluZSI6WyJ2b2xjYW5vX3Bsb3RfZW1pdCIsInBsb3RWb2xjYW5vIiwiYXJnc1ZvbGNhbm8iXSwiZWRpdCI6dHJ1ZSwiZXZhbCI6dHJ1ZSwiaW5wdXQiOlsidm9sY2Fub19mY19yYW5nZSIsInZvbGNhbm9fcHZhbF90aHJlc2hvbGQiLCJ2b2xjYW5vX3B0X3NpemUiLCJ2b2xjYW5vX2FscGhhIiwidm9sY2Fub19wdF9jb2xvciIsInZvbGNhbm9fc2lnX2NvbG9yIiwidm9sY2Fub19oaWdoX2ZjX2xhYmVsIiwidm9sY2Fub19sb3dfZmNfbGFiZWwiLCJ2b2xjYW5vX3B2YWxfbGFiZWwiLCJ2b2xjYW5vX2luY2x1ZGVfc2VsZWN0ZWRfZ2VuZXMiLCJzZWxlY3RlZF9nZW5lcyJdLCJvdXRwdXQiOnRydWUsInRpdGxlIjoiVm9sY2FubyBQbG90IFNvdXJjZSBDb2RlIiwid2FybmluZyI6ZmFsc2V9LCJjb2RlIjoiXG52b2xjYW5vX3Bsb3RfZW1pdCA8LSBUUlVFXG5pZihleGlzdHMoXCIuUmFuZG9tLnNlZWRcIikpe1xuICBybSguUmFuZG9tLnNlZWQpXG59XG5zZXQuc2VlZCg0MkwpXG5wbG90Vm9sY2FubyA8LSBmdW5jdGlvbihkZiwgdmZjLCB2cGwsIHZwdCwgdmFscGhhLCB2cHRjb2xvcil7XG5cbiAgY29udHJhc3Rfc3RyaW5nIDwtIGdzdWIoXCIgdnMuIFwiLCBcIiAvIFwiLCBkZiRjb250cmFzdFsxXSlcbiAgbGV2ZWxzIDwtIHVubGlzdChzdHJzcGxpdChjb250cmFzdF9zdHJpbmcsIFwiIC8gXCIpKVxuXG4gIGlmKGxlbmd0aChsZXZlbHMpID09IDIpIHtcbiAgICBudW1lcmF0b3IgPC0gbGV2ZWxzWzFdXG4gICAgaWYoXCJuY2VsbHNfMVwiICVpbiUgY29sbmFtZXMoZGYpICYmICFpcy5uYShkZiRuY2VsbHNfMVsxXSkpe1xuICAgICAgbnVtZXJhdG9yIDwtIHBhc3RlMChudW1lcmF0b3IsIFwiIChuPVwiLGRmJG5jZWxsc18xWzFdLCBcIilcIiApXG4gICAgfSAgICBcbiAgICBkZW5vbWluYXRvciA8LSBsZXZlbHNbMl1cbiAgICBpZihcIm5jZWxsc18yXCIgJWluJSBjb2xuYW1lcyhkZikgJiYgIWlzLm5hKGRmJG5jZWxsc18yWzFdKSl7XG4gICAgICBkZW5vbWluYXRvciA8LSBwYXN0ZTAoZGVub21pbmF0b3IsIFwiIChuPVwiLGRmJG5jZWxsc18yWzFdLCBcIilcIiApXG4gICAgfSAgXG4gICAgZHluYW1pY19sYWJlbCA8LSBwYXN0ZShkZW5vbWluYXRvciwgXCJcXHUyMTkwIGxvZzIoRkMpIFxcdTIxOTJcIiwgbnVtZXJhdG9yKVxuICB9IGVsc2Uge1xuICAgIGR5bmFtaWNfbGFiZWwgPC0gXCJsb2cyKEZDKVwiXG4gIH1cbiAgXG4gIGRmJGNvbG9yX2dyb3VwIDwtIGlmZWxzZShcbiAgICBkZiRwLnZhbHVlIDwgdnBsICYgYWJzKGRmJGxvZzJmYykgPiB2ZmMsIFxuICAgIFwiU2lnbmlmaWNhbnRcIiwgXG4gICAgXCJOb3QgU2lnbmlmaWNhbnRcIlxuICApXG4gIGdlbmVzX3RvX2xhYmVsIDwtIGMoKVxuICBpZihsZW5ndGgoc2VsZWN0ZWRfZ2VuZXMpPjAgJiYgdm9sY2Fub19pbmNsdWRlX3NlbGVjdGVkX2dlbmVzPT1cIlllc1wiKXtcbiAgICBnZW5lc190b19sYWJlbCA8LSBjKGdlbmVzX3RvX2xhYmVsLCBcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkX2dlbmVzKVxuICB9XG4gIGlmKHZvbGNhbm9faGlnaF9mY19sYWJlbD4wKXtcbiAgICBnZW5lc190b19sYWJlbCA8LSBjKGdlbmVzX3RvX2xhYmVsLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGYgJT4lIGFycmFuZ2UoLWxvZzJmYykgJT4lIGhlYWQodm9sY2Fub19oaWdoX2ZjX2xhYmVsKSAlPiUgc2VsZWN0KHRhcmdldCkpXG4gIH1cbiAgaWYodm9sY2Fub19sb3dfZmNfbGFiZWw+MCl7XG4gICAgZ2VuZXNfdG9fbGFiZWwgPC0gYyhnZW5lc190b19sYWJlbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRmICU+JSBhcnJhbmdlKGxvZzJmYykgJT4lIGhlYWQodm9sY2Fub19sb3dfZmNfbGFiZWwpICU+JSBzZWxlY3QodGFyZ2V0KSlcbiAgfSAgXG4gIGlmKHZvbGNhbm9fcHZhbF9sYWJlbD4wKXtcbiAgICBnZW5lc190b19sYWJlbCA8LSBjKGdlbmVzX3RvX2xhYmVsLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGYgJT4lIGFycmFuZ2UocC52YWx1ZSkgJT4lIGhlYWQodm9sY2Fub19wdmFsX2xhYmVsKSAlPiUgc2VsZWN0KHRhcmdldCkpXG4gIH0gIFxuICBnZW5lc190b19sYWJlbCA8LSB1bmlxdWUodW5saXN0KGdlbmVzX3RvX2xhYmVsKSlcbiAgXG4gIHAgPC0gZ2dwbG90KGRmLCBhZXMoeD1sb2cyZmMsIHk9LWxvZzEwKHAudmFsdWUpKSkgKyBcbiAgICAgIGdlb21fcG9pbnQoYWVzKGNvbG9yID0gY29sb3JfZ3JvdXApLCBcbiAgICAgICAgICAgICAgICAgc2l6ZT12cHQsIGFscGhhPXZhbHBoYSkgK1xuICAgICAgc2NhbGVfY29sb3JfbWFudWFsKHZhbHVlcyA9IGMoXCJTaWduaWZpY2FudFwiID0gdm9sY2Fub19zaWdfY29sb3IsIFwiTm90IFNpZ25pZmljYW50XCIgPSB2cHRjb2xvcikpICsgXG4gICAgICBnZW9tX3ZsaW5lKHhpbnRlcmNlcHQgPSBjKC12ZmMsIHZmYykpICsgXG4gICAgICBnZW9tX2hsaW5lKHlpbnRlcmNlcHQgPSAtbG9nMTAodnBsKSkgKyBcbiAgICAgIGxhYnMoeCA9IGR5bmFtaWNfbGFiZWwpICsgXG4gICAgICB0aGVtZV9idygpICsgXG4gICAgICB0aGVtZShsZWdlbmQucG9zaXRpb24gPSBcIm5vbmVcIilcbiAgXG4gIGlmKGxlbmd0aChnZW5lc190b19sYWJlbCk+MCl7XG4gICAgcCA8LSBwICsgZ2dyZXBlbDo6Z2VvbV9sYWJlbF9yZXBlbChkYXRhPWZpbHRlcihkZiwgdGFyZ2V0ICVpbiUgZ2VuZXNfdG9fbGFiZWwpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFlcyh4PWxvZzJmYywgeT0tbG9nMTAocC52YWx1ZSksIGxhYmVsPXRhcmdldCkpXG4gIH1cbiAgc3RhdHMgPSBkYXRhLmZyYW1lKFxuICAgIGBDYXRlZ29yeWAgPSBjKHBhc3RlMChcIlNpZ25pZmljYW50IGF0IFAtdmFsdWUgXCIsIHZwbCwgXCIgdGhyZXNob2xkOiBcIiksXG4gICAgICAgICAgICAgICAgICAgcGFzdGUwKFwiTnVtYmVyIGdlbmVzIHdpdGggbG9nMkZDID49IFwiLCAgdmZjLCBcIjpcIiksXG4gICAgICAgICAgICAgICAgICAgcGFzdGUwKFwiTnVtYmVyIGdlbmVzIHdpdGggbG9nMkZDIDw9IFwiLCAgLXZmYywgXCI6XCIpLFxuICAgICAgICAgICAgICAgICAgIHBhc3RlMChcIlNpZ25pZmFudCBhbmQgaGlnaCBsb2cyRkM6XCIpLFxuICAgICAgICAgICAgICAgICAgIHBhc3RlMChcIlNpZ25pZmFudCBhbmQgbG93IGxvZzJGQzpcIilcbiAgICAgICAgICAgICAgICAgICApLFxuICAgIGBWYWx1ZWAgPSBjKGZpbHRlcihkZiwgcC52YWx1ZSA8PSB2cGwpICU+JSBucm93KCksXG4gICAgICAgICAgICAgICAgZmlsdGVyKGRmLCBsb2cyZmMgPj0gdmZjKSAlPiUgbnJvdygpLFxuICAgICAgICAgICAgICAgIGZpbHRlcihkZiwgbG9nMmZjIDw9IC12ZmMpICU+JSBucm93KCksXG4gICAgICAgICAgICAgICAgZmlsdGVyKGRmLCBsb2cyZmMgPj0gdmZjLCBwLnZhbHVlIDw9IHZwbCkgJT4lIG5yb3coKSxcbiAgICAgICAgICAgICAgICBmaWx0ZXIoZGYsIGxvZzJmYyA8PSAtdmZjLCBwLnZhbHVlIDw9IHZwbCkgJT4lIG5yb3coKVxuICAgICAgICAgICAgICAgIClcbiAgKVxuICByZXR1cm4obGlzdChwLCBzdGF0cywgZ2VuZXNfdG9fbGFiZWwpKSAjIFJldHVybiBsYWJlbGVkIGdlbmVzIGFzIHRoZSAzcmQgZWxlbWVudFxufVxuXG5hcmdzVm9sY2FubyA8LSBsaXN0KHZmYz12b2xjYW5vX2ZjX3JhbmdlLCBcbiAgICAgICAgICAgICAgICAgICAgdnBsPXZvbGNhbm9fcHZhbF90aHJlc2hvbGQsXG4gICAgICAgICAgICAgICAgICAgIHZwdD12b2xjYW5vX3B0X3NpemUsXG4gICAgICAgICAgICAgICAgICAgIHZhbHBoYT12b2xjYW5vX2FscGhhLFxuICAgICAgICAgICAgICAgICAgICB2cHRjb2xvcj12b2xjYW5vX3B0X2NvbG9yKSJ9
</script>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div>
</div>
</div>
</div><div id="webr-console" class="dashboard-page tab-pane grid-skip html-fill-item html-fill-container" data-orientation="rows" aria-labelledby="tab-webr-console">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, max-content) minmax(3em, 1fr); grid-auto-columns: minmax(0, 1fr);">
<div class="card html-fill-item html-fill-container bslib-card" data-fill="false" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-body html-fill-item html-fill-container">
<p>This <code>webR</code> console is available for anything from quick calculations to creating additional plots. For a list of pre-compiled R packages that are available take a look at <a href="https://repo.r-wasm.org/" target="_blank">https://repo.r-wasm.org/</a>.</p>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
<div class="card cell html-fill-item html-fill-container bslib-card" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-body html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="webr-16" class="exercise-cell html-fill-item html-fill-container">

</div>
<script type="webr-16-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiXG5scygpIn0=
</script>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div>
</div><div id="sec-testing" class="dashboard-page tab-pane grid-skip html-fill-item html-fill-container" data-orientation="rows" aria-labelledby="tab-sec-testing">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, 1fr); grid-auto-columns: minmax(0, 1fr);">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-columns: minmax(3em, 1fr) minmax(3em, 1fr);
grid-auto-rows: minmax(0, 1fr);">
<div class="card html-fill-item html-fill-container bslib-card" data-title="Interactive Prototyping" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-header"><div class="card-title html-fill-item html-fill-container"><span style="display: inline">
Interactive Prototyping
</span></div></div>
<div class="card-body html-fill-item html-fill-container">
<p>Use the plot below to explore your data. You can drag the dashed lines to adjust Fold-Change and P-value thresholds manually. These changes will reflect back into the dashboard’s global state.</p>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div><div class="html-fill-item html-fill-container bslib-grid" data-height="700px" style="display: grid; grid-template-rows: minmax(3em, 1fr) minmax(3em, max-content); grid-auto-columns: minmax(0, 1fr);">
<div class="card cell html-fill-item html-fill-container bslib-card" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb45" data-startfrom="2789" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2788;"><span id="cb45-2789"><a href="#cb45-2789" aria-hidden="true" tabindex="-1"></a>viewof nudge_volcano <span class="op">=</span> {</span>
<span id="cb45-2790"><a href="#cb45-2790" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> width <span class="op">=</span> <span class="dv">800</span><span class="op">;</span></span>
<span id="cb45-2791"><a href="#cb45-2791" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> height <span class="op">=</span> <span class="dv">500</span><span class="op">;</span></span>
<span id="cb45-2792"><a href="#cb45-2792" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-2793"><a href="#cb45-2793" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> current_fc <span class="op">=</span> <span class="fl">1.0</span><span class="op">;</span></span>
<span id="cb45-2794"><a href="#cb45-2794" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> current_pval <span class="op">=</span> <span class="fl">0.05</span><span class="op">;</span></span>
<span id="cb45-2795"><a href="#cb45-2795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-2796"><a href="#cb45-2796" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> mock_data <span class="op">=</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>({<span class="dt">length</span><span class="op">:</span> <span class="dv">300</span>}<span class="op">,</span> (_<span class="op">,</span> i) <span class="kw">=&gt;</span> ({</span>
<span id="cb45-2797"><a href="#cb45-2797" aria-hidden="true" tabindex="-1"></a>    <span class="dt">log2fc</span><span class="op">:</span> (<span class="bu">Math</span><span class="op">.</span><span class="fu">random</span>() <span class="op">-</span> <span class="fl">0.5</span>) <span class="op">*</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb45-2798"><a href="#cb45-2798" aria-hidden="true" tabindex="-1"></a>    <span class="dt">p_value</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="fl">0.0001</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">random</span>() <span class="op">*</span> <span class="fl">0.1</span>)</span>
<span id="cb45-2799"><a href="#cb45-2799" aria-hidden="true" tabindex="-1"></a>  }))<span class="op">;</span></span>
<span id="cb45-2800"><a href="#cb45-2800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-2801"><a href="#cb45-2801" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Styled Container</span></span>
<span id="cb45-2802"><a href="#cb45-2802" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> container <span class="op">=</span> <span class="fu">html</span><span class="vs">`</span></span>
<span id="cb45-2803"><a href="#cb45-2803" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;div style="border: 1px solid #dee2e6; border-radius: 12px; padding: 25px; background: #ffffff; box-shadow: 0 4px 10px rgba(0,0,0,0.03);"&gt;</span></span>
<span id="cb45-2804"><a href="#cb45-2804" aria-hidden="true" tabindex="-1"></a><span class="vs">      </span></span>
<span id="cb45-2805"><a href="#cb45-2805" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 20px; border-bottom: 2px solid #f8f9fa; padding-bottom: 15px;"&gt;</span></span>
<span id="cb45-2806"><a href="#cb45-2806" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;div style="display: flex; gap: 30px;"&gt;</span></span>
<span id="cb45-2807"><a href="#cb45-2807" aria-hidden="true" tabindex="-1"></a><span class="vs">          </span></span>
<span id="cb45-2808"><a href="#cb45-2808" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;div style="display: flex; flex-direction: column; gap: 8px;"&gt;</span></span>
<span id="cb45-2809"><a href="#cb45-2809" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;label style="text-transform: uppercase; color: #999; font-size: 0.7em; letter-spacing: 0.05em; font-weight: 700;"&gt;Threshold: log2FC&lt;/label&gt;</span></span>
<span id="cb45-2810"><a href="#cb45-2810" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;div style="display: flex; align-items: center; gap: 10px;"&gt;</span></span>
<span id="cb45-2811"><a href="#cb45-2811" aria-hidden="true" tabindex="-1"></a><span class="vs">              &lt;button id="fc-down" class="btn btn-outline-secondary btn-sm" style="width: 32px;"&gt;-&lt;/button&gt;</span></span>
<span id="cb45-2812"><a href="#cb45-2812" aria-hidden="true" tabindex="-1"></a><span class="vs">              &lt;span id="fc-label" style="font-family: monospace; font-weight: bold; width: 45px; text-align: center;"&gt;1.00&lt;/span&gt;</span></span>
<span id="cb45-2813"><a href="#cb45-2813" aria-hidden="true" tabindex="-1"></a><span class="vs">              &lt;button id="fc-up" class="btn btn-outline-secondary btn-sm" style="width: 32px;"&gt;+&lt;/button&gt;</span></span>
<span id="cb45-2814"><a href="#cb45-2814" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;/div&gt;</span></span>
<span id="cb45-2815"><a href="#cb45-2815" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;/div&gt;</span></span>
<span id="cb45-2816"><a href="#cb45-2816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-2817"><a href="#cb45-2817" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;div style="display: flex; flex-direction: column; gap: 8px;"&gt;</span></span>
<span id="cb45-2818"><a href="#cb45-2818" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;label style="text-transform: uppercase; color: #999; font-size: 0.7em; letter-spacing: 0.05em; font-weight: 700;"&gt;Threshold: P-Value&lt;/label&gt;</span></span>
<span id="cb45-2819"><a href="#cb45-2819" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;div style="display: flex; align-items: center; gap: 10px;"&gt;</span></span>
<span id="cb45-2820"><a href="#cb45-2820" aria-hidden="true" tabindex="-1"></a><span class="vs">              &lt;button id="pval-down" class="btn btn-outline-secondary btn-sm" style="width: 32px;"&gt;+&lt;/button&gt;</span></span>
<span id="cb45-2821"><a href="#cb45-2821" aria-hidden="true" tabindex="-1"></a><span class="vs">              &lt;span id="pval-label" style="font-family: monospace; font-weight: bold; width: 60px; text-align: center;"&gt;0.050&lt;/span&gt;</span></span>
<span id="cb45-2822"><a href="#cb45-2822" aria-hidden="true" tabindex="-1"></a><span class="vs">              &lt;button id="pval-up" class="btn btn-outline-secondary btn-sm" style="width: 32px;"&gt;-&lt;/button&gt;</span></span>
<span id="cb45-2823"><a href="#cb45-2823" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;/div&gt;</span></span>
<span id="cb45-2824"><a href="#cb45-2824" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;/div&gt;</span></span>
<span id="cb45-2825"><a href="#cb45-2825" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;/div&gt;</span></span>
<span id="cb45-2826"><a href="#cb45-2826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-2827"><a href="#cb45-2827" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;div id="stat-summary" style="font-size: 0.8em; color: #666; font-style: italic;"&gt;</span></span>
<span id="cb45-2828"><a href="#cb45-2828" aria-hidden="true" tabindex="-1"></a><span class="vs">          Updating results...</span></span>
<span id="cb45-2829"><a href="#cb45-2829" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;/div&gt;</span></span>
<span id="cb45-2830"><a href="#cb45-2830" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/div&gt;</span></span>
<span id="cb45-2831"><a href="#cb45-2831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-2832"><a href="#cb45-2832" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div id="plot-area" style="background: #fdfdfd; border-radius: 8px;"&gt;&lt;/div&gt;</span></span>
<span id="cb45-2833"><a href="#cb45-2833" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/div&gt;</span></span>
<span id="cb45-2834"><a href="#cb45-2834" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span><span class="op">;</span></span>
<span id="cb45-2835"><a href="#cb45-2835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-2836"><a href="#cb45-2836" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">render</span>() {</span>
<span id="cb45-2837"><a href="#cb45-2837" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> plot <span class="op">=</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb45-2838"><a href="#cb45-2838" aria-hidden="true" tabindex="-1"></a>      width<span class="op">,</span> <span class="dt">height</span><span class="op">:</span> <span class="dv">450</span><span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb45-2839"><a href="#cb45-2839" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"log2FoldChange"</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="op">-</span><span class="dv">5</span><span class="op">,</span> <span class="dv">5</span>] }<span class="op">,</span></span>
<span id="cb45-2840"><a href="#cb45-2840" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"-log10 P-value"</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">5</span>] }<span class="op">,</span></span>
<span id="cb45-2841"><a href="#cb45-2841" aria-hidden="true" tabindex="-1"></a>      <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb45-2842"><a href="#cb45-2842" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">ruleX</span>([<span class="op">-</span>current_fc<span class="op">,</span> current_fc]<span class="op">,</span> {<span class="dt">stroke</span><span class="op">:</span> <span class="st">"#b44697"</span><span class="op">,</span> <span class="dt">strokeWidth</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">strokeDasharray</span><span class="op">:</span> <span class="st">"4,4"</span>})<span class="op">,</span></span>
<span id="cb45-2843"><a href="#cb45-2843" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">ruleY</span>([<span class="op">-</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log10</span>(current_pval)]<span class="op">,</span> {<span class="dt">stroke</span><span class="op">:</span> <span class="st">"#3C3F40"</span><span class="op">,</span> <span class="dt">strokeWidth</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">strokeDasharray</span><span class="op">:</span> <span class="st">"4,4"</span>})<span class="op">,</span></span>
<span id="cb45-2844"><a href="#cb45-2844" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">dot</span>(mock_data<span class="op">,</span> {</span>
<span id="cb45-2845"><a href="#cb45-2845" aria-hidden="true" tabindex="-1"></a>          <span class="dt">x</span><span class="op">:</span> <span class="st">"log2fc"</span><span class="op">,</span> </span>
<span id="cb45-2846"><a href="#cb45-2846" aria-hidden="true" tabindex="-1"></a>          <span class="dt">y</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="op">-</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log10</span>(d<span class="op">.</span><span class="at">p_value</span>)<span class="op">,</span></span>
<span id="cb45-2847"><a href="#cb45-2847" aria-hidden="true" tabindex="-1"></a>          <span class="dt">r</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb45-2848"><a href="#cb45-2848" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> (<span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(d<span class="op">.</span><span class="at">log2fc</span>) <span class="op">&gt;=</span> current_fc <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">p_value</span> <span class="op">&lt;=</span> current_pval) <span class="op">?</span> <span class="st">"#b44697"</span> <span class="op">:</span> <span class="st">"#dee2e6"</span><span class="op">,</span></span>
<span id="cb45-2849"><a href="#cb45-2849" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.7</span></span>
<span id="cb45-2850"><a href="#cb45-2850" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb45-2851"><a href="#cb45-2851" aria-hidden="true" tabindex="-1"></a>      ]</span>
<span id="cb45-2852"><a href="#cb45-2852" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb45-2853"><a href="#cb45-2853" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-2854"><a href="#cb45-2854" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Calculate Stats</span></span>
<span id="cb45-2855"><a href="#cb45-2855" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> sigCount <span class="op">=</span> mock_data<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(d<span class="op">.</span><span class="at">log2fc</span>) <span class="op">&gt;=</span> current_fc <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">p_value</span> <span class="op">&lt;=</span> current_pval)<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb45-2856"><a href="#cb45-2856" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-2857"><a href="#cb45-2857" aria-hidden="true" tabindex="-1"></a>    container<span class="op">.</span><span class="fu">querySelector</span>(<span class="st">"#plot-area"</span>)<span class="op">.</span><span class="fu">replaceChildren</span>(plot)<span class="op">;</span></span>
<span id="cb45-2858"><a href="#cb45-2858" aria-hidden="true" tabindex="-1"></a>    container<span class="op">.</span><span class="fu">querySelector</span>(<span class="st">"#fc-label"</span>)<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> current_fc<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb45-2859"><a href="#cb45-2859" aria-hidden="true" tabindex="-1"></a>    container<span class="op">.</span><span class="fu">querySelector</span>(<span class="st">"#pval-label"</span>)<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> current_pval<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb45-2860"><a href="#cb45-2860" aria-hidden="true" tabindex="-1"></a>    container<span class="op">.</span><span class="fu">querySelector</span>(<span class="st">"#stat-summary"</span>)<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>sigCount<span class="sc">}</span><span class="vs"> significant targets identified`</span><span class="op">;</span></span>
<span id="cb45-2861"><a href="#cb45-2861" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-2862"><a href="#cb45-2862" aria-hidden="true" tabindex="-1"></a>    container<span class="op">.</span><span class="at">value</span> <span class="op">=</span> {<span class="dt">fc</span><span class="op">:</span> current_fc<span class="op">,</span> <span class="dt">pval</span><span class="op">:</span> current_pval}<span class="op">;</span></span>
<span id="cb45-2863"><a href="#cb45-2863" aria-hidden="true" tabindex="-1"></a>    container<span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">CustomEvent</span>(<span class="st">"input"</span>))<span class="op">;</span></span>
<span id="cb45-2864"><a href="#cb45-2864" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb45-2865"><a href="#cb45-2865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-2866"><a href="#cb45-2866" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Button Listeners with Logic</span></span>
<span id="cb45-2867"><a href="#cb45-2867" aria-hidden="true" tabindex="-1"></a>  container<span class="op">.</span><span class="fu">querySelector</span>(<span class="st">"#fc-up"</span>)<span class="op">.</span><span class="at">onclick</span> <span class="op">=</span> () <span class="kw">=&gt;</span> { current_fc <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="dv">5</span><span class="op">,</span> current_fc <span class="op">+</span> <span class="fl">0.05</span>)<span class="op">;</span> <span class="fu">render</span>()<span class="op">;</span> }<span class="op">;</span></span>
<span id="cb45-2868"><a href="#cb45-2868" aria-hidden="true" tabindex="-1"></a>  container<span class="op">.</span><span class="fu">querySelector</span>(<span class="st">"#fc-down"</span>)<span class="op">.</span><span class="at">onclick</span> <span class="op">=</span> () <span class="kw">=&gt;</span> { current_fc <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> current_fc <span class="op">-</span> <span class="fl">0.05</span>)<span class="op">;</span> <span class="fu">render</span>()<span class="op">;</span> }<span class="op">;</span></span>
<span id="cb45-2869"><a href="#cb45-2869" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-2870"><a href="#cb45-2870" aria-hidden="true" tabindex="-1"></a>  <span class="co">// P-Value nudge (logarithmic step feels better for p-values)</span></span>
<span id="cb45-2871"><a href="#cb45-2871" aria-hidden="true" tabindex="-1"></a>  container<span class="op">.</span><span class="fu">querySelector</span>(<span class="st">"#pval-up"</span>)<span class="op">.</span><span class="at">onclick</span> <span class="op">=</span> () <span class="kw">=&gt;</span> { current_pval <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="fl">0.00001</span><span class="op">,</span> current_pval <span class="op">*</span> <span class="fl">0.5</span>)<span class="op">;</span> <span class="fu">render</span>()<span class="op">;</span> }<span class="op">;</span></span>
<span id="cb45-2872"><a href="#cb45-2872" aria-hidden="true" tabindex="-1"></a>  container<span class="op">.</span><span class="fu">querySelector</span>(<span class="st">"#pval-down"</span>)<span class="op">.</span><span class="at">onclick</span> <span class="op">=</span> () <span class="kw">=&gt;</span> { current_pval <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="dv">1</span><span class="op">,</span> current_pval <span class="op">*</span> <span class="fl">2.0</span>)<span class="op">;</span> <span class="fu">render</span>()<span class="op">;</span> }<span class="op">;</span></span>
<span id="cb45-2873"><a href="#cb45-2873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-2874"><a href="#cb45-2874" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb45-2875"><a href="#cb45-2875" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> container<span class="op">;</span></span>
<span id="cb45-2876"><a href="#cb45-2876" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div id="ojs-cell-39" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
<!-- This script simply changes out the temporary OJS runtime error messages  -->
<!-- that pop up when the cells are initializing.  -->
<div class="cell hidden html-fill-item html-fill-container">
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb46" data-startfrom="2885" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2884;"><span id="cb46-2885"><a href="#cb46-2885" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb46-2886"><a href="#cb46-2886" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> catchRuntimeLoadingErrors <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb46-2887"><a href="#cb46-2887" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Target the specific Quarto callout structure you captured</span></span>
<span id="cb46-2888"><a href="#cb46-2888" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> errors <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">querySelectorAll</span>(<span class="st">'.observablehq--error, .ojs-in-a-box-waiting-for-module-import'</span>)<span class="op">;</span></span>
<span id="cb46-2889"><a href="#cb46-2889" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-2890"><a href="#cb46-2890" aria-hidden="true" tabindex="-1"></a>    errors<span class="op">.</span><span class="fu">forEach</span>(el <span class="kw">=&gt;</span> {</span>
<span id="cb46-2891"><a href="#cb46-2891" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> callout <span class="op">=</span> el<span class="op">.</span><span class="fu">querySelector</span>(<span class="st">'.callout-important'</span>)<span class="op">;</span></span>
<span id="cb46-2892"><a href="#cb46-2892" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (callout) {</span>
<span id="cb46-2893"><a href="#cb46-2893" aria-hidden="true" tabindex="-1"></a>        callout<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">'none'</span><span class="op">;</span> </span>
<span id="cb46-2894"><a href="#cb46-2894" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb46-2895"><a href="#cb46-2895" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span>el<span class="op">.</span><span class="fu">querySelector</span>(<span class="st">'.custom-loading-label'</span>)) {</span>
<span id="cb46-2896"><a href="#cb46-2896" aria-hidden="true" tabindex="-1"></a>          <span class="kw">const</span> label <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">'div'</span>)<span class="op">;</span></span>
<span id="cb46-2897"><a href="#cb46-2897" aria-hidden="true" tabindex="-1"></a>          label<span class="op">.</span><span class="at">className</span> <span class="op">=</span> <span class="st">'custom-loading-label'</span><span class="op">;</span></span>
<span id="cb46-2898"><a href="#cb46-2898" aria-hidden="true" tabindex="-1"></a>          label<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb46-2899"><a href="#cb46-2899" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;div style="padding: 2rem; border: 1px dashed #ccc; border-radius: 8px; </span></span>
<span id="cb46-2900"><a href="#cb46-2900" aria-hidden="true" tabindex="-1"></a><span class="vs">                        background: #f9f9f9; color: #888; text-align: center; font-style: italic;"&gt;</span></span>
<span id="cb46-2901"><a href="#cb46-2901" aria-hidden="true" tabindex="-1"></a><span class="vs">              ⌛ Initializing Dashboard Components...</span></span>
<span id="cb46-2902"><a href="#cb46-2902" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;/div&gt;`</span><span class="op">;</span></span>
<span id="cb46-2903"><a href="#cb46-2903" aria-hidden="true" tabindex="-1"></a>          el<span class="op">.</span><span class="fu">prepend</span>(label)<span class="op">;</span></span>
<span id="cb46-2904"><a href="#cb46-2904" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb46-2905"><a href="#cb46-2905" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb46-2906"><a href="#cb46-2906" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb46-2907"><a href="#cb46-2907" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb46-2908"><a href="#cb46-2908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-2909"><a href="#cb46-2909" aria-hidden="true" tabindex="-1"></a>  <span class="fu">catchRuntimeLoadingErrors</span>()<span class="op">;</span></span>
<span id="cb46-2910"><a href="#cb46-2910" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-2911"><a href="#cb46-2911" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> observer <span class="op">=</span> <span class="kw">new</span> <span class="bu">MutationObserver</span>(catchRuntimeLoadingErrors)<span class="op">;</span></span>
<span id="cb46-2912"><a href="#cb46-2912" aria-hidden="true" tabindex="-1"></a>  observer<span class="op">.</span><span class="fu">observe</span>(<span class="bu">document</span><span class="op">.</span><span class="at">body</span><span class="op">,</span> { <span class="dt">childList</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">subtree</span><span class="op">:</span> <span class="kw">true</span> })<span class="op">;</span></span>
<span id="cb46-2913"><a href="#cb46-2913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-2914"><a href="#cb46-2914" aria-hidden="true" tabindex="-1"></a>  invalidation<span class="op">.</span><span class="fu">then</span>(() <span class="kw">=&gt;</span> observer<span class="op">.</span><span class="fu">disconnect</span>())<span class="op">;</span></span>
<span id="cb46-2915"><a href="#cb46-2915" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div id="ojs-cell-40" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>


<div id="3ade8a4a-fb1d-4a6c-8409-ac45482d5fc9" class="hidden html-fill-item html-fill-container">

</div>
<div class="card html-fill-item html-fill-container bslib-card" data-fill="false" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-body html-fill-item html-fill-container">
<script type="webr-data">
eyJvcHRpb25zIjp7ImJhc2VVcmwiOiJodHRwczovL3dlYnIuci13YXNtLm9yZy92MC41LjgvIn0sInBhY2thZ2VzIjp7InBrZ3MiOlsiZXZhbHVhdGUiLCJrbml0ciIsImh0bWx0b29scyIsImRwbHlyIiwiZGJwbHlyIiwiREJJIiwiZHVja2RiIiwiZ2dwbG90MiIsImdncmVwZWwiLCJzdmdsaXRlIiwianNvbmxpdGUiLCJwbG90bHkiXSwicmVwb3MiOlsiaHR0cHM6Ly9yLWxpYi5yLXVuaXZlcnNlLmRldiJdfSwicmVuZGVyX2RmIjoiZGVmYXVsdCJ9
</script>
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3siY2VsbE5hbWUiOiJ3ZWJyLXdpZGdldC0xNiIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6IntcbiAgLy8gV2FpdCBmb3Igb3V0cHV0IHRvIGJlIHdyaXR0ZW4gdG8gdGhlIERPTSwgdGhlbiB0cmlnZ2VyIHdpZGdldCByZW5kZXJpbmdcbiAgYXdhaXQgX3dlYnJfdmFsdWVfMTY7XG4gIGlmICh3aW5kb3cuSFRNTFdpZGdldHMpIHtcbiAgICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKCk7XG4gIH1cbiAgaWYgKHdpbmRvdy5QYWdlZFRhYmxlRG9jKSB7XG4gICAgd2luZG93LlBhZ2VkVGFibGVEb2MuaW5pdEFsbCgpO1xuICB9XG59XG4ifSx7ImNlbGxOYW1lIjoid2Vici0xNiIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJzb3VyY2UiOiJ2aWV3b2YgX3dlYnJfZWRpdG9yXzE2ID0ge1xuICBjb25zdCB7IFdlYlJFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuICBjb25zdCBzY3JpcHRDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihgc2NyaXB0W3R5cGU9XFxcIndlYnItMTYtY29udGVudHNcXFwiXWApLnRleHRDb250ZW50O1xuICBjb25zdCBibG9jayA9IEpTT04ucGFyc2UoYjY0RGVjb2RlKHNjcmlwdENvbnRlbnQpKTtcblxuICBjb25zdCBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7IGlkOiBgd2Vici0xNi1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBXZWJSRXhlcmNpc2VFZGl0b3Iod2ViUk9qcy53ZWJSUHJvbWlzZSwgYmxvY2suY29kZSwgb3B0aW9ucyk7XG5cbiAgcmV0dXJuIGVkaXRvci5jb250YWluZXI7XG59XG5fd2Vicl92YWx1ZV8xNiA9IHdlYlJPanMucHJvY2Vzcyhfd2Vicl9lZGl0b3JfMTYsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLXdpZGdldC0xNSIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6IntcbiAgLy8gV2FpdCBmb3Igb3V0cHV0IHRvIGJlIHdyaXR0ZW4gdG8gdGhlIERPTSwgdGhlbiB0cmlnZ2VyIHdpZGdldCByZW5kZXJpbmdcbiAgYXdhaXQgX3dlYnJfdmFsdWVfMTU7XG4gIGlmICh3aW5kb3cuSFRNTFdpZGdldHMpIHtcbiAgICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKCk7XG4gIH1cbiAgaWYgKHdpbmRvdy5QYWdlZFRhYmxlRG9jKSB7XG4gICAgd2luZG93LlBhZ2VkVGFibGVEb2MuaW5pdEFsbCgpO1xuICB9XG59XG4ifSx7ImNlbGxOYW1lIjoid2Vici0xNSIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJzb3VyY2UiOiJ2aWV3b2YgX3dlYnJfZWRpdG9yXzE1ID0ge1xuICBjb25zdCB7IFdlYlJFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuICBjb25zdCBzY3JpcHRDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihgc2NyaXB0W3R5cGU9XFxcIndlYnItMTUtY29udGVudHNcXFwiXWApLnRleHRDb250ZW50O1xuICBjb25zdCBibG9jayA9IEpTT04ucGFyc2UoYjY0RGVjb2RlKHNjcmlwdENvbnRlbnQpKTtcblxuICBjb25zdCBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7IGlkOiBgd2Vici0xNS1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBXZWJSRXhlcmNpc2VFZGl0b3Iod2ViUk9qcy53ZWJSUHJvbWlzZSwgYmxvY2suY29kZSwgb3B0aW9ucyk7XG5cbiAgcmV0dXJuIGVkaXRvci5jb250YWluZXI7XG59XG5fd2Vicl92YWx1ZV8xNSA9IHdlYlJPanMucHJvY2Vzcyhfd2Vicl9lZGl0b3JfMTUsIHt2b2xjYW5vX2ZjX3JhbmdlLCB2b2xjYW5vX3B2YWxfdGhyZXNob2xkLCB2b2xjYW5vX3B0X3NpemUsIHZvbGNhbm9fYWxwaGEsIHZvbGNhbm9fcHRfY29sb3IsIHZvbGNhbm9fc2lnX2NvbG9yLCB2b2xjYW5vX2hpZ2hfZmNfbGFiZWwsIHZvbGNhbm9fbG93X2ZjX2xhYmVsLCB2b2xjYW5vX3B2YWxfbGFiZWwsIHZvbGNhbm9faW5jbHVkZV9zZWxlY3RlZF9nZW5lcywgc2VsZWN0ZWRfZ2VuZXN9KTtcbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLXdpZGdldC0xNCIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6IntcbiAgLy8gV2FpdCBmb3Igb3V0cHV0IHRvIGJlIHdyaXR0ZW4gdG8gdGhlIERPTSwgdGhlbiB0cmlnZ2VyIHdpZGdldCByZW5kZXJpbmdcbiAgYXdhaXQgX3dlYnJfdmFsdWVfMTQ7XG4gIGlmICh3aW5kb3cuSFRNTFdpZGdldHMpIHtcbiAgICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKCk7XG4gIH1cbiAgaWYgKHdpbmRvdy5QYWdlZFRhYmxlRG9jKSB7XG4gICAgd2luZG93LlBhZ2VkVGFibGVEb2MuaW5pdEFsbCgpO1xuICB9XG59XG4ifSx7ImNlbGxOYW1lIjoid2Vici0xNCIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJzb3VyY2UiOiJfd2Vicl92YWx1ZV8xNCA9IHtcbiAgY29uc3QgeyBoaWdobGlnaHRSLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici0xNC1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIC8vIERlZmF1bHQgZXZhbHVhdGlvbiBjb25maWd1cmF0aW9uXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHtcbiAgICBpZDogXCJ3ZWJyLTE0LWNvbnRlbnRzXCIsXG4gICAgZWNobzogdHJ1ZSxcbiAgICBvdXRwdXQ6IHRydWVcbiAgfSwgYmxvY2suYXR0cik7XG5cbiAgLy8gRXZhbHVhdGUgdGhlIHByb3ZpZGVkIFIgY29kZVxuICBjb25zdCByZXN1bHQgPSB3ZWJST2pzLnByb2Nlc3Moe2NvZGU6IGJsb2NrLmNvZGUsIG9wdGlvbnN9LCB7fSk7XG5cbiAgLy8gRWFybHkgeWllbGQgd2hpbGUgd2Ugd2FpdCBmb3IgdGhlIGZpcnN0IGV2YWx1YXRpb24gYW5kIHJlbmRlclxuICBpZiAob3B0aW9ucy5vdXRwdXQgJiYgIShcIjE0XCIgaW4gd2ViUk9qcy5yZW5kZXJlZE9qcykpIHtcbiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIGNvbnN0IHNwaW5uZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXG4gICAgaWYgKG9wdGlvbnMuZWNobykge1xuICAgICAgLy8gU2hvdyBvdXRwdXQgYXMgaGlnaGxpZ2h0ZWQgc291cmNlXG4gICAgICBjb25zdCBwcmVFbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInByZVwiKTtcbiAgICAgIGNvbnRhaW5lci5jbGFzc05hbWUgPSBcInNvdXJjZUNvZGVcIjtcbiAgICAgIHByZUVsZW0uY2xhc3NOYW1lID0gXCJzb3VyY2VDb2RlIHJcIjtcbiAgICAgIHByZUVsZW0uYXBwZW5kQ2hpbGQoaGlnaGxpZ2h0UihibG9jay5jb2RlKSk7XG4gICAgICBzcGlubmVyLmNsYXNzTmFtZSA9IFwic3Bpbm5lci1ncm93IHNwaW5uZXItZ3Jvdy1zbSBtLTIgcG9zaXRpb24tYWJzb2x1dGUgdG9wLTAgZW5kLTBcIjtcbiAgICAgIHByZUVsZW0uYXBwZW5kQ2hpbGQoc3Bpbm5lcik7XG4gICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQocHJlRWxlbSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNwaW5uZXIuY2xhc3NOYW1lID0gXCJzcGlubmVyLWJvcmRlciBzcGlubmVyLWJvcmRlci1zbVwiO1xuICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHNwaW5uZXIpO1xuICAgIH1cblxuICAgIHlpZWxkIGNvbnRhaW5lcjtcbiAgfVxuXG4gIHdlYlJPanMucmVuZGVyZWRPanNbXCIxNFwiXSA9IHRydWU7XG4gIHlpZWxkIGF3YWl0IHJlc3VsdDtcbn1cbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLXdpZGdldC0xMyIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6IntcbiAgLy8gV2FpdCBmb3Igb3V0cHV0IHRvIGJlIHdyaXR0ZW4gdG8gdGhlIERPTSwgdGhlbiB0cmlnZ2VyIHdpZGdldCByZW5kZXJpbmdcbiAgYXdhaXQgX3dlYnJfdmFsdWVfMTM7XG4gIGlmICh3aW5kb3cuSFRNTFdpZGdldHMpIHtcbiAgICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKCk7XG4gIH1cbiAgaWYgKHdpbmRvdy5QYWdlZFRhYmxlRG9jKSB7XG4gICAgd2luZG93LlBhZ2VkVGFibGVEb2MuaW5pdEFsbCgpO1xuICB9XG59XG4ifSx7ImNlbGxOYW1lIjoid2Vici0xMyIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJzb3VyY2UiOiJfd2Vicl92YWx1ZV8xMyA9IHtcbiAgY29uc3QgeyBoaWdobGlnaHRSLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici0xMy1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIC8vIERlZmF1bHQgZXZhbHVhdGlvbiBjb25maWd1cmF0aW9uXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHtcbiAgICBpZDogXCJ3ZWJyLTEzLWNvbnRlbnRzXCIsXG4gICAgZWNobzogdHJ1ZSxcbiAgICBvdXRwdXQ6IHRydWVcbiAgfSwgYmxvY2suYXR0cik7XG5cbiAgLy8gRXZhbHVhdGUgdGhlIHByb3ZpZGVkIFIgY29kZVxuICBjb25zdCByZXN1bHQgPSB3ZWJST2pzLnByb2Nlc3Moe2NvZGU6IGJsb2NrLmNvZGUsIG9wdGlvbnN9LCB7fSk7XG5cbiAgLy8gRWFybHkgeWllbGQgd2hpbGUgd2Ugd2FpdCBmb3IgdGhlIGZpcnN0IGV2YWx1YXRpb24gYW5kIHJlbmRlclxuICBpZiAob3B0aW9ucy5vdXRwdXQgJiYgIShcIjEzXCIgaW4gd2ViUk9qcy5yZW5kZXJlZE9qcykpIHtcbiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIGNvbnN0IHNwaW5uZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXG4gICAgaWYgKG9wdGlvbnMuZWNobykge1xuICAgICAgLy8gU2hvdyBvdXRwdXQgYXMgaGlnaGxpZ2h0ZWQgc291cmNlXG4gICAgICBjb25zdCBwcmVFbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInByZVwiKTtcbiAgICAgIGNvbnRhaW5lci5jbGFzc05hbWUgPSBcInNvdXJjZUNvZGVcIjtcbiAgICAgIHByZUVsZW0uY2xhc3NOYW1lID0gXCJzb3VyY2VDb2RlIHJcIjtcbiAgICAgIHByZUVsZW0uYXBwZW5kQ2hpbGQoaGlnaGxpZ2h0UihibG9jay5jb2RlKSk7XG4gICAgICBzcGlubmVyLmNsYXNzTmFtZSA9IFwic3Bpbm5lci1ncm93IHNwaW5uZXItZ3Jvdy1zbSBtLTIgcG9zaXRpb24tYWJzb2x1dGUgdG9wLTAgZW5kLTBcIjtcbiAgICAgIHByZUVsZW0uYXBwZW5kQ2hpbGQoc3Bpbm5lcik7XG4gICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQocHJlRWxlbSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNwaW5uZXIuY2xhc3NOYW1lID0gXCJzcGlubmVyLWJvcmRlciBzcGlubmVyLWJvcmRlci1zbVwiO1xuICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHNwaW5uZXIpO1xuICAgIH1cblxuICAgIHlpZWxkIGNvbnRhaW5lcjtcbiAgfVxuXG4gIHdlYlJPanMucmVuZGVyZWRPanNbXCIxM1wiXSA9IHRydWU7XG4gIHlpZWxkIGF3YWl0IHJlc3VsdDtcbn1cbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLXdpZGdldC0xMiIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6IntcbiAgLy8gV2FpdCBmb3Igb3V0cHV0IHRvIGJlIHdyaXR0ZW4gdG8gdGhlIERPTSwgdGhlbiB0cmlnZ2VyIHdpZGdldCByZW5kZXJpbmdcbiAgYXdhaXQgX3dlYnJfdmFsdWVfMTI7XG4gIGlmICh3aW5kb3cuSFRNTFdpZGdldHMpIHtcbiAgICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKCk7XG4gIH1cbiAgaWYgKHdpbmRvdy5QYWdlZFRhYmxlRG9jKSB7XG4gICAgd2luZG93LlBhZ2VkVGFibGVEb2MuaW5pdEFsbCgpO1xuICB9XG59XG4ifSx7ImNlbGxOYW1lIjoid2Vici0xMiIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJzb3VyY2UiOiJfd2Vicl92YWx1ZV8xMiA9IHtcbiAgY29uc3QgeyBoaWdobGlnaHRSLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici0xMi1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIC8vIERlZmF1bHQgZXZhbHVhdGlvbiBjb25maWd1cmF0aW9uXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHtcbiAgICBpZDogXCJ3ZWJyLTEyLWNvbnRlbnRzXCIsXG4gICAgZWNobzogdHJ1ZSxcbiAgICBvdXRwdXQ6IHRydWVcbiAgfSwgYmxvY2suYXR0cik7XG5cbiAgLy8gRXZhbHVhdGUgdGhlIHByb3ZpZGVkIFIgY29kZVxuICBjb25zdCByZXN1bHQgPSB3ZWJST2pzLnByb2Nlc3Moe2NvZGU6IGJsb2NrLmNvZGUsIG9wdGlvbnN9LCB7dGVybV9zZWxlY3Rpb24sIHNsaWRlX3NlbGVjdGlvbiwgZGJfcmVhZHl9KTtcblxuICAvLyBFYXJseSB5aWVsZCB3aGlsZSB3ZSB3YWl0IGZvciB0aGUgZmlyc3QgZXZhbHVhdGlvbiBhbmQgcmVuZGVyXG4gIGlmIChvcHRpb25zLm91dHB1dCAmJiAhKFwiMTJcIiBpbiB3ZWJST2pzLnJlbmRlcmVkT2pzKSkge1xuICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgY29uc3Qgc3Bpbm5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cbiAgICBpZiAob3B0aW9ucy5lY2hvKSB7XG4gICAgICAvLyBTaG93IG91dHB1dCBhcyBoaWdobGlnaHRlZCBzb3VyY2VcbiAgICAgIGNvbnN0IHByZUVsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicHJlXCIpO1xuICAgICAgY29udGFpbmVyLmNsYXNzTmFtZSA9IFwic291cmNlQ29kZVwiO1xuICAgICAgcHJlRWxlbS5jbGFzc05hbWUgPSBcInNvdXJjZUNvZGUgclwiO1xuICAgICAgcHJlRWxlbS5hcHBlbmRDaGlsZChoaWdobGlnaHRSKGJsb2NrLmNvZGUpKTtcbiAgICAgIHNwaW5uZXIuY2xhc3NOYW1lID0gXCJzcGlubmVyLWdyb3cgc3Bpbm5lci1ncm93LXNtIG0tMiBwb3NpdGlvbi1hYnNvbHV0ZSB0b3AtMCBlbmQtMFwiO1xuICAgICAgcHJlRWxlbS5hcHBlbmRDaGlsZChzcGlubmVyKTtcbiAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChwcmVFbGVtKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3Bpbm5lci5jbGFzc05hbWUgPSBcInNwaW5uZXItYm9yZGVyIHNwaW5uZXItYm9yZGVyLXNtXCI7XG4gICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoc3Bpbm5lcik7XG4gICAgfVxuXG4gICAgeWllbGQgY29udGFpbmVyO1xuICB9XG5cbiAgd2ViUk9qcy5yZW5kZXJlZE9qc1tcIjEyXCJdID0gdHJ1ZTtcbiAgeWllbGQgYXdhaXQgcmVzdWx0O1xufVxuIn0seyJjZWxsTmFtZSI6IndlYnItd2lkZ2V0LTExIiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV8xMTtcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLTExIiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCIsInNvdXJjZSI6Il93ZWJyX3ZhbHVlXzExID0ge1xuICBjb25zdCB7IGhpZ2hsaWdodFIsIGI2NERlY29kZSB9ID0gd2luZG93Ll9leGVyY2lzZV9vanNfcnVudGltZTtcbiAgY29uc3Qgc2NyaXB0Q29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYHNjcmlwdFt0eXBlPVxcXCJ3ZWJyLTExLWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgLy8gRGVmYXVsdCBldmFsdWF0aW9uIGNvbmZpZ3VyYXRpb25cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe1xuICAgIGlkOiBcIndlYnItMTEtY29udGVudHNcIixcbiAgICBlY2hvOiB0cnVlLFxuICAgIG91dHB1dDogdHJ1ZVxuICB9LCBibG9jay5hdHRyKTtcblxuICAvLyBFdmFsdWF0ZSB0aGUgcHJvdmlkZWQgUiBjb2RlXG4gIGNvbnN0IHJlc3VsdCA9IHdlYlJPanMucHJvY2Vzcyh7Y29kZTogYmxvY2suY29kZSwgb3B0aW9uc30sIHtzdHVkeV9kYXRhX3BheWxvYWQsIG1lYW5zX2RhdGFfanMsIG1lYW5zX2xldmVsLCBtZWFuc19oaWdobGlnaHQsIG1lYW5zX3Nob3dfbGFiZWxlZCwgc2VsZWN0ZWRfZ2VuZXN9KTtcblxuICAvLyBFYXJseSB5aWVsZCB3aGlsZSB3ZSB3YWl0IGZvciB0aGUgZmlyc3QgZXZhbHVhdGlvbiBhbmQgcmVuZGVyXG4gIGlmIChvcHRpb25zLm91dHB1dCAmJiAhKFwiMTFcIiBpbiB3ZWJST2pzLnJlbmRlcmVkT2pzKSkge1xuICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgY29uc3Qgc3Bpbm5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cbiAgICBpZiAob3B0aW9ucy5lY2hvKSB7XG4gICAgICAvLyBTaG93IG91dHB1dCBhcyBoaWdobGlnaHRlZCBzb3VyY2VcbiAgICAgIGNvbnN0IHByZUVsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicHJlXCIpO1xuICAgICAgY29udGFpbmVyLmNsYXNzTmFtZSA9IFwic291cmNlQ29kZVwiO1xuICAgICAgcHJlRWxlbS5jbGFzc05hbWUgPSBcInNvdXJjZUNvZGUgclwiO1xuICAgICAgcHJlRWxlbS5hcHBlbmRDaGlsZChoaWdobGlnaHRSKGJsb2NrLmNvZGUpKTtcbiAgICAgIHNwaW5uZXIuY2xhc3NOYW1lID0gXCJzcGlubmVyLWdyb3cgc3Bpbm5lci1ncm93LXNtIG0tMiBwb3NpdGlvbi1hYnNvbHV0ZSB0b3AtMCBlbmQtMFwiO1xuICAgICAgcHJlRWxlbS5hcHBlbmRDaGlsZChzcGlubmVyKTtcbiAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChwcmVFbGVtKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3Bpbm5lci5jbGFzc05hbWUgPSBcInNwaW5uZXItYm9yZGVyIHNwaW5uZXItYm9yZGVyLXNtXCI7XG4gICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoc3Bpbm5lcik7XG4gICAgfVxuXG4gICAgeWllbGQgY29udGFpbmVyO1xuICB9XG5cbiAgd2ViUk9qcy5yZW5kZXJlZE9qc1tcIjExXCJdID0gdHJ1ZTtcbiAgeWllbGQgYXdhaXQgcmVzdWx0O1xufVxuIn0seyJjZWxsTmFtZSI6IndlYnItd2lkZ2V0LTEwIiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV8xMDtcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLTEwIiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCIsInNvdXJjZSI6Il93ZWJyX3ZhbHVlXzEwID0ge1xuICBjb25zdCB7IGhpZ2hsaWdodFIsIGI2NERlY29kZSB9ID0gd2luZG93Ll9leGVyY2lzZV9vanNfcnVudGltZTtcbiAgY29uc3Qgc2NyaXB0Q29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYHNjcmlwdFt0eXBlPVxcXCJ3ZWJyLTEwLWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgLy8gRGVmYXVsdCBldmFsdWF0aW9uIGNvbmZpZ3VyYXRpb25cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe1xuICAgIGlkOiBcIndlYnItMTAtY29udGVudHNcIixcbiAgICBlY2hvOiB0cnVlLFxuICAgIG91dHB1dDogdHJ1ZVxuICB9LCBibG9jay5hdHRyKTtcblxuICAvLyBFdmFsdWF0ZSB0aGUgcHJvdmlkZWQgUiBjb2RlXG4gIGNvbnN0IHJlc3VsdCA9IHdlYlJPanMucHJvY2Vzcyh7Y29kZTogYmxvY2suY29kZSwgb3B0aW9uc30sIHtzdHVkeV9kYXRhX3BheWxvYWQsIGF2YWlsYWJsZV9sZXZlbHN9KTtcblxuICAvLyBFYXJseSB5aWVsZCB3aGlsZSB3ZSB3YWl0IGZvciB0aGUgZmlyc3QgZXZhbHVhdGlvbiBhbmQgcmVuZGVyXG4gIGlmIChvcHRpb25zLm91dHB1dCAmJiAhKFwiMTBcIiBpbiB3ZWJST2pzLnJlbmRlcmVkT2pzKSkge1xuICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgY29uc3Qgc3Bpbm5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cbiAgICBpZiAob3B0aW9ucy5lY2hvKSB7XG4gICAgICAvLyBTaG93IG91dHB1dCBhcyBoaWdobGlnaHRlZCBzb3VyY2VcbiAgICAgIGNvbnN0IHByZUVsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicHJlXCIpO1xuICAgICAgY29udGFpbmVyLmNsYXNzTmFtZSA9IFwic291cmNlQ29kZVwiO1xuICAgICAgcHJlRWxlbS5jbGFzc05hbWUgPSBcInNvdXJjZUNvZGUgclwiO1xuICAgICAgcHJlRWxlbS5hcHBlbmRDaGlsZChoaWdobGlnaHRSKGJsb2NrLmNvZGUpKTtcbiAgICAgIHNwaW5uZXIuY2xhc3NOYW1lID0gXCJzcGlubmVyLWdyb3cgc3Bpbm5lci1ncm93LXNtIG0tMiBwb3NpdGlvbi1hYnNvbHV0ZSB0b3AtMCBlbmQtMFwiO1xuICAgICAgcHJlRWxlbS5hcHBlbmRDaGlsZChzcGlubmVyKTtcbiAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChwcmVFbGVtKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3Bpbm5lci5jbGFzc05hbWUgPSBcInNwaW5uZXItYm9yZGVyIHNwaW5uZXItYm9yZGVyLXNtXCI7XG4gICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoc3Bpbm5lcik7XG4gICAgfVxuXG4gICAgeWllbGQgY29udGFpbmVyO1xuICB9XG5cbiAgd2ViUk9qcy5yZW5kZXJlZE9qc1tcIjEwXCJdID0gdHJ1ZTtcbiAgeWllbGQgYXdhaXQgcmVzdWx0O1xufVxuIn0seyJjZWxsTmFtZSI6IndlYnItd2lkZ2V0LTkiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJ7XG4gIC8vIFdhaXQgZm9yIG91dHB1dCB0byBiZSB3cml0dGVuIHRvIHRoZSBET00sIHRoZW4gdHJpZ2dlciB3aWRnZXQgcmVuZGVyaW5nXG4gIGF3YWl0IF93ZWJyX3ZhbHVlXzk7XG4gIGlmICh3aW5kb3cuSFRNTFdpZGdldHMpIHtcbiAgICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKCk7XG4gIH1cbiAgaWYgKHdpbmRvdy5QYWdlZFRhYmxlRG9jKSB7XG4gICAgd2luZG93LlBhZ2VkVGFibGVEb2MuaW5pdEFsbCgpO1xuICB9XG59XG4ifSx7ImNlbGxOYW1lIjoid2Vici05IiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCIsInNvdXJjZSI6Il93ZWJyX3ZhbHVlXzkgPSB7XG4gIGNvbnN0IHsgaGlnaGxpZ2h0UiwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuICBjb25zdCBzY3JpcHRDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihgc2NyaXB0W3R5cGU9XFxcIndlYnItOS1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIC8vIERlZmF1bHQgZXZhbHVhdGlvbiBjb25maWd1cmF0aW9uXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHtcbiAgICBpZDogXCJ3ZWJyLTktY29udGVudHNcIixcbiAgICBlY2hvOiB0cnVlLFxuICAgIG91dHB1dDogdHJ1ZVxuICB9LCBibG9jay5hdHRyKTtcblxuICAvLyBFdmFsdWF0ZSB0aGUgcHJvdmlkZWQgUiBjb2RlXG4gIGNvbnN0IHJlc3VsdCA9IHdlYlJPanMucHJvY2Vzcyh7Y29kZTogYmxvY2suY29kZSwgb3B0aW9uc30sIHtzYXZlX2J0biwgc2F2ZV9yZXF1ZXN0fSk7XG5cbiAgLy8gRWFybHkgeWllbGQgd2hpbGUgd2Ugd2FpdCBmb3IgdGhlIGZpcnN0IGV2YWx1YXRpb24gYW5kIHJlbmRlclxuICBpZiAob3B0aW9ucy5vdXRwdXQgJiYgIShcIjlcIiBpbiB3ZWJST2pzLnJlbmRlcmVkT2pzKSkge1xuICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgY29uc3Qgc3Bpbm5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cbiAgICBpZiAob3B0aW9ucy5lY2hvKSB7XG4gICAgICAvLyBTaG93IG91dHB1dCBhcyBoaWdobGlnaHRlZCBzb3VyY2VcbiAgICAgIGNvbnN0IHByZUVsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicHJlXCIpO1xuICAgICAgY29udGFpbmVyLmNsYXNzTmFtZSA9IFwic291cmNlQ29kZVwiO1xuICAgICAgcHJlRWxlbS5jbGFzc05hbWUgPSBcInNvdXJjZUNvZGUgclwiO1xuICAgICAgcHJlRWxlbS5hcHBlbmRDaGlsZChoaWdobGlnaHRSKGJsb2NrLmNvZGUpKTtcbiAgICAgIHNwaW5uZXIuY2xhc3NOYW1lID0gXCJzcGlubmVyLWdyb3cgc3Bpbm5lci1ncm93LXNtIG0tMiBwb3NpdGlvbi1hYnNvbHV0ZSB0b3AtMCBlbmQtMFwiO1xuICAgICAgcHJlRWxlbS5hcHBlbmRDaGlsZChzcGlubmVyKTtcbiAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChwcmVFbGVtKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3Bpbm5lci5jbGFzc05hbWUgPSBcInNwaW5uZXItYm9yZGVyIHNwaW5uZXItYm9yZGVyLXNtXCI7XG4gICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoc3Bpbm5lcik7XG4gICAgfVxuXG4gICAgeWllbGQgY29udGFpbmVyO1xuICB9XG5cbiAgd2ViUk9qcy5yZW5kZXJlZE9qc1tcIjlcIl0gPSB0cnVlO1xuICB5aWVsZCBhd2FpdCByZXN1bHQ7XG59XG4ifSx7ImNlbGxOYW1lIjoid2Vici13aWRnZXQtOCIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6IntcbiAgLy8gV2FpdCBmb3Igb3V0cHV0IHRvIGJlIHdyaXR0ZW4gdG8gdGhlIERPTSwgdGhlbiB0cmlnZ2VyIHdpZGdldCByZW5kZXJpbmdcbiAgYXdhaXQgX3dlYnJfdmFsdWVfODtcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLTgiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoiX3dlYnJfdmFsdWVfOCA9IHtcbiAgY29uc3QgeyBoaWdobGlnaHRSLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici04LWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgLy8gRGVmYXVsdCBldmFsdWF0aW9uIGNvbmZpZ3VyYXRpb25cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe1xuICAgIGlkOiBcIndlYnItOC1jb250ZW50c1wiLFxuICAgIGVjaG86IHRydWUsXG4gICAgb3V0cHV0OiB0cnVlXG4gIH0sIGJsb2NrLmF0dHIpO1xuXG4gIC8vIEV2YWx1YXRlIHRoZSBwcm92aWRlZCBSIGNvZGVcbiAgY29uc3QgcmVzdWx0ID0gd2ViUk9qcy5wcm9jZXNzKHtjb2RlOiBibG9jay5jb2RlLCBvcHRpb25zfSwge3ZvbGNhbm9fcGxvdF9lbWl0LCBhcmdzVm9sY2FubywgY3VycmVudF92b2xjYW5vX2RhdGF9KTtcblxuICAvLyBFYXJseSB5aWVsZCB3aGlsZSB3ZSB3YWl0IGZvciB0aGUgZmlyc3QgZXZhbHVhdGlvbiBhbmQgcmVuZGVyXG4gIGlmIChvcHRpb25zLm91dHB1dCAmJiAhKFwiOFwiIGluIHdlYlJPanMucmVuZGVyZWRPanMpKSB7XG4gICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBjb25zdCBzcGlubmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblxuICAgIGlmIChvcHRpb25zLmVjaG8pIHtcbiAgICAgIC8vIFNob3cgb3V0cHV0IGFzIGhpZ2hsaWdodGVkIHNvdXJjZVxuICAgICAgY29uc3QgcHJlRWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJwcmVcIik7XG4gICAgICBjb250YWluZXIuY2xhc3NOYW1lID0gXCJzb3VyY2VDb2RlXCI7XG4gICAgICBwcmVFbGVtLmNsYXNzTmFtZSA9IFwic291cmNlQ29kZSByXCI7XG4gICAgICBwcmVFbGVtLmFwcGVuZENoaWxkKGhpZ2hsaWdodFIoYmxvY2suY29kZSkpO1xuICAgICAgc3Bpbm5lci5jbGFzc05hbWUgPSBcInNwaW5uZXItZ3JvdyBzcGlubmVyLWdyb3ctc20gbS0yIHBvc2l0aW9uLWFic29sdXRlIHRvcC0wIGVuZC0wXCI7XG4gICAgICBwcmVFbGVtLmFwcGVuZENoaWxkKHNwaW5uZXIpO1xuICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHByZUVsZW0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBzcGlubmVyLmNsYXNzTmFtZSA9IFwic3Bpbm5lci1ib3JkZXIgc3Bpbm5lci1ib3JkZXItc21cIjtcbiAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChzcGlubmVyKTtcbiAgICB9XG5cbiAgICB5aWVsZCBjb250YWluZXI7XG4gIH1cblxuICB3ZWJST2pzLnJlbmRlcmVkT2pzW1wiOFwiXSA9IHRydWU7XG4gIHlpZWxkIGF3YWl0IHJlc3VsdDtcbn1cbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLXdpZGdldC03IiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV83O1xuICBpZiAod2luZG93LkhUTUxXaWRnZXRzKSB7XG4gICAgd2luZG93LkhUTUxXaWRnZXRzLnN0YXRpY1JlbmRlcigpO1xuICB9XG4gIGlmICh3aW5kb3cuUGFnZWRUYWJsZURvYykge1xuICAgIHdpbmRvdy5QYWdlZFRhYmxlRG9jLmluaXRBbGwoKTtcbiAgfVxufVxuIn0seyJjZWxsTmFtZSI6IndlYnItNyIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJzb3VyY2UiOiJfd2Vicl92YWx1ZV83ID0ge1xuICBjb25zdCB7IGhpZ2hsaWdodFIsIGI2NERlY29kZSB9ID0gd2luZG93Ll9leGVyY2lzZV9vanNfcnVudGltZTtcbiAgY29uc3Qgc2NyaXB0Q29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYHNjcmlwdFt0eXBlPVxcXCJ3ZWJyLTctY29udGVudHNcXFwiXWApLnRleHRDb250ZW50O1xuICBjb25zdCBibG9jayA9IEpTT04ucGFyc2UoYjY0RGVjb2RlKHNjcmlwdENvbnRlbnQpKTtcblxuICAvLyBEZWZhdWx0IGV2YWx1YXRpb24gY29uZmlndXJhdGlvblxuICBjb25zdCBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7XG4gICAgaWQ6IFwid2Vici03LWNvbnRlbnRzXCIsXG4gICAgZWNobzogdHJ1ZSxcbiAgICBvdXRwdXQ6IHRydWVcbiAgfSwgYmxvY2suYXR0cik7XG5cbiAgLy8gRXZhbHVhdGUgdGhlIHByb3ZpZGVkIFIgY29kZVxuICBjb25zdCByZXN1bHQgPSB3ZWJST2pzLnByb2Nlc3Moe2NvZGU6IGJsb2NrLmNvZGUsIG9wdGlvbnN9LCB7c3R1ZHlfZGF0YV9wYXlsb2FkLCB2b2xjYW5vX2RhdGFfanMsIGNvbnRyYXN0X3NlbGVjdGlvbiwgdGVybV9zZWxlY3Rpb259KTtcblxuICAvLyBFYXJseSB5aWVsZCB3aGlsZSB3ZSB3YWl0IGZvciB0aGUgZmlyc3QgZXZhbHVhdGlvbiBhbmQgcmVuZGVyXG4gIGlmIChvcHRpb25zLm91dHB1dCAmJiAhKFwiN1wiIGluIHdlYlJPanMucmVuZGVyZWRPanMpKSB7XG4gICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBjb25zdCBzcGlubmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblxuICAgIGlmIChvcHRpb25zLmVjaG8pIHtcbiAgICAgIC8vIFNob3cgb3V0cHV0IGFzIGhpZ2hsaWdodGVkIHNvdXJjZVxuICAgICAgY29uc3QgcHJlRWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJwcmVcIik7XG4gICAgICBjb250YWluZXIuY2xhc3NOYW1lID0gXCJzb3VyY2VDb2RlXCI7XG4gICAgICBwcmVFbGVtLmNsYXNzTmFtZSA9IFwic291cmNlQ29kZSByXCI7XG4gICAgICBwcmVFbGVtLmFwcGVuZENoaWxkKGhpZ2hsaWdodFIoYmxvY2suY29kZSkpO1xuICAgICAgc3Bpbm5lci5jbGFzc05hbWUgPSBcInNwaW5uZXItZ3JvdyBzcGlubmVyLWdyb3ctc20gbS0yIHBvc2l0aW9uLWFic29sdXRlIHRvcC0wIGVuZC0wXCI7XG4gICAgICBwcmVFbGVtLmFwcGVuZENoaWxkKHNwaW5uZXIpO1xuICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHByZUVsZW0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBzcGlubmVyLmNsYXNzTmFtZSA9IFwic3Bpbm5lci1ib3JkZXIgc3Bpbm5lci1ib3JkZXItc21cIjtcbiAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChzcGlubmVyKTtcbiAgICB9XG5cbiAgICB5aWVsZCBjb250YWluZXI7XG4gIH1cblxuICB3ZWJST2pzLnJlbmRlcmVkT2pzW1wiN1wiXSA9IHRydWU7XG4gIHlpZWxkIGF3YWl0IHJlc3VsdDtcbn1cbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLXdpZGdldC02IiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV82O1xuICBpZiAod2luZG93LkhUTUxXaWRnZXRzKSB7XG4gICAgd2luZG93LkhUTUxXaWRnZXRzLnN0YXRpY1JlbmRlcigpO1xuICB9XG4gIGlmICh3aW5kb3cuUGFnZWRUYWJsZURvYykge1xuICAgIHdpbmRvdy5QYWdlZFRhYmxlRG9jLmluaXRBbGwoKTtcbiAgfVxufVxuIn0seyJjZWxsTmFtZSI6IndlYnItNiIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJzb3VyY2UiOiJfd2Vicl92YWx1ZV82ID0ge1xuICBjb25zdCB7IGhpZ2hsaWdodFIsIGI2NERlY29kZSB9ID0gd2luZG93Ll9leGVyY2lzZV9vanNfcnVudGltZTtcbiAgY29uc3Qgc2NyaXB0Q29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYHNjcmlwdFt0eXBlPVxcXCJ3ZWJyLTYtY29udGVudHNcXFwiXWApLnRleHRDb250ZW50O1xuICBjb25zdCBibG9jayA9IEpTT04ucGFyc2UoYjY0RGVjb2RlKHNjcmlwdENvbnRlbnQpKTtcblxuICAvLyBEZWZhdWx0IGV2YWx1YXRpb24gY29uZmlndXJhdGlvblxuICBjb25zdCBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7XG4gICAgaWQ6IFwid2Vici02LWNvbnRlbnRzXCIsXG4gICAgZWNobzogdHJ1ZSxcbiAgICBvdXRwdXQ6IHRydWVcbiAgfSwgYmxvY2suYXR0cik7XG5cbiAgLy8gRXZhbHVhdGUgdGhlIHByb3ZpZGVkIFIgY29kZVxuICBjb25zdCByZXN1bHQgPSB3ZWJST2pzLnByb2Nlc3Moe2NvZGU6IGJsb2NrLmNvZGUsIG9wdGlvbnN9LCB7dnBsb3Rfc3RhdHN9KTtcblxuICAvLyBFYXJseSB5aWVsZCB3aGlsZSB3ZSB3YWl0IGZvciB0aGUgZmlyc3QgZXZhbHVhdGlvbiBhbmQgcmVuZGVyXG4gIGlmIChvcHRpb25zLm91dHB1dCAmJiAhKFwiNlwiIGluIHdlYlJPanMucmVuZGVyZWRPanMpKSB7XG4gICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBjb25zdCBzcGlubmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblxuICAgIGlmIChvcHRpb25zLmVjaG8pIHtcbiAgICAgIC8vIFNob3cgb3V0cHV0IGFzIGhpZ2hsaWdodGVkIHNvdXJjZVxuICAgICAgY29uc3QgcHJlRWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJwcmVcIik7XG4gICAgICBjb250YWluZXIuY2xhc3NOYW1lID0gXCJzb3VyY2VDb2RlXCI7XG4gICAgICBwcmVFbGVtLmNsYXNzTmFtZSA9IFwic291cmNlQ29kZSByXCI7XG4gICAgICBwcmVFbGVtLmFwcGVuZENoaWxkKGhpZ2hsaWdodFIoYmxvY2suY29kZSkpO1xuICAgICAgc3Bpbm5lci5jbGFzc05hbWUgPSBcInNwaW5uZXItZ3JvdyBzcGlubmVyLWdyb3ctc20gbS0yIHBvc2l0aW9uLWFic29sdXRlIHRvcC0wIGVuZC0wXCI7XG4gICAgICBwcmVFbGVtLmFwcGVuZENoaWxkKHNwaW5uZXIpO1xuICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHByZUVsZW0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBzcGlubmVyLmNsYXNzTmFtZSA9IFwic3Bpbm5lci1ib3JkZXIgc3Bpbm5lci1ib3JkZXItc21cIjtcbiAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChzcGlubmVyKTtcbiAgICB9XG5cbiAgICB5aWVsZCBjb250YWluZXI7XG4gIH1cblxuICB3ZWJST2pzLnJlbmRlcmVkT2pzW1wiNlwiXSA9IHRydWU7XG4gIHlpZWxkIGF3YWl0IHJlc3VsdDtcbn1cbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLXdpZGdldC01IiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV81O1xuICBpZiAod2luZG93LkhUTUxXaWRnZXRzKSB7XG4gICAgd2luZG93LkhUTUxXaWRnZXRzLnN0YXRpY1JlbmRlcigpO1xuICB9XG4gIGlmICh3aW5kb3cuUGFnZWRUYWJsZURvYykge1xuICAgIHdpbmRvdy5QYWdlZFRhYmxlRG9jLmluaXRBbGwoKTtcbiAgfVxufVxuIn0seyJjZWxsTmFtZSI6IndlYnItNSIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJzb3VyY2UiOiJfd2Vicl92YWx1ZV81ID0ge1xuICBjb25zdCB7IGhpZ2hsaWdodFIsIGI2NERlY29kZSB9ID0gd2luZG93Ll9leGVyY2lzZV9vanNfcnVudGltZTtcbiAgY29uc3Qgc2NyaXB0Q29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYHNjcmlwdFt0eXBlPVxcXCJ3ZWJyLTUtY29udGVudHNcXFwiXWApLnRleHRDb250ZW50O1xuICBjb25zdCBibG9jayA9IEpTT04ucGFyc2UoYjY0RGVjb2RlKHNjcmlwdENvbnRlbnQpKTtcblxuICAvLyBEZWZhdWx0IGV2YWx1YXRpb24gY29uZmlndXJhdGlvblxuICBjb25zdCBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7XG4gICAgaWQ6IFwid2Vici01LWNvbnRlbnRzXCIsXG4gICAgZWNobzogdHJ1ZSxcbiAgICBvdXRwdXQ6IHRydWVcbiAgfSwgYmxvY2suYXR0cik7XG5cbiAgLy8gRXZhbHVhdGUgdGhlIHByb3ZpZGVkIFIgY29kZVxuICBjb25zdCByZXN1bHQgPSB3ZWJST2pzLnByb2Nlc3Moe2NvZGU6IGJsb2NrLmNvZGUsIG9wdGlvbnN9LCB7c3R1ZHlfZGF0YV9wYXlsb2FkLCBjb250cmFzdHNfZnJvbV9qcywgdGVybXNfZnJvbV9qcywgc2xpZGVzX2Zyb21fanN9KTtcblxuICAvLyBFYXJseSB5aWVsZCB3aGlsZSB3ZSB3YWl0IGZvciB0aGUgZmlyc3QgZXZhbHVhdGlvbiBhbmQgcmVuZGVyXG4gIGlmIChvcHRpb25zLm91dHB1dCAmJiAhKFwiNVwiIGluIHdlYlJPanMucmVuZGVyZWRPanMpKSB7XG4gICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBjb25zdCBzcGlubmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblxuICAgIGlmIChvcHRpb25zLmVjaG8pIHtcbiAgICAgIC8vIFNob3cgb3V0cHV0IGFzIGhpZ2hsaWdodGVkIHNvdXJjZVxuICAgICAgY29uc3QgcHJlRWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJwcmVcIik7XG4gICAgICBjb250YWluZXIuY2xhc3NOYW1lID0gXCJzb3VyY2VDb2RlXCI7XG4gICAgICBwcmVFbGVtLmNsYXNzTmFtZSA9IFwic291cmNlQ29kZSByXCI7XG4gICAgICBwcmVFbGVtLmFwcGVuZENoaWxkKGhpZ2hsaWdodFIoYmxvY2suY29kZSkpO1xuICAgICAgc3Bpbm5lci5jbGFzc05hbWUgPSBcInNwaW5uZXItZ3JvdyBzcGlubmVyLWdyb3ctc20gbS0yIHBvc2l0aW9uLWFic29sdXRlIHRvcC0wIGVuZC0wXCI7XG4gICAgICBwcmVFbGVtLmFwcGVuZENoaWxkKHNwaW5uZXIpO1xuICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHByZUVsZW0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBzcGlubmVyLmNsYXNzTmFtZSA9IFwic3Bpbm5lci1ib3JkZXIgc3Bpbm5lci1ib3JkZXItc21cIjtcbiAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChzcGlubmVyKTtcbiAgICB9XG5cbiAgICB5aWVsZCBjb250YWluZXI7XG4gIH1cblxuICB3ZWJST2pzLnJlbmRlcmVkT2pzW1wiNVwiXSA9IHRydWU7XG4gIHlpZWxkIGF3YWl0IHJlc3VsdDtcbn1cbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLXdpZGdldC00IiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV80O1xuICBpZiAod2luZG93LkhUTUxXaWRnZXRzKSB7XG4gICAgd2luZG93LkhUTUxXaWRnZXRzLnN0YXRpY1JlbmRlcigpO1xuICB9XG4gIGlmICh3aW5kb3cuUGFnZWRUYWJsZURvYykge1xuICAgIHdpbmRvdy5QYWdlZFRhYmxlRG9jLmluaXRBbGwoKTtcbiAgfVxufVxuIn0seyJjZWxsTmFtZSI6IndlYnItNCIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJzb3VyY2UiOiJfd2Vicl92YWx1ZV80ID0ge1xuICBjb25zdCB7IGhpZ2hsaWdodFIsIGI2NERlY29kZSB9ID0gd2luZG93Ll9leGVyY2lzZV9vanNfcnVudGltZTtcbiAgY29uc3Qgc2NyaXB0Q29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYHNjcmlwdFt0eXBlPVxcXCJ3ZWJyLTQtY29udGVudHNcXFwiXWApLnRleHRDb250ZW50O1xuICBjb25zdCBibG9jayA9IEpTT04ucGFyc2UoYjY0RGVjb2RlKHNjcmlwdENvbnRlbnQpKTtcblxuICAvLyBEZWZhdWx0IGV2YWx1YXRpb24gY29uZmlndXJhdGlvblxuICBjb25zdCBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7XG4gICAgaWQ6IFwid2Vici00LWNvbnRlbnRzXCIsXG4gICAgZWNobzogdHJ1ZSxcbiAgICBvdXRwdXQ6IHRydWVcbiAgfSwgYmxvY2suYXR0cik7XG5cbiAgLy8gRXZhbHVhdGUgdGhlIHByb3ZpZGVkIFIgY29kZVxuICBjb25zdCByZXN1bHQgPSB3ZWJST2pzLnByb2Nlc3Moe2NvZGU6IGJsb2NrLmNvZGUsIG9wdGlvbnN9LCB7c3R1ZHlfZGF0YV9wYXlsb2FkfSk7XG5cbiAgLy8gRWFybHkgeWllbGQgd2hpbGUgd2Ugd2FpdCBmb3IgdGhlIGZpcnN0IGV2YWx1YXRpb24gYW5kIHJlbmRlclxuICBpZiAob3B0aW9ucy5vdXRwdXQgJiYgIShcIjRcIiBpbiB3ZWJST2pzLnJlbmRlcmVkT2pzKSkge1xuICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgY29uc3Qgc3Bpbm5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cbiAgICBpZiAob3B0aW9ucy5lY2hvKSB7XG4gICAgICAvLyBTaG93IG91dHB1dCBhcyBoaWdobGlnaHRlZCBzb3VyY2VcbiAgICAgIGNvbnN0IHByZUVsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicHJlXCIpO1xuICAgICAgY29udGFpbmVyLmNsYXNzTmFtZSA9IFwic291cmNlQ29kZVwiO1xuICAgICAgcHJlRWxlbS5jbGFzc05hbWUgPSBcInNvdXJjZUNvZGUgclwiO1xuICAgICAgcHJlRWxlbS5hcHBlbmRDaGlsZChoaWdobGlnaHRSKGJsb2NrLmNvZGUpKTtcbiAgICAgIHNwaW5uZXIuY2xhc3NOYW1lID0gXCJzcGlubmVyLWdyb3cgc3Bpbm5lci1ncm93LXNtIG0tMiBwb3NpdGlvbi1hYnNvbHV0ZSB0b3AtMCBlbmQtMFwiO1xuICAgICAgcHJlRWxlbS5hcHBlbmRDaGlsZChzcGlubmVyKTtcbiAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChwcmVFbGVtKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3Bpbm5lci5jbGFzc05hbWUgPSBcInNwaW5uZXItYm9yZGVyIHNwaW5uZXItYm9yZGVyLXNtXCI7XG4gICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoc3Bpbm5lcik7XG4gICAgfVxuXG4gICAgeWllbGQgY29udGFpbmVyO1xuICB9XG5cbiAgd2ViUk9qcy5yZW5kZXJlZE9qc1tcIjRcIl0gPSB0cnVlO1xuICB5aWVsZCBhd2FpdCByZXN1bHQ7XG59XG4ifSx7ImNlbGxOYW1lIjoid2Vici13aWRnZXQtMyIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6IntcbiAgLy8gV2FpdCBmb3Igb3V0cHV0IHRvIGJlIHdyaXR0ZW4gdG8gdGhlIERPTSwgdGhlbiB0cmlnZ2VyIHdpZGdldCByZW5kZXJpbmdcbiAgYXdhaXQgX3dlYnJfdmFsdWVfMztcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLTMiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoiX3dlYnJfdmFsdWVfMyA9IHtcbiAgY29uc3QgeyBoaWdobGlnaHRSLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici0zLWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgLy8gRGVmYXVsdCBldmFsdWF0aW9uIGNvbmZpZ3VyYXRpb25cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe1xuICAgIGlkOiBcIndlYnItMy1jb250ZW50c1wiLFxuICAgIGVjaG86IHRydWUsXG4gICAgb3V0cHV0OiB0cnVlXG4gIH0sIGJsb2NrLmF0dHIpO1xuXG4gIC8vIEV2YWx1YXRlIHRoZSBwcm92aWRlZCBSIGNvZGVcbiAgY29uc3QgcmVzdWx0ID0gd2ViUk9qcy5wcm9jZXNzKHtjb2RlOiBibG9jay5jb2RlLCBvcHRpb25zfSwge25ld196aXBfZGF0YX0pO1xuXG4gIC8vIEVhcmx5IHlpZWxkIHdoaWxlIHdlIHdhaXQgZm9yIHRoZSBmaXJzdCBldmFsdWF0aW9uIGFuZCByZW5kZXJcbiAgaWYgKG9wdGlvbnMub3V0cHV0ICYmICEoXCIzXCIgaW4gd2ViUk9qcy5yZW5kZXJlZE9qcykpIHtcbiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIGNvbnN0IHNwaW5uZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXG4gICAgaWYgKG9wdGlvbnMuZWNobykge1xuICAgICAgLy8gU2hvdyBvdXRwdXQgYXMgaGlnaGxpZ2h0ZWQgc291cmNlXG4gICAgICBjb25zdCBwcmVFbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInByZVwiKTtcbiAgICAgIGNvbnRhaW5lci5jbGFzc05hbWUgPSBcInNvdXJjZUNvZGVcIjtcbiAgICAgIHByZUVsZW0uY2xhc3NOYW1lID0gXCJzb3VyY2VDb2RlIHJcIjtcbiAgICAgIHByZUVsZW0uYXBwZW5kQ2hpbGQoaGlnaGxpZ2h0UihibG9jay5jb2RlKSk7XG4gICAgICBzcGlubmVyLmNsYXNzTmFtZSA9IFwic3Bpbm5lci1ncm93IHNwaW5uZXItZ3Jvdy1zbSBtLTIgcG9zaXRpb24tYWJzb2x1dGUgdG9wLTAgZW5kLTBcIjtcbiAgICAgIHByZUVsZW0uYXBwZW5kQ2hpbGQoc3Bpbm5lcik7XG4gICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQocHJlRWxlbSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNwaW5uZXIuY2xhc3NOYW1lID0gXCJzcGlubmVyLWJvcmRlciBzcGlubmVyLWJvcmRlci1zbVwiO1xuICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHNwaW5uZXIpO1xuICAgIH1cblxuICAgIHlpZWxkIGNvbnRhaW5lcjtcbiAgfVxuXG4gIHdlYlJPanMucmVuZGVyZWRPanNbXCIzXCJdID0gdHJ1ZTtcbiAgeWllbGQgYXdhaXQgcmVzdWx0O1xufVxuIn0seyJjZWxsTmFtZSI6IndlYnItd2lkZ2V0LTIiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJ7XG4gIC8vIFdhaXQgZm9yIG91dHB1dCB0byBiZSB3cml0dGVuIHRvIHRoZSBET00sIHRoZW4gdHJpZ2dlciB3aWRnZXQgcmVuZGVyaW5nXG4gIGF3YWl0IF93ZWJyX3ZhbHVlXzI7XG4gIGlmICh3aW5kb3cuSFRNTFdpZGdldHMpIHtcbiAgICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKCk7XG4gIH1cbiAgaWYgKHdpbmRvdy5QYWdlZFRhYmxlRG9jKSB7XG4gICAgd2luZG93LlBhZ2VkVGFibGVEb2MuaW5pdEFsbCgpO1xuICB9XG59XG4ifSx7ImNlbGxOYW1lIjoid2Vici0yIiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCIsInNvdXJjZSI6Il93ZWJyX3ZhbHVlXzIgPSB7XG4gIGNvbnN0IHsgaGlnaGxpZ2h0UiwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuICBjb25zdCBzY3JpcHRDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihgc2NyaXB0W3R5cGU9XFxcIndlYnItMi1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIC8vIERlZmF1bHQgZXZhbHVhdGlvbiBjb25maWd1cmF0aW9uXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHtcbiAgICBpZDogXCJ3ZWJyLTItY29udGVudHNcIixcbiAgICBlY2hvOiB0cnVlLFxuICAgIG91dHB1dDogdHJ1ZVxuICB9LCBibG9jay5hdHRyKTtcblxuICAvLyBFdmFsdWF0ZSB0aGUgcHJvdmlkZWQgUiBjb2RlXG4gIGNvbnN0IHJlc3VsdCA9IHdlYlJPanMucHJvY2Vzcyh7Y29kZTogYmxvY2suY29kZSwgb3B0aW9uc30sIHt9KTtcblxuICAvLyBFYXJseSB5aWVsZCB3aGlsZSB3ZSB3YWl0IGZvciB0aGUgZmlyc3QgZXZhbHVhdGlvbiBhbmQgcmVuZGVyXG4gIGlmIChvcHRpb25zLm91dHB1dCAmJiAhKFwiMlwiIGluIHdlYlJPanMucmVuZGVyZWRPanMpKSB7XG4gICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBjb25zdCBzcGlubmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblxuICAgIGlmIChvcHRpb25zLmVjaG8pIHtcbiAgICAgIC8vIFNob3cgb3V0cHV0IGFzIGhpZ2hsaWdodGVkIHNvdXJjZVxuICAgICAgY29uc3QgcHJlRWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJwcmVcIik7XG4gICAgICBjb250YWluZXIuY2xhc3NOYW1lID0gXCJzb3VyY2VDb2RlXCI7XG4gICAgICBwcmVFbGVtLmNsYXNzTmFtZSA9IFwic291cmNlQ29kZSByXCI7XG4gICAgICBwcmVFbGVtLmFwcGVuZENoaWxkKGhpZ2hsaWdodFIoYmxvY2suY29kZSkpO1xuICAgICAgc3Bpbm5lci5jbGFzc05hbWUgPSBcInNwaW5uZXItZ3JvdyBzcGlubmVyLWdyb3ctc20gbS0yIHBvc2l0aW9uLWFic29sdXRlIHRvcC0wIGVuZC0wXCI7XG4gICAgICBwcmVFbGVtLmFwcGVuZENoaWxkKHNwaW5uZXIpO1xuICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHByZUVsZW0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBzcGlubmVyLmNsYXNzTmFtZSA9IFwic3Bpbm5lci1ib3JkZXIgc3Bpbm5lci1ib3JkZXItc21cIjtcbiAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChzcGlubmVyKTtcbiAgICB9XG5cbiAgICB5aWVsZCBjb250YWluZXI7XG4gIH1cblxuICB3ZWJST2pzLnJlbmRlcmVkT2pzW1wiMlwiXSA9IHRydWU7XG4gIHlpZWxkIGF3YWl0IHJlc3VsdDtcbn1cbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLXdpZGdldC0xIiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV8xO1xuICBpZiAod2luZG93LkhUTUxXaWRnZXRzKSB7XG4gICAgd2luZG93LkhUTUxXaWRnZXRzLnN0YXRpY1JlbmRlcigpO1xuICB9XG4gIGlmICh3aW5kb3cuUGFnZWRUYWJsZURvYykge1xuICAgIHdpbmRvdy5QYWdlZFRhYmxlRG9jLmluaXRBbGwoKTtcbiAgfVxufVxuIn0seyJjZWxsTmFtZSI6IndlYnItMSIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJzb3VyY2UiOiJfd2Vicl92YWx1ZV8xID0ge1xuICBjb25zdCB7IGhpZ2hsaWdodFIsIGI2NERlY29kZSB9ID0gd2luZG93Ll9leGVyY2lzZV9vanNfcnVudGltZTtcbiAgY29uc3Qgc2NyaXB0Q29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYHNjcmlwdFt0eXBlPVxcXCJ3ZWJyLTEtY29udGVudHNcXFwiXWApLnRleHRDb250ZW50O1xuICBjb25zdCBibG9jayA9IEpTT04ucGFyc2UoYjY0RGVjb2RlKHNjcmlwdENvbnRlbnQpKTtcblxuICAvLyBEZWZhdWx0IGV2YWx1YXRpb24gY29uZmlndXJhdGlvblxuICBjb25zdCBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7XG4gICAgaWQ6IFwid2Vici0xLWNvbnRlbnRzXCIsXG4gICAgZWNobzogdHJ1ZSxcbiAgICBvdXRwdXQ6IHRydWVcbiAgfSwgYmxvY2suYXR0cik7XG5cbiAgLy8gRXZhbHVhdGUgdGhlIHByb3ZpZGVkIFIgY29kZVxuICBjb25zdCByZXN1bHQgPSB3ZWJST2pzLnByb2Nlc3Moe2NvZGU6IGJsb2NrLmNvZGUsIG9wdGlvbnN9LCB7c2VsZWN0ZWRfc3R1ZHl9KTtcblxuICAvLyBFYXJseSB5aWVsZCB3aGlsZSB3ZSB3YWl0IGZvciB0aGUgZmlyc3QgZXZhbHVhdGlvbiBhbmQgcmVuZGVyXG4gIGlmIChvcHRpb25zLm91dHB1dCAmJiAhKFwiMVwiIGluIHdlYlJPanMucmVuZGVyZWRPanMpKSB7XG4gICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBjb25zdCBzcGlubmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblxuICAgIGlmIChvcHRpb25zLmVjaG8pIHtcbiAgICAgIC8vIFNob3cgb3V0cHV0IGFzIGhpZ2hsaWdodGVkIHNvdXJjZVxuICAgICAgY29uc3QgcHJlRWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJwcmVcIik7XG4gICAgICBjb250YWluZXIuY2xhc3NOYW1lID0gXCJzb3VyY2VDb2RlXCI7XG4gICAgICBwcmVFbGVtLmNsYXNzTmFtZSA9IFwic291cmNlQ29kZSByXCI7XG4gICAgICBwcmVFbGVtLmFwcGVuZENoaWxkKGhpZ2hsaWdodFIoYmxvY2suY29kZSkpO1xuICAgICAgc3Bpbm5lci5jbGFzc05hbWUgPSBcInNwaW5uZXItZ3JvdyBzcGlubmVyLWdyb3ctc20gbS0yIHBvc2l0aW9uLWFic29sdXRlIHRvcC0wIGVuZC0wXCI7XG4gICAgICBwcmVFbGVtLmFwcGVuZENoaWxkKHNwaW5uZXIpO1xuICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHByZUVsZW0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBzcGlubmVyLmNsYXNzTmFtZSA9IFwic3Bpbm5lci1ib3JkZXIgc3Bpbm5lci1ib3JkZXItc21cIjtcbiAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChzcGlubmVyKTtcbiAgICB9XG5cbiAgICB5aWVsZCBjb250YWluZXI7XG4gIH1cblxuICB3ZWJST2pzLnJlbmRlcmVkT2pzW1wiMVwiXSA9IHRydWU7XG4gIHlpZWxkIGF3YWl0IHJlc3VsdDtcbn1cbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLXByZWx1ZGUiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJ3ZWJST2pzID0ge1xuICBjb25zdCB7IFdlYlIsIENoYW5uZWxUeXBlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lLldlYlI7XG4gIGNvbnN0IHtcbiAgICBXZWJSRXZhbHVhdG9yLFxuICAgIFdlYlJFbnZpcm9ubWVudE1hbmFnZXIsXG4gICAgc2V0dXBSLFxuICAgIGI2NERlY29kZSxcbiAgICBjb2xsYXBzZVBhdGhcbiAgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG5cbiAgY29uc3Qgc3RhdHVzQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJleGVyY2lzZS1sb2FkaW5nLXN0YXR1c1wiKTtcbiAgY29uc3QgaW5kaWNhdG9yQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJleGVyY2lzZS1sb2FkaW5nLWluZGljYXRvclwiKTtcbiAgaW5kaWNhdG9yQ29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoXCJkLW5vbmVcIik7XG5cbiAgbGV0IHN0YXR1c1RleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpXG4gIHN0YXR1c1RleHQuY2xhc3NMaXN0ID0gXCJleGVyY2lzZS1sb2FkaW5nLWRldGFpbHNcIjtcbiAgc3RhdHVzVGV4dCA9IHN0YXR1c0NvbnRhaW5lci5hcHBlbmRDaGlsZChzdGF0dXNUZXh0KTtcbiAgc3RhdHVzVGV4dC50ZXh0Q29udGVudCA9IGBJbml0aWFsaXNlYDtcblxuICAvLyBIb2lzdCBpbmRpY2F0b3Igb3V0IGZyb20gZmluYWwgc2xpZGUgd2hlbiBydW5uaW5nIHVuZGVyIHJldmVhbFxuICBjb25zdCByZXZlYWxTdGF0dXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnJldmVhbCAuZXhlcmNpc2UtbG9hZGluZy1pbmRpY2F0b3JcIik7XG4gIGlmIChyZXZlYWxTdGF0dXMpIHtcbiAgICByZXZlYWxTdGF0dXMucmVtb3ZlKCk7XG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5yZXZlYWwgPiAuc2xpZGVzXCIpLmFwcGVuZENoaWxkKHJldmVhbFN0YXR1cyk7XG4gIH1cblxuICAvLyBNYWtlIGFueSByZXZlYWwgc2xpZGVzIHdpdGggbGl2ZSBjZWxscyBzY3JvbGxhYmxlXG4gIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIucmV2ZWFsIC5leGVyY2lzZS1jZWxsXCIpLmZvckVhY2goKGVsKSA9PiB7XG4gICAgZWwuY2xvc2VzdCgnc2VjdGlvbi5zbGlkZScpLmNsYXNzTGlzdC5hZGQoXCJzY3JvbGxhYmxlXCIpO1xuICB9KVxuXG4gIC8vIHdlYlIgc3VwcGxlbWVudGFsIGRhdGEgYW5kIG9wdGlvbnNcbiAgY29uc3QgZGF0YUNvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici1kYXRhXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgZGF0YSA9IEpTT04ucGFyc2UoYjY0RGVjb2RlKGRhdGFDb250ZW50KSk7XG5cbiAgLy8gR3JhYiBsaXN0IG9mIHJlc291cmNlcyB0byBiZSBkb3dubG9hZGVkXG4gIGNvbnN0IGZpbGVzQ29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYHNjcmlwdFt0eXBlPVxcXCJ2ZnMtZmlsZVxcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGZpbGVzID0gSlNPTi5wYXJzZShiNjREZWNvZGUoZmlsZXNDb250ZW50KSk7XG5cbiAgLy8gSW5pdGlhbGlzZSB3ZWJSIGFuZCBzZXR1cCBmb3IgUiBjb2RlIGV2YWx1YXRpb25cbiAgbGV0IHdlYlJQcm9taXNlID0gKGFzeW5jICh3ZWJSKSA9PiB7XG4gICAgc3RhdHVzVGV4dC50ZXh0Q29udGVudCA9IGBEb3dubG9hZGluZyB3ZWJSYDtcbiAgICBhd2FpdCB3ZWJSLmluaXQoKTtcblxuICAgIC8vIEluc3RhbGwgcHJvdmlkZWQgbGlzdCBvZiBwYWNrYWdlc1xuICAgIC8vIEVuc3VyZSB3ZWJSIGRlZmF1bHQgcmVwbyBpcyBpbmNsdWRlZFxuICAgIGRhdGEucGFja2FnZXMucmVwb3MucHVzaChcImh0dHBzOi8vcmVwby5yLXdhc20ub3JnXCIpXG4gICAgYXdhaXQgZGF0YS5wYWNrYWdlcy5wa2dzLm1hcCgocGtnKSA9PiAoKSA9PiB7XG4gICAgICBzdGF0dXNUZXh0LnRleHRDb250ZW50ID0gYERvd25sb2FkaW5nIHBhY2thZ2U6ICR7cGtnfWA7XG4gICAgICByZXR1cm4gd2ViUi5ldmFsUlZvaWQoYFxuICAgICAgICB3ZWJyOjppbnN0YWxsKHBrZywgcmVwb3MgPSByZXBvcylcbiAgICAgICAgbGlicmFyeShwa2csIGNoYXJhY3Rlci5vbmx5ID0gVFJVRSlcbiAgICAgIGAsIHsgZW52OiB7XG4gICAgICAgIHBrZzogcGtnLFxuICAgICAgICByZXBvczogZGF0YS5wYWNrYWdlcy5yZXBvcyxcbiAgICAgIH19KTtcbiAgICB9KS5yZWR1Y2UoKGN1ciwgbmV4dCkgPT4gY3VyLnRoZW4obmV4dCksIFByb21pc2UucmVzb2x2ZSgpKTtcblxuICAgIC8vIERvd25sb2FkIGFuZCBpbnN0YWxsIHJlc291cmNlc1xuICAgIGF3YWl0IGZpbGVzLm1hcCgoZmlsZSkgPT4gYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbmFtZSA9IGZpbGUuc3Vic3RyaW5nKGZpbGUubGFzdEluZGV4T2YoJy8nKSArIDEpO1xuICAgICAgc3RhdHVzVGV4dC50ZXh0Q29udGVudCA9IGBEb3dubG9hZGluZyByZXNvdXJjZTogJHtuYW1lfWA7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGZpbGUpO1xuICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENhbid0IGRvd25sb2FkIFxcYCR7ZmlsZX1cXGAuIEVycm9yICR7cmVzcG9uc2Uuc3RhdHVzfTogXCIke3Jlc3BvbnNlLnN0YXR1c1RleHR9XCIuYCk7XG4gICAgICB9XG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuYXJyYXlCdWZmZXIoKTtcblxuICAgICAgLy8gU3RvcmUgVVJMcyBpbiB0aGUgY3dkIHdpdGhvdXQgYW55IHN1YmRpcmVjdG9yeSBzdHJ1Y3R1cmVcbiAgICAgIGlmIChmaWxlLmluY2x1ZGVzKFwiOi8vXCIpKSB7XG4gICAgICAgIGZpbGUgPSBuYW1lO1xuICAgICAgfVxuXG4gICAgICAvLyBDb2xsYXBzZSBoaWdoZXIgZGlyZWN0b3J5IHN0cnVjdHVyZVxuICAgICAgZmlsZSA9IGNvbGxhcHNlUGF0aChmaWxlKTtcblxuICAgICAgLy8gQ3JlYXRlIGRpcmVjdG9yeSB0cmVlLCBpZ25vcmluZyBcImRpcmVjdG9yeSBleGlzdHNcIiBWRlMgZXJyb3JzXG4gICAgICBjb25zdCBwYXJ0cyA9IGZpbGUuc3BsaXQoJy8nKS5zbGljZSgwLCAtMSk7XG4gICAgICBsZXQgcGF0aCA9ICcnO1xuICAgICAgd2hpbGUgKHBhcnRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgcGF0aCArPSBwYXJ0cy5zaGlmdCgpICsgJy8nO1xuICAgICAgICBjb25zdCBhbmFseXNpcyA9IGF3YWl0IHdlYlIuRlMuYW5hbHl6ZVBhdGgocGF0aCk7XG4gICAgICAgIGlmICghYW5hbHlzaXMuZXhpc3RzKSB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IHdlYlIuRlMubWtkaXIocGF0aCk7XG4gICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGaWxlc3lzdGVtIEVycm9yOiBcIiR7ZS5tZXNzYWdlfVwiLmApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBXcml0ZSB0aGlzIGZpbGUgdG8gdGhlIFZGU1xuICAgICAgcmV0dXJuIGF3YWl0IHdlYlIuRlMud3JpdGVGaWxlKGZpbGUsIG5ldyBVaW50OEFycmF5KGRhdGEpKTtcbiAgICB9KS5yZWR1Y2UoKGN1ciwgbmV4dCkgPT4gY3VyLnRoZW4obmV4dCksIFByb21pc2UucmVzb2x2ZSgpKTtcblxuICAgIHN0YXR1c1RleHQudGV4dENvbnRlbnQgPSBgSW5zdGFsbGluZyB3ZWJSIHNoaW1zYDtcbiAgICBhd2FpdCB3ZWJSLmV2YWxSVm9pZChgd2Vicjo6c2hpbV9pbnN0YWxsKClgKTtcblxuICAgIHN0YXR1c1RleHQudGV4dENvbnRlbnQgPSBgV2ViUiBlbnZpcm9ubWVudCBzZXR1cGA7XG4gICAgYXdhaXQgc2V0dXBSKHdlYlIsIGRhdGEpO1xuXG4gICAgc3RhdHVzVGV4dC5yZW1vdmUoKTtcbiAgICBpZiAoc3RhdHVzQ29udGFpbmVyLmNoaWxkcmVuLmxlbmd0aCA9PSAwKSB7XG4gICAgICBzdGF0dXNDb250YWluZXIucGFyZW50Tm9kZS5yZW1vdmUoKTtcbiAgICB9XG4gICAgcmV0dXJuIHdlYlI7XG4gIH0pKG5ldyBXZWJSKGRhdGEub3B0aW9ucykpO1xuXG4gIC8vIEtlZXAgdHJhY2sgb2YgaW5pdGlhbCBPSlMgYmxvY2sgcmVuZGVyXG4gIGNvbnN0IHJlbmRlcmVkT2pzID0ge307XG5cbiAgY29uc3QgcHJvY2VzcyA9IGFzeW5jIChjb250ZXh0LCBpbnB1dHMpID0+IHtcbiAgICBjb25zdCB3ZWJSID0gYXdhaXQgd2ViUlByb21pc2U7XG4gICAgY29uc3QgZXZhbHVhdG9yID0gbmV3IFdlYlJFdmFsdWF0b3Iod2ViUiwgY29udGV4dClcbiAgICBhd2FpdCBldmFsdWF0b3IucHJvY2VzcyhpbnB1dHMpO1xuICAgIHJldHVybiBldmFsdWF0b3IuY29udGFpbmVyO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBwcm9jZXNzLFxuICAgIHdlYlJQcm9taXNlLFxuICAgIHJlbmRlcmVkT2pzLFxuICB9O1xufVxuIn1dfQ==
</script>
<div id="exercise-loading-indicator" class="exercise-loading-indicator d-none d-flex align-items-center gap-2 html-fill-item html-fill-container">
<div id="exercise-loading-status" class="d-flex gap-2 html-fill-item html-fill-container">

</div>
<div class="spinner-grow spinner-grow-sm html-fill-item html-fill-container">

</div>
</div>
<script type="vfs-file">
W10=
</script>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div>
</div>
</div>
</div>
</div>
</div></div><aside id="bslib-sidebar-1" class="sidebar html-fill-container html-fill-item"><div class="html-fill-container html-fill-item">
<div class="sourceCode cell-code hidden" id="cb1" data-startfrom="48" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 47;"><span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>duck_db_client <span class="op">=</span> {</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> duckdb <span class="op">=</span> <span class="cf">await</span> <span class="im">import</span>(<span class="st">"https://cdn.jsdelivr.net/npm/@duckdb/duckdb-wasm@1.28.0/+esm"</span>)<span class="op">;</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"🔧 Initializing DuckDB-Wasm Client..."</span>)<span class="op">;</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> JSDELIVR_BUNDLES <span class="op">=</span> duckdb<span class="op">.</span><span class="fu">getJsDelivrBundles</span>()<span class="op">;</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> bundle <span class="op">=</span> <span class="cf">await</span> duckdb<span class="op">.</span><span class="fu">selectBundle</span>(JSDELIVR_BUNDLES)<span class="op">;</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> worker_url <span class="op">=</span> URL<span class="op">.</span><span class="fu">createObjectURL</span>(</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="bu">Blob</span>([<span class="vs">`importScripts("</span><span class="sc">${</span>bundle<span class="op">.</span><span class="at">mainWorker</span><span class="sc">}</span><span class="vs">");`</span>]<span class="op">,</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"text/javascript"</span> })</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> worker <span class="op">=</span> <span class="kw">new</span> <span class="bu">Worker</span>(worker_url)<span class="op">;</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> logger <span class="op">=</span> <span class="kw">new</span> duckdb<span class="op">.</span><span class="fu">ConsoleLogger</span>()<span class="op">;</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> db <span class="op">=</span> <span class="kw">new</span> duckdb<span class="op">.</span><span class="fu">AsyncDuckDB</span>(logger<span class="op">,</span> worker)<span class="op">;</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>  <span class="cf">await</span> db<span class="op">.</span><span class="fu">instantiate</span>(bundle<span class="op">.</span><span class="at">mainModule</span><span class="op">,</span> bundle<span class="op">.</span><span class="at">pthreadWorker</span>)<span class="op">;</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> conn <span class="op">=</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">connect</span>()<span class="op">;</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>  conn<span class="op">.</span><span class="at">instance</span> <span class="op">=</span> db<span class="op">;</span> <span class="co">// Attach the engine to the connection</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"✅ DuckDB-Wasm Ready (Engine + Connection)"</span>)<span class="op">;</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> conn<span class="op">;</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-1" data-nodetype="declaration">

</div>
</div>
<div>
<div id="webr-1" class="exercise-cell">

</div>
<script type="webr-1-contents">
eyJhdHRyIjp7ImF1dG9ydW4iOnRydWUsImVjaG8iOmZhbHNlLCJlZGl0IjpmYWxzZSwiZXZhbCI6dHJ1ZSwiaW5wdXQiOlsic2VsZWN0ZWRfc3R1ZHkiXSwib3V0cHV0IjpmYWxzZX0sImNvZGUiOiJcbmlmKGV4aXN0cyhcImNvblwiKSAmJiBkYklzVmFsaWQoY29uKSl7XG4gIGNhdChcIkNsb3NpbmcgcHJldmlvdXMgY29ubmVjdGlvbiFcIilcbiAgZGJEaXNjb25uZWN0KGNvbilcbn0gXG5jYXQoXCJcXG5DcmVhdGluZyBuZXcgY29ubmVjdGlvbi5cIilcbmNvbiA8LSBkYkNvbm5lY3QoZHVja2RiKCkpIn0=
</script>
</div>
<div>
<div id="webr-2" class="exercise-cell">

</div>
<script type="webr-2-contents">
eyJhdHRyIjp7ImF1dG9ydW4iOnRydWUsImVjaG8iOmZhbHNlLCJlZGl0IjpmYWxzZSwiZXZhbCI6dHJ1ZX0sImNvZGUiOiJcbiMgZnVuY3Rpb24gdG8gZG9lcyBhIHF1aWNrIHZlcmlmaWNhdGlvbiBvZiB1c2VyIGRhdGFcbnZlcmlmeSA8LSBmdW5jdGlvbih2ZnNfZGlyKXtcbiAgdmFsaWQgPC0gVFJVRVxuICBmaWxlcyA8LSBsaXN0LmZpbGVzKHZmc19kaXIpXG4gIHJlcXVpcmVkX2ZpbGVzIDwtIGMoXG4gICAgXCJjZWxsX21ldGFkYXRhLnBhcnF1ZXRcIiwgXCJlbW1lYW5zLnBhcnF1ZXRcIixcbiAgICBcInBhaXJ3aXNlLnBhcnF1ZXRcIiwgXCJzdHVkeV9oZWFkZXIucGFycXVldFwiXG4gIClcbiAgaWYoIWFsbChyZXF1aXJlZF9maWxlcyAlaW4lIGZpbGVzKSl7XG4gICAgY2F0KHBhc3RlMChcIlRoZSB6aXAgZmlsZSBtdXN0IGNvbnRhaW4gdGhlIGZvbGxvd2luZzogXCIsIHBhc3RlMChcbiAgICAgIHJlcXVpcmVkX2ZpbGVzLCBjb2xsYXBzZT1cIiwgXCIpLCBcIi5cIikpXG4gICAgdmFsaWQgPC0gRkFMU0VcbiAgfVxuICByZXR1cm4odmFsaWQpXG59In0=
</script>
</div>
<div class="sourceCode cell-code hidden" id="cb2" data-startfrom="113" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 112;"><span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>sparkbar <span class="op">=</span> (max) <span class="kw">=&gt;</span> {</span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (x) <span class="kw">=&gt;</span> {</span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 1. Create container</span></span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> div <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"div"</span>)</span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"flex"</span>)</span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"align-items"</span><span class="op">,</span> <span class="st">"center"</span>)</span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span> <span class="st">"100%"</span>)<span class="op">;</span> <span class="co">// Let it fill the cell</span></span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> color <span class="op">=</span> x <span class="op">&gt;=</span> <span class="dv">0</span> <span class="op">?</span> <span class="st">"#E41A1C"</span> <span class="op">:</span> <span class="st">"#377EB8"</span><span class="op">;</span> </span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> widthPercent <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>((<span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(x) <span class="op">/</span> max) <span class="op">*</span> <span class="dv">100</span><span class="op">,</span> <span class="dv">100</span>)<span class="op">;</span></span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>    div<span class="op">.</span><span class="fu">append</span>(<span class="st">"span"</span>)</span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a>       <span class="op">.</span><span class="fu">text</span>(x<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>))</span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a>       <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"0.85em"</span>)</span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a>       <span class="op">.</span><span class="fu">style</span>(<span class="st">"color"</span><span class="op">,</span> <span class="st">"#666"</span>)</span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>       <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span> <span class="st">"35px"</span>)         <span class="co">// Fixed width for alignment</span></span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>       <span class="op">.</span><span class="fu">style</span>(<span class="st">"text-align"</span><span class="op">,</span> <span class="st">"right"</span>)   <span class="co">// Align numbers to the right</span></span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>       <span class="op">.</span><span class="fu">style</span>(<span class="st">"margin-right"</span><span class="op">,</span> <span class="st">"8px"</span>)<span class="op">;</span>  <span class="co">// Space between number and bar</span></span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a>    div<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>widthPercent<span class="sc">}</span><span class="vs">%`</span>)</span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"height"</span><span class="op">,</span> <span class="st">"12px"</span>)</span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"background-color"</span><span class="op">,</span> color)</span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"border-radius"</span><span class="op">,</span> <span class="st">"2px"</span>)<span class="op">;</span></span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> div<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-2" data-nodetype="declaration">

</div>
</div>
<div class="sourceCode cell-code hidden" id="cb3" data-startfrom="149" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 148;"><span id="cb3-149"><a href="#cb3-149" aria-hidden="true" tabindex="-1"></a>d3 <span class="op">=</span> <span class="pp">require</span>(<span class="st">"d3@7"</span>)</span>
<span id="cb3-150"><a href="#cb3-150" aria-hidden="true" tabindex="-1"></a>Plotly <span class="op">=</span> <span class="pp">require</span>(<span class="st">"https://cdn.plot.ly/plotly-2.24.1.min.js"</span>)</span>
<span id="cb3-151"><a href="#cb3-151" aria-hidden="true" tabindex="-1"></a>manifest_raw <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"https://raw.githubusercontent.com/Nanostring-Biostats/ScratchSpaceDatasets/refs/heads/main/browser_bytes/manifest.tsv"</span>)<span class="op">.</span><span class="fu">tsv</span>({<span class="dt">typed</span><span class="op">:</span> <span class="kw">true</span>})</span>
<span id="cb3-152"><a href="#cb3-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-153"><a href="#cb3-153" aria-hidden="true" tabindex="-1"></a>mutable available_studies <span class="op">=</span> {</span>
<span id="cb3-154"><a href="#cb3-154" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>manifest_raw) <span class="cf">return</span> []<span class="op">;</span></span>
<span id="cb3-155"><a href="#cb3-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-156"><a href="#cb3-156" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> manifest_raw<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> ({</span>
<span id="cb3-157"><a href="#cb3-157" aria-hidden="true" tabindex="-1"></a>    <span class="dt">id</span><span class="op">:</span> d<span class="op">.</span><span class="at">id</span><span class="op">,</span></span>
<span id="cb3-158"><a href="#cb3-158" aria-hidden="true" tabindex="-1"></a>    <span class="dt">name</span><span class="op">:</span> d<span class="op">.</span><span class="at">name</span><span class="op">,</span></span>
<span id="cb3-159"><a href="#cb3-159" aria-hidden="true" tabindex="-1"></a>    <span class="dt">description</span><span class="op">:</span> d<span class="op">.</span><span class="at">description</span><span class="op">,</span></span>
<span id="cb3-160"><a href="#cb3-160" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-161"><a href="#cb3-161" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Direct mapping of your TSV columns</span></span>
<span id="cb3-162"><a href="#cb3-162" aria-hidden="true" tabindex="-1"></a>    <span class="dt">url_header</span><span class="op">:</span>   d<span class="op">.</span><span class="at">url_header</span><span class="op">,</span></span>
<span id="cb3-163"><a href="#cb3-163" aria-hidden="true" tabindex="-1"></a>    <span class="dt">url_pairwise</span><span class="op">:</span> d<span class="op">.</span><span class="at">url_pairwise</span><span class="op">,</span></span>
<span id="cb3-164"><a href="#cb3-164" aria-hidden="true" tabindex="-1"></a>    <span class="dt">url_meta</span><span class="op">:</span>     d<span class="op">.</span><span class="at">url_meta</span><span class="op">,</span></span>
<span id="cb3-165"><a href="#cb3-165" aria-hidden="true" tabindex="-1"></a>    <span class="dt">url_emmeans</span><span class="op">:</span>  d<span class="op">.</span><span class="at">url_emmeans</span><span class="op">,</span></span>
<span id="cb3-166"><a href="#cb3-166" aria-hidden="true" tabindex="-1"></a>    <span class="dt">url_overlap</span><span class="op">:</span> d<span class="op">.</span><span class="at">url_overlap</span><span class="op">,</span></span>
<span id="cb3-167"><a href="#cb3-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-168"><a href="#cb3-168" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">'remote'</span><span class="op">,</span></span>
<span id="cb3-169"><a href="#cb3-169" aria-hidden="true" tabindex="-1"></a>    <span class="dt">valid</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb3-170"><a href="#cb3-170" aria-hidden="true" tabindex="-1"></a>  }))<span class="op">;</span></span>
<span id="cb3-171"><a href="#cb3-171" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="sourceCode cell-code hidden" id="cb4" data-startfrom="178" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 177;"><span id="cb4-178"><a href="#cb4-178" aria-hidden="true" tabindex="-1"></a>viewof selected_study <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(available_studies<span class="op">,</span> {</span>
<span id="cb4-179"><a href="#cb4-179" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">"Select Study:"</span><span class="op">,</span></span>
<span id="cb4-180"><a href="#cb4-180" aria-hidden="true" tabindex="-1"></a>  <span class="dt">format</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">name</span><span class="op">,</span></span>
<span id="cb4-181"><a href="#cb4-181" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> latest_upload <span class="op">||</span> available_studies[<span class="dv">0</span>] </span>
<span id="cb4-182"><a href="#cb4-182" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-4" data-nodetype="declaration">

</div>
</div>
<div class="sourceCode cell-code hidden" id="cb5" data-startfrom="188" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 187;"><span id="cb5-188"><a href="#cb5-188" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb5-189"><a href="#cb5-189" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> study_data_payload<span class="op">;</span></span>
<span id="cb5-190"><a href="#cb5-190" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> contrast <span class="op">=</span> contrast_selection<span class="op">;</span> </span>
<span id="cb5-191"><a href="#cb5-191" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> volcano <span class="op">=</span> current_volcano_data <span class="op">||</span> []<span class="op">;</span></span>
<span id="cb5-192"><a href="#cb5-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-193"><a href="#cb5-193" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>data <span class="op">||</span> <span class="op">!</span>data<span class="op">.</span><span class="at">header_data</span> <span class="op">||</span> data<span class="op">.</span><span class="at">header_data</span><span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb5-194"><a href="#cb5-194" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">html</span><span class="vs">`&lt;div style="font-size: 0.9em; color: #888; font-style: italic;"&gt;⏳ Waiting for study data...&lt;/div&gt;`</span><span class="op">;</span></span>
<span id="cb5-195"><a href="#cb5-195" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-196"><a href="#cb5-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-197"><a href="#cb5-197" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> row <span class="op">=</span> data<span class="op">.</span><span class="at">header_data</span>[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb5-198"><a href="#cb5-198" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pretty_contrast <span class="op">=</span> contrast <span class="op">?</span> contrast<span class="op">.</span><span class="fu">replace</span>(<span class="st">" / "</span><span class="op">,</span> <span class="st">" vs. "</span>) <span class="op">:</span> <span class="st">"None selected"</span><span class="op">;</span></span>
<span id="cb5-199"><a href="#cb5-199" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> count <span class="op">=</span> volcano<span class="op">.</span><span class="at">length</span> <span class="op">?</span> volcano<span class="op">.</span><span class="at">length</span><span class="op">.</span><span class="fu">toLocaleString</span>() <span class="op">:</span> <span class="st">"0"</span><span class="op">;</span></span>
<span id="cb5-200"><a href="#cb5-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-201"><a href="#cb5-201" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">html</span><span class="vs">`</span></span>
<span id="cb5-202"><a href="#cb5-202" aria-hidden="true" tabindex="-1"></a><span class="vs">  &lt;div style="font-size: 0.9em; color: #444;"&gt;</span></span>
<span id="cb5-203"><a href="#cb5-203" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span></span>
<span id="cb5-204"><a href="#cb5-204" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;h5 style="text-transform: uppercase; color: #888; font-size: 0.75em; margin-top: 20px; margin-bottom: 4px; border-top: 1px solid #ddd; padding-top: 12px;"&gt;</span></span>
<span id="cb5-205"><a href="#cb5-205" aria-hidden="true" tabindex="-1"></a><span class="vs">      Study Description</span></span>
<span id="cb5-206"><a href="#cb5-206" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/h5&gt;</span></span>
<span id="cb5-207"><a href="#cb5-207" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;p style="margin-bottom: 16px; font-weight: 500;"&gt;</span><span class="sc">${</span>row<span class="op">.</span><span class="at">Description</span> <span class="op">||</span> <span class="st">"No description available."</span><span class="sc">}</span><span class="vs">&lt;/p&gt;</span></span>
<span id="cb5-208"><a href="#cb5-208" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span></span>
<span id="cb5-209"><a href="#cb5-209" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;h5 style="text-transform: uppercase; color: #888; font-size: 0.75em; margin-top: 15px; margin-bottom: 8px; border-top: 1px solid #ddd; padding-top: 12px;"&gt;</span></span>
<span id="cb5-210"><a href="#cb5-210" aria-hidden="true" tabindex="-1"></a><span class="vs">      Model Formula</span></span>
<span id="cb5-211"><a href="#cb5-211" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/h5&gt;</span></span>
<span id="cb5-212"><a href="#cb5-212" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;div style="background: #f4f4f4; padding: 10px; border-radius: 6px; font-family: monospace; color: #d63384; font-size: 0.9em; margin-bottom: 20px;"&gt;</span></span>
<span id="cb5-213"><a href="#cb5-213" aria-hidden="true" tabindex="-1"></a><span class="vs">      </span><span class="sc">${</span>row<span class="op">.</span><span class="at">Formala</span> <span class="op">||</span> <span class="st">"NA"</span><span class="sc">}</span></span>
<span id="cb5-214"><a href="#cb5-214" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/div&gt;</span></span>
<span id="cb5-215"><a href="#cb5-215" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span></span>
<span id="cb5-216"><a href="#cb5-216" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;div style="display: flex; gap: 20px; border-top: 1px solid #ddd; padding-top: 15px;"&gt;</span></span>
<span id="cb5-217"><a href="#cb5-217" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div style="flex: 1;"&gt;</span></span>
<span id="cb5-218"><a href="#cb5-218" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;h5 style="text-transform: uppercase; color: #888; font-size: 0.75em; margin-bottom: 4px;"&gt;Current Contrast&lt;/h5&gt;</span></span>
<span id="cb5-219"><a href="#cb5-219" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;div style="font-weight: 600; color: #007bff;"&gt;</span><span class="sc">${</span>pretty_contrast<span class="sc">}</span><span class="vs">&lt;/div&gt;</span></span>
<span id="cb5-220"><a href="#cb5-220" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/div&gt;</span></span>
<span id="cb5-221"><a href="#cb5-221" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div style="flex: 0 0 100px; border-left: 1px solid #ddd; padding-left: 15px;"&gt;</span></span>
<span id="cb5-222"><a href="#cb5-222" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;h5 style="text-transform: uppercase; color: #888; font-size: 0.75em; margin-bottom: 4px;"&gt;Total Targets&lt;/h5&gt;</span></span>
<span id="cb5-223"><a href="#cb5-223" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;div style="font-weight: bold; font-size: 1.1em;"&gt;</span><span class="sc">${</span>count<span class="sc">}</span><span class="vs">&lt;/div&gt;</span></span>
<span id="cb5-224"><a href="#cb5-224" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/div&gt;</span></span>
<span id="cb5-225"><a href="#cb5-225" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/div&gt;</span></span>
<span id="cb5-226"><a href="#cb5-226" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span></span>
<span id="cb5-227"><a href="#cb5-227" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;h5 style="text-transform: uppercase; color: #888; font-size: 0.75em; margin-top: 20px; margin-bottom: 4px; border-top: 1px solid #ddd; padding-top: 12px;"&gt;</span></span>
<span id="cb5-228"><a href="#cb5-228" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/h5&gt;</span></span>
<span id="cb5-229"><a href="#cb5-229" aria-hidden="true" tabindex="-1"></a><span class="vs">  &lt;/div&gt;</span></span>
<span id="cb5-230"><a href="#cb5-230" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span><span class="op">;</span></span>
<span id="cb5-231"><a href="#cb5-231" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-5" data-nodetype="expression">

</div>
</div>
<h5 style="text-transform: uppercase; color: #888; font-size: 0.75em; margin-top: 20px; margin-bottom: 8px; border-top: 1px solid #ddd; padding-top: 12px;">
Data Generation Options
</h5>
<p>You can use your own results in this dashboard! Whether your DE results come from AtoMx SIP’s DE Module or the open-sourced smiDE package, we can show you how to load your results.</p>
<ul>
<li><strong>AtoMx SIP</strong>: ✅ <a href="#sec-convert-atomx">Convert data in browser</a></li>
<li><strong>smiDE (R Package)</strong>: ✅ <a href="#sec-convert-smide">View instructions</a></li>
</ul>
<div style="background: #fdfdfe; border: 1px solid #eee; padding: 10px; border-radius: 6px; margin-top: 10px;">
<p style="margin-bottom: 0; font-size: 0.85em; color: #666; font-style: italic;">
Note: Both methods generate a dashboard-ready .zip file.
</p>
</div>
<div class="sourceCode cell-code hidden" id="cb6" data-startfrom="255" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 254;"><span id="cb6-255"><a href="#cb6-255" aria-hidden="true" tabindex="-1"></a>viewof new_zip_file <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">file</span>({</span>
<span id="cb6-256"><a href="#cb6-256" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">"Import the formatted results (.zip):"</span><span class="op">,</span></span>
<span id="cb6-257"><a href="#cb6-257" aria-hidden="true" tabindex="-1"></a>  <span class="dt">accept</span><span class="op">:</span> <span class="st">".zip"</span><span class="op">,</span></span>
<span id="cb6-258"><a href="#cb6-258" aria-hidden="true" tabindex="-1"></a>  <span class="dt">multiple</span><span class="op">:</span> <span class="kw">false</span></span>
<span id="cb6-259"><a href="#cb6-259" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-6" data-nodetype="declaration">

</div>
</div>
<div class="sourceCode cell-code hidden" id="cb7" data-startfrom="271" data-source-offset="-40"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 270;"><span id="cb7-271"><a href="#cb7-271" aria-hidden="true" tabindex="-1"></a>mutable new_zip_data <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb7-272"><a href="#cb7-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-273"><a href="#cb7-273" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. This "watcher" cell handles manual file uploads</span></span>
<span id="cb7-274"><a href="#cb7-274" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb7-275"><a href="#cb7-275" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (new_zip_file) {</span>
<span id="cb7-276"><a href="#cb7-276" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> buf <span class="op">=</span> <span class="cf">await</span> new_zip_file<span class="op">.</span><span class="fu">arrayBuffer</span>()<span class="op">;</span></span>
<span id="cb7-277"><a href="#cb7-277" aria-hidden="true" tabindex="-1"></a>    mutable new_zip_data <span class="op">=</span> {</span>
<span id="cb7-278"><a href="#cb7-278" aria-hidden="true" tabindex="-1"></a>      <span class="dt">id</span><span class="op">:</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>()<span class="op">,</span></span>
<span id="cb7-279"><a href="#cb7-279" aria-hidden="true" tabindex="-1"></a>      <span class="dt">filename</span><span class="op">:</span> new_zip_file<span class="op">.</span><span class="at">name</span><span class="op">,</span></span>
<span id="cb7-280"><a href="#cb7-280" aria-hidden="true" tabindex="-1"></a>      <span class="dt">data</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Uint8Array</span>(buf)</span>
<span id="cb7-281"><a href="#cb7-281" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb7-282"><a href="#cb7-282" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-283"><a href="#cb7-283" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-7-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-7-2" data-nodetype="expression">

</div>
</div>
</div>
<div>
<div id="webr-3" class="exercise-cell">

</div>
<script type="webr-3-contents">
eyJhdHRyIjp7ImF1dG9ydW4iOnRydWUsImRlZmluZSI6WyJwcm9jZXNzZWRfbmV3X3N0dWR5Il0sImVjaG8iOmZhbHNlLCJlZGl0IjpmYWxzZSwiZXZhbCI6dHJ1ZSwiaW5wdXQiOlsibmV3X3ppcF9kYXRhIl0sIm91dHB1dCI6ZmFsc2V9LCJjb2RlIjoiXG5wcm9jZXNzZWRfbmV3X3N0dWR5IDwtIE5VTExcblxuaWYobGVuZ3RoKG5ld196aXBfZGF0YSkgPiAxKXtcbiAgY2F0KHBhc3RlMChcIlByb2Nlc3NpbmcgbmV3IHVzZXIgZGF0YS4gVGltZXN0YW1wOiBcIiwgU3lzLnRpbWUoKSkpXG5cbiAgemlwX2ZpbGVfbmFtZSA8LSBhcy5jaGFyYWN0ZXIobmV3X3ppcF9kYXRhJGZpbGVuYW1lKVxuICB0YXJnZXRfZGlyIDwtIGFzLmNoYXJhY3RlcihuZXdfemlwX2RhdGEkaWQpXG5cbiAgd3JpdGVCaW4oYXMucmF3KG5ld196aXBfZGF0YSRkYXRhKSwgemlwX2ZpbGVfbmFtZSlcbiAgaWYoZGlyLmV4aXN0cyh0YXJnZXRfZGlyKSkgdW5saW5rKHRhcmdldF9kaXIsIHJlY3Vyc2l2ZT1UUlVFKVxuICB1dGlsczo6dW56aXAoemlwX2ZpbGVfbmFtZSwgZXhkaXIgPSB0YXJnZXRfZGlyLCBqdW5rcGF0aHMgPSBUUlVFKVxuICBpZihmaWxlLmV4aXN0cyh6aXBfZmlsZV9uYW1lKSkgdW5saW5rKHppcF9maWxlX25hbWUsIHJlY3Vyc2l2ZT1UUlVFKVxuXG4gIGlzVmFsaWQgPC0gdmVyaWZ5KHRhcmdldF9kaXIpXG4gIFxuICBpZighaXNWYWxpZCl7XG4gICAgY2F0KFwiXFxu4p2MIFZhbGlkYXRpb24gRmFpbGVkLlwiKVxuICB9IGVsc2Uge1xuICAgIGhlYWRlcl9wYXRoIDwtIGZpbGUucGF0aCh0YXJnZXRfZGlyLCBcInN0dWR5X2hlYWRlci5wYXJxdWV0XCIpXG4gICAgc3R1ZHlfbmFtZSA8LSBwYXN0ZTAoXCJDdXN0b206IFwiLCB6aXBfZmlsZV9uYW1lKSBcbiAgICBoZWFkZXJfZGYgPC0gZGF0YS5mcmFtZShOYW1lID0gc3R1ZHlfbmFtZSwgRGVzY3JpcHRpb24gPSBcIlVzZXIgRGF0YVwiLCBGb3JtYWxhID0gXCJOQVwiKSAjIEZhbGxiYWNrXG5cbiAgICB0cnlDYXRjaCh7XG4gICAgICAgY29uX3BlZWsgPC0gZGJDb25uZWN0KGR1Y2tkYigpKVxuICAgICAgIGRmIDwtIGRiR2V0UXVlcnkoY29uX3BlZWssIHBhc3RlMChcIlNFTEVDVCAqIEZST00gJ1wiLCBoZWFkZXJfcGF0aCwgXCInIExJTUlUIDFcIikpXG4gICAgICAgXG4gICAgICAgaWYobnJvdyhkZikgPiAwKSB7XG4gICAgICAgICBoZWFkZXJfZGYgPC0gZGZcbiAgICAgICAgIGlmKFwiTmFtZVwiICVpbiUgbmFtZXMoZGYpKSBzdHVkeV9uYW1lIDwtIGFzLmNoYXJhY3RlcihkZiROYW1lWzFdKVxuICAgICAgIH1cbiAgICAgICBkYkRpc2Nvbm5lY3QoY29uX3BlZWssIHNodXRkb3duPVRSVUUpXG4gICAgfSwgZXJyb3IgPSBmdW5jdGlvbihlKSB7XG4gICAgICAgaWYoZXhpc3RzKFwiY29uX3BlZWtcIikgJiYgZGJJc1ZhbGlkKGNvbl9wZWVrKSkgZGJEaXNjb25uZWN0KGNvbl9wZWVrLCBzaHV0ZG93bj1UUlVFKVxuICAgICAgIGNhdChcIldhcm5pbmc6IENvdWxkIG5vdCByZWFkIGhlYWRlciBmaWxlLiBVc2luZyBkZWZhdWx0cy5cXG5cIilcbiAgICB9KVxuICAgIFxuICAgIGNhdChwYXN0ZTAoXCJcXG7inIUgVmFsaWRhdGVkOiBcIiwgc3R1ZHlfbmFtZSkpXG5cbiAgICBuZXdfc3R1ZHlfbGlzdCA8LSBsaXN0KFxuICAgICAgaWQgPSB0YXJnZXRfZGlyLFxuICAgICAgbmFtZSA9IHN0dWR5X25hbWUsXG4gICAgICBkZXNjcmlwdGlvbiA9IFwiVXNlciBVcGxvYWRlZCBEYXRhXCIsIFxuICAgICAgXG4gICAgICBoZWFkZXJfZGF0YSA9IGhlYWRlcl9kZiwgXG4gICAgICBcbiAgICAgIHVybF9oZWFkZXIgICA9IGhlYWRlcl9wYXRoLFxuICAgICAgdXJsX3BhaXJ3aXNlID0gZmlsZS5wYXRoKHRhcmdldF9kaXIsIFwicGFpcndpc2UucGFycXVldFwiKSxcbiAgICAgIHVybF9tZXRhICAgICA9IGZpbGUucGF0aCh0YXJnZXRfZGlyLCBcImNlbGxfbWV0YWRhdGEucGFycXVldFwiKSxcbiAgICAgIHVybF9lbW1lYW5zICA9IGZpbGUucGF0aCh0YXJnZXRfZGlyLCBcImVtbWVhbnMucGFycXVldFwiKSxcbiAgICAgIHVybF9vdmVybGFwID0gZmlsZS5wYXRoKHRhcmdldF9kaXIsIFwib3ZlcmxhcC5wYXJxdWV0XCIpLFxuICAgICAgdHlwZSA9IFwibG9jYWxcIixcbiAgICAgIHZhbGlkID0gVFJVRVxuICAgIClcbiAgICBcbiAgICBwcm9jZXNzZWRfbmV3X3N0dWR5IDwtIGFzLmNoYXJhY3Rlcihqc29ubGl0ZTo6dG9KU09OKG5ld19zdHVkeV9saXN0LCBhdXRvX3VuYm94ID0gVFJVRSkpXG4gIH1cbiAgXG59IGVsc2Uge1xuICBjYXQocGFzdGUwKFwibmV3X3ppcF9kYXRhIGlzIE5BLiBUaW1lc3RhbXA6IFwiLCBTeXMudGltZSgpKSlcbn0ifQ==
</script>
</div>
<div class="sourceCode cell-code hidden" id="cb8" data-startfrom="359" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 358;"><span id="cb8-359"><a href="#cb8-359" aria-hidden="true" tabindex="-1"></a>mutable latest_upload <span class="op">=</span> <span class="kw">null</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-8" data-nodetype="declaration">

</div>
</div>
<div class="sourceCode cell-code hidden" id="cb9" data-startfrom="366" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 365;"><span id="cb9-366"><a href="#cb9-366" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb9-367"><a href="#cb9-367" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (processed_new_study) {</span>
<span id="cb9-368"><a href="#cb9-368" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> new_record <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">parse</span>(processed_new_study)<span class="op">;</span></span>
<span id="cb9-369"><a href="#cb9-369" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-370"><a href="#cb9-370" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (new_record <span class="op">&amp;&amp;</span> new_record<span class="op">.</span><span class="at">valid</span>) {</span>
<span id="cb9-371"><a href="#cb9-371" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> exists <span class="op">=</span> available_studies<span class="op">.</span><span class="fu">find</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">id</span> <span class="op">===</span> new_record<span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb9-372"><a href="#cb9-372" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb9-373"><a href="#cb9-373" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="op">!</span>exists) {</span>
<span id="cb9-374"><a href="#cb9-374" aria-hidden="true" tabindex="-1"></a>         <span class="co">// 1. Update the list</span></span>
<span id="cb9-375"><a href="#cb9-375" aria-hidden="true" tabindex="-1"></a>         mutable available_studies<span class="op">.</span><span class="fu">push</span>(new_record)<span class="op">;</span></span>
<span id="cb9-376"><a href="#cb9-376" aria-hidden="true" tabindex="-1"></a>         mutable available_studies <span class="op">=</span> mutable available_studies<span class="op">;</span></span>
<span id="cb9-377"><a href="#cb9-377" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb9-378"><a href="#cb9-378" aria-hidden="true" tabindex="-1"></a>         mutable latest_upload <span class="op">=</span> new_record<span class="op">;</span> </span>
<span id="cb9-379"><a href="#cb9-379" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb9-380"><a href="#cb9-380" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"✅ Loaded:"</span><span class="op">,</span> new_record<span class="op">.</span><span class="at">name</span>)<span class="op">;</span></span>
<span id="cb9-381"><a href="#cb9-381" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-382"><a href="#cb9-382" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-383"><a href="#cb9-383" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-9" data-nodetype="expression">

</div>
</div>
<div class="sourceCode cell-code hidden" id="cb10" data-startfrom="390" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 389;"><span id="cb10-390"><a href="#cb10-390" aria-hidden="true" tabindex="-1"></a>study_data_payload <span class="op">=</span> {</span>
<span id="cb10-391"><a href="#cb10-391" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> selection <span class="op">=</span> selected_study<span class="op">;</span></span>
<span id="cb10-392"><a href="#cb10-392" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>selection) <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb10-393"><a href="#cb10-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-394"><a href="#cb10-394" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"🔄 Processing selection:"</span><span class="op">,</span> selection<span class="op">.</span><span class="at">name</span>)<span class="op">;</span></span>
<span id="cb10-395"><a href="#cb10-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-396"><a href="#cb10-396" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (selection<span class="op">.</span><span class="at">type</span> <span class="op">===</span> <span class="st">"local"</span>) {</span>
<span id="cb10-397"><a href="#cb10-397" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"👉 Mode: Local"</span>)<span class="op">;</span></span>
<span id="cb10-398"><a href="#cb10-398" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb10-399"><a href="#cb10-399" aria-hidden="true" tabindex="-1"></a>      <span class="dt">mode</span><span class="op">:</span> <span class="st">"local"</span><span class="op">,</span></span>
<span id="cb10-400"><a href="#cb10-400" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span>selection</span>
<span id="cb10-401"><a href="#cb10-401" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb10-402"><a href="#cb10-402" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-403"><a href="#cb10-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-404"><a href="#cb10-404" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (selection<span class="op">.</span><span class="at">type</span> <span class="op">===</span> <span class="st">"remote"</span>) {</span>
<span id="cb10-405"><a href="#cb10-405" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"👉 Mode: Remote (JS Bridge)"</span>)<span class="op">;</span></span>
<span id="cb10-406"><a href="#cb10-406" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-407"><a href="#cb10-407" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb10-408"><a href="#cb10-408" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> conn <span class="op">=</span> <span class="cf">await</span> duck_db_client<span class="op">;</span></span>
<span id="cb10-409"><a href="#cb10-409" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb10-410"><a href="#cb10-410" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> header_table <span class="op">=</span> <span class="cf">await</span> conn<span class="op">.</span><span class="fu">query</span>(<span class="vs">`SELECT * FROM '</span><span class="sc">${</span>selection<span class="op">.</span><span class="at">url_header</span><span class="sc">}</span><span class="vs">'`</span>)<span class="op">;</span></span>
<span id="cb10-411"><a href="#cb10-411" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb10-412"><a href="#cb10-412" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> header_json <span class="op">=</span> header_table<span class="op">.</span><span class="fu">toArray</span>()<span class="op">.</span><span class="fu">map</span>(row <span class="kw">=&gt;</span> row<span class="op">.</span><span class="fu">toJSON</span>())<span class="op">;</span></span>
<span id="cb10-413"><a href="#cb10-413" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb10-414"><a href="#cb10-414" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"✅ Header received:"</span><span class="op">,</span> header_json)<span class="op">;</span></span>
<span id="cb10-415"><a href="#cb10-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-416"><a href="#cb10-416" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> {</span>
<span id="cb10-417"><a href="#cb10-417" aria-hidden="true" tabindex="-1"></a>        <span class="dt">mode</span><span class="op">:</span> <span class="st">"remote_js_bridge"</span><span class="op">,</span></span>
<span id="cb10-418"><a href="#cb10-418" aria-hidden="true" tabindex="-1"></a>        <span class="dt">id</span><span class="op">:</span> selection<span class="op">.</span><span class="at">id</span><span class="op">,</span></span>
<span id="cb10-419"><a href="#cb10-419" aria-hidden="true" tabindex="-1"></a>        <span class="dt">name</span><span class="op">:</span> selection<span class="op">.</span><span class="at">name</span><span class="op">,</span></span>
<span id="cb10-420"><a href="#cb10-420" aria-hidden="true" tabindex="-1"></a>        <span class="dt">header_data</span><span class="op">:</span> header_json<span class="op">,</span></span>
<span id="cb10-421"><a href="#cb10-421" aria-hidden="true" tabindex="-1"></a>        <span class="dt">url_pairwise</span><span class="op">:</span> selection<span class="op">.</span><span class="at">url_pairwise</span><span class="op">,</span></span>
<span id="cb10-422"><a href="#cb10-422" aria-hidden="true" tabindex="-1"></a>        <span class="dt">url_meta</span><span class="op">:</span> selection<span class="op">.</span><span class="at">url_meta</span><span class="op">,</span></span>
<span id="cb10-423"><a href="#cb10-423" aria-hidden="true" tabindex="-1"></a>        <span class="dt">url_emmeans</span><span class="op">:</span> selection<span class="op">.</span><span class="at">url_emmeans</span><span class="op">,</span></span>
<span id="cb10-424"><a href="#cb10-424" aria-hidden="true" tabindex="-1"></a>        <span class="dt">url_overlap</span><span class="op">:</span> selection<span class="op">.</span><span class="at">url_overlap</span></span>
<span id="cb10-425"><a href="#cb10-425" aria-hidden="true" tabindex="-1"></a>      }<span class="op">;</span></span>
<span id="cb10-426"><a href="#cb10-426" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb10-427"><a href="#cb10-427" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (e) {</span>
<span id="cb10-428"><a href="#cb10-428" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(<span class="st">"❌ JS Bridge Error:"</span><span class="op">,</span> e)<span class="op">;</span></span>
<span id="cb10-429"><a href="#cb10-429" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb10-430"><a href="#cb10-430" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-431"><a href="#cb10-431" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-432"><a href="#cb10-432" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-10" data-nodetype="declaration">

</div>
</div>
<div>
<div id="webr-4" class="exercise-cell">

</div>
<script type="webr-4-contents">
eyJhdHRyIjp7ImF1dG9ydW4iOnRydWUsImRlZmluZSI6WyJkYl9yZWFkeSIsInJfc3RhdHVzX3Byb3h5Il0sImVjaG8iOmZhbHNlLCJlZGl0IjpmYWxzZSwiZXZhbCI6dHJ1ZSwiaW5wdXQiOlsic3R1ZHlfZGF0YV9wYXlsb2FkIl0sIm91dHB1dCI6ZmFsc2V9LCJjb2RlIjoiXG5kYl9yZWFkeSA8LSBGQUxTRVxucl9zdGF0dXNfcHJveHkgPC0gXCJXYWl0aW5nIGZvciBkYXRhLi4uXCJcbnByaW50KGNvbilcblxuaWYgKCFpcy5udWxsKHN0dWR5X2RhdGFfcGF5bG9hZCkpIHtcbiAgXG4gIGNhdChwYXN0ZTAoXCJSOiBSZWNlaXZlZCBwYXlsb2FkIG1vZGU6IFwiLCBzdHVkeV9kYXRhX3BheWxvYWQkbW9kZSwgXCJcXG5cIikpXG5cbiAgaWYgKHN0dWR5X2RhdGFfcGF5bG9hZCRtb2RlID09IFwicmVtb3RlX2pzX2JyaWRnZVwiKSB7XG4gICAgXG4gICAgaWYgKCFpcy5udWxsKHN0dWR5X2RhdGFfcGF5bG9hZCRoZWFkZXJfZGF0YSkpIHtcbiAgICAgICBoZWFkZXJfanNvbl9zdHIgPC0ganNvbmxpdGU6OnRvSlNPTihzdHVkeV9kYXRhX3BheWxvYWQkaGVhZGVyX2RhdGEpXG4gICAgICAgaGVhZGVyX2RmIDwtIGpzb25saXRlOjpmcm9tSlNPTihoZWFkZXJfanNvbl9zdHIpXG5cbiAgICAgICBkYldyaXRlVGFibGUoY29uLCBcInN0dWR5X21ldGFcIiwgaGVhZGVyX2RmLCBvdmVyd3JpdGUgPSBUUlVFKVxuICAgICAgIGNhdChcIlI6IEhlYWRlciB0YWJsZSB3cml0dGVuIHN1Y2Nlc3NmdWxseS5cXG5cIilcbiAgICB9XG4gICAgXG4gIH0gZWxzZSB7XG5cbiAgICBpZiAoIWlzLm5hKHN0dWR5X2RhdGFfcGF5bG9hZCR1cmxfaGVhZGVyKSkge1xuICAgICAgIGRiRXhlY3V0ZShjb24sIHBhc3RlMChcIkNSRUFURSBPUiBSRVBMQUNFIFZJRVcgc3R1ZHlfbWV0YSBBUyBTRUxFQ1QgKiBGUk9NICdcIiwgc3R1ZHlfZGF0YV9wYXlsb2FkJHVybF9oZWFkZXIsIFwiJ1wiKSlcbiAgICB9XG5cbiAgICBpZiAoIWlzLm5hKHN0dWR5X2RhdGFfcGF5bG9hZCR1cmxfcGFpcndpc2UpKSB7XG4gICAgICAgZGJFeGVjdXRlKGNvbiwgcGFzdGUwKFwiQ1JFQVRFIE9SIFJFUExBQ0UgVklFVyBkZV9yZXN1bHRzIEFTIFNFTEVDVCAqIEZST00gJ1wiLCBzdHVkeV9kYXRhX3BheWxvYWQkdXJsX3BhaXJ3aXNlLCBcIidcIikpXG4gICAgfVxuXG4gICAgaWYgKCFpcy5uYShzdHVkeV9kYXRhX3BheWxvYWQkdXJsX21ldGEpKSB7XG4gICAgICAgZGJFeGVjdXRlKGNvbiwgcGFzdGUwKFwiQ1JFQVRFIE9SIFJFUExBQ0UgVklFVyBjZWxsX21ldGEgQVMgU0VMRUNUICogRlJPTSAnXCIsIHN0dWR5X2RhdGFfcGF5bG9hZCR1cmxfbWV0YSwgXCInXCIpKVxuICAgIH1cblxuICAgIGlmICghaXMubmEoc3R1ZHlfZGF0YV9wYXlsb2FkJHVybF9lbW1lYW5zKSkge1xuICAgICAgIGRiRXhlY3V0ZShjb24sIHBhc3RlMChcIkNSRUFURSBPUiBSRVBMQUNFIFZJRVcgZW1tZWFuc19kYXRhIEFTIFNFTEVDVCAqIEZST00gJ1wiLCBzdHVkeV9kYXRhX3BheWxvYWQkdXJsX2VtbWVhbnMsIFwiJ1wiKSlcbiAgICB9XG4gICAgIyBPdmVybGFwIChmdXJ0dXJlIGZlYXR1cmUpXG4gICAgI2lmICghaXMubmEoc3R1ZHlfZGF0YV9wYXlsb2FkJHVybF9vdmVybGFwKSkge1xuICAgICMgICBkYkV4ZWN1dGUoY29uLCBwYXN0ZTAoXCJDUkVBVEUgT1IgUkVQTEFDRSBWSUVXIG92ZXJsYXBfZGF0YSBBUyBTRUxFQ1QgKiBGUk9NICdcIiwgc3R1ZHlfZGF0YV9wYXlsb2FkJHVybF9vdmVybGFwLCBcIidcIikpXG4gICAgI31cbiAgICAgIH1cbiAgXG4gIHJfc3RhdHVzX3Byb3h5IDwtIHBhc3RlKFwiQWN0aXZlOlwiLCBzdHVkeV9kYXRhX3BheWxvYWQkbmFtZSlcbiAgZGJfcmVhZHkgPC0gVFJVRVxufSJ9
</script>
</div>
<div class="sourceCode cell-code hidden" id="cb11" data-startfrom="495" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 494;"><span id="cb11-495"><a href="#cb11-495" aria-hidden="true" tabindex="-1"></a>contrasts_from_js <span class="op">=</span> {</span>
<span id="cb11-496"><a href="#cb11-496" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> payload <span class="op">=</span> study_data_payload<span class="op">;</span></span>
<span id="cb11-497"><a href="#cb11-497" aria-hidden="true" tabindex="-1"></a>  <span class="co">// If local, let webR/R handle the contrast list to avoid path errors</span></span>
<span id="cb11-498"><a href="#cb11-498" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>payload <span class="op">||</span> payload<span class="op">.</span><span class="at">type</span> <span class="op">===</span> <span class="st">"local"</span>) <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb11-499"><a href="#cb11-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-500"><a href="#cb11-500" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (payload<span class="op">.</span><span class="at">mode</span> <span class="op">===</span> <span class="st">"remote_js_bridge"</span>) {</span>
<span id="cb11-501"><a href="#cb11-501" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb11-502"><a href="#cb11-502" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> conn <span class="op">=</span> <span class="cf">await</span> duck_db_client<span class="op">;</span></span>
<span id="cb11-503"><a href="#cb11-503" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> table <span class="op">=</span> payload<span class="op">.</span><span class="at">isAtoMx</span> <span class="op">?</span> <span class="st">'pairwise_harmonized'</span> <span class="op">:</span> <span class="vs">`"</span><span class="sc">${</span>payload<span class="op">.</span><span class="at">url_pairwise</span><span class="sc">}</span><span class="vs">"`</span><span class="op">;</span></span>
<span id="cb11-504"><a href="#cb11-504" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb11-505"><a href="#cb11-505" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> query <span class="op">=</span> <span class="vs">`SELECT DISTINCT "contrast" FROM </span><span class="sc">${</span>table<span class="sc">}</span><span class="vs"> ORDER BY "contrast"`</span><span class="op">;</span></span>
<span id="cb11-506"><a href="#cb11-506" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> result <span class="op">=</span> <span class="cf">await</span> conn<span class="op">.</span><span class="fu">query</span>(query)<span class="op">;</span></span>
<span id="cb11-507"><a href="#cb11-507" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> result<span class="op">.</span><span class="fu">toArray</span>()<span class="op">.</span><span class="fu">map</span>(row <span class="kw">=&gt;</span> row<span class="op">.</span><span class="at">contrast</span>)<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> <span class="op">!</span>d<span class="op">.</span><span class="fu">includes</span>(<span class="st">"otherct_expr"</span>))<span class="op">;</span></span>
<span id="cb11-508"><a href="#cb11-508" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (e) {</span>
<span id="cb11-509"><a href="#cb11-509" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(<span class="st">"❌ Contrast Fetch Error:"</span><span class="op">,</span> e)<span class="op">;</span></span>
<span id="cb11-510"><a href="#cb11-510" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> []<span class="op">;</span> </span>
<span id="cb11-511"><a href="#cb11-511" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-512"><a href="#cb11-512" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-513"><a href="#cb11-513" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-11" data-nodetype="declaration">

</div>
</div>
<div class="sourceCode cell-code hidden" id="cb12" data-startfrom="520" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 519;"><span id="cb12-520"><a href="#cb12-520" aria-hidden="true" tabindex="-1"></a>terms_from_js <span class="op">=</span> {</span>
<span id="cb12-521"><a href="#cb12-521" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> payload <span class="op">=</span> study_data_payload<span class="op">;</span></span>
<span id="cb12-522"><a href="#cb12-522" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Guard against local studies to allow R-based term population</span></span>
<span id="cb12-523"><a href="#cb12-523" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>payload <span class="op">||</span> payload<span class="op">.</span><span class="at">type</span> <span class="op">===</span> <span class="st">"local"</span>) <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb12-524"><a href="#cb12-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-525"><a href="#cb12-525" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (payload<span class="op">.</span><span class="at">mode</span> <span class="op">===</span> <span class="st">"remote_js_bridge"</span>) {</span>
<span id="cb12-526"><a href="#cb12-526" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb12-527"><a href="#cb12-527" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> conn <span class="op">=</span> <span class="cf">await</span> duck_db_client<span class="op">;</span></span>
<span id="cb12-528"><a href="#cb12-528" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> table <span class="op">=</span> payload<span class="op">.</span><span class="at">isAtoMx</span> <span class="op">?</span> <span class="st">'pairwise_harmonized'</span> <span class="op">:</span> <span class="vs">`"</span><span class="sc">${</span>payload<span class="op">.</span><span class="at">url_pairwise</span><span class="sc">}</span><span class="vs">"`</span><span class="op">;</span></span>
<span id="cb12-529"><a href="#cb12-529" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb12-530"><a href="#cb12-530" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> query <span class="op">=</span> <span class="vs">`SELECT DISTINCT "term" FROM </span><span class="sc">${</span>table<span class="sc">}</span><span class="vs"> ORDER BY "term"`</span><span class="op">;</span></span>
<span id="cb12-531"><a href="#cb12-531" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> result <span class="op">=</span> <span class="cf">await</span> conn<span class="op">.</span><span class="fu">query</span>(query)<span class="op">;</span></span>
<span id="cb12-532"><a href="#cb12-532" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> result<span class="op">.</span><span class="fu">toArray</span>()<span class="op">.</span><span class="fu">map</span>(row <span class="kw">=&gt;</span> row<span class="op">.</span><span class="at">term</span>)<span class="op">;</span></span>
<span id="cb12-533"><a href="#cb12-533" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (e) {</span>
<span id="cb12-534"><a href="#cb12-534" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(<span class="st">"❌ Terms Fetch Error:"</span><span class="op">,</span> e)<span class="op">;</span></span>
<span id="cb12-535"><a href="#cb12-535" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> []<span class="op">;</span></span>
<span id="cb12-536"><a href="#cb12-536" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb12-537"><a href="#cb12-537" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-538"><a href="#cb12-538" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-12" data-nodetype="declaration">

</div>
</div>
<div class="sourceCode cell-code hidden" id="cb13" data-startfrom="545" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 544;"><span id="cb13-545"><a href="#cb13-545" aria-hidden="true" tabindex="-1"></a>slides_from_js <span class="op">=</span> {</span>
<span id="cb13-546"><a href="#cb13-546" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> payload <span class="op">=</span> study_data_payload<span class="op">;</span></span>
<span id="cb13-547"><a href="#cb13-547" aria-hidden="true" tabindex="-1"></a>  <span class="co">// If local, return null to let R query the local cell_meta table</span></span>
<span id="cb13-548"><a href="#cb13-548" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>payload <span class="op">||</span> payload<span class="op">.</span><span class="at">type</span> <span class="op">===</span> <span class="st">"local"</span>) <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb13-549"><a href="#cb13-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-550"><a href="#cb13-550" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (payload<span class="op">.</span><span class="at">mode</span> <span class="op">===</span> <span class="st">"remote_js_bridge"</span>) {</span>
<span id="cb13-551"><a href="#cb13-551" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (payload<span class="op">.</span><span class="at">isAtoMx</span>) <span class="cf">return</span> [<span class="dv">1</span>]<span class="op">;</span> </span>
<span id="cb13-552"><a href="#cb13-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-553"><a href="#cb13-553" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb13-554"><a href="#cb13-554" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> conn <span class="op">=</span> <span class="cf">await</span> duck_db_client<span class="op">;</span></span>
<span id="cb13-555"><a href="#cb13-555" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> query <span class="op">=</span> <span class="vs">`SELECT DISTINCT "slide_id_numeric" FROM "</span><span class="sc">${</span>payload<span class="op">.</span><span class="at">url_meta</span><span class="sc">}</span><span class="vs">" ORDER BY "slide_id_numeric"`</span><span class="op">;</span></span>
<span id="cb13-556"><a href="#cb13-556" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> result <span class="op">=</span> <span class="cf">await</span> conn<span class="op">.</span><span class="fu">query</span>(query)<span class="op">;</span></span>
<span id="cb13-557"><a href="#cb13-557" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> list <span class="op">=</span> result<span class="op">.</span><span class="fu">toArray</span>()<span class="op">.</span><span class="fu">map</span>(row <span class="kw">=&gt;</span> row<span class="op">.</span><span class="at">slide_id_numeric</span>)<span class="op">;</span></span>
<span id="cb13-558"><a href="#cb13-558" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> list<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> list <span class="op">:</span> [<span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb13-559"><a href="#cb13-559" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (e) {</span>
<span id="cb13-560"><a href="#cb13-560" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> [<span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb13-561"><a href="#cb13-561" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-562"><a href="#cb13-562" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-563"><a href="#cb13-563" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-13" data-nodetype="declaration">

</div>
</div>
<div>
<div id="webr-5" class="exercise-cell">

</div>
<script type="webr-5-contents">
eyJhdHRyIjp7ImF1dG9ydW4iOnRydWUsImRlZmluZSI6WyJhdmFpbGFibGVfY29udHJhc3RzIiwiYXZhaWxhYmxlX3Rlcm1zIiwiYXZhaWxhYmxlX3NsaWRlcyJdLCJlY2hvIjpmYWxzZSwiZWRpdCI6ZmFsc2UsImV2YWwiOnRydWUsImlucHV0IjpbInN0dWR5X2RhdGFfcGF5bG9hZCIsImNvbnRyYXN0c19mcm9tX2pzIiwidGVybXNfZnJvbV9qcyIsInNsaWRlc19mcm9tX2pzIl0sIm91dHB1dCI6ZmFsc2V9LCJjb2RlIjoiXG4jIHByaW50KFN5cy50aW1lKCkpXG4jIHByaW50KGNvbnRyYXN0c19mcm9tX2pzKVxuIyBwcmludCh0ZXJtc19mcm9tX2pzKVxuIyBwcmludChzbGlkZXNfZnJvbV9qcylcblxuYXZhaWxhYmxlX2NvbnRyYXN0cyA8LSBpZihleGlzdHMoXCJhdmFpbGFibGVfY29udHJhc3RzXCIpKSBhdmFpbGFibGVfY29udHJhc3RzIGVsc2UgTlVMTFxuYXZhaWxhYmxlX3Rlcm1zIDwtIGlmKGV4aXN0cyhcImF2YWlsYWJsZV90ZXJtc1wiKSkgYXZhaWxhYmxlX3Rlcm1zIGVsc2UgTlVMTFxuYXZhaWxhYmxlX3NsaWRlcyA8LSBpZihleGlzdHMoXCJhdmFpbGFibGVfc2xpZGVzXCIpKSBhdmFpbGFibGVfc2xpZGVzIGVsc2UgMVxuXG5pZiAoIWlzLm51bGwoc3R1ZHlfZGF0YV9wYXlsb2FkKSkge1xuICAjIFJFTU9URSBNT0RFXG4gIGlmIChzdHVkeV9kYXRhX3BheWxvYWQkbW9kZSA9PSBcInJlbW90ZV9qc19icmlkZ2VcIikge1xuICAgIGlmICghaXMubnVsbChjb250cmFzdHNfZnJvbV9qcykpIGF2YWlsYWJsZV9jb250cmFzdHMgPC0gdW5saXN0KGNvbnRyYXN0c19mcm9tX2pzKVxuICAgIGlmICghaXMubnVsbCh0ZXJtc19mcm9tX2pzKSkgYXZhaWxhYmxlX3Rlcm1zIDwtIHVubGlzdCh0ZXJtc19mcm9tX2pzKVxuICAgIGlmICghaXMubnVsbChzbGlkZXNfZnJvbV9qcykpIGF2YWlsYWJsZV9zbGlkZXMgPC0gdW5saXN0KHNsaWRlc19mcm9tX2pzKVxuICAgIFxuICAjIExPQ0FMIE1PREVcbiAgfSBlbHNlIGlmIChkYkV4aXN0c1RhYmxlKGNvbiwgXCJkZV9yZXN1bHRzXCIpKSB7XG4gICAgYXZhaWxhYmxlX2NvbnRyYXN0cyA8LSBkYkdldFF1ZXJ5KGNvbiwgXCJTRUxFQ1QgRElTVElOQ1QgY29udHJhc3QgRlJPTSBkZV9yZXN1bHRzXCIpJGNvbnRyYXN0XG4gICAgYXZhaWxhYmxlX2NvbnRyYXN0cyA8LSBhdmFpbGFibGVfY29udHJhc3RzWyFncmVwbChcIm90aGVyY3RfZXhwclwiLCBhdmFpbGFibGVfY29udHJhc3RzKV1cbiAgICBhdmFpbGFibGVfdGVybXMgPC0gZGJHZXRRdWVyeShjb24sIFwiU0VMRUNUIERJU1RJTkNUIHRlcm0gRlJPTSBkZV9yZXN1bHRzXCIpJHRlcm1cbiAgICBcbiAgICBpZiAoZGJFeGlzdHNUYWJsZShjb24sIFwiY2VsbF9tZXRhXCIpKSB7XG4gICAgICBhdmFpbGFibGVfc2xpZGVzIDwtIGRiR2V0UXVlcnkoY29uLCBcIlNFTEVDVCBESVNUSU5DVCBzbGlkZV9pZF9udW1lcmljIEZST00gY2VsbF9tZXRhXCIpJHNsaWRlX2lkX251bWVyaWNcbiAgICB9XG4gIH1cbn0ifQ==
</script>
</div>
<br>
<p>For best results, use Chrome, Edge, or Safari. This is optimized for desktop and tablet view.</p>
<p>Tool Version: 1.0</p>
<p>Tool Type: Serverless (OJS + webr)</p>
<p>Source Code Available: ✅ Yes</p>
</div></aside>
<button class="collapse-toggle" type="button" title="Toggle sidebar" aria-expanded="true" aria-controls="bslib-sidebar-1">
    <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 16 16" class="bi bi-chevron-left collapse-icon" style="fill:currentColor;" aria-hidden="true" role="img">
      <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"></path>
    </svg>
</button>
<script data-bslib-sidebar-init="">
bslib.Sidebar.initCollapsibleAll()
</script>
</div>
<div class="ojs-auto-generated hidden bslib-grid-item html-fill-item">
<script type="ojs-module-contents">
eyJjb250ZW50cyI6WyAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7c2VsZWN0aW9uV2FybmluZ308L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTEifV19
</script>
</div>


<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlxuZHVja19kYl9jbGllbnQgPSB7XG4gIGNvbnN0IGR1Y2tkYiA9IGF3YWl0IGltcG9ydChcImh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vQGR1Y2tkYi9kdWNrZGItd2FzbUAxLjI4LjAvK2VzbVwiKTtcbiAgXG4gIGNvbnNvbGUubG9nKFwi8J+UpyBJbml0aWFsaXppbmcgRHVja0RCLVdhc20gQ2xpZW50Li4uXCIpO1xuICBcbiAgY29uc3QgSlNERUxJVlJfQlVORExFUyA9IGR1Y2tkYi5nZXRKc0RlbGl2ckJ1bmRsZXMoKTtcbiAgY29uc3QgYnVuZGxlID0gYXdhaXQgZHVja2RiLnNlbGVjdEJ1bmRsZShKU0RFTElWUl9CVU5ETEVTKTtcbiAgXG4gIGNvbnN0IHdvcmtlcl91cmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKFxuICAgIG5ldyBCbG9iKFtgaW1wb3J0U2NyaXB0cyhcIiR7YnVuZGxlLm1haW5Xb3JrZXJ9XCIpO2BdLCB7IHR5cGU6IFwidGV4dC9qYXZhc2NyaXB0XCIgfSlcbiAgKTtcblxuICBjb25zdCB3b3JrZXIgPSBuZXcgV29ya2VyKHdvcmtlcl91cmwpO1xuICBjb25zdCBsb2dnZXIgPSBuZXcgZHVja2RiLkNvbnNvbGVMb2dnZXIoKTtcbiAgY29uc3QgZGIgPSBuZXcgZHVja2RiLkFzeW5jRHVja0RCKGxvZ2dlciwgd29ya2VyKTtcbiAgXG4gIGF3YWl0IGRiLmluc3RhbnRpYXRlKGJ1bmRsZS5tYWluTW9kdWxlLCBidW5kbGUucHRocmVhZFdvcmtlcik7XG4gIFxuICBjb25zdCBjb25uID0gYXdhaXQgZGIuY29ubmVjdCgpO1xuICBjb25uLmluc3RhbmNlID0gZGI7IC8vIEF0dGFjaCB0aGUgZW5naW5lIHRvIHRoZSBjb25uZWN0aW9uXG4gIGNvbnNvbGUubG9nKFwi4pyFIER1Y2tEQi1XYXNtIFJlYWR5IChFbmdpbmUgKyBDb25uZWN0aW9uKVwiKTtcbiAgcmV0dXJuIGNvbm47XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJcbnNwYXJrYmFyID0gKG1heCkgPT4ge1xuICByZXR1cm4gKHgpID0+IHtcbiAgICAvLyAxLiBDcmVhdGUgY29udGFpbmVyXG4gICAgY29uc3QgZGl2ID0gZDMuY3JlYXRlKFwiZGl2XCIpXG4gICAgICAuc3R5bGUoXCJkaXNwbGF5XCIsIFwiZmxleFwiKVxuICAgICAgLnN0eWxlKFwiYWxpZ24taXRlbXNcIiwgXCJjZW50ZXJcIilcbiAgICAgIC5zdHlsZShcIndpZHRoXCIsIFwiMTAwJVwiKTsgLy8gTGV0IGl0IGZpbGwgdGhlIGNlbGxcblxuICAgIGNvbnN0IGNvbG9yID0geCA+PSAwID8gXCIjRTQxQTFDXCIgOiBcIiMzNzdFQjhcIjsgXG4gICAgY29uc3Qgd2lkdGhQZXJjZW50ID0gTWF0aC5taW4oKE1hdGguYWJzKHgpIC8gbWF4KSAqIDEwMCwgMTAwKTtcblxuICAgIGRpdi5hcHBlbmQoXCJzcGFuXCIpXG4gICAgICAgLnRleHQoeC50b0ZpeGVkKDIpKVxuICAgICAgIC5zdHlsZShcImZvbnQtc2l6ZVwiLCBcIjAuODVlbVwiKVxuICAgICAgIC5zdHlsZShcImNvbG9yXCIsIFwiIzY2NlwiKVxuICAgICAgIC5zdHlsZShcIndpZHRoXCIsIFwiMzVweFwiKSAgICAgICAgIC8vIEZpeGVkIHdpZHRoIGZvciBhbGlnbm1lbnRcbiAgICAgICAuc3R5bGUoXCJ0ZXh0LWFsaWduXCIsIFwicmlnaHRcIikgICAvLyBBbGlnbiBudW1iZXJzIHRvIHRoZSByaWdodFxuICAgICAgIC5zdHlsZShcIm1hcmdpbi1yaWdodFwiLCBcIjhweFwiKTsgIC8vIFNwYWNlIGJldHdlZW4gbnVtYmVyIGFuZCBiYXJcblxuICAgIGRpdi5hcHBlbmQoXCJkaXZcIilcbiAgICAgIC5zdHlsZShcIndpZHRoXCIsIGAke3dpZHRoUGVyY2VudH0lYClcbiAgICAgIC5zdHlsZShcImhlaWdodFwiLCBcIjEycHhcIilcbiAgICAgIC5zdHlsZShcImJhY2tncm91bmQtY29sb3JcIiwgY29sb3IpXG4gICAgICAuc3R5bGUoXCJib3JkZXItcmFkaXVzXCIsIFwiMnB4XCIpO1xuXG4gICAgcmV0dXJuIGRpdi5ub2RlKCk7XG4gIH1cbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlxuZDMgPSByZXF1aXJlKFwiZDNAN1wiKVxuUGxvdGx5ID0gcmVxdWlyZShcImh0dHBzOi8vY2RuLnBsb3QubHkvcGxvdGx5LTIuMjQuMS5taW4uanNcIilcbm1hbmlmZXN0X3JhdyA9IEZpbGVBdHRhY2htZW50KFwiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL05hbm9zdHJpbmctQmlvc3RhdHMvU2NyYXRjaFNwYWNlRGF0YXNldHMvcmVmcy9oZWFkcy9tYWluL2Jyb3dzZXJfYnl0ZXMvbWFuaWZlc3QudHN2XCIpLnRzdih7dHlwZWQ6IHRydWV9KVxuXG5tdXRhYmxlIGF2YWlsYWJsZV9zdHVkaWVzID0ge1xuICBpZiAoIW1hbmlmZXN0X3JhdykgcmV0dXJuIFtdO1xuXG4gIHJldHVybiBtYW5pZmVzdF9yYXcubWFwKGQgPT4gKHtcbiAgICBpZDogZC5pZCxcbiAgICBuYW1lOiBkLm5hbWUsXG4gICAgZGVzY3JpcHRpb246IGQuZGVzY3JpcHRpb24sXG4gICAgXG4gICAgLy8gRGlyZWN0IG1hcHBpbmcgb2YgeW91ciBUU1YgY29sdW1uc1xuICAgIHVybF9oZWFkZXI6ICAgZC51cmxfaGVhZGVyLFxuICAgIHVybF9wYWlyd2lzZTogZC51cmxfcGFpcndpc2UsXG4gICAgdXJsX21ldGE6ICAgICBkLnVybF9tZXRhLFxuICAgIHVybF9lbW1lYW5zOiAgZC51cmxfZW1tZWFucyxcbiAgICB1cmxfb3ZlcmxhcDogZC51cmxfb3ZlcmxhcCxcblxuICAgIHR5cGU6ICdyZW1vdGUnLFxuICAgIHZhbGlkOiB0cnVlXG4gIH0pKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ilxudmlld29mIHNlbGVjdGVkX3N0dWR5ID0gSW5wdXRzLnNlbGVjdChhdmFpbGFibGVfc3R1ZGllcywge1xuICBsYWJlbDogXCJTZWxlY3QgU3R1ZHk6XCIsXG4gIGZvcm1hdDogZCA9PiBkLm5hbWUsXG4gIHZhbHVlOiBsYXRlc3RfdXBsb2FkIHx8IGF2YWlsYWJsZV9zdHVkaWVzWzBdIFxufSlcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ilxue1xuICBjb25zdCBkYXRhID0gc3R1ZHlfZGF0YV9wYXlsb2FkO1xuICBjb25zdCBjb250cmFzdCA9IGNvbnRyYXN0X3NlbGVjdGlvbjsgXG4gIGNvbnN0IHZvbGNhbm8gPSBjdXJyZW50X3ZvbGNhbm9fZGF0YSB8fCBbXTtcblxuICBpZiAoIWRhdGEgfHwgIWRhdGEuaGVhZGVyX2RhdGEgfHwgZGF0YS5oZWFkZXJfZGF0YS5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm4gaHRtbGA8ZGl2IHN0eWxlPVwiZm9udC1zaXplOiAwLjllbTsgY29sb3I6ICM4ODg7IGZvbnQtc3R5bGU6IGl0YWxpYztcIj7ij7MgV2FpdGluZyBmb3Igc3R1ZHkgZGF0YS4uLjwvZGl2PmA7XG4gIH1cblxuICBjb25zdCByb3cgPSBkYXRhLmhlYWRlcl9kYXRhWzBdO1xuICBjb25zdCBwcmV0dHlfY29udHJhc3QgPSBjb250cmFzdCA/IGNvbnRyYXN0LnJlcGxhY2UoXCIgLyBcIiwgXCIgdnMuIFwiKSA6IFwiTm9uZSBzZWxlY3RlZFwiO1xuICBjb25zdCBjb3VudCA9IHZvbGNhbm8ubGVuZ3RoID8gdm9sY2Fuby5sZW5ndGgudG9Mb2NhbGVTdHJpbmcoKSA6IFwiMFwiO1xuXG4gIHJldHVybiBodG1sYFxuICA8ZGl2IHN0eWxlPVwiZm9udC1zaXplOiAwLjllbTsgY29sb3I6ICM0NDQ7XCI+XG4gICAgXG4gICAgPGg1IHN0eWxlPVwidGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsgY29sb3I6ICM4ODg7IGZvbnQtc2l6ZTogMC43NWVtOyBtYXJnaW4tdG9wOiAyMHB4OyBtYXJnaW4tYm90dG9tOiA0cHg7IGJvcmRlci10b3A6IDFweCBzb2xpZCAjZGRkOyBwYWRkaW5nLXRvcDogMTJweDtcIj5cbiAgICAgIFN0dWR5IERlc2NyaXB0aW9uXG4gICAgPC9oNT5cbiAgICA8cCBzdHlsZT1cIm1hcmdpbi1ib3R0b206IDE2cHg7IGZvbnQtd2VpZ2h0OiA1MDA7XCI+JHtyb3cuRGVzY3JpcHRpb24gfHwgXCJObyBkZXNjcmlwdGlvbiBhdmFpbGFibGUuXCJ9PC9wPlxuICAgIFxuICAgIDxoNSBzdHlsZT1cInRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7IGNvbG9yOiAjODg4OyBmb250LXNpemU6IDAuNzVlbTsgbWFyZ2luLXRvcDogMTVweDsgbWFyZ2luLWJvdHRvbTogOHB4OyBib3JkZXItdG9wOiAxcHggc29saWQgI2RkZDsgcGFkZGluZy10b3A6IDEycHg7XCI+XG4gICAgICBNb2RlbCBGb3JtdWxhXG4gICAgPC9oNT5cbiAgICA8ZGl2IHN0eWxlPVwiYmFja2dyb3VuZDogI2Y0ZjRmNDsgcGFkZGluZzogMTBweDsgYm9yZGVyLXJhZGl1czogNnB4OyBmb250LWZhbWlseTogbW9ub3NwYWNlOyBjb2xvcjogI2Q2MzM4NDsgZm9udC1zaXplOiAwLjllbTsgbWFyZ2luLWJvdHRvbTogMjBweDtcIj5cbiAgICAgICR7cm93LkZvcm1hbGEgfHwgXCJOQVwifVxuICAgIDwvZGl2PlxuICAgIFxuICAgIDxkaXYgc3R5bGU9XCJkaXNwbGF5OiBmbGV4OyBnYXA6IDIwcHg7IGJvcmRlci10b3A6IDFweCBzb2xpZCAjZGRkOyBwYWRkaW5nLXRvcDogMTVweDtcIj5cbiAgICAgIDxkaXYgc3R5bGU9XCJmbGV4OiAxO1wiPlxuICAgICAgICA8aDUgc3R5bGU9XCJ0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOyBjb2xvcjogIzg4ODsgZm9udC1zaXplOiAwLjc1ZW07IG1hcmdpbi1ib3R0b206IDRweDtcIj5DdXJyZW50IENvbnRyYXN0PC9oNT5cbiAgICAgICAgPGRpdiBzdHlsZT1cImZvbnQtd2VpZ2h0OiA2MDA7IGNvbG9yOiAjMDA3YmZmO1wiPiR7cHJldHR5X2NvbnRyYXN0fTwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgICA8ZGl2IHN0eWxlPVwiZmxleDogMCAwIDEwMHB4OyBib3JkZXItbGVmdDogMXB4IHNvbGlkICNkZGQ7IHBhZGRpbmctbGVmdDogMTVweDtcIj5cbiAgICAgICAgPGg1IHN0eWxlPVwidGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsgY29sb3I6ICM4ODg7IGZvbnQtc2l6ZTogMC43NWVtOyBtYXJnaW4tYm90dG9tOiA0cHg7XCI+VG90YWwgVGFyZ2V0czwvaDU+XG4gICAgICAgIDxkaXYgc3R5bGU9XCJmb250LXdlaWdodDogYm9sZDsgZm9udC1zaXplOiAxLjFlbTtcIj4ke2NvdW50fTwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gICAgXG4gICAgPGg1IHN0eWxlPVwidGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsgY29sb3I6ICM4ODg7IGZvbnQtc2l6ZTogMC43NWVtOyBtYXJnaW4tdG9wOiAyMHB4OyBtYXJnaW4tYm90dG9tOiA0cHg7IGJvcmRlci10b3A6IDFweCBzb2xpZCAjZGRkOyBwYWRkaW5nLXRvcDogMTJweDtcIj5cbiAgICA8L2g1PlxuICA8L2Rpdj5cbiAgYDtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ilxudmlld29mIG5ld196aXBfZmlsZSA9IElucHV0cy5maWxlKHtcbiAgbGFiZWw6IFwiSW1wb3J0IHRoZSBmb3JtYXR0ZWQgcmVzdWx0cyAoLnppcCk6XCIsXG4gIGFjY2VwdDogXCIuemlwXCIsXG4gIG11bHRpcGxlOiBmYWxzZVxufSlcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlxuLy8gMS4gRGVjbGFyZSB0aGUgY29udGFpbmVyIGFzIG11dGFibGVcbm11dGFibGUgbmV3X3ppcF9kYXRhID0gbnVsbDtcblxuLy8gMi4gVGhpcyBcIndhdGNoZXJcIiBjZWxsIGhhbmRsZXMgbWFudWFsIGZpbGUgdXBsb2Fkc1xue1xuICBpZiAobmV3X3ppcF9maWxlKSB7XG4gICAgY29uc3QgYnVmID0gYXdhaXQgbmV3X3ppcF9maWxlLmFycmF5QnVmZmVyKCk7XG4gICAgbXV0YWJsZSBuZXdfemlwX2RhdGEgPSB7XG4gICAgICBpZDogRGF0ZS5ub3coKSxcbiAgICAgIGZpbGVuYW1lOiBuZXdfemlwX2ZpbGUubmFtZSxcbiAgICAgIGRhdGE6IG5ldyBVaW50OEFycmF5KGJ1ZilcbiAgICB9O1xuICB9XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTgiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJcbm11dGFibGUgbGF0ZXN0X3VwbG9hZCA9IG51bGxcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtOSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ilxue1xuICBpZiAocHJvY2Vzc2VkX25ld19zdHVkeSkge1xuICAgIGNvbnN0IG5ld19yZWNvcmQgPSBKU09OLnBhcnNlKHByb2Nlc3NlZF9uZXdfc3R1ZHkpO1xuICAgIFxuICAgIGlmIChuZXdfcmVjb3JkICYmIG5ld19yZWNvcmQudmFsaWQpIHtcbiAgICAgIGNvbnN0IGV4aXN0cyA9IGF2YWlsYWJsZV9zdHVkaWVzLmZpbmQoZCA9PiBkLmlkID09PSBuZXdfcmVjb3JkLmlkKTtcbiAgICAgIFxuICAgICAgaWYgKCFleGlzdHMpIHtcbiAgICAgICAgIC8vIDEuIFVwZGF0ZSB0aGUgbGlzdFxuICAgICAgICAgbXV0YWJsZSBhdmFpbGFibGVfc3R1ZGllcy5wdXNoKG5ld19yZWNvcmQpO1xuICAgICAgICAgbXV0YWJsZSBhdmFpbGFibGVfc3R1ZGllcyA9IG11dGFibGUgYXZhaWxhYmxlX3N0dWRpZXM7XG4gICAgICAgICBcbiAgICAgICAgIG11dGFibGUgbGF0ZXN0X3VwbG9hZCA9IG5ld19yZWNvcmQ7IFxuICAgICAgfVxuICAgICAgY29uc29sZS5sb2coXCLinIUgTG9hZGVkOlwiLCBuZXdfcmVjb3JkLm5hbWUpO1xuICAgIH1cbiAgfVxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ilxuc3R1ZHlfZGF0YV9wYXlsb2FkID0ge1xuICBjb25zdCBzZWxlY3Rpb24gPSBzZWxlY3RlZF9zdHVkeTtcbiAgaWYgKCFzZWxlY3Rpb24pIHJldHVybiBudWxsO1xuXG4gIGNvbnNvbGUubG9nKFwi8J+UhCBQcm9jZXNzaW5nIHNlbGVjdGlvbjpcIiwgc2VsZWN0aW9uLm5hbWUpO1xuXG4gIGlmIChzZWxlY3Rpb24udHlwZSA9PT0gXCJsb2NhbFwiKSB7XG4gICAgY29uc29sZS5sb2coXCLwn5GJIE1vZGU6IExvY2FsXCIpO1xuICAgIHJldHVybiB7XG4gICAgICBtb2RlOiBcImxvY2FsXCIsXG4gICAgICAuLi5zZWxlY3Rpb25cbiAgICB9O1xuICB9XG5cbiAgaWYgKHNlbGVjdGlvbi50eXBlID09PSBcInJlbW90ZVwiKSB7XG4gICAgY29uc29sZS5sb2coXCLwn5GJIE1vZGU6IFJlbW90ZSAoSlMgQnJpZGdlKVwiKTtcbiAgICBcbiAgICB0cnkge1xuICAgICAgY29uc3QgY29ubiA9IGF3YWl0IGR1Y2tfZGJfY2xpZW50O1xuICAgICAgXG4gICAgICBjb25zdCBoZWFkZXJfdGFibGUgPSBhd2FpdCBjb25uLnF1ZXJ5KGBTRUxFQ1QgKiBGUk9NICcke3NlbGVjdGlvbi51cmxfaGVhZGVyfSdgKTtcbiAgICAgIFxuICAgICAgY29uc3QgaGVhZGVyX2pzb24gPSBoZWFkZXJfdGFibGUudG9BcnJheSgpLm1hcChyb3cgPT4gcm93LnRvSlNPTigpKTtcbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coXCLinIUgSGVhZGVyIHJlY2VpdmVkOlwiLCBoZWFkZXJfanNvbik7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIG1vZGU6IFwicmVtb3RlX2pzX2JyaWRnZVwiLFxuICAgICAgICBpZDogc2VsZWN0aW9uLmlkLFxuICAgICAgICBuYW1lOiBzZWxlY3Rpb24ubmFtZSxcbiAgICAgICAgaGVhZGVyX2RhdGE6IGhlYWRlcl9qc29uLFxuICAgICAgICB1cmxfcGFpcndpc2U6IHNlbGVjdGlvbi51cmxfcGFpcndpc2UsXG4gICAgICAgIHVybF9tZXRhOiBzZWxlY3Rpb24udXJsX21ldGEsXG4gICAgICAgIHVybF9lbW1lYW5zOiBzZWxlY3Rpb24udXJsX2VtbWVhbnMsXG4gICAgICAgIHVybF9vdmVybGFwOiBzZWxlY3Rpb24udXJsX292ZXJsYXBcbiAgICAgIH07XG4gICAgICBcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwi4p2MIEpTIEJyaWRnZSBFcnJvcjpcIiwgZSk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTEiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJcbmNvbnRyYXN0c19mcm9tX2pzID0ge1xuICBjb25zdCBwYXlsb2FkID0gc3R1ZHlfZGF0YV9wYXlsb2FkO1xuICAvLyBJZiBsb2NhbCwgbGV0IHdlYlIvUiBoYW5kbGUgdGhlIGNvbnRyYXN0IGxpc3QgdG8gYXZvaWQgcGF0aCBlcnJvcnNcbiAgaWYgKCFwYXlsb2FkIHx8IHBheWxvYWQudHlwZSA9PT0gXCJsb2NhbFwiKSByZXR1cm4gbnVsbDtcblxuICBpZiAocGF5bG9hZC5tb2RlID09PSBcInJlbW90ZV9qc19icmlkZ2VcIikge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjb25uID0gYXdhaXQgZHVja19kYl9jbGllbnQ7XG4gICAgICBjb25zdCB0YWJsZSA9IHBheWxvYWQuaXNBdG9NeCA/ICdwYWlyd2lzZV9oYXJtb25pemVkJyA6IGBcIiR7cGF5bG9hZC51cmxfcGFpcndpc2V9XCJgO1xuICAgICAgXG4gICAgICBjb25zdCBxdWVyeSA9IGBTRUxFQ1QgRElTVElOQ1QgXCJjb250cmFzdFwiIEZST00gJHt0YWJsZX0gT1JERVIgQlkgXCJjb250cmFzdFwiYDtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbm4ucXVlcnkocXVlcnkpO1xuICAgICAgcmV0dXJuIHJlc3VsdC50b0FycmF5KCkubWFwKHJvdyA9PiByb3cuY29udHJhc3QpLmZpbHRlcihkID0+ICFkLmluY2x1ZGVzKFwib3RoZXJjdF9leHByXCIpKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwi4p2MIENvbnRyYXN0IEZldGNoIEVycm9yOlwiLCBlKTtcbiAgICAgIHJldHVybiBbXTsgXG4gICAgfVxuICB9XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEyIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiXG50ZXJtc19mcm9tX2pzID0ge1xuICBjb25zdCBwYXlsb2FkID0gc3R1ZHlfZGF0YV9wYXlsb2FkO1xuICAvLyBHdWFyZCBhZ2FpbnN0IGxvY2FsIHN0dWRpZXMgdG8gYWxsb3cgUi1iYXNlZCB0ZXJtIHBvcHVsYXRpb25cbiAgaWYgKCFwYXlsb2FkIHx8IHBheWxvYWQudHlwZSA9PT0gXCJsb2NhbFwiKSByZXR1cm4gbnVsbDtcblxuICBpZiAocGF5bG9hZC5tb2RlID09PSBcInJlbW90ZV9qc19icmlkZ2VcIikge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjb25uID0gYXdhaXQgZHVja19kYl9jbGllbnQ7XG4gICAgICBjb25zdCB0YWJsZSA9IHBheWxvYWQuaXNBdG9NeCA/ICdwYWlyd2lzZV9oYXJtb25pemVkJyA6IGBcIiR7cGF5bG9hZC51cmxfcGFpcndpc2V9XCJgO1xuICAgICAgXG4gICAgICBjb25zdCBxdWVyeSA9IGBTRUxFQ1QgRElTVElOQ1QgXCJ0ZXJtXCIgRlJPTSAke3RhYmxlfSBPUkRFUiBCWSBcInRlcm1cImA7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb25uLnF1ZXJ5KHF1ZXJ5KTtcbiAgICAgIHJldHVybiByZXN1bHQudG9BcnJheSgpLm1hcChyb3cgPT4gcm93LnRlcm0pO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCLinYwgVGVybXMgRmV0Y2ggRXJyb3I6XCIsIGUpO1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgfVxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ilxuc2xpZGVzX2Zyb21fanMgPSB7XG4gIGNvbnN0IHBheWxvYWQgPSBzdHVkeV9kYXRhX3BheWxvYWQ7XG4gIC8vIElmIGxvY2FsLCByZXR1cm4gbnVsbCB0byBsZXQgUiBxdWVyeSB0aGUgbG9jYWwgY2VsbF9tZXRhIHRhYmxlXG4gIGlmICghcGF5bG9hZCB8fCBwYXlsb2FkLnR5cGUgPT09IFwibG9jYWxcIikgcmV0dXJuIG51bGw7XG5cbiAgaWYgKHBheWxvYWQubW9kZSA9PT0gXCJyZW1vdGVfanNfYnJpZGdlXCIpIHtcbiAgICBpZiAocGF5bG9hZC5pc0F0b014KSByZXR1cm4gWzFdOyBcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBjb25uID0gYXdhaXQgZHVja19kYl9jbGllbnQ7XG4gICAgICBjb25zdCBxdWVyeSA9IGBTRUxFQ1QgRElTVElOQ1QgXCJzbGlkZV9pZF9udW1lcmljXCIgRlJPTSBcIiR7cGF5bG9hZC51cmxfbWV0YX1cIiBPUkRFUiBCWSBcInNsaWRlX2lkX251bWVyaWNcImA7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb25uLnF1ZXJ5KHF1ZXJ5KTtcbiAgICAgIGNvbnN0IGxpc3QgPSByZXN1bHQudG9BcnJheSgpLm1hcChyb3cgPT4gcm93LnNsaWRlX2lkX251bWVyaWMpO1xuICAgICAgcmV0dXJuIGxpc3QubGVuZ3RoID4gMCA/IGxpc3QgOiBbMV07XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgcmV0dXJuIFsxXTtcbiAgICB9XG4gIH1cbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJcbnZpZXdvZiBhZXN0aGV0aWNzX3JhdyA9IElucHV0cy5mb3JtKHtcbiAgdm9sY2Fub19mY19yYW5nZTogICAgICBJbnB1dHMucmFuZ2UoWzAsIDEwXSwge3N0ZXA6IDAuMDAxLCBsYWJlbDogXCJBYnMuIGxvZzJGQ1wiLCB2YWx1ZTogMX0pLFxuICB2b2xjYW5vX3B2YWxfdGhyZXNob2xkOiBJbnB1dHMucmFuZ2UoWzAsIDFdLCB7c3RlcDogMC4wMDAwMSwgbGFiZWw6IFwiUC12YWx1ZSB0aHJlc2hvbGRcIiwgdmFsdWU6IDAuMDV9KSxcbiAgdm9sY2Fub19wdF9zaXplOiAgICAgICBJbnB1dHMucmFuZ2UoWzAuMSwgNV0sIHtzdGVwOiAwLjEsIGxhYmVsOiBcIlB0LiBTaXplXCJ9KSxcbiAgdm9sY2Fub19hbHBoYTogICAgICAgICBJbnB1dHMucmFuZ2UoWzAsIDFdLCB7c3RlcDogMC4wMSwgbGFiZWw6IFwiUHQuIEFscGhhXCIsIHZhbHVlOiAxLjB9KSxcbiAgXG4gIHZvbGNhbm9fcHRfY29sb3I6ICAgICAgSW5wdXRzLmNvbG9yKHtsYWJlbDogXCJQdC4gQ29sb3JcIiwgdmFsdWU6IFwiIzNDM0Y0MFwifSksXG4gIHZvbGNhbm9fc2lnX2NvbG9yOiAgICAgSW5wdXRzLmNvbG9yKHtsYWJlbDogXCJTaWduaWZpY2FudCB0YXJnZXRzXCIsIHZhbHVlOiBcIiNiNDQ2OTdcIn0pLFxuICBcbiAgdm9sY2Fub19oaWdoX2ZjX2xhYmVsOiBJbnB1dHMucmFuZ2UoWzAsIDEwXSwge3N0ZXA6IDEsIGxhYmVsOiBcIkxhYmVsIGhpZ2ggRkNcIiwgdmFsdWU6IDN9KSxcbiAgdm9sY2Fub19sb3dfZmNfbGFiZWw6ICBJbnB1dHMucmFuZ2UoWzAsIDEwXSwge3N0ZXA6IDEsIGxhYmVsOiBcIkxhYmVsIGxvdyBGQ1wiLCB2YWx1ZTogM30pLFxuICB2b2xjYW5vX3B2YWxfbGFiZWw6ICAgIElucHV0cy5yYW5nZShbMCwgMTBdLCB7c3RlcDogMSwgbGFiZWw6IFwiTGFiZWwgU2lnLlwiLCB2YWx1ZTogM30pLFxuICB2b2xjYW5vX2luY2x1ZGVfc2VsZWN0ZWRfZ2VuZXM6IElucHV0cy5yYWRpbyhbXCJZZXNcIiwgXCJOb1wiXSwge2xhYmVsOiBcIkxhYmVsIHNlbGVjdGVkP1wiLCB2YWx1ZTogXCJZZXNcIn0pXG59KVxuXG5hZXN0aGV0aWNzX2RlYm91bmNlZCA9IHtcbiAgY29uc3QgcmF3ID0gYWVzdGhldGljc19yYXc7XG4gIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcbiAgICBjb25zdCB0aW1lciA9IHNldFRpbWVvdXQoKCkgPT4gcmVzb2x2ZShyYXcpLCA2MDApOyBcbiAgICBpbnZhbGlkYXRpb24udGhlbigoKSA9PiBjbGVhclRpbWVvdXQodGltZXIpKTtcbiAgfSk7XG59XG5cblxuYWVzdGhldGljcyA9IGFlc3RoZXRpY3NfZGVib3VuY2VkXG5cbnZvbGNhbm9fZmNfcmFuZ2UgICAgICAgICAgICAgICA9IGFlc3RoZXRpY3Mudm9sY2Fub19mY19yYW5nZVxudm9sY2Fub19wdmFsX3RocmVzaG9sZCAgICAgICAgID0gYWVzdGhldGljcy52b2xjYW5vX3B2YWxfdGhyZXNob2xkXG52b2xjYW5vX3B0X3NpemUgICAgICAgICAgICAgICAgPSBhZXN0aGV0aWNzLnZvbGNhbm9fcHRfc2l6ZVxudm9sY2Fub19hbHBoYSAgICAgICAgICAgICAgICAgID0gYWVzdGhldGljcy52b2xjYW5vX2FscGhhXG52b2xjYW5vX3B0X2NvbG9yICAgICAgICAgICAgICAgPSBhZXN0aGV0aWNzLnZvbGNhbm9fcHRfY29sb3JcbnZvbGNhbm9fc2lnX2NvbG9yICAgICAgICAgICAgICA9IGFlc3RoZXRpY3Mudm9sY2Fub19zaWdfY29sb3JcbnZvbGNhbm9faGlnaF9mY19sYWJlbCAgICAgICAgICA9IGFlc3RoZXRpY3Mudm9sY2Fub19oaWdoX2ZjX2xhYmVsXG52b2xjYW5vX2xvd19mY19sYWJlbCAgICAgICAgICAgPSBhZXN0aGV0aWNzLnZvbGNhbm9fbG93X2ZjX2xhYmVsXG52b2xjYW5vX3B2YWxfbGFiZWwgICAgICAgICAgICAgPSBhZXN0aGV0aWNzLnZvbGNhbm9fcHZhbF9sYWJlbFxudm9sY2Fub19pbmNsdWRlX3NlbGVjdGVkX2dlbmVzID0gYWVzdGhldGljcy52b2xjYW5vX2luY2x1ZGVfc2VsZWN0ZWRfZ2VuZXNcblxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ilxudm9sY2Fub19kYXRhX2pzID0ge1xuICBjb25zdCBwYXlsb2FkID0gc3R1ZHlfZGF0YV9wYXlsb2FkO1xuICBjb25zdCBjb250cmFzdCA9IGNvbnRyYXN0X3NlbGVjdGlvbjtcbiAgY29uc3QgdGVybSA9IHRlcm1fc2VsZWN0aW9uO1xuICBcbiAgLy8gMS4gRE9OVCBQUk9DRUVEIGlmIGVzc2VudGlhbCBzZWxlY3Rpb25zIGFyZSBtaXNzaW5nXG4gIGlmICghcGF5bG9hZCB8fCAhY29udHJhc3QgfHwgIXRlcm0gfHwgcGF5bG9hZC5tb2RlID09PSBcImxvY2FsXCIpIHJldHVybiBudWxsO1xuXG4gIGlmIChwYXlsb2FkLm1vZGUgPT09IFwicmVtb3RlX2pzX2JyaWRnZVwiKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGNvbm4gPSBhd2FpdCBkdWNrX2RiX2NsaWVudDtcbiAgICAgIGNvbnN0IHRhYmxlU291cmNlID0gcGF5bG9hZC5pc0F0b014ID8gYHBhaXJ3aXNlX2hhcm1vbml6ZWRgIDogYFwiJHtwYXlsb2FkLnVybF9wYWlyd2lzZX1cImA7XG5cbiAgICAgIC8vIDIuIENIRUNLIElGIFZJRVcgRVhJU1RTIChGb3IgQXRvTXgpXG4gICAgICBpZiAocGF5bG9hZC5pc0F0b014KSB7XG4gICAgICAgICBjb25zdCB2aWV3Q2hlY2sgPSBhd2FpdCBjb25uLnF1ZXJ5KGBTRUxFQ1QgY291bnQoKikgYXMgbiBGUk9NICR7dGFibGVTb3VyY2V9YCk7XG4gICAgICAgICBpZiAodmlld0NoZWNrLnRvQXJyYXkoKVswXS5uID09PSAwKSByZXR1cm4gbnVsbDsgLy8gV2FpdCBmb3IgZGF0YVxuICAgICAgfVxuXG4gICAgICBjb25zdCBxdWVyeSA9IGBcbiAgICAgICAgU0VMRUNUIHRlcm0sIGNvbnRyYXN0LCB0YXJnZXQsIGxvZzJmYywgXCJwLnZhbHVlXCIsIG5jZWxsc18xLCBuY2VsbHNfMlxuICAgICAgICBGUk9NICR7dGFibGVTb3VyY2V9XG4gICAgICAgIFdIRVJFIGNvbnRyYXN0ID0gJyR7Y29udHJhc3R9JyBBTkQgdGVybSA9ICcke3Rlcm19J1xuICAgICAgYDtcbiAgICAgIFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29ubi5xdWVyeShxdWVyeSk7XG4gICAgICBjb25zdCBkYXRhID0gcmVzdWx0LnRvQXJyYXkoKS5tYXAocm93ID0+IHJvdy50b0pTT04oKSk7XG4gICAgICBcbiAgICAgIC8vIDMuIE9OTFkgUkVUVVJOIElGIFdFIEhBVkUgREFUQVxuICAgICAgaWYgKGRhdGEubGVuZ3RoID09PSAwKSByZXR1cm4gbnVsbDsgXG5cbiAgICAgIGNvbnNvbGUubG9nKGDinIUgUGFpcndpc2UgZGF0YSBmZXRjaGVkIGZyb20gJHt0YWJsZVNvdXJjZX0gKCR7ZGF0YS5sZW5ndGh9IHJvd3MpYCk7XG4gICAgICByZXR1cm4gZGF0YTtcbiAgICAgIFxuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCLinYwgRmFpbGVkIHRvIGZldGNoIHBhaXJ3aXNlIGRhdGE6XCIsIGUpO1xuICAgICAgcmV0dXJuIG51bGw7IC8vIFJldHVybiBudWxsIHNvIHdlYlIgZG9lc24ndCB0cnkgdG8gcHJvY2VzcyBhbiBlcnJvclxuICAgIH1cbiAgfVxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiBwYWlyd2lzZV9zZWFyY2ggPSBJbnB1dHMuc2VhcmNoKGN1cnJlbnRfdm9sY2Fub19kYXRhLCB7cGxhY2Vob2xkZXI6IFwiU2VhcmNoIFJlc3VsdHNcIn0pXG5cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJcbnZpZXdvZiBwYWlyd2lzZV90YWJsZSA9IElucHV0cy50YWJsZShwYWlyd2lzZV9zZWFyY2gsIHtcbiAgbXVsdGlwbGU6IHRydWUsXG4gIHJvd3M6IDIwLFxuICBmb3JtYXQ6IHtcbiAgICBsb2cyZmM6IHNwYXJrYmFyKGQzLm1heChwYWlyd2lzZV9zZWFyY2gsIGQgPT4gZC5sb2cyZmMpKVxuICB9fSlcblxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xOCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlxuLy8gY2FwdHVyZXMgYW55IHNlbGVjdGVkIGdlbmVzICh1cCB0byAzMClcbnNlbGVjdGVkX2dlbmVzID0ge1xuICBpZiAoIWN1cnJlbnRfdm9sY2Fub19kYXRhIHx8ICFwYWlyd2lzZV90YWJsZSkgcmV0dXJuIFsnbm90YWdlbmUnXTtcbiAgaWYgKHBhaXJ3aXNlX3RhYmxlLmxlbmd0aCA9PT0gY3VycmVudF92b2xjYW5vX2RhdGEpIHtcbiAgICByZXR1cm4gWydub3RhZ2VuZSddO1xuICB9XG4gIGlmIChwYWlyd2lzZV90YWJsZS5sZW5ndGggPiAzMCkge1xuICAgIHJldHVybiBbJ25vdGFnZW5lJ107XG4gIH1cbiAgcmV0dXJuIHBhaXJ3aXNlX3RhYmxlLm1hcChkID0+IGQudGFyZ2V0KTtcbn1cblxuc2VsZWN0aW9uV2FybmluZyA9IHtcbiAgLy8gMS4gV2FpdCBmb3IgZGF0YVxuICBpZiAoIXBhaXJ3aXNlX3RhYmxlIHx8ICFjdXJyZW50X3ZvbGNhbm9fZGF0YSkgcmV0dXJuIGBTZWxlY3QgYmV0d2VlbiAxIGFuZCAzMCBnZW5lcyB0byBsYWJlbC5gO1xuXG4gIGNvbnN0IGNvdW50ID0gcGFpcndpc2VfdGFibGUubGVuZ3RoO1xuICBjb25zdCB0b3RhbCA9IGN1cnJlbnRfdm9sY2Fub19kYXRhLmxlbmd0aDtcbiAgY29uc3QgaXNTZWxlY3RBbGwgPSAoY291bnQgPT09IHRvdGFsKTtcblxuICBpZihpc1NlbGVjdEFsbCl7XG4gICAgcmV0dXJuIGBTZWxlY3QgdXAgdG8gMzAgZ2VuZXMgdG8gbGFiZWwgaW4gdGhlIHZvbGNhbm8gcGxvdC5gO1xuICB9XG4gIGlmIChjb3VudCA+IDMwKSB7XG4gICAgcmV0dXJuIGDimqDvuI8gVG9vIG1hbnkgdGFyZ2V0cyBzZWxlY3RlZCAoJHtjb3VudH0pLiBMaW1pdCBpcyAzMC5gO1xuICB9XG5cbiAgcmV0dXJuIGBDdXJyZW50bHkgc2VsZWN0ZWQ6ICR7Y291bnR9IGdlbmUke2NvdW50ID09PSAxID8gJycgOiAncyd9LmA7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE5IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiXG4vLyBtdXN0IG9jY3VyIGJlZm9yZSB2b2xjYW5vIHBsb3QgY2FyZFxudmlld29mIHRlcm1fc2VsZWN0aW9uID0ge1xuICBpZiAoIWF2YWlsYWJsZV90ZXJtcyB8fCBhdmFpbGFibGVfdGVybXMubGVuZ3RoID09PSAwKSByZXR1cm4gbWRgX0xvYWRpbmcgdGVybXMuLi5fYDtcblxuICByZXR1cm4gSW5wdXRzLnNlbGVjdChhdmFpbGFibGVfdGVybXMsIHtcbiAgICBsYWJlbDogXCJBdmFpbGFibGUgVGVybXM6XCIsXG4gICAgbXVsdGlwbGU6IGZhbHNlLFxuICAgIHNpemU6IDNcbiAgfSk7XG59XG52aWV3b2YgY29udHJhc3Rfc2VsZWN0aW9uID0ge1xuICBpZiAoIWF2YWlsYWJsZV9jb250cmFzdHMgfHwgYXZhaWxhYmxlX2NvbnRyYXN0cy5sZW5ndGggPT09IDApIHJldHVybiBtZGBfTG9hZGluZyBjb250cmFzdHMuLi5fYDtcblxuICByZXR1cm4gSW5wdXRzLnNlbGVjdChhdmFpbGFibGVfY29udHJhc3RzLCB7XG4gICAgbGFiZWw6IFwiQXZhaWxhYmxlIENvbnRyYXN0czpcIixcbiAgICBmb3JtYXQ6IGQgPT4gZC5yZXBsYWNlKFwiIC8gXCIsIFwiIHZzLiBcIiksXG4gICAgbXVsdGlwbGU6IGZhbHNlLFxuICAgIHNpemU6IDNcbiAgfSk7XG59XG5cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2aWV3b2Ygc2F2ZV9zZXR0aW5ncyA9IElucHV0cy5mb3JtKHtcbiAgd2lkdGg6ICBJbnB1dHMubnVtYmVyKHtsYWJlbDogXCJXaWR0aFwiLCB2YWx1ZTogNiwgc3RlcDogMC41fSksXG4gIGhlaWdodDogSW5wdXRzLm51bWJlcih7bGFiZWw6IFwiSGVpZ2h0XCIsIHZhbHVlOiA0LCBzdGVwOiAwLjV9KSxcbiAgdW5pdHM6ICBJbnB1dHMuc2VsZWN0KFtcImluXCIsIFwiY21cIiwgXCJtbVwiLCBcInB4XCJdLCB7bGFiZWw6IFwiVW5pdHNcIiwgdmFsdWU6IFwiaW5cIn0pLFxuICBmb3JtYXQ6IElucHV0cy5zZWxlY3QoW1wicG5nXCIsIFwic3ZnXCJdLCB7bGFiZWw6IFwiRm9ybWF0XCIsIHZhbHVlOiBcInBuZ1wifSlcbn0pXG52aWV3b2Ygc2F2ZV9idG4gPSBJbnB1dHMuYnV0dG9uKFwiRG93bmxvYWQgUGxvdFwiLCB7dmFsdWU6IDAsIGNvbG9yOiBcIiMyQzNFNTBcIn0pXG5zYXZlX3JlcXVlc3QgPSB7XG4gIHNhdmVfYnRuOyBcbiAgcmV0dXJuIHNhdmVfc2V0dGluZ3M7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTIxIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoie1xuICBpZiAoZG93bmxvYWRlZF9maWxlKSB7XG4gICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFtuZXcgVWludDhBcnJheShkb3dubG9hZGVkX2ZpbGUuZGF0YSldLCB7IHR5cGU6IGRvd25sb2FkZWRfZmlsZS5taW1lIH0pO1xuICAgIFxuICAgIGNvbnN0IHVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7XG4gICAgY29uc3QgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpO1xuICAgIGEuaHJlZiA9IHVybDtcbiAgICBhLmRvd25sb2FkID0gZG93bmxvYWRlZF9maWxlLmZpbGVuYW1lO1xuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoYSk7XG4gICAgYS5jbGljaygpO1xuICAgIFxuICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoYSk7XG4gICAgVVJMLnJldm9rZU9iamVjdFVSTCh1cmwpO1xuICB9XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTIyIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiXG5hdmFpbGFibGVfbGV2ZWxzID0ge1xuICBjb25zdCBwYXlsb2FkID0gc3R1ZHlfZGF0YV9wYXlsb2FkO1xuICAvLyBQcmV2ZW50cyBPSlMgZnJvbSBjcmFzaGluZyBvbiBsb2NhbCBWRlMgcGF0aHNcbiAgaWYgKCFwYXlsb2FkIHx8IHBheWxvYWQudHlwZSA9PT0gXCJsb2NhbFwiKSByZXR1cm4gbnVsbDtcbiAgXG4gIGlmIChwYXlsb2FkLm1vZGUgPT09IFwicmVtb3RlX2pzX2JyaWRnZVwiKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGNvbm4gPSBhd2FpdCBkdWNrX2RiX2NsaWVudDtcbiAgICAgIGNvbnN0IHF1ZXJ5ID0gYFNFTEVDVCBESVNUSU5DVCBsZXZlbCBGUk9NICcke3BheWxvYWQudXJsX2VtbWVhbnN9JyBPUkRFUiBCWSBsZXZlbGA7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb25uLnF1ZXJ5KHF1ZXJ5KTtcbiAgICAgIHJldHVybiByZXN1bHQudG9BcnJheSgpLm1hcChyb3cgPT4gcm93LmxldmVsKS5maWx0ZXIodCA9PiAhdC5zdGFydHNXaXRoKFwib3RoZXJjdF9cIikpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCLinYwgQXZhaWxhYmxlIExldmVscyBGZXRjaCBFcnJvcjpcIiwgZSk7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICB9XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTIzIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiXG52aWV3b2YgdGVybV9jb3B5ID0ge1xuICBcbiAgaWYgKCFhdmFpbGFibGVfdGVybXMgfHwgYXZhaWxhYmxlX3Rlcm1zLmxlbmd0aCA9PT0gMCkgcmV0dXJuIG1kYF9Mb2FkaW5nLi4uX2A7XG5cbiAgY29uc3QgbWlycm9yX2lucHV0ID0gSW5wdXRzLnNlbGVjdChhdmFpbGFibGVfdGVybXMsIHtcbiAgICBsYWJlbDogXCJBdmFpbGFibGUgVGVybXM6XCIsXG4gICAgbXVsdGlwbGU6IGZhbHNlLFxuICAgIHNpemU6IDNcbiAgfSk7XG5cbiAgcmV0dXJuIElucHV0cy5iaW5kKG1pcnJvcl9pbnB1dCwgdmlld29mIHRlcm1fc2VsZWN0aW9uKTtcbn1cblxudmlld29mIGNvbnRyYXN0X2NvcHkgPSB7XG5cbiAgaWYgKCFhdmFpbGFibGVfY29udHJhc3RzIHx8IGF2YWlsYWJsZV9jb250cmFzdHMubGVuZ3RoID09PSAwKSByZXR1cm4gbWRgX0xvYWRpbmcuLi5fYDtcblxuICBjb25zdCBtaXJyb3JfaW5wdXQgPSBJbnB1dHMuc2VsZWN0KGF2YWlsYWJsZV9jb250cmFzdHMsIHtcbiAgICBsYWJlbDogXCJBdmFpbGFibGUgQ29udHJhc3RzOlwiLFxuICAgIGZvcm1hdDogZCA9PiBkLnJlcGxhY2UoXCIgLyBcIiwgXCIgdnMuIFwiKSxcbiAgICBtdWx0aXBsZTogZmFsc2UsXG4gICAgc2l6ZTogM1xuICB9KTtcblxuICByZXR1cm4gSW5wdXRzLmJpbmQobWlycm9yX2lucHV0LCB2aWV3b2YgY29udHJhc3Rfc2VsZWN0aW9uKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJcbnZpZXdvZiBtZWFuc19yYXcgPSBJbnB1dHMuZm9ybSh7XG4gIG1lYW5zX2hpZ2hsaWdodDogSW5wdXRzLnRleHQoe2xhYmVsOiBcIkhpZ2hsaWdodCBUYXJnZXQ6XCIsIHBsYWNlaG9sZGVyOiBcImUuZy4gQTFCRyxBMUNGXCJ9KSxcbiAgbWVhbnNfc2hvd19sYWJlbGVkOiAgICAgICBJbnB1dHMudG9nZ2xlKHtsYWJlbDogXCJBbHNvIGhpZ2hsaWdodCBWb2xjYW5vLWxhYmVsZWQgR2VuZXNcIiwgdmFsdWU6IHRydWV9KSxcbiAgbWVhbnNfYWxwaGE6IElucHV0cy5yYW5nZShbMC4xLCAxXSwge3ZhbHVlOiAwLjgsIHN0ZXA6IDAuMSwgbGFiZWw6IFwiRG90IFRyYW5zcGFyZW5jeVwifSksXG4gIG1lYW5zX2NvbG9yXzE6IElucHV0cy5jb2xvcih7bGFiZWw6IFwiTGV2ZWwgMSBDb2xvclwiLCB2YWx1ZTogXCIjZTE1NzU5XCJ9KSxcbiAgbWVhbnNfY29sb3JfMjogSW5wdXRzLmNvbG9yKHtsYWJlbDogXCJMZXZlbCAyIENvbG9yXCIsIHZhbHVlOiBcIiM0ZTc5YTdcIn0pXG59KVxuXG5tZWFuc19kZWJvdW5jZWQgPSB7XG4gIGNvbnN0IHJhdyA9IG1lYW5zX3JhdztcbiAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgIGNvbnN0IHRpbWVyID0gc2V0VGltZW91dCgoKSA9PiByZXNvbHZlKHJhdyksIDYwMCk7IFxuICAgIGludmFsaWRhdGlvbi50aGVuKCgpID0+IGNsZWFyVGltZW91dCh0aW1lcikpO1xuICB9KTtcbn1cblxubWVhbnNfaGlnaGxpZ2h0ICAgICAgID0gbWVhbnNfZGVib3VuY2VkLm1lYW5zX2hpZ2hsaWdodFxubWVhbnNfc2hvd19sYWJlbGVkICAgID0gbWVhbnNfZGVib3VuY2VkLm1lYW5zX3Nob3dfbGFiZWxlZFxubWVhbnNfYWxwaGEgICAgICAgICAgID0gbWVhbnNfZGVib3VuY2VkLm1lYW5zX2FscGhhXG5tZWFuc19jb2xvcl8xICAgICAgICAgPSBtZWFuc19kZWJvdW5jZWQubWVhbnNfY29sb3JfMVxubWVhbnNfY29sb3JfMiAgICAgICAgID0gbWVhbnNfZGVib3VuY2VkLm1lYW5zX2NvbG9yXzJcblxuY29tYmluZWRfc2VsZWN0aW9uID0ge1xuXG4gIGNvbnN0IG1hbnVhbCA9IG1lYW5zX2hpZ2hsaWdodCBcbiAgICA/IG1lYW5zX2hpZ2hsaWdodC50b1VwcGVyQ2FzZSgpLnNwbGl0KCcsJykubWFwKHMgPT4gcy50cmltKCkpLmZpbHRlcihzID0+IHMubGVuZ3RoID4gMCkgXG4gICAgOiBbXTtcbiAgICBcbiAgbGV0IGZyb21fdm9sY2FubyA9IFtdO1xuICBpZiAobWVhbnNfc2hvd19sYWJlbGVkICYmIHR5cGVvZiB2cGxvdF9sYWJlbHMgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgIGlmKEFycmF5LmlzQXJyYXkodnBsb3RfbGFiZWxzKSkge1xuICAgICAgICBmcm9tX3ZvbGNhbm8gPSB2cGxvdF9sYWJlbHM7XG4gICAgICB9IGVsc2UgaWYgKHR5cGVvZiB2cGxvdF9sYWJlbHMgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIGZyb21fdm9sY2FubyA9IFt2cGxvdF9sYWJlbHNdO1xuICAgICAgfVxuICB9XG4gIFxuICByZXR1cm4gQXJyYXkuZnJvbShuZXcgU2V0KFsuLi5tYW51YWwsIC4uLmZyb21fdm9sY2Fub10pKTtcbn1cbm1lYW5zX2xldmVsID0ge1xuICBjb25zdCBjb250cmFzdCA9IGNvbnRyYXN0X3NlbGVjdGlvbjtcbiAgaWYgKCFjb250cmFzdCkgcmV0dXJuIFtdO1xuXG4gIHJldHVybiBjb250cmFzdC5zcGxpdCgvXFwvfHZzXFwuLykubWFwKHMgPT4gcy50cmltKCkpO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yNSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ilxue1xuXG4gIGlmICghbWVhbnNfc2VhcmNoIHx8IG1lYW5zX3NlYXJjaC5sZW5ndGggPT09IDApIHtcbiAgICB5aWVsZCBodG1sYDxkaXYgc3R5bGU9XCJoZWlnaHQ6NDAwcHg7IGRpc3BsYXk6ZmxleDsgYWxpZ24taXRlbXM6Y2VudGVyOyBqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyOyBiYWNrZ3JvdW5kOiNmOWY5Zjk7IGJvcmRlcjoxcHggYm9yZGVyLXJhZGl1czo4cHg7XCI+XG4gICAgICA8cCBzdHlsZT1cImNvbG9yOiM4ODg7XCI+U2VsZWN0IGxldmVscyBpbiB0aGUgc2lkZWJhciB0byB2aXN1YWxpemUuLi48L3A+XG4gICAgPC9kaXY+YDtcbiAgfSBlbHNlIHtcblxuICAgIGNvbnN0IGNvbG9yU2NhbGUgPSBkMy5zY2hlbWVUYWJsZWF1MTA7XG4gICAgXG4gICAgbGV0IHRhYmxlX3RhcmdldHMgPSBbXTtcbiAgICBcbiAgICBpZiAodHlwZW9mIG1lYW5zX3RhYmxlICE9PSBcInVuZGVmaW5lZFwiICYmIG1lYW5zX3RhYmxlICYmIG1lYW5zX3NlYXJjaCkge1xuICAgICAgICBpZiAobWVhbnNfdGFibGUubGVuZ3RoICE9PSBtZWFuc19zZWFyY2gubGVuZ3RoKSB7XG4gICAgICAgICAgdGFibGVfdGFyZ2V0cyA9IG1lYW5zX3RhYmxlLm1hcChkID0+IGQudGFyZ2V0KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBcbiAgICBjb25zdCBtYW51YWxfdGFyZ2V0cyA9IGNvbWJpbmVkX3NlbGVjdGlvbiB8fCBbXTtcbiAgICBcbiAgICBjb25zdCBoaWdobGlnaHRfbGlzdCA9IEFycmF5LmZyb20obmV3IFNldChbLi4udGFibGVfdGFyZ2V0cywgLi4ubWFudWFsX3RhcmdldHNdKSk7XG4gICAgXG4gICAgY29uc3QgdGFyZ2V0R3JvdXBzID0gZDMuZ3JvdXBzKG1lYW5zX3NlYXJjaCwgZCA9PiBkLnRhcmdldCk7XG4gICAgXG4gICAgY29uc3QgbGV2ZWxzID0gWy4uLm5ldyBTZXQobWVhbnNfc2VhcmNoLm1hcChkID0+IGQubGV2ZWwpKV0uc29ydCgpO1xuXG4gICAgY29uc3QgdHJhY2VzID0gW107XG5cbiAgICBjb25zdCBhbHBoYV9zY2FsZXIgPSBtZWFuc19hbHBoYTtcbiAgICBjb25zdCBsaW5lX3NlZ21lbnRzX2hpZ2ggPSB7IHg6IFtdLCB5OiBbXSwgaG92ZXJpbmZvOiAnc2tpcCcsIHNob3dsZWdlbmQ6IGZhbHNlLCBtb2RlOiAnbGluZXMnLCBsaW5lOiB7Y29sb3I6ICcjODg4Jywgd2lkdGg6IDEuNX0sIG9wYWNpdHk6IDAuOCAqIGFscGhhX3NjYWxlciwgdHlwZTogJ3NjYXR0ZXInIH07IFxuICAgIGNvbnN0IGxpbmVfc2VnbWVudHNfbWVkICA9IHsgeDogW10sIHk6IFtdLCBob3ZlcmluZm86ICdza2lwJywgc2hvd2xlZ2VuZDogZmFsc2UsIG1vZGU6ICdsaW5lcycsIGxpbmU6IHtjb2xvcjogJyM4ODgnLCB3aWR0aDogMX0sIG9wYWNpdHk6IDAuNCAqIGFscGhhX3NjYWxlciwgdHlwZTogJ3NjYXR0ZXInIH07XG4gICAgY29uc3QgbGluZV9zZWdtZW50c19sb3cgID0geyB4OiBbXSwgeTogW10sIGhvdmVyaW5mbzogJ3NraXAnLCBzaG93bGVnZW5kOiBmYWxzZSwgbW9kZTogJ2xpbmVzJywgbGluZToge2NvbG9yOiAnI2NjYycsIHdpZHRoOiAxfSwgb3BhY2l0eTogMC4zICogYWxwaGFfc2NhbGVyLCB0eXBlOiAnc2NhdHRlcicgfTtcblxuICAgIHRhcmdldEdyb3Vwcy5mb3JFYWNoKChbdGFyZ2V0LCB2YWx1ZXNdKSA9PiB7XG4gICAgICBpZih2YWx1ZXMubGVuZ3RoIDwgMikgcmV0dXJuO1xuICAgICAgXG4gICAgICBjb25zdCB2MSA9IHZhbHVlc1swXTtcbiAgICAgIGNvbnN0IHggPSB2MS5sb2cyZmM7XG4gICAgICBpZih4ID09IG51bGwgfHwgaXNOYU4oeCkpIHJldHVybjtcblxuICAgICAgLy8gVHJhbnNmb3JtIFJlc3BvbnNlIHRvIExvZzIgZm9yIFktYXhpc1xuICAgICAgY29uc3QgeXMgPSB2YWx1ZXMubWFwKGQgPT4gTWF0aC5sb2cyKGQucmVzcG9uc2UpKTsgXG4gICAgICBcbiAgICAgIGNvbnN0IG1pbl95ID0gTWF0aC5taW4oLi4ueXMpO1xuICAgICAgY29uc3QgbWF4X3kgPSBNYXRoLm1heCguLi55cyk7XG4gICAgICBcbiAgICAgIGNvbnN0IHZhbF9wID0gdjFbXCJwLnZhbHVlXCJdO1xuICAgICAgY29uc3QgcCA9IHZhbF9wICE9IG51bGwgPyB2YWxfcCA6IDE7XG4gICAgICBcbiAgICAgIGxldCBzZWcgPSBsaW5lX3NlZ21lbnRzX2xvdztcbiAgICAgIGlmKHAgPCAwLjAwMSkgc2VnID0gbGluZV9zZWdtZW50c19oaWdoO1xuICAgICAgZWxzZSBpZihwIDwgMC4wNSkgc2VnID0gbGluZV9zZWdtZW50c19tZWQ7XG4gICAgICBcbiAgICAgIHNlZy54LnB1c2goeCwgeCwgbnVsbCk7XG4gICAgICBzZWcueS5wdXNoKG1pbl95LCBtYXhfeSwgbnVsbCk7XG4gICAgfSk7XG5cbiAgICB0cmFjZXMucHVzaChsaW5lX3NlZ21lbnRzX2xvdywgbGluZV9zZWdtZW50c19tZWQsIGxpbmVfc2VnbWVudHNfaGlnaCk7XG5cbiAgICBsZXZlbHMuZm9yRWFjaCgobHZsLCBpKSA9PiB7XG4gICAgICAgIGNvbnN0IGNvbG9yID0gKGkgPT09IDApID8gbWVhbnNfY29sb3JfMSA6IG1lYW5zX2NvbG9yXzI7IFxuICAgICAgICBcbiAgICAgICAgY29uc3QgbHZsX3RyYWNlID0ge1xuICAgICAgICAgIHg6IFtdLCB5OiBbXSwgdGV4dDogW10sIGlkczogW10sXG4gICAgICAgICAgbW9kZTogJ21hcmtlcnMnLFxuICAgICAgICAgIHR5cGU6ICdzY2F0dGVyJyxcbiAgICAgICAgICBuYW1lOiBsdmwsIFxuICAgICAgICAgIG1hcmtlcjogeyBjb2xvcjogY29sb3IsIHNpemU6IDYsIG9wYWNpdHk6IG1lYW5zX2FscGhhIH0sXG4gICAgICAgICAgZXJyb3JfeToge1xuICAgICAgICAgICAgdHlwZTogJ2RhdGEnLCBzeW1tZXRyaWM6IGZhbHNlLCBhcnJheTogW10sIGFycmF5bWludXM6IFtdLFxuICAgICAgICAgICAgdmlzaWJsZTogdHJ1ZSwgY29sb3I6IGNvbG9yLCB0aGlja25lc3M6IDEsIHdpZHRoOiAyLCBvcGFjaXR5OiAwLjZcbiAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgbHZsRGF0YSA9IG1lYW5zX3NlYXJjaC5maWx0ZXIoZCA9PiBkLmxldmVsID09PSBsdmwpO1xuICAgICAgICBcbiAgICAgICAgbHZsRGF0YS5mb3JFYWNoKGQgPT4ge1xuICAgICAgICAgICBpZiAoZC5sb2cyZmMgPT0gbnVsbCB8fCBpc05hTihkLmxvZzJmYykpIHJldHVybjtcbiAgICAgICAgICAgXG4gICAgICAgICAgIC8vIExvZzIgVHJhbnNmb3JtYXRpb25cbiAgICAgICAgICAgY29uc3QgeV9sb2cgPSBNYXRoLmxvZzIoZC5yZXNwb25zZSk7XG4gICAgICAgICAgIGNvbnN0IHVjbF9sb2cgPSBNYXRoLmxvZzIoZC5VQ0wpO1xuICAgICAgICAgICBjb25zdCBsY2xfbG9nID0gTWF0aC5sb2cyKGQuTENMKTtcblxuICAgICAgICAgICBsdmxfdHJhY2UueC5wdXNoKGQubG9nMmZjKTtcbiAgICAgICAgICAgbHZsX3RyYWNlLnkucHVzaCh5X2xvZyk7XG4gICAgICAgICAgIGx2bF90cmFjZS50ZXh0LnB1c2goYDxiPiR7ZC50YXJnZXR9PC9iPjxicj5MZXZlbDogJHtkLmxldmVsfTxicj5Mb2cyIFJlc3A6ICR7eV9sb2cudG9GaXhlZCgyKX08YnI+RkM6ICR7ZC5sb2cyZmMudG9GaXhlZCgyKX1gKTtcbiAgICAgICAgICAgbHZsX3RyYWNlLmlkcy5wdXNoKGAke2QudGFyZ2V0fV8ke2QubGV2ZWx9YCk7XG4gICAgICAgICAgIFxuICAgICAgICAgICBsdmxfdHJhY2UuZXJyb3JfeS5hcnJheS5wdXNoKHVjbF9sb2cgLSB5X2xvZyk7XG4gICAgICAgICAgIGx2bF90cmFjZS5lcnJvcl95LmFycmF5bWludXMucHVzaCh5X2xvZyAtIGxjbF9sb2cpO1xuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIHRyYWNlcy5wdXNoKGx2bF90cmFjZSk7XG4gICAgfSk7XG5cbiAgICBpZihoaWdobGlnaHRfbGlzdC5sZW5ndGggPiAwKSB7XG4gICAgICAgY29uc3QgaGlnaGxpZ2h0RGF0YSA9IG1lYW5zX3NlYXJjaC5maWx0ZXIoZCA9PiBoaWdobGlnaHRfbGlzdC5pbmNsdWRlcyhkLnRhcmdldCkgJiYgZC5sb2cyZmMgIT0gbnVsbCk7XG4gICAgICAgXG4gICAgICAgIHRyYWNlcy5wdXNoKHtcbiAgICAgICAgeDogaGlnaGxpZ2h0RGF0YS5tYXAoZCA9PiBkLmxvZzJmYyksXG4gICAgICAgIHk6IGhpZ2hsaWdodERhdGEubWFwKGQgPT4gTWF0aC5sb2cyKGQucmVzcG9uc2UpKSxcbiAgICAgICAgbW9kZTogJ21hcmtlcnMrdGV4dCcsXG4gICAgICAgIHR5cGU6ICdzY2F0dGVyJywgXG4gICAgICAgIG5hbWU6ICdIaWdobGlnaHRzJyxcbiAgICAgICAgdGV4dDogaGlnaGxpZ2h0RGF0YS5tYXAoZCA9PiBkLnRhcmdldCksXG4gICAgICAgIHRleHRwb3NpdGlvbjogJ3RvcCBjZW50ZXInLFxuICAgICAgICB0ZXh0Zm9udDogeyBjb2xvcjogJ2JsYWNrJywgc2l6ZTogMTEsIHdlaWdodDogJ2JvbGQnIH0sXG4gICAgICAgIG1hcmtlcjogeyBjb2xvcjogJ2JsYWNrJywgc2l6ZTogMTAsIHN5bWJvbDogJ2NpcmNsZS1vcGVuJywgbGluZToge3dpZHRoOiAyfSB9LFxuICAgICAgICBob3ZlcmluZm86ICdza2lwJyxcbiAgICAgICAgY2xpcG9uYXhpczogZmFsc2VcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IGxheW91dCA9IHtcbiAgICAgIGhlaWdodDogNTAwLFxuICAgICAgbWFyZ2luOiB7IHQ6IDMwLCBiOiA1MCwgbDogNjAsIHI6IDIwIH0sXG4gICAgICBob3Zlcm1vZGU6ICdjbG9zZXN0JyxcbiAgICAgIHRpdGxlOiB7IHRleHQ6ICdNYXJnaW5hbCBNZWFucyB2cyBGb2xkIENoYW5nZScsIGZvbnQ6IHtzaXplOiAxNH0gfSxcbiAgICAgIHhheGlzOiB7IFxuICAgICAgICB0aXRsZTogJ0xvZzIgRm9sZCBDaGFuZ2UgKENvbnRyYXN0KScsIFxuICAgICAgICB6ZXJvbGluZTogdHJ1ZSwgXG4gICAgICAgIHplcm9saW5lY29sb3I6ICcjZWVlJyxcbiAgICAgICAgZ3JpZGNvbG9yOiAnI2Y5ZjlmOSdcbiAgICAgIH0sXG4gICAgICB5YXhpczogeyBcbiAgICAgICAgdGl0bGU6ICdMb2cyIEV4cHJlc3Npb24gKFJlc3BvbnNlKScsIFxuICAgICAgICBncmlkY29sb3I6ICcjZjlmOWY5JyxcbiAgICAgICAgemVyb2xpbmU6IGZhbHNlXG4gICAgICB9LFxuICAgICAgbGVnZW5kOiB7IG9yaWVudGF0aW9uOiAnaCcsIHk6IC0wLjE1IH0sXG4gICAgICBzaG93bGVnZW5kOiB0cnVlXG4gICAgfTtcblxuICAgIGNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgUGxvdGx5Lm5ld1Bsb3QoZGl2LCB0cmFjZXMsIGxheW91dCwgeyByZXNwb25zaXZlOiB0cnVlLCBkaXNwbGF5TW9kZUJhcjogdHJ1ZSB9KTtcbiAgICB5aWVsZCBkaXY7XG4gIH1cbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjYiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2aWV3b2YgbWVhbnNfc2VhcmNoID0gSW5wdXRzLnNlYXJjaChjdXJyZW50X21lYW5zX2RhdGEsIHtwbGFjZWhvbGRlcjogXCJBZGRpdGlvbmFsIFRhcmdldCBGaWx0ZXJpbmdcIn0pXG5cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJcbnZpZXdvZiBtZWFuc190YWJsZSA9IElucHV0cy50YWJsZShtZWFuc19zZWFyY2gsIHtcbiAgbXVsdGlwbGU6IHRydWUsXG4gIHZhbHVlOiBjb21iaW5lZF9zZWxlY3Rpb24sIC8vIFByZS1jaGVjayB0aGUgY29tYmluZWQgc2VsZWN0aW9uXG4gIHJvd3M6IDIwLFxuICBmb3JtYXQ6IHtcbiAgICByZXNwb25zZTogc3BhcmtiYXIoZDMubWF4KG1lYW5zX3NlYXJjaCwgZCA9PiBkLnJlc3BvbnNlKSlcbiAgfX0pXG5cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjgiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJtZWFuc19kYXRhX2pzID0ge1xuICBjb25zdCBwYXlsb2FkID0gc3R1ZHlfZGF0YV9wYXlsb2FkO1xuICBjb25zdCBsdmwgPSBtZWFuc19sZXZlbDsgXG4gIFxuICBpZiAoIXBheWxvYWQgfHwgIWx2bCB8fCBsdmwubGVuZ3RoID09PSAwIHx8IHBheWxvYWQubW9kZSA9PT0gXCJsb2NhbFwiKSByZXR1cm4gbnVsbDtcblxuICBpZiAocGF5bG9hZC5tb2RlID09PSBcInJlbW90ZV9qc19icmlkZ2VcIikge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjb25uID0gYXdhaXQgZHVja19kYl9jbGllbnQ7XG5cbiAgICAgIGNvbnN0IGZvcm1hdHRlZExldmVscyA9IGx2bC5tYXAoZCA9PiBgJyR7ZH0nYCkuam9pbignLCcpO1xuXG4gICAgICBjb25zdCBxdWVyeSA9IGBcbiAgICAgICAgU0VMRUNUIGxldmVsLCB0YXJnZXQsIHJlc3BvbnNlLCBcImFzeW1wLkxDTFwiIGFzIExDTCwgXCJhc3ltcC5VQ0xcIiBhcyBVQ0xcbiAgICAgICAgRlJPTSAnJHtwYXlsb2FkLnVybF9lbW1lYW5zfScgXG4gICAgICAgIFdIRVJFIGxldmVsIElOICgke2Zvcm1hdHRlZExldmVsc30pXG4gICAgICBgO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb25uLnF1ZXJ5KHF1ZXJ5KTtcbiAgICAgIHJldHVybiByZXN1bHQudG9BcnJheSgpLm1hcChyb3cgPT4gcm93LnRvSlNPTigpKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiTWVhbiBGZXRjaCBFcnJvcjpcIiwgZSk7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICB9XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTI5IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidmlld29mIHNwYXRpYWxfb3B0aW9ucyA9IElucHV0cy5mb3JtKHtcbiAgcHRfc2l6ZTogICAgSW5wdXRzLnJhbmdlKFswLjUsIDEwXSwge3ZhbHVlOiAyLCBzdGVwOiAwLjUsIGxhYmVsOiBcIlBvaW50IFNpemVcIn0pLFxuICBwdF9vcGFjaXR5OiBJbnB1dHMucmFuZ2UoWzAuMSwgMV0sIHt2YWx1ZTogMC43LCBzdGVwOiAwLjEsIGxhYmVsOiBcIk9wYWNpdHlcIn0pLFxuICBiZ19jb2xvcjogICBJbnB1dHMuY29sb3Ioe2xhYmVsOiBcIkJhY2tncm91bmQgQ29sb3JcIiwgdmFsdWU6IFwiI2UwZTBlMFwifSksXG4gIFxuICAvLyBTY2FsZSBCYXJcbiAgc2NhbGVfbGVuOiAgIElucHV0cy5udW1iZXIoe2xhYmVsOiBcIlNjYWxlIEJhciAobW0pXCIsIHZhbHVlOiAxLCBzdGVwOiAwLjF9KSxcbiAgc2NhbGVfY29sb3I6IElucHV0cy5jb2xvcih7bGFiZWw6IFwiU2NhbGUgQ29sb3JcIiwgdmFsdWU6IFwiIzAwMDAwMFwifSksXG4gIHNob3dfc2NhbGU6ICBJbnB1dHMudG9nZ2xlKHtsYWJlbDogXCJTaG93IFNjYWxlIEJhclwiLCB2YWx1ZTogdHJ1ZX0pXG59KVxuXG52aWV3b2YgbG9nX3NjYWxlX29wdCA9IHtcbiAgaWYoIXNwYXRpYWxfZGF0YSB8fCBzcGF0aWFsX2RhdGEubGVuZ3RoID09PSAwKSByZXR1cm4gbWRgYDtcbiAgXG4gIGNvbnN0IHZhbCA9IHNwYXRpYWxfZGF0YVswXS5ncm91cF9pZDtcbiAgXG4gIGlmICh0eXBlb2YgdmFsID09PSAnbnVtYmVyJykge1xuICAgIHJldHVybiBJbnB1dHMudG9nZ2xlKHtsYWJlbDogXCJMb2cgU2NhbGUgQ29sb3IgKG4rMSlcIiwgdmFsdWU6IGZhbHNlfSk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIElucHV0cy50b2dnbGUoe2xhYmVsOiBcIkxvZyBTY2FsZSBDb2xvciAobisxKVwiLCB2YWx1ZTogZmFsc2UsIGRpc2FibGVkOiB0cnVlfSk7XG4gIH1cbn1cblxuc3BhdGlhbF9jb2xvcnMgPSB7XG4gICByZXR1cm4ge1xuICAgICBsMTogbWVhbnNfY29sb3JfMSB8fCBcIiNlMTU3NTlcIixcbiAgICAgbDI6IG1lYW5zX2NvbG9yXzIgfHwgXCIjNGU3OWE3XCIsXG4gICAgIG90aGVyOiBzcGF0aWFsX29wdGlvbnMuYmdfY29sb3JcbiAgIH1cbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMzAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyAxLiBDb2x1bW4gU2VsZWN0aW9uXG52aWV3b2YgZmlsdGVyX2NvbCA9IElucHV0cy5zZWxlY3Qoc3BhdGlhbF9tZXRhX2NvbHVtbnMsIHtsYWJlbDogXCJGaWx0ZXIgQnk6XCIsIHZhbHVlOiBudWxsLCBtdWx0aXBsZTogZmFsc2V9KVxuXG5pc19udW1lcmljX2ZpbHRlciA9IHtcbiAgaWYoIXNwYXRpYWxfZGF0YSB8fCAhZmlsdGVyX2NvbCkgcmV0dXJuIGZhbHNlO1xuICBjb25zdCB2YWwgPSBzcGF0aWFsX2RhdGFbMF1bZmlsdGVyX2NvbF07XG4gIHJldHVybiB0eXBlb2YgdmFsID09PSAnbnVtYmVyJztcbn1cblxudmlld29mIGZpbHRlcl92YWxzID0ge1xuICBpZighZmlsdGVyX2NvbCB8fCAhc3BhdGlhbF9kYXRhKSByZXR1cm4gbWRgX1NlbGVjdCBhIGNvbHVtbi4uLl9gO1xuICBcbiAgaWYgKGlzX251bWVyaWNfZmlsdGVyKSB7XG5cbiAgICBjb25zdCBleHRlbnQgPSBkMy5leHRlbnQoc3BhdGlhbF9kYXRhLCBkID0+IGRbZmlsdGVyX2NvbF0pO1xuICAgIFxuICAgIHJldHVybiBJbnB1dHMuZm9ybSh7XG4gICAgICBtaW46IElucHV0cy5udW1iZXIoe2xhYmVsOiBcIk1pblwiLCB2YWx1ZTogZXh0ZW50WzBdfSksXG4gICAgICBtYXg6IElucHV0cy5udW1iZXIoe2xhYmVsOiBcIk1heFwiLCB2YWx1ZTogZXh0ZW50WzFdfSlcbiAgICB9KTtcbiAgICBcbiAgfSBlbHNlIHtcblxuICAgIGNvbnN0IHVuaXF1ZV92YWxzID0gWy4uLm5ldyBTZXQoc3BhdGlhbF9kYXRhLm1hcChkID0+IGRbZmlsdGVyX2NvbF0pKV0uc29ydCgpO1xuICAgIFxuICAgIHJldHVybiBJbnB1dHMuc2VsZWN0KHVuaXF1ZV92YWxzLCB7XG4gICAgICBsYWJlbDogXCJJbmNsdWRlIFZhbHVlczpcIiwgXG4gICAgICBtdWx0aXBsZTogdHJ1ZSxcbiAgICAgIHNvcnQ6IHRydWUsXG4gICAgICB1bmlxdWU6IHRydWVcbiAgICB9KTtcbiAgfVxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0zMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Im1kYFxuLSAqKlRvdGFsIExvYWRlZCoqOiAke3NwYXRpYWxfZGF0YSA/IHNwYXRpYWxfZGF0YS5sZW5ndGgudG9Mb2NhbGVTdHJpbmcoKSA6IFwiLi4uXCJ9XG4tICoqVmlzaWJsZSoqOiAke3NwYXRpYWxfZmlsdGVyZWQgPyBzcGF0aWFsX2ZpbHRlcmVkLmxlbmd0aC50b0xvY2FsZVN0cmluZygpIDogXCIuLi5cIn1cbmBcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMzIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJcbnZpZXdvZiBzbGlkZV9zZWxlY3Rpb24gPSB7XG4gIGlmICghYXZhaWxhYmxlX3NsaWRlcyB8fCBhdmFpbGFibGVfc2xpZGVzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIG1kYF9Mb2FkaW5nIHNsaWRlcy4uLl9gO1xuXG4gIHJldHVybiBJbnB1dHMuc2VsZWN0KGF2YWlsYWJsZV9zbGlkZXMsIHtcbiAgICBsYWJlbDogXCJBdmFpbGFibGUgU2xpZGVzOlwiLFxuICAgIG11bHRpcGxlOiBmYWxzZSxcbiAgICBzaXplOiAzXG4gIH0pO1xufVxuXG52aWV3b2YgdGVybV9jb3B5MiA9IHtcbiAgXG4gIGlmICghYXZhaWxhYmxlX3Rlcm1zIHx8IGF2YWlsYWJsZV90ZXJtcy5sZW5ndGggPT09IDApIHJldHVybiBtZGBfTG9hZGluZy4uLl9gO1xuXG4gIGNvbnN0IG1pcnJvcl9pbnB1dDMgPSBJbnB1dHMuc2VsZWN0KGF2YWlsYWJsZV90ZXJtcywge1xuICAgIGxhYmVsOiBcIkF2YWlsYWJsZSBUZXJtczpcIixcbiAgICBtdWx0aXBsZTogZmFsc2UsXG4gICAgc2l6ZTogM1xuICB9KTtcblxuICByZXR1cm4gSW5wdXRzLmJpbmQobWlycm9yX2lucHV0Mywgdmlld29mIHRlcm1fc2VsZWN0aW9uKTtcbn1cblxudmlld29mIGNvbnRyYXN0X2NvcHkyID0ge1xuICBpZiAoIWF2YWlsYWJsZV9jb250cmFzdHMgfHwgYXZhaWxhYmxlX2NvbnRyYXN0cy5sZW5ndGggPT09IDApIHJldHVybiBtZGBfTG9hZGluZy4uLl9gO1xuXG4gIGNvbnN0IG1pcnJvcl9pbnB1dDIgPSBJbnB1dHMuc2VsZWN0KGF2YWlsYWJsZV9jb250cmFzdHMsIHtcbiAgICBsYWJlbDogXCJBdmFpbGFibGUgQ29udHJhc3RzOlwiLFxuICAgIGZvcm1hdDogZCA9PiBkLnJlcGxhY2UoXCIgLyBcIiwgXCIgdnMuIFwiKSxcbiAgICBtdWx0aXBsZTogZmFsc2UsXG4gICAgc2l6ZTogM1xuICB9KTtcblxuICByZXR1cm4gSW5wdXRzLmJpbmQobWlycm9yX2lucHV0Miwgdmlld29mIGNvbnRyYXN0X3NlbGVjdGlvbik7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTMzIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiXG5zcGF0aWFsX2RhdGEgPSB7XG4gIGNvbnN0IHBheWxvYWQgPSBzdHVkeV9kYXRhX3BheWxvYWQ7XG4gIGNvbnN0IHJfcHVzaCA9IHJfc3BhdGlhbF9kYXRhX2V4cG9ydDsgLy8gUmVhY3RpdmUgbGluayB0byB0aGUgd2ViUiBibG9jayBhYm92ZVxuICBcbiAgaWYgKCFwYXlsb2FkKSByZXR1cm4gbnVsbDtcblxuICAvLyAxLiBMT0NBTCBNT0RFOiBBbHdheXMgdXNlIHRoZSBSLXNpZGUgRHVja0RCIGRhdGFcbiAgaWYgKHBheWxvYWQudHlwZSA9PT0gXCJsb2NhbFwiKSB7XG4gICAgaWYgKHJfcHVzaCAmJiByX3B1c2gubGVuZ3RoID4gMCkge1xuICAgICAgIGNvbnNvbGUubG9nKFwi8J+TjSBTcGF0aWFsIERhdGE6IFJlY2VpdmVkIHZpYSBSLVNpZGUgRHVja0RCIEJyaWRnZVwiKTtcbiAgICAgICByZXR1cm4gcl9wdXNoO1xuICAgIH1cbiAgICAvLyBSZXR1cm4gZW1wdHkgYXJyYXkgdG8gY2xlYXIgdGhlIGNhbnZhcyBkdXJpbmcgdHJhbnNpdGlvbnNcbiAgICByZXR1cm4gW107IFxuICB9XG5cbiAgLy8gMi4gUkVNT1RFIE1PREU6IEtlZXAgdGhlIFVSTC1iYXNlZCBKUy1icmlkZ2UgZm9yIG1hbmlmZXN0IHN0dWRpZXNcbiAgY29uc3QgdGVybSA9IHRlcm1fc2VsZWN0aW9uO1xuICBjb25zdCBzbGlkZSA9IHNsaWRlX3NlbGVjdGlvbjtcbiAgaWYgKCF0ZXJtIHx8IHNsaWRlID09PSBudWxsKSByZXR1cm4gbnVsbDtcblxuICB0cnkge1xuICAgIGNvbnN0IGNvbm4gPSBhd2FpdCBkdWNrX2RiX2NsaWVudDtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb25uLnF1ZXJ5KGBTRUxFQ1QgKiBGUk9NIFwiJHtwYXlsb2FkLnVybF9tZXRhfVwiIFdIRVJFIHNsaWRlX2lkX251bWVyaWMgPSAke3NsaWRlfWApO1xuICAgIGNvbnN0IHJvd3MgPSByZXN1bHQudG9BcnJheSgpLm1hcChyb3cgPT4gcm93LnRvSlNPTigpKTtcbiAgICByb3dzLmZvckVhY2gociA9PiB7IHIuZ3JvdXBfaWQgPSByW3Rlcm1dOyB9KTtcbiAgICByZXR1cm4gcm93cztcbiAgfSBjYXRjaCAoZSkge1xuICAgIGNvbnNvbGUuZXJyb3IoXCLinYwgUmVtb3RlIFNwYXRpYWwgRmV0Y2ggRXJyb3I6XCIsIGUpO1xuICAgIHJldHVybiBbXTtcbiAgfVxufVxuXG5zcGF0aWFsX21ldGFfY29sdW1ucyA9IHtcbiAgaWYgKCFzcGF0aWFsX2RhdGEgfHwgc3BhdGlhbF9kYXRhLmxlbmd0aCA9PT0gMCkgcmV0dXJuIFtdO1xuICBcbiAgLy8gRHluYW1pY2FsbHkgZ3JhYiBjb2x1bW5zIGZyb20gd2hhdGV2ZXIgc3R1ZHkgaXMgY3VycmVudGx5IGxvYWRlZFxuICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMoc3BhdGlhbF9kYXRhWzBdKTtcbiAgXG4gIHJldHVybiBrZXlzLmZpbHRlcihrID0+IFxuICAgICFbXCJ4X3NsaWRlX21tXCIsIFwieV9zbGlkZV9tbVwiLCBcImdyb3VwX2lkXCIsIFwiX19pbmRleF9sZXZlbF8wX19cIiwgXCJzbGlkZV9pZF9udW1lcmljXCJdLmluY2x1ZGVzKGspXG4gICk7XG59XG5cbnNwYXRpYWxfZmlsdGVyZWQgPSB7XG4gIGlmKCFzcGF0aWFsX2RhdGEpIHJldHVybiBbXTtcblxuICBpZighZmlsdGVyX2NvbCB8fCAhZmlsdGVyX3ZhbHMpIHJldHVybiBzcGF0aWFsX2RhdGE7XG4gIFxuICAvLyBMT0dJQyBTV0lUQ0g6XG4gIGlmKGlzX251bWVyaWNfZmlsdGVyKSB7XG4gICAgIC8vIE51bWVyaWMgRmlsdGVyOiBmaWx0ZXJfdmFscyBpcyBhbiBvYmplY3Qge21pbjogeCwgbWF4OiB5fVxuICAgICBjb25zdCB7IG1pbiwgbWF4IH0gPSBmaWx0ZXJfdmFscztcbiAgICAgcmV0dXJuIHNwYXRpYWxfZGF0YS5maWx0ZXIoZCA9PiBkW2ZpbHRlcl9jb2xdID49IG1pbiAmJiBkW2ZpbHRlcl9jb2xdIDw9IG1heCk7XG4gIH0gZWxzZSB7XG4gICAgIC8vIENhdGVnb3JpY2FsIEZpbHRlcjogZmlsdGVyX3ZhbHMgaXMgYW4gYXJyYXkgb2Ygc2VsZWN0ZWQgc3RyaW5nc1xuICAgICBpZihmaWx0ZXJfdmFscy5sZW5ndGggPT09IDApIHJldHVybiBzcGF0aWFsX2RhdGE7XG4gICAgIHJldHVybiBzcGF0aWFsX2RhdGEuZmlsdGVyKGQgPT4gZmlsdGVyX3ZhbHMuaW5jbHVkZXMoZFtmaWx0ZXJfY29sXSkpO1xuICB9XG59XG5cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMzQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJcbntcbiAgY29uc3QgZGF0YSA9IHNwYXRpYWxfZmlsdGVyZWQ7XG4gIGNvbnN0IGxldmVscyA9IG1lYW5zX2xldmVsOyBcbiAgY29uc3Qgb3B0cyA9IHNwYXRpYWxfb3B0aW9ucztcbiAgY29uc3QgY29sb3JzID0gc3BhdGlhbF9jb2xvcnM7XG4gIGNvbnN0IHdpZHRoID0gMTIwMDsgXG4gIGNvbnN0IGhlaWdodCA9IDkwMDsgXG4gIFxuICBjb25zdCB1c2VMb2cgPSBsb2dfc2NhbGVfb3B0ID09PSB0cnVlOyBcbiAgXG4gIC8vaWYgKCFkYXRhIHx8IGRhdGEubGVuZ3RoID09PSAwKSByZXR1cm4gbWRgX0xvYWRpbmcgc3BhdGlhbCBkYXRhLi4uX2A7XG5cbiAgY29uc3QgaXNNb2NrID0gIWRhdGEgfHwgZGF0YS5sZW5ndGggPT09IDAgfHwgXG4gICAgICAgICAgICAgICAgIChkYXRhLmxlbmd0aCA9PT0gNCAmJiBkMy5tYXgoZGF0YSwgZCA9PiBkLnhfc2xpZGVfbW0pIDw9IDEpO1xuICBcbiAgaWYgKGlzTW9jaykge1xuICAgIHJldHVybiBodG1sYFxuICAgICAgPGRpdiBzdHlsZT1cImhlaWdodDogNjAwcHg7IGRpc3BsYXk6IGZsZXg7IGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGp1c3RpZnktY29udGVudDogY2VudGVyOyBiYWNrZ3JvdW5kOiAjZmRmZGZkOyBib3JkZXI6IDJweCBkYXNoZWQgI2RlZTJlNjsgYm9yZGVyLXJhZGl1czogMTJweDsgdGV4dC1hbGlnbjogY2VudGVyOyBwYWRkaW5nOiA0MHB4O1wiPlxuICAgICAgICA8ZGl2IHN0eWxlPVwiZm9udC1zaXplOiAzZW07IG9wYWNpdHk6IDAuNDtcIj7wn5ONPC9kaXY+XG4gICAgICAgIDxoMyBzdHlsZT1cImNvbG9yOiAjM0MzRjQwOyBtYXJnaW4tdG9wOiAxNXB4O1wiPlNwYXRpYWwgUGxvdCBVbmF2YWlsYWJsZTwvaDM+XG4gICAgICAgIDxwIHN0eWxlPVwibWF4LXdpZHRoOiA0NDBweDsgY29sb3I6ICM4ODg7IGZvbnQtc2l6ZTogMC45ZW07IGxpbmUtaGVpZ2h0OiAxLjY7XCI+XG4gICAgICAgICAgVGhpcyBzdHVkeSAoQXRvTXggU0lQIG9yIHNtaURFKSBkb2VzIG5vdCBjb250YWluIGFueSBjZWxsLWxldmVsIHNwYXRpYWwgbWV0YWRhdGEgdG8gZGlzcGxheS5cbiAgICAgICAgPC9wPlxuICAgICAgICA8ZGl2IHN0eWxlPVwibWFyZ2luLXRvcDogMjBweDsgZm9udC1zaXplOiAwLjc1ZW07IGJvcmRlci10b3A6IDFweCBzb2xpZCAjZWVlOyBwYWRkaW5nLXRvcDogMTVweDsgZm9udC1zdHlsZTogaXRhbGljOyBjb2xvcjogI2I0NDY5NztcIj5cbiAgICAgICAgICBSIHVzZXJzOiBVc2UgPGNvZGU+Y3JlYXRlX21vY2tfc3BfZGF0YSgpPC9jb2RlPiB0byBnZW5lcmF0ZSBwbGFjZWhvbGRlciBjb29yZGluYXRlcy5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICBgO1xuICB9XG5cbiAgY29uc3QgaXNDb250aW51b3VzID0gdHlwZW9mIGRhdGFbMF0uZ3JvdXBfaWQgPT09ICdudW1iZXInO1xuICBcbiAgbGV0IGNvbG9yU2NhbGUgPSBudWxsO1xuICBsZXQgdGVybUV4dGVudCA9IFswLCAxXTtcbiAgXG4gIGlmKGlzQ29udGludW91cykge1xuICAgICB0ZXJtRXh0ZW50ID0gZDMuZXh0ZW50KGRhdGEsIGQgPT4gZC5ncm91cF9pZCk7XG4gICAgIFxuICAgICBpZiAodXNlTG9nKSB7XG4gICAgICAgIC8vIExvZyBTY2FsZTogTWFwIExvZyhNaW4rMSkgLT4gTG9nKE1heCsxKVxuICAgICAgICBjb25zdCBsb2dNaW4gPSBNYXRoLmxvZyh0ZXJtRXh0ZW50WzBdICsgMSk7XG4gICAgICAgIGNvbnN0IGxvZ01heCA9IE1hdGgubG9nKHRlcm1FeHRlbnRbMV0gKyAxKTtcbiAgICAgICAgXG4gICAgICAgIGNvbG9yU2NhbGUgPSBkMy5zY2FsZVNlcXVlbnRpYWwoZDMuaW50ZXJwb2xhdGVSZ2IoY29sb3JzLmwyLCBjb2xvcnMubDEpKVxuICAgICAgICAgIC5kb21haW4oW2xvZ01pbiwgbG9nTWF4XSk7XG4gICAgICAgICAgXG4gICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIExpbmVhciBTY2FsZVxuICAgICAgICBjb2xvclNjYWxlID0gZDMuc2NhbGVMaW5lYXIoKVxuICAgICAgICAgIC5kb21haW4odGVybUV4dGVudClcbiAgICAgICAgICAucmFuZ2UoW2NvbG9ycy5sMiwgY29sb3JzLmwxXSk7XG4gICAgIH1cbiAgfVxuXG4gIGNvbnN0IHhFeHRlbnQgPSBkMy5leHRlbnQoZGF0YSwgZCA9PiBkLnhfc2xpZGVfbW0pO1xuICBjb25zdCB5RXh0ZW50ID0gZDMuZXh0ZW50KGRhdGEsIGQgPT4gZC55X3NsaWRlX21tKTtcbiAgXG4gIGNvbnN0IHhNaW4gPSB4RXh0ZW50WzBdLCB4TWF4ID0geEV4dGVudFsxXTtcbiAgY29uc3QgeU1pbiA9IHlFeHRlbnRbMF0sIHlNYXggPSB5RXh0ZW50WzFdO1xuICBcbiAgY29uc3QgZGF0YVdpZHRoID0geE1heCAtIHhNaW47XG4gIGNvbnN0IGRhdGFIZWlnaHQgPSB5TWF4IC0geU1pbjtcbiAgXG4gIGNvbnN0IHhTY2FsZUZhY3RvciA9IHdpZHRoIC8gZGF0YVdpZHRoO1xuICBjb25zdCB5U2NhbGVGYWN0b3IgPSBoZWlnaHQgLyBkYXRhSGVpZ2h0O1xuICBjb25zdCBzY2FsZSA9IE1hdGgubWluKHhTY2FsZUZhY3RvciwgeVNjYWxlRmFjdG9yKSAqIDAuOTU7IFxuICBcbiAgY29uc3QgY3ggPSB3aWR0aCAvIDI7XG4gIGNvbnN0IGN5ID0gaGVpZ2h0IC8gMjtcbiAgY29uc3QgZHggPSAoeE1pbiArIHhNYXgpIC8gMjtcbiAgY29uc3QgZHkgPSAoeU1pbiArIHlNYXgpIC8gMjtcblxuICBjb25zdCBwcm9qZWN0ID0gKHgsIHkpID0+IHtcbiAgICByZXR1cm4gW1xuICAgICAgY3ggKyAoeCAtIGR4KSAqIHNjYWxlLFxuICAgICAgY3kgLSAoeSAtIGR5KSAqIHNjYWxlIFxuICAgIF07XG4gIH1cbiAgXG4gIGNvbnN0IHBpeGVsc1Blck1tID0gc2NhbGU7XG5cbiAgLy8gLS0tIDMuIERPTSBTZXR1cCAtLS1cbiAgY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgZGl2LnN0eWxlLnBvc2l0aW9uID0gXCJyZWxhdGl2ZVwiO1xuICBkaXYuc3R5bGUud2lkdGggPSBcIjEwMCVcIjtcbiAgZGl2LnN0eWxlLm1heFdpZHRoID0gXCIxMDAlXCI7XG4gIGRpdi5zdHlsZS5oZWlnaHQgPSBcImF1dG9cIjtcbiAgZGl2LnN0eWxlLmJvcmRlciA9IFwiMXB4IHNvbGlkICNlZWVcIjtcbiAgZGl2LnN0eWxlLmJhY2tncm91bmQgPSBcIiNmZmZcIjtcblxuICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xuICBjYW52YXMud2lkdGggPSB3aWR0aDtcbiAgY2FudmFzLmhlaWdodCA9IGhlaWdodDtcbiAgY2FudmFzLnN0eWxlLndpZHRoID0gXCIxMDAlXCI7IC8vIFJlc3BvbnNpdmUgQ1NTXG4gIGNhbnZhcy5zdHlsZS5oZWlnaHQgPSBcImF1dG9cIjtcbiAgY2FudmFzLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XG4gIGRpdi5hcHBlbmRDaGlsZChjYW52YXMpO1xuICBcbiAgLy8gTGVnZW5kIFxuICBjb25zdCBsZWdlbmQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICBsZWdlbmQuc3R5bGUucG9zaXRpb24gPSBcImFic29sdXRlXCI7XG4gIGxlZ2VuZC5zdHlsZS50b3AgPSBcIjEwcHhcIjtcbiAgbGVnZW5kLnN0eWxlLnJpZ2h0ID0gXCIxMHB4XCI7XG4gIGxlZ2VuZC5zdHlsZS5iYWNrZ3JvdW5kID0gXCJyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuOSlcIjtcbiAgbGVnZW5kLnN0eWxlLnBhZGRpbmcgPSBcIjhweFwiO1xuICBsZWdlbmQuc3R5bGUuYm9yZGVyUmFkaXVzID0gXCI0cHhcIjtcbiAgbGVnZW5kLnN0eWxlLmJvcmRlciA9IFwiMXB4IHNvbGlkICNjY2NcIjtcbiAgbGVnZW5kLnN0eWxlLmZvbnRTaXplID0gXCIxMnB4XCI7XG4gIGxlZ2VuZC5zdHlsZS5mb250RmFtaWx5ID0gXCJzYW5zLXNlcmlmXCI7XG4gIFxuICBpZiAoaXNDb250aW51b3VzKSB7XG4gICAgIGNvbnN0IGxhYmVsID0gdXNlTG9nID8gYExvZygke3Rlcm1fc2VsZWN0aW9ufSArIDEpYCA6IHRlcm1fc2VsZWN0aW9uO1xuICAgICBjb25zdCBtaW5MYWJlbCA9IHVzZUxvZyA/IE1hdGgubG9nKHRlcm1FeHRlbnRbMF0gKyAxKS50b0ZpeGVkKDIpIDogdGVybUV4dGVudFswXS50b0ZpeGVkKDIpO1xuICAgICBjb25zdCBtYXhMYWJlbCA9IHVzZUxvZyA/IE1hdGgubG9nKHRlcm1FeHRlbnRbMV0gKyAxKS50b0ZpeGVkKDIpIDogdGVybUV4dGVudFsxXS50b0ZpeGVkKDIpO1xuICAgICBcbiAgICAgbGVnZW5kLmlubmVySFRNTCA9IGBcbiAgICAgICA8c3Ryb25nPiR7bGFiZWx9PC9zdHJvbmc+PGJyPlxuICAgICAgIDxkaXYgc3R5bGU9XCJkaXNwbGF5OmZsZXg7IGFsaWduLWl0ZW1zOmNlbnRlcjsgZ2FwOjVweDsgbWFyZ2luLXRvcDo0cHg7XCI+XG4gICAgICAgICA8c3Bhbj4ke21pbkxhYmVsfTwvc3Bhbj5cbiAgICAgICAgIDxkaXYgc3R5bGU9XCJ3aWR0aDo2MHB4OyBoZWlnaHQ6MTBweDsgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KHRvIHJpZ2h0LCAke2NvbG9ycy5sMn0sICR7Y29sb3JzLmwxfSk7XCI+PC9kaXY+XG4gICAgICAgICA8c3Bhbj4ke21heExhYmVsfTwvc3Bhbj5cbiAgICAgICA8L2Rpdj5cbiAgICAgYDtcbiAgfSBlbHNlIHtcbiAgICAgY29uc3QgTDEgPSAobGV2ZWxzICYmIGxldmVscy5sZW5ndGggPiAwKSA/IGxldmVsc1swXSA6IFwiTGV2ZWwgMVwiO1xuICAgICBjb25zdCBMMiA9IChsZXZlbHMgJiYgbGV2ZWxzLmxlbmd0aCA+IDEpID8gbGV2ZWxzWzFdIDogXCJMZXZlbCAyXCI7XG4gICAgIGxlZ2VuZC5pbm5lckhUTUwgPSBgXG4gICAgICAgPHN0cm9uZz4ke3Rlcm1fc2VsZWN0aW9ufTwvc3Ryb25nPjxicj5cbiAgICAgICA8ZGl2IHN0eWxlPVwiZGlzcGxheTpmbGV4OyBhbGlnbi1pdGVtczpjZW50ZXI7IGdhcDo1cHg7IG1hcmdpbi10b3A6MnB4O1wiPlxuICAgICAgICAgPHNwYW4gc3R5bGU9XCJkaXNwbGF5OmlubGluZS1ibG9jazsgd2lkdGg6MTBweDsgaGVpZ2h0OjEwcHg7IGJhY2tncm91bmQ6JHtjb2xvcnMubDF9O1wiPjwvc3Bhbj4gJHtMMX08YnI+XG4gICAgICAgPC9kaXY+XG4gICAgICAgPGRpdiBzdHlsZT1cImRpc3BsYXk6ZmxleDsgYWxpZ24taXRlbXM6Y2VudGVyOyBnYXA6NXB4OyBtYXJnaW4tdG9wOjJweDtcIj5cbiAgICAgICAgIDxzcGFuIHN0eWxlPVwiZGlzcGxheTppbmxpbmUtYmxvY2s7IHdpZHRoOjEwcHg7IGhlaWdodDoxMHB4OyBiYWNrZ3JvdW5kOiR7Y29sb3JzLmwyfTtcIj48L3NwYW4+ICR7TDJ9XG4gICAgICAgPC9kaXY+XG4gICAgIGA7XG4gIH1cbiAgZGl2LmFwcGVuZENoaWxkKGxlZ2VuZCk7XG5cbiAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcbiAgbGV0IHRyYW5zZm9ybSA9IGQzLnpvb21JZGVudGl0eTtcblxuICBmdW5jdGlvbiBkcmF3KCkge1xuICAgIGN0eC5zYXZlKCk7XG4gICAgY3R4LmNsZWFyUmVjdCgwLCAwLCB3aWR0aCwgaGVpZ2h0KTtcbiAgICBcbiAgICBjdHgudHJhbnNsYXRlKHRyYW5zZm9ybS54LCB0cmFuc2Zvcm0ueSk7XG4gICAgY3R4LnNjYWxlKHRyYW5zZm9ybS5rLCB0cmFuc2Zvcm0uayk7XG4gICAgXG4gICAgY29uc3QgcmFkaXVzID0gb3B0cy5wdF9zaXplIC8gdHJhbnNmb3JtLms7XG4gICAgY3R4Lmdsb2JhbEFscGhhID0gb3B0cy5wdF9vcGFjaXR5O1xuXG4gICAgY29uc3QgY090aGVyID0gY29sb3JzLm90aGVyO1xuICAgIGNvbnN0IGNMMSA9IGNvbG9ycy5sMTtcbiAgICBjb25zdCBjTDIgPSBjb2xvcnMubDI7XG4gICAgY29uc3QgTDEgPSAobGV2ZWxzICYmIGxldmVscy5sZW5ndGggPiAwKSA/IGxldmVsc1swXSA6IG51bGw7XG4gICAgY29uc3QgTDIgPSAobGV2ZWxzICYmIGxldmVscy5sZW5ndGggPiAxKSA/IGxldmVsc1sxXSA6IG51bGw7XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IGQgPSBkYXRhW2ldO1xuICAgICAgbGV0IGZpbGwgPSBjT3RoZXI7XG4gICAgICBcbiAgICAgIGlmIChpc0NvbnRpbnVvdXMpIHtcbiAgICAgICAgIGlmIChkLmdyb3VwX2lkICE9IG51bGwpIHtcbiAgICAgICAgICAgIGNvbnN0IHZhbCA9IHVzZUxvZyA/IE1hdGgubG9nKGQuZ3JvdXBfaWQgKyAxKSA6IGQuZ3JvdXBfaWQ7XG4gICAgICAgICAgICBmaWxsID0gY29sb3JTY2FsZSh2YWwpO1xuICAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgIGlmIChMMSAmJiBkLmdyb3VwX2lkID09PSBMMSkgZmlsbCA9IGNMMTtcbiAgICAgICAgIGVsc2UgaWYgKEwyICYmIGQuZ3JvdXBfaWQgPT09IEwyKSBmaWxsID0gY0wyO1xuICAgICAgfVxuICAgICAgXG4gICAgICBjb25zdCB4eSA9IHByb2plY3QoZC54X3NsaWRlX21tLCBkLnlfc2xpZGVfbW0pO1xuICAgICAgXG4gICAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgICBjdHguZmlsbFN0eWxlID0gZmlsbDtcbiAgICAgIGN0eC5maWxsUmVjdCh4eVswXSAtIHJhZGl1cywgeHlbMV0gLSByYWRpdXMsIHJhZGl1cyoyLCByYWRpdXMqMik7XG4gICAgfVxuICAgIFxuICAgIGN0eC5yZXN0b3JlKCk7XG4gICAgXG4gICAgaWYgKG9wdHMuc2hvd19zY2FsZSkge1xuICAgICAgIGNvbnN0IGJhckxlbk1tID0gb3B0cy5zY2FsZV9sZW47XG4gICAgICAgY29uc3QgYmFyTGVuUHggPSBiYXJMZW5NbSAqIHBpeGVsc1Blck1tICogdHJhbnNmb3JtLms7IFxuICAgICAgIFxuICAgICAgIGNvbnN0IG1hcmdpbiA9IDIwO1xuICAgICAgIGNvbnN0IGJhclggPSB3aWR0aCAtIG1hcmdpbiAtIGJhckxlblB4O1xuICAgICAgIGNvbnN0IGJhclkgPSBoZWlnaHQgLSBtYXJnaW47XG4gICAgICAgXG4gICAgICAgY3R4LnNhdmUoKTtcbiAgICAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgICAgY3R4LnN0cm9rZVN0eWxlID0gb3B0cy5zY2FsZV9jb2xvcjtcbiAgICAgICBjdHgubGluZVdpZHRoID0gNDtcbiAgICAgICBjdHgubW92ZVRvKGJhclgsIGJhclkpO1xuICAgICAgIGN0eC5saW5lVG8oYmFyWCArIGJhckxlblB4LCBiYXJZKTtcbiAgICAgICBjdHguc3Ryb2tlKCk7XG4gICAgICAgXG4gICAgICAgY3R4LmZpbGxTdHlsZSA9IG9wdHMuc2NhbGVfY29sb3I7XG4gICAgICAgY3R4LmZvbnQgPSBcImJvbGQgMTRweCBzYW5zLXNlcmlmXCI7XG4gICAgICAgY3R4LnRleHRBbGlnbiA9IFwiY2VudGVyXCI7XG4gICAgICAgY3R4LnRleHRCYXNlbGluZSA9IFwiYm90dG9tXCI7XG4gICAgICAgY3R4LmZpbGxUZXh0KGAke2Jhckxlbk1tfSBtbWAsIGJhclggKyBiYXJMZW5QeC8yLCBiYXJZIC0gNSk7XG4gICAgICAgY3R4LnJlc3RvcmUoKTtcbiAgICB9XG4gIH1cblxuICBkcmF3KCk7XG5cbiAgY29uc3Qgem9vbSA9IGQzLnpvb20oKVxuICAgIC5zY2FsZUV4dGVudChbMC41LCA1MF0pIFxuICAgIC5vbihcInpvb21cIiwgKGV2ZW50KSA9PiB7XG4gICAgICB0cmFuc2Zvcm0gPSBldmVudC50cmFuc2Zvcm07XG4gICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZHJhdyk7XG4gICAgfSk7XG5cbiAgZDMuc2VsZWN0KGNhbnZhcykuY2FsbCh6b29tKTtcblxuICByZXR1cm4gZGl2O1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0zNSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ilxudmlld29mIGF0b214X3ppcF9maWxlID0gSW5wdXRzLmZpbGUoe1xuICBsYWJlbDogXCJJbXBvcnQgQXRvTXggU0lQIERFIFJlc3VsdHMgKC56aXApOlwiLFxuICBhY2NlcHQ6IFwiLnppcFwiXG59KVxuXG5hdG9teF9zdXJnaWNhbF9pbmdlc3RvciA9IHtcbiAgaWYgKCFhdG9teF96aXBfZmlsZSkgcmV0dXJuIG51bGw7XG4gIFxuICB0cnkge1xuICAgIGNvbnNvbGUubG9nKFwi8J+boO+4jyBJTkdFU1RPUiBTVEFSVDogUmVhZGluZyBBcnJheUJ1ZmZlci4uLlwiKTtcbiAgICBjb25zdCBidWZmZXIgPSBhd2FpdCBhdG9teF96aXBfZmlsZS5hcnJheUJ1ZmZlcigpO1xuICAgIGNvbnN0IHogPSBhd2FpdCBpbXBvcnQoXCJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL0B6aXAuanMvemlwLmpzQDIuNy4zNC8rZXNtXCIpO1xuICAgIFxuICAgIC8vIENyZWF0ZSB0aGUgcmVhZGVyIGZyb20gdGhlIFVpbnQ4QXJyYXkgb2YgdGhlIGZ1bGwgemlwXG4gICAgY29uc3QgcmVhZGVyID0gbmV3IHouWmlwUmVhZGVyKG5ldyB6LlVpbnQ4QXJyYXlSZWFkZXIobmV3IFVpbnQ4QXJyYXkoYnVmZmVyKSkpO1xuICAgIGNvbnN0IGVudHJpZXMgPSBhd2FpdCByZWFkZXIuZ2V0RW50cmllcygpO1xuICAgIFxuICAgIGNvbnN0IHRhcmdldHMgPSBbXCJlbW1lYW5zLmNzdlwiLCBcInBhaXJ3aXNlLmNzdlwiLCBcIm9uZS52cy5yZXN0LmNzdlwiLCBcIm9uZS52cy5hbGwuY3N2XCJdO1xuICAgIGNvbnN0IGNvbm4gPSBhd2FpdCBkdWNrX2RiX2NsaWVudDtcbiAgICBjb25zdCBkYiA9IGNvbm4uaW5zdGFuY2UgfHwgY29ubi5kYiB8fCBjb25uO1xuXG4gICAgZm9yIChjb25zdCBlbnRyeSBvZiBlbnRyaWVzKSB7XG4gICAgICBjb25zdCBtYXRjaCA9IHRhcmdldHMuZmluZCh0ID0+IGVudHJ5LmZpbGVuYW1lLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXModCkpO1xuICAgICAgaWYgKG1hdGNoKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGDwn5OmIFpJUCBFTlRSWSBGT1VORDogJHtlbnRyeS5maWxlbmFtZX1gKTtcbiAgICAgICAgXG4gICAgICAgIC8vIEZJWDogRW5zdXJlIHdlIGFyZSBhd2FpdGluZyB0aGUgZnVsbCBkYXRhIGV4dHJhY3Rpb25cbiAgICAgICAgY29uc3QgdWludDggPSBhd2FpdCBlbnRyeS5nZXREYXRhKG5ldyB6LlVpbnQ4QXJyYXlXcml0ZXIoKSk7XG4gICAgICAgIFxuICAgICAgICBpZiAodWludDggJiYgdWludDgubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGF3YWl0IGRiLnJlZ2lzdGVyRmlsZUJ1ZmZlcihtYXRjaCwgdWludDgpO1xuICAgICAgICAgIGNvbnNvbGUubG9nKGDinIUgUkVHSVNURVJFRDogJHttYXRjaH0gKCR7dWludDgubGVuZ3RoLnRvTG9jYWxlU3RyaW5nKCl9IGJ5dGVzKWApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnNvbGUud2Fybihg4pqg77iPIFdBUk5JTkc6ICR7bWF0Y2h9IGV4dHJhY3RlZCBhcyAwIGJ5dGVzIWApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIGF3YWl0IHJlYWRlci5jbG9zZSgpO1xuICAgIHJldHVybiB7IHN0YXR1czogXCJyZWFkeVwiLCB0aW1lc3RhbXA6IERhdGUubm93KCkgfTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgY29uc29sZS5lcnJvcihcIuKdjCBJTkdFU1RPUiBDUklUSUNBTCBFUlJPUjpcIiwgZXJyKTtcbiAgICByZXR1cm4geyBzdGF0dXM6IFwiZXJyb3JcIiwgbWVzc2FnZTogZXJyLm1lc3NhZ2UgfTtcbiAgfVxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0zNiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlxuYXRvbXhfcGFycXVldF9nZW5lcmF0b3IgPSB7XG4gIGlmICghYXRvbXhfc3VyZ2ljYWxfaW5nZXN0b3IgfHwgYXRvbXhfc3VyZ2ljYWxfaW5nZXN0b3Iuc3RhdHVzICE9PSBcInJlYWR5XCIpIHJldHVybiBudWxsO1xuICBpZiAoIWF0b214X21ldGFkYXRhIHx8IGF0b214X21ldGFkYXRhLnByb2Nlc3NfYnRuID09PSAwKSByZXR1cm4gbnVsbDtcbiAgXG4gIGNvbnN0IGNvbm4gPSBhd2FpdCBkdWNrX2RiX2NsaWVudDtcbiAgY29uc29sZS5sb2coXCLwn6qEIEdFTkVSQVRPUiBTVEFSVDogQnVpbGRpbmcgU1FMIFZpZXdzLi4uXCIpO1xuXG4gIHRyeSB7XG4gICAgLy8gRklYOiBVc2UgRHVja0RCJ3MgaW50ZXJuYWwgc2NoZW1hIGZpZWxkIG1hcHBpbmdcbiAgICBjb25zb2xlLmxvZyhcIvCflI0gUHJvYmluZyBjb2x1bW5zIGluIHBhaXJ3aXNlLmNzdi4uLlwiKTtcbiAgICBjb25zdCBzY2hlbWFSZXMgPSBhd2FpdCBjb25uLnF1ZXJ5KFwiU0VMRUNUICogRlJPTSByZWFkX2Nzdl9hdXRvKCdwYWlyd2lzZS5jc3YnKSBMSU1JVCAwXCIpO1xuICAgIGNvbnN0IGNvbHMgPSBzY2hlbWFSZXMuc2NoZW1hLmZpZWxkcy5tYXAoZiA9PiBmLm5hbWUpO1xuICAgIGNvbnNvbGUubG9nKFwi8J+TiyBEZXRlY3RlZCBDb2x1bW5zOlwiLCBjb2xzKTtcbiAgICBcbiAgICBjb25zdCBuMSA9IGNvbHMuaW5jbHVkZXMoXCJuY2VsbHNfMVwiKSA/IFwibmNlbGxzXzFcIiA6IFwiTlVMTCBhcyBuY2VsbHNfMVwiO1xuICAgIGNvbnN0IG4yID0gY29scy5pbmNsdWRlcyhcIm5jZWxsc18yXCIpID8gXCJuY2VsbHNfMlwiIDogXCJOVUxMIGFzIG5jZWxsc18yXCI7XG5cbiAgICAvLyAxLiBIYXJtb25pemUgRU1NRUFOU1xuICAgIGF3YWl0IGNvbm4ucXVlcnkoYFxuICAgICAgQ1JFQVRFIE9SIFJFUExBQ0UgVklFVyBlbW1lYW5zX2ZpbmFsIEFTXG4gICAgICBXSVRIIGJhc2UgQVMgKFxuICAgICAgICBTRUxFQ1QgKixcbiAgICAgICAgICByZWdleHBfcmVwbGFjZShsZXZlbCwgdGVybSwgJycpIGFzIHN1ZmZpeF9zdHIsXG4gICAgICAgICAgVFJZX0NBU1QocmVnZXhwX3JlcGxhY2UobGV2ZWwsIHRlcm0sICcnKSBBUyBET1VCTEUpIGFzIHN1ZmZpeF92YWwsXG4gICAgICAgICAgKGxldmVsIExJS0UgdGVybSB8fCAnJScpIEFORCAoVFJZX0NBU1QocmVnZXhwX3JlcGxhY2UobGV2ZWwsIHRlcm0sICcnKSBBUyBET1VCTEUpIElTIE5PVCBOVUxMKSBhcyBpc19jb250aW51b3VzXG4gICAgICAgIEZST00gcmVhZF9jc3ZfYXV0bygnZW1tZWFucy5jc3YnKVxuICAgICAgICBXSEVSRSB0ZXJtICE9ICdvdGhlcmN0X2V4cHInXG4gICAgICApXG4gICAgICBTRUxFQ1QgXG4gICAgICAgIHRlcm0sXG4gICAgICAgIENBU0UgXG4gICAgICAgICAgV0hFTiBpc19jb250aW51b3VzIEFORCBjYXRlZ29yeSA9ICdjMScgVEhFTiAnbWVhbiArIDFTRCAoJyB8fCBwcmludGYoJyUuMmYnLCBzdWZmaXhfdmFsKSB8fCAnKSdcbiAgICAgICAgICBXSEVOIGlzX2NvbnRpbnVvdXMgQU5EIGNhdGVnb3J5ID0gJ2MyJyBUSEVOICdtZWFuICAoJyB8fCBwcmludGYoJyUuMmYnLCBzdWZmaXhfdmFsKSB8fCAnKSdcbiAgICAgICAgICBFTFNFIGxldmVsIFxuICAgICAgICBFTkQgYXMgbGV2ZWwsXG4gICAgICAgIHRhcmdldCwgcmVzcG9uc2UsIFwiYXN5bXAuTENMXCIsIFwiYXN5bXAuVUNMXCJcbiAgICAgIEZST00gYmFzZVxuICAgIGApO1xuXG4gICAgLy8gMi4gQnVpbGQgTWFzdGVyIFBBSVJXSVNFIFVuaW9uXG4gICAgYXdhaXQgY29ubi5xdWVyeShgXG4gICAgICBDUkVBVEUgT1IgUkVQTEFDRSBWSUVXIHBhaXJ3aXNlX2ZpbmFsIEFTXG4gICAgICBTRUxFQ1QgJ3BhaXJ3aXNlJyBhcyBjb250cmFzdF90eXBlLCB0ZXJtLCBjb250cmFzdCwgdGFyZ2V0LCBsb2cyKGZvbGRfY2hhbmdlKSBhcyBsb2cyZmMsIFwicC52YWx1ZVwiLCAke24xfSwgJHtuMn0gRlJPTSByZWFkX2Nzdl9hdXRvKCdwYWlyd2lzZS5jc3YnKVxuICAgICAgVU5JT04gQUxMXG4gICAgICBTRUxFQ1QgJ29uZV92c19yZXN0JywgdGVybSwgY29udHJhc3QsIHRhcmdldCwgbG9nMihmb2xkX2NoYW5nZSksIFwicC52YWx1ZVwiLCAke24xfSwgJHtuMn0gRlJPTSByZWFkX2Nzdl9hdXRvKCdvbmUudnMucmVzdC5jc3YnKVxuICAgICAgVU5JT04gQUxMXG4gICAgICBTRUxFQ1QgJ29uZV92c19hbGwnLCB0ZXJtLCBjb250cmFzdCwgdGFyZ2V0LCBsb2cyKGZvbGRfY2hhbmdlKSwgXCJwLnZhbHVlXCIsICR7bjF9LCAke24yfSBGUk9NIHJlYWRfY3N2X2F1dG8oJ29uZS52cy5hbGwuY3N2JylcbiAgICBgKTtcblxuICAgIGNvbnNvbGUubG9nKFwi4pyFIEdFTkVSQVRPUiBTVUNDRVNTIVwiKTtcbiAgICByZXR1cm4geyByZWFkeTogdHJ1ZSwgdGltZXN0YW1wOiBEYXRlLm5vdygpIH07XG5cbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgY29uc29sZS5lcnJvcihcIuKdjCBHRU5FUkFUT1IgU1FMIEVSUk9SOlwiLCBlcnIpO1xuICAgIHJldHVybiB7IHJlYWR5OiBmYWxzZSwgZXJyb3I6IGVyci5tZXNzYWdlIH07XG4gIH1cbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMzciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2aWV3b2YgYXRvbXhfbWV0YWRhdGEgPSB7XG4gIFxuICBpZiAoIWF0b214X3N1cmdpY2FsX2luZ2VzdG9yIHx8IGF0b214X3N1cmdpY2FsX2luZ2VzdG9yLnN0YXR1cyAhPT0gXCJyZWFkeVwiKSB7XG4gICAgcmV0dXJuIGh0bWxgXG4gICAgICA8ZGl2IHN0eWxlPVwibWFyZ2luLXRvcDogMTBweDsgcGFkZGluZzogMTVweDsgYm9yZGVyOiAxcHggZGFzaGVkICNkZGQ7IGJvcmRlci1yYWRpdXM6IDhweDsgYmFja2dyb3VuZDogI2ZhZmFmYTsgY29sb3I6ICM2NjY7XCI+XG4gICAgICAgIDxoNSBzdHlsZT1cInRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7IGNvbG9yOiAjODg4OyBmb250LXNpemU6IDAuNzVlbTsgbWFyZ2luLWJvdHRvbTogOHB4O1wiPkF0b014IEluZ2VzdG9yIFN0YXR1czwvaDU+XG4gICAgICAgIDxkaXYgc3R5bGU9XCJmb250LXNpemU6IDAuOWVtOyBkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogY2VudGVyOyBnYXA6IDEwcHg7XCI+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cInNwaW5uZXItYm9yZGVyIHNwaW5uZXItYm9yZGVyLXNtIHRleHQtc2Vjb25kYXJ5XCIgcm9sZT1cInN0YXR1c1wiPjwvZGl2PlxuICAgICAgICAgIDxzcGFuPldhaXRpbmcgZm9yIEF0b014IFNJUCByZXN1bHRzIGltcG9ydCBmcm9tIFN0ZXAgMS4uLjwvc3Bhbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICBgO1xuICB9XG5cbiAgXG4gIGNvbnN0IGZvcm0gPSBJbnB1dHMuZm9ybSh7XG4gICAgc3R1ZHlfbmFtZTogIElucHV0cy50ZXh0KHtsYWJlbDogXCJTdHVkeSBOYW1lXCIsIHZhbHVlOiBcIkF0b014IEFuYWx5c2lzXCJ9KSxcbiAgICBkZXNjcmlwdGlvbjogSW5wdXRzLnRleHQoe2xhYmVsOiBcIkRlc2NyaXB0aW9uXCIsIHZhbHVlOiBcIkF0b014IFNJUCBFeHBvcnRcIn0pLFxuICAgIGZvcm11bGE6ICAgICBJbnB1dHMudGV4dCh7bGFiZWw6IFwiTW9kZWwgRm9ybXVsYVwiLCBwbGFjZWhvbGRlcjogXCJlLmcuIH5hbm5vdGF0ZWRfZG9tYWluXCJ9KSxcbiAgICBwcm9jZXNzX2J0bjogSW5wdXRzLmJ1dHRvbihcIvCfmoAgRm9ybWF0IFJlc3VsdHNcIiwge3ZhbHVlOiAwfSlcbiAgfSk7XG5cblxuICBmb3JtLnN0eWxlLmJvcmRlciA9IFwiMXB4IHNvbGlkICNlZWVcIjtcbiAgZm9ybS5zdHlsZS5ib3JkZXJSYWRpdXMgPSBcIjhweFwiO1xuICBmb3JtLnN0eWxlLnBhZGRpbmcgPSBcIjIwcHhcIjtcbiAgZm9ybS5zdHlsZS5iYWNrZ3JvdW5kID0gXCIjZmZmXCI7XG4gIGZvcm0uc3R5bGUubWFyZ2luVG9wID0gXCIxMHB4XCI7XG5cbiAgLy8gUHJlcGVuZCB0aGUgaGVhZGVyIGluc2lkZSB0aGUgZm9ybSBjYXJkXG4gIGNvbnN0IGhlYWRlciA9IGh0bWxgXG4gICAgPGg1IHN0eWxlPVwidGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsgY29sb3I6ICM4ODg7IGZvbnQtc2l6ZTogMC43NWVtOyBtYXJnaW4tYm90dG9tOiAxMnB4OyBib3JkZXItYm90dG9tOiAxcHggc29saWQgI2VlZTsgcGFkZGluZy1ib3R0b206IDhweDtcIj5cbiAgICAgIE9wdGlvbmFsIFN0dWR5IE1ldGFkYXRhXG4gICAgPC9oNT5cbiAgYDtcbiAgZm9ybS5wcmVwZW5kKGhlYWRlcik7XG5cbiAgcmV0dXJuIGZvcm07XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTM4IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiXG5hdG9teF9kb3dubG9hZGVyX21hbmFnZXIgPSB7XG4gIGNvbnN0IGNvbnRhaW5lciA9IGQzLnNlbGVjdChcIiNhdG9teC1kb3dubG9hZC1jb250YWluZXJcIik7XG4gIFxuICAvLyBHdWFyZDogSGlkZSBjb250YWluZXIgaWYgZGF0YSBpc24ndCBwcm9jZXNzZWQgeWV0XG4gIGlmICghYXRvbXhfcGFycXVldF9nZW5lcmF0b3IgfHwgIWF0b214X3BhcnF1ZXRfZ2VuZXJhdG9yLnJlYWR5KSB7XG4gICAgY29udGFpbmVyLnN0eWxlKFwiZGlzcGxheVwiLCBcIm5vbmVcIik7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBjb250YWluZXIuc3R5bGUoXCJkaXNwbGF5XCIsIFwiYmxvY2tcIikuaHRtbChcIlwiKTsgLy8gQ2xlYXIgYW5kIHNob3dcblxuXG4gIGNvbnN0IHVpID0gaHRtbGBcbiAgICA8aDUgc3R5bGU9XCJtYXJnaW4tdG9wOiAwO1wiPvCfmoAgRm9ybWF0dGluZyBDb21wbGV0ZTwvaDU+XG4gICAgPHAgc3R5bGU9XCJmb250LXNpemU6IDAuOWVtOyBjb2xvcjogIzU1NTtcIj5DaG9vc2UgaG93IHlvdSB3b3VsZCBsaWtlIHRvIHByb2NlZWQgd2l0aCB5b3VyIGhhcm1vbml6ZWQgc3R1ZHk6PC9wPlxuICAgIFxuICAgIDxkaXYgY2xhc3M9XCJkLWdyaWQgZ2FwLTIgZC1tZC1ibG9ja1wiPlxuICAgICAgPGJ1dHRvbiBpZD1cImJ0bi1hdG9teC1kb3dubG9hZC1vbmx5XCIgY2xhc3M9XCJidG4gYnRuLW91dGxpbmUtcHJpbWFyeVwiPvCfkr4gRG93bmxvYWQgT25seTwvYnV0dG9uPlxuICAgICAgPGJ1dHRvbiBpZD1cImJ0bi1hdG9teC1sYXVuY2gtb25seVwiIGNsYXNzPVwiYnRuIGJ0bi1vdXRsaW5lLXN1Y2Nlc3NcIj7imqEgTGF1bmNoIE9ubHk8L2J1dHRvbj5cbiAgICAgIDxidXR0b24gaWQ9XCJidG4tYXRvbXgtYm90aFwiIGNsYXNzPVwiYnRuIGJ0bi1wcmltYXJ5XCI+8J+agCBEb3dubG9hZCAmIExhdW5jaDwvYnV0dG9uPlxuICAgIDwvZGl2PlxuICAgIFxuICAgIDxkaXYgaWQ9XCJhdG9teC1kb3dubG9hZC1zdGF0dXNcIiBzdHlsZT1cIm1hcmdpbi10b3A6IDEycHg7IGZvbnQtd2VpZ2h0OiA1MDA7XCI+PC9kaXY+XG4gIGA7XG5cblxuICBjb250YWluZXIubm9kZSgpLmFwcGVuZENoaWxkKHVpKTtcblxuXG4gIGNvbnN0IHN0YXR1cyA9IHVpLnF1ZXJ5U2VsZWN0b3IoXCIjYXRvbXgtZG93bmxvYWQtc3RhdHVzXCIpO1xuICBjb25zdCBidG5Eb3dubG9hZCA9IHVpLnF1ZXJ5U2VsZWN0b3IoXCIjYnRuLWF0b214LWRvd25sb2FkLW9ubHlcIik7XG4gIGNvbnN0IGJ0bkxhdW5jaCA9IHVpLnF1ZXJ5U2VsZWN0b3IoXCIjYnRuLWF0b214LWxhdW5jaC1vbmx5XCIpO1xuICBjb25zdCBidG5Cb3RoID0gdWkucXVlcnlTZWxlY3RvcihcIiNidG4tYXRvbXgtYm90aFwiKTtcblxuXG4gIGNvbnN0IHJ1bkNvbnZlcnNpb24gPSBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjb25uID0gYXdhaXQgZHVja19kYl9jbGllbnQ7XG4gICAgICBjb25zdCBkYiA9IGNvbm4uaW5zdGFuY2UgfHwgY29ubi5kYiB8fCBjb25uO1xuICAgICAgXG5cbiAgICAgIGF3YWl0IGNvbm4ucXVlcnkoYFxuICAgICAgICBDUkVBVEUgT1IgUkVQTEFDRSBWSUVXIHBhaXJ3aXNlX3NjcnViYmVkIEFTIFxuICAgICAgICBTRUxFQ1QgKiBGUk9NIHBhaXJ3aXNlX2ZpbmFsIFdIRVJFIHRlcm0gIT0gJ290aGVyY3RfZXhwcidcbiAgICAgIGApO1xuICAgICAgXG4gICAgICBhd2FpdCBjb25uLnF1ZXJ5KGBcbiAgICAgICAgQ1JFQVRFIE9SIFJFUExBQ0UgVklFVyBlbW1lYW5zX3NjcnViYmVkIEFTIFxuICAgICAgICBTRUxFQ1QgKiBGUk9NIGVtbWVhbnNfZmluYWwgV0hFUkUgdGVybSAhPSAnb3RoZXJjdF9leHByJ1xuICAgICAgYCk7XG4gIFxuXG4gICAgICBjb25zdCB0ZXJtUmVzID0gYXdhaXQgY29ubi5xdWVyeShcIlNFTEVDVCBESVNUSU5DVCB0ZXJtIEZST00gcGFpcndpc2Vfc2NydWJiZWQgTElNSVQgMVwiKTtcbiAgICAgIGNvbnN0IGFjdGl2ZVRlcm0gPSB0ZXJtUmVzLnRvQXJyYXkoKVswXT8udGVybSB8fCBcIlRlcm1cIjtcbiAgICAgIFxuICAgICAgY29uc3QgbGV2ZWxSZXMgPSBhd2FpdCBjb25uLnF1ZXJ5KFwiU0VMRUNUIERJU1RJTkNUIGxldmVsIEZST00gZW1tZWFuc19zY3J1YmJlZCBMSU1JVCAyXCIpO1xuICAgICAgY29uc3QgbGV2ZWxzID0gbGV2ZWxSZXMudG9BcnJheSgpLm1hcChyb3cgPT4gcm93LmxldmVsKTtcbiAgICAgIGNvbnN0IGwxID0gbGV2ZWxzWzBdIHx8ICdMZXZlbF9BJztcbiAgICAgIGNvbnN0IGwyID0gbGV2ZWxzWzFdIHx8IGwxO1xuICBcbiAgICAgIGNvbnNvbGUubG9nKGDwn6e8IEZJTFRFUklORzogUmVtb3ZlZCAnb3RoZXJjdF9leHByJy4gQWN0aXZlIFRlcm06ICR7YWN0aXZlVGVybX1gKTtcbiAgXG5cbiAgICAgIGF3YWl0IGNvbm4ucXVlcnkoXCJDT1BZIChTRUxFQ1QgKiBGUk9NIHBhaXJ3aXNlX3NjcnViYmVkKSBUTyAncGFpcndpc2UucGFycXVldCcgKEZPUk1BVCAnUEFSUVVFVCcpXCIpO1xuICAgICAgYXdhaXQgY29ubi5xdWVyeShcIkNPUFkgKFNFTEVDVCAqIEZST00gZW1tZWFuc19zY3J1YmJlZCkgVE8gJ2VtbWVhbnMucGFycXVldCcgKEZPUk1BVCAnUEFSUVVFVCcpXCIpO1xuICBcblxuICAgICAgYXdhaXQgY29ubi5xdWVyeShgXG4gICAgICAgIENSRUFURSBPUiBSRVBMQUNFIFZJRVcgc3BhdGlhbF9zbWFydF9wbGFjZWhvbGRlciBBU1xuICAgICAgICBTRUxFQ1QgMC4wIGFzIHhfc2xpZGVfbW0sIDAuMCBhcyB5X3NsaWRlX21tLCAxIGFzIHNsaWRlX2lkX251bWVyaWMsICcke2wxfScgYXMgXCIke2FjdGl2ZVRlcm19XCIgVU5JT04gQUxMXG4gICAgICAgIFNFTEVDVCAwLjAsIDEuMCwgMSwgJyR7bDF9JyBVTklPTiBBTExcbiAgICAgICAgU0VMRUNUIDEuMCwgMC4wLCAxLCAnJHtsMn0nIFVOSU9OIEFMTFxuICAgICAgICBTRUxFQ1QgMS4wLCAxLjAsIDEsICcke2wyfSdcbiAgICAgIGApO1xuICAgICAgYXdhaXQgY29ubi5xdWVyeShcIkNPUFkgKFNFTEVDVCAqIEZST00gc3BhdGlhbF9zbWFydF9wbGFjZWhvbGRlcikgVE8gJ2NlbGxfbWV0YWRhdGEucGFycXVldCcgKEZPUk1BVCAnUEFSUVVFVCcpXCIpO1xuICBcblxuICAgICAgY29uc3QgY291bnRSZXMgPSBhd2FpdCBjb25uLnF1ZXJ5KFwiU0VMRUNUIENPVU5UKERJU1RJTkNUIHRhcmdldCkgYXMgbiBGUk9NIHBhaXJ3aXNlX3NjcnViYmVkXCIpO1xuICAgICAgY29uc3QgdGFyZ2V0Q291bnQgPSBOdW1iZXIoY291bnRSZXMudG9BcnJheSgpWzBdLm4pO1xuICAgICAgYXdhaXQgY29ubi5xdWVyeShgXG4gICAgICAgIENPUFkgKFNFTEVDVCAnJHthdG9teF9tZXRhZGF0YS5zdHVkeV9uYW1lfScgYXMgTmFtZSwgJyR7YXRvbXhfbWV0YWRhdGEuZGVzY3JpcHRpb259JyBhcyBEZXNjcmlwdGlvbiwgXG4gICAgICAgICAgICAgICcke2F0b214X21ldGFkYXRhLmZvcm11bGF9JyBhcyBGb3JtYWxhLCAke3RhcmdldENvdW50fSBhcyBcIlRhcmdldHMgdGVzdGVkXCIpIFxuICAgICAgICBUTyAnc3R1ZHlfaGVhZGVyLnBhcnF1ZXQnIChGT1JNQVQgJ1BBUlFVRVQnKWApO1xuICBcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcDogYXdhaXQgZGIuY29weUZpbGVUb0J1ZmZlcigncGFpcndpc2UucGFycXVldCcpLFxuICAgICAgICBlOiBhd2FpdCBkYi5jb3B5RmlsZVRvQnVmZmVyKCdlbW1lYW5zLnBhcnF1ZXQnKSxcbiAgICAgICAgbTogYXdhaXQgZGIuY29weUZpbGVUb0J1ZmZlcignY2VsbF9tZXRhZGF0YS5wYXJxdWV0JyksXG4gICAgICAgIGg6IGF3YWl0IGRiLmNvcHlGaWxlVG9CdWZmZXIoJ3N0dWR5X2hlYWRlci5wYXJxdWV0JylcbiAgICAgIH07XG4gICAgfTtcblxuICBjb25zdCBjcmVhdGVaaXBCbG9iID0gYXN5bmMgKGJ1ZmZlcnMpID0+IHtcbiAgICBjb25zdCB6ID0gYXdhaXQgaW1wb3J0KFwiaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9AemlwLmpzL3ppcC5qc0AyLjcuMzQvK2VzbVwiKTtcbiAgICBjb25zdCB6aXBXcml0ZXIgPSBuZXcgei5aaXBXcml0ZXIobmV3IHouQmxvYldyaXRlcihcImFwcGxpY2F0aW9uL3ppcFwiKSk7XG4gICAgYXdhaXQgemlwV3JpdGVyLmFkZChcInBhaXJ3aXNlLnBhcnF1ZXRcIiwgbmV3IHouVWludDhBcnJheVJlYWRlcihuZXcgVWludDhBcnJheShidWZmZXJzLnApKSk7XG4gICAgYXdhaXQgemlwV3JpdGVyLmFkZChcImVtbWVhbnMucGFycXVldFwiLCBuZXcgei5VaW50OEFycmF5UmVhZGVyKG5ldyBVaW50OEFycmF5KGJ1ZmZlcnMuZSkpKTtcbiAgICBhd2FpdCB6aXBXcml0ZXIuYWRkKFwiY2VsbF9tZXRhZGF0YS5wYXJxdWV0XCIsIG5ldyB6LlVpbnQ4QXJyYXlSZWFkZXIobmV3IFVpbnQ4QXJyYXkoYnVmZmVycy5tKSkpO1xuICAgIGF3YWl0IHppcFdyaXRlci5hZGQoXCJzdHVkeV9oZWFkZXIucGFycXVldFwiLCBuZXcgei5VaW50OEFycmF5UmVhZGVyKG5ldyBVaW50OEFycmF5KGJ1ZmZlcnMuaCkpKTtcbiAgICByZXR1cm4gYXdhaXQgemlwV3JpdGVyLmNsb3NlKCk7XG4gIH07XG5cbiAgY29uc3QgdHJpZ2dlckRvd25sb2FkID0gKGJsb2IpID0+IHtcbiAgICBjb25zdCB1cmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xuICAgIGNvbnN0IGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYVwiKTtcbiAgICBhLmhyZWYgPSB1cmw7IGEuZG93bmxvYWQgPSBgJHthdG9teF9tZXRhZGF0YS5zdHVkeV9uYW1lfV9zbWlERS56aXBgO1xuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoYSk7XG4gICAgYS5jbGljaygpO1xuICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoYSk7XG4gIH07XG5cblxuICBidG5Eb3dubG9hZC5vbmNsaWNrID0gYXN5bmMgKCkgPT4ge1xuICAgIHN0YXR1cy5pbm5lckhUTUwgPSBcIuKame+4jyBHZW5lcmF0aW5nIFppcC4uLlwiO1xuICAgIGNvbnN0IGJ1ZmZlcnMgPSBhd2FpdCBydW5Db252ZXJzaW9uKCk7XG4gICAgY29uc3QgYmxvYiA9IGF3YWl0IGNyZWF0ZVppcEJsb2IoYnVmZmVycyk7XG4gICAgdHJpZ2dlckRvd25sb2FkKGJsb2IpO1xuICAgIHN0YXR1cy5pbm5lckhUTUwgPSBcIuKchSBEb3dubG9hZCBDb21wbGV0ZS5cIjtcbiAgfTtcblxuICBidG5MYXVuY2gub25jbGljayA9IGFzeW5jICgpID0+IHtcbiAgICBzdGF0dXMuaW5uZXJIVE1MID0gXCLwn5qAIExhdW5jaGluZyBTdHVkeS4uLlwiO1xuICAgIGNvbnN0IGJ1ZmZlcnMgPSBhd2FpdCBydW5Db252ZXJzaW9uKCk7XG4gICAgY29uc3QgYmxvYiA9IGF3YWl0IGNyZWF0ZVppcEJsb2IoYnVmZmVycyk7XG5cbiAgICBtdXRhYmxlIG5ld196aXBfZGF0YSA9IHtcbiAgICAgIGlkOiBEYXRlLm5vdygpLFxuICAgICAgZmlsZW5hbWU6IGAke2F0b214X21ldGFkYXRhLnN0dWR5X25hbWV9X3NtaURFLnppcGAsXG4gICAgICBkYXRhOiBuZXcgVWludDhBcnJheShhd2FpdCBibG9iLmFycmF5QnVmZmVyKCkpXG4gICAgfTtcbiAgICBzdGF0dXMuaW5uZXJIVE1MID0gXCLinIUgU3R1ZHkgTGF1bmNoZWQhIENoZWNrIHRoZSBzaWRlYmFyLlwiO1xuICB9O1xuXG4gIGJ0bkJvdGgub25jbGljayA9IGFzeW5jICgpID0+IHtcbiAgICBzdGF0dXMuaW5uZXJIVE1MID0gXCLimpnvuI8gUHJvY2Vzc2luZyBCb3RoLi4uXCI7XG4gICAgY29uc3QgYnVmZmVycyA9IGF3YWl0IHJ1bkNvbnZlcnNpb24oKTtcbiAgICBjb25zdCBibG9iID0gYXdhaXQgY3JlYXRlWmlwQmxvYihidWZmZXJzKTtcbiAgICB0cmlnZ2VyRG93bmxvYWQoYmxvYik7XG4gICAgbXV0YWJsZSBuZXdfemlwX2RhdGEgPSB7XG4gICAgICBpZDogRGF0ZS5ub3coKSxcbiAgICAgIGZpbGVuYW1lOiBgJHthdG9teF9tZXRhZGF0YS5zdHVkeV9uYW1lfV9zbWlERS56aXBgLFxuICAgICAgZGF0YTogbmV3IFVpbnQ4QXJyYXkoYXdhaXQgYmxvYi5hcnJheUJ1ZmZlcigpKVxuICAgIH07XG4gICAgc3RhdHVzLmlubmVySFRNTCA9IFwi4pyFIFN1Y2Nlc3MhIFppcCBkb3dubG9hZGVkIGFuZCBTdHVkeSBsYXVuY2hlZC5cIjtcbiAgfTtcblxuICByZXR1cm4gdWk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTM5IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiXG52aWV3b2YgbnVkZ2Vfdm9sY2FubyA9IHtcbiAgY29uc3Qgd2lkdGggPSA4MDA7XG4gIGNvbnN0IGhlaWdodCA9IDUwMDtcbiAgXG4gIGxldCBjdXJyZW50X2ZjID0gMS4wO1xuICBsZXQgY3VycmVudF9wdmFsID0gMC4wNTtcblxuICBjb25zdCBtb2NrX2RhdGEgPSBBcnJheS5mcm9tKHtsZW5ndGg6IDMwMH0sIChfLCBpKSA9PiAoe1xuICAgIGxvZzJmYzogKE1hdGgucmFuZG9tKCkgLSAwLjUpICogOCxcbiAgICBwX3ZhbHVlOiBNYXRoLm1heCgwLjAwMDEsIE1hdGgucmFuZG9tKCkgKiAwLjEpXG4gIH0pKTtcblxuICAvLyBTdHlsZWQgQ29udGFpbmVyXG4gIGNvbnN0IGNvbnRhaW5lciA9IGh0bWxgXG4gICAgPGRpdiBzdHlsZT1cImJvcmRlcjogMXB4IHNvbGlkICNkZWUyZTY7IGJvcmRlci1yYWRpdXM6IDEycHg7IHBhZGRpbmc6IDI1cHg7IGJhY2tncm91bmQ6ICNmZmZmZmY7IGJveC1zaGFkb3c6IDAgNHB4IDEwcHggcmdiYSgwLDAsMCwwLjAzKTtcIj5cbiAgICAgIFxuICAgICAgPGRpdiBzdHlsZT1cImRpc3BsYXk6IGZsZXg7IGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsgYWxpZ24taXRlbXM6IGZsZXgtZW5kOyBtYXJnaW4tYm90dG9tOiAyMHB4OyBib3JkZXItYm90dG9tOiAycHggc29saWQgI2Y4ZjlmYTsgcGFkZGluZy1ib3R0b206IDE1cHg7XCI+XG4gICAgICAgIDxkaXYgc3R5bGU9XCJkaXNwbGF5OiBmbGV4OyBnYXA6IDMwcHg7XCI+XG4gICAgICAgICAgXG4gICAgICAgICAgPGRpdiBzdHlsZT1cImRpc3BsYXk6IGZsZXg7IGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47IGdhcDogOHB4O1wiPlxuICAgICAgICAgICAgPGxhYmVsIHN0eWxlPVwidGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsgY29sb3I6ICM5OTk7IGZvbnQtc2l6ZTogMC43ZW07IGxldHRlci1zcGFjaW5nOiAwLjA1ZW07IGZvbnQtd2VpZ2h0OiA3MDA7XCI+VGhyZXNob2xkOiBsb2cyRkM8L2xhYmVsPlxuICAgICAgICAgICAgPGRpdiBzdHlsZT1cImRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGdhcDogMTBweDtcIj5cbiAgICAgICAgICAgICAgPGJ1dHRvbiBpZD1cImZjLWRvd25cIiBjbGFzcz1cImJ0biBidG4tb3V0bGluZS1zZWNvbmRhcnkgYnRuLXNtXCIgc3R5bGU9XCJ3aWR0aDogMzJweDtcIj4tPC9idXR0b24+XG4gICAgICAgICAgICAgIDxzcGFuIGlkPVwiZmMtbGFiZWxcIiBzdHlsZT1cImZvbnQtZmFtaWx5OiBtb25vc3BhY2U7IGZvbnQtd2VpZ2h0OiBib2xkOyB3aWR0aDogNDVweDsgdGV4dC1hbGlnbjogY2VudGVyO1wiPjEuMDA8L3NwYW4+XG4gICAgICAgICAgICAgIDxidXR0b24gaWQ9XCJmYy11cFwiIGNsYXNzPVwiYnRuIGJ0bi1vdXRsaW5lLXNlY29uZGFyeSBidG4tc21cIiBzdHlsZT1cIndpZHRoOiAzMnB4O1wiPis8L2J1dHRvbj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgPGRpdiBzdHlsZT1cImRpc3BsYXk6IGZsZXg7IGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47IGdhcDogOHB4O1wiPlxuICAgICAgICAgICAgPGxhYmVsIHN0eWxlPVwidGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsgY29sb3I6ICM5OTk7IGZvbnQtc2l6ZTogMC43ZW07IGxldHRlci1zcGFjaW5nOiAwLjA1ZW07IGZvbnQtd2VpZ2h0OiA3MDA7XCI+VGhyZXNob2xkOiBQLVZhbHVlPC9sYWJlbD5cbiAgICAgICAgICAgIDxkaXYgc3R5bGU9XCJkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogY2VudGVyOyBnYXA6IDEwcHg7XCI+XG4gICAgICAgICAgICAgIDxidXR0b24gaWQ9XCJwdmFsLWRvd25cIiBjbGFzcz1cImJ0biBidG4tb3V0bGluZS1zZWNvbmRhcnkgYnRuLXNtXCIgc3R5bGU9XCJ3aWR0aDogMzJweDtcIj4rPC9idXR0b24+XG4gICAgICAgICAgICAgIDxzcGFuIGlkPVwicHZhbC1sYWJlbFwiIHN0eWxlPVwiZm9udC1mYW1pbHk6IG1vbm9zcGFjZTsgZm9udC13ZWlnaHQ6IGJvbGQ7IHdpZHRoOiA2MHB4OyB0ZXh0LWFsaWduOiBjZW50ZXI7XCI+MC4wNTA8L3NwYW4+XG4gICAgICAgICAgICAgIDxidXR0b24gaWQ9XCJwdmFsLXVwXCIgY2xhc3M9XCJidG4gYnRuLW91dGxpbmUtc2Vjb25kYXJ5IGJ0bi1zbVwiIHN0eWxlPVwid2lkdGg6IDMycHg7XCI+LTwvYnV0dG9uPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuXG4gICAgICAgIDxkaXYgaWQ9XCJzdGF0LXN1bW1hcnlcIiBzdHlsZT1cImZvbnQtc2l6ZTogMC44ZW07IGNvbG9yOiAjNjY2OyBmb250LXN0eWxlOiBpdGFsaWM7XCI+XG4gICAgICAgICAgVXBkYXRpbmcgcmVzdWx0cy4uLlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuXG4gICAgICA8ZGl2IGlkPVwicGxvdC1hcmVhXCIgc3R5bGU9XCJiYWNrZ3JvdW5kOiAjZmRmZGZkOyBib3JkZXItcmFkaXVzOiA4cHg7XCI+PC9kaXY+XG4gICAgPC9kaXY+XG4gIGA7XG5cbiAgZnVuY3Rpb24gcmVuZGVyKCkge1xuICAgIGNvbnN0IHBsb3QgPSBQbG90LnBsb3Qoe1xuICAgICAgd2lkdGgsIGhlaWdodDogNDUwLCBncmlkOiB0cnVlLFxuICAgICAgeDogeyBsYWJlbDogXCJsb2cyRm9sZENoYW5nZVwiLCBkb21haW46IFstNSwgNV0gfSxcbiAgICAgIHk6IHsgbGFiZWw6IFwiLWxvZzEwIFAtdmFsdWVcIiwgZG9tYWluOiBbMCwgNV0gfSxcbiAgICAgIG1hcmtzOiBbXG4gICAgICAgIFBsb3QucnVsZVgoWy1jdXJyZW50X2ZjLCBjdXJyZW50X2ZjXSwge3N0cm9rZTogXCIjYjQ0Njk3XCIsIHN0cm9rZVdpZHRoOiAyLCBzdHJva2VEYXNoYXJyYXk6IFwiNCw0XCJ9KSxcbiAgICAgICAgUGxvdC5ydWxlWShbLU1hdGgubG9nMTAoY3VycmVudF9wdmFsKV0sIHtzdHJva2U6IFwiIzNDM0Y0MFwiLCBzdHJva2VXaWR0aDogMiwgc3Ryb2tlRGFzaGFycmF5OiBcIjQsNFwifSksXG4gICAgICAgIFBsb3QuZG90KG1vY2tfZGF0YSwge1xuICAgICAgICAgIHg6IFwibG9nMmZjXCIsIFxuICAgICAgICAgIHk6IGQgPT4gLU1hdGgubG9nMTAoZC5wX3ZhbHVlKSxcbiAgICAgICAgICByOiAzLFxuICAgICAgICAgIGZpbGw6IGQgPT4gKE1hdGguYWJzKGQubG9nMmZjKSA+PSBjdXJyZW50X2ZjICYmIGQucF92YWx1ZSA8PSBjdXJyZW50X3B2YWwpID8gXCIjYjQ0Njk3XCIgOiBcIiNkZWUyZTZcIixcbiAgICAgICAgICBmaWxsT3BhY2l0eTogMC43XG4gICAgICAgIH0pXG4gICAgICBdXG4gICAgfSk7XG4gICAgXG4gICAgLy8gQ2FsY3VsYXRlIFN0YXRzXG4gICAgY29uc3Qgc2lnQ291bnQgPSBtb2NrX2RhdGEuZmlsdGVyKGQgPT4gTWF0aC5hYnMoZC5sb2cyZmMpID49IGN1cnJlbnRfZmMgJiYgZC5wX3ZhbHVlIDw9IGN1cnJlbnRfcHZhbCkubGVuZ3RoO1xuICAgIFxuICAgIGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFwiI3Bsb3QtYXJlYVwiKS5yZXBsYWNlQ2hpbGRyZW4ocGxvdCk7XG4gICAgY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoXCIjZmMtbGFiZWxcIikudGV4dENvbnRlbnQgPSBjdXJyZW50X2ZjLnRvRml4ZWQoMik7XG4gICAgY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoXCIjcHZhbC1sYWJlbFwiKS50ZXh0Q29udGVudCA9IGN1cnJlbnRfcHZhbC50b0ZpeGVkKDMpO1xuICAgIGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFwiI3N0YXQtc3VtbWFyeVwiKS50ZXh0Q29udGVudCA9IGAke3NpZ0NvdW50fSBzaWduaWZpY2FudCB0YXJnZXRzIGlkZW50aWZpZWRgO1xuICAgIFxuICAgIGNvbnRhaW5lci52YWx1ZSA9IHtmYzogY3VycmVudF9mYywgcHZhbDogY3VycmVudF9wdmFsfTtcbiAgICBjb250YWluZXIuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoXCJpbnB1dFwiKSk7XG4gIH1cblxuICAvLyBCdXR0b24gTGlzdGVuZXJzIHdpdGggTG9naWNcbiAgY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoXCIjZmMtdXBcIikub25jbGljayA9ICgpID0+IHsgY3VycmVudF9mYyA9IE1hdGgubWluKDUsIGN1cnJlbnRfZmMgKyAwLjA1KTsgcmVuZGVyKCk7IH07XG4gIGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFwiI2ZjLWRvd25cIikub25jbGljayA9ICgpID0+IHsgY3VycmVudF9mYyA9IE1hdGgubWF4KDAsIGN1cnJlbnRfZmMgLSAwLjA1KTsgcmVuZGVyKCk7IH07XG4gIFxuICAvLyBQLVZhbHVlIG51ZGdlIChsb2dhcml0aG1pYyBzdGVwIGZlZWxzIGJldHRlciBmb3IgcC12YWx1ZXMpXG4gIGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFwiI3B2YWwtdXBcIikub25jbGljayA9ICgpID0+IHsgY3VycmVudF9wdmFsID0gTWF0aC5tYXgoMC4wMDAwMSwgY3VycmVudF9wdmFsICogMC41KTsgcmVuZGVyKCk7IH07XG4gIGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFwiI3B2YWwtZG93blwiKS5vbmNsaWNrID0gKCkgPT4geyBjdXJyZW50X3B2YWwgPSBNYXRoLm1pbigxLCBjdXJyZW50X3B2YWwgKiAyLjApOyByZW5kZXIoKTsgfTtcblxuICByZW5kZXIoKTtcbiAgcmV0dXJuIGNvbnRhaW5lcjtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNDAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJcbntcbiAgY29uc3QgY2F0Y2hSdW50aW1lTG9hZGluZ0Vycm9ycyA9ICgpID0+IHtcbiAgICAvLyBUYXJnZXQgdGhlIHNwZWNpZmljIFF1YXJ0byBjYWxsb3V0IHN0cnVjdHVyZSB5b3UgY2FwdHVyZWRcbiAgICBjb25zdCBlcnJvcnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcub2JzZXJ2YWJsZWhxLS1lcnJvciwgLm9qcy1pbi1hLWJveC13YWl0aW5nLWZvci1tb2R1bGUtaW1wb3J0Jyk7XG4gICAgXG4gICAgZXJyb3JzLmZvckVhY2goZWwgPT4ge1xuICAgICAgY29uc3QgY2FsbG91dCA9IGVsLnF1ZXJ5U2VsZWN0b3IoJy5jYWxsb3V0LWltcG9ydGFudCcpO1xuICAgICAgaWYgKGNhbGxvdXQpIHtcbiAgICAgICAgY2FsbG91dC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOyBcbiAgICAgICAgXG4gICAgICAgIGlmICghZWwucXVlcnlTZWxlY3RvcignLmN1c3RvbS1sb2FkaW5nLWxhYmVsJykpIHtcbiAgICAgICAgICBjb25zdCBsYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgIGxhYmVsLmNsYXNzTmFtZSA9ICdjdXN0b20tbG9hZGluZy1sYWJlbCc7XG4gICAgICAgICAgbGFiZWwuaW5uZXJIVE1MID0gYFxuICAgICAgICAgICAgPGRpdiBzdHlsZT1cInBhZGRpbmc6IDJyZW07IGJvcmRlcjogMXB4IGRhc2hlZCAjY2NjOyBib3JkZXItcmFkaXVzOiA4cHg7IFxuICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZDogI2Y5ZjlmOTsgY29sb3I6ICM4ODg7IHRleHQtYWxpZ246IGNlbnRlcjsgZm9udC1zdHlsZTogaXRhbGljO1wiPlxuICAgICAgICAgICAgICDijJsgSW5pdGlhbGl6aW5nIERhc2hib2FyZCBDb21wb25lbnRzLi4uXG4gICAgICAgICAgICA8L2Rpdj5gO1xuICAgICAgICAgIGVsLnByZXBlbmQobGFiZWwpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH07XG5cbiAgY2F0Y2hSdW50aW1lTG9hZGluZ0Vycm9ycygpO1xuXG4gIGNvbnN0IG9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoY2F0Y2hSdW50aW1lTG9hZGluZ0Vycm9ycyk7XG4gIG9ic2VydmVyLm9ic2VydmUoZG9jdW1lbnQuYm9keSwgeyBjaGlsZExpc3Q6IHRydWUsIHN1YnRyZWU6IHRydWUgfSk7XG5cbiAgaW52YWxpZGF0aW9uLnRoZW4oKCkgPT4gb2JzZXJ2ZXIuZGlzY29ubmVjdCgpKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnc2VsZWN0ZWRfc3R1ZHknKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnbmV3X3ppcF9maWxlJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2Flc3RoZXRpY3NfcmF3JykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3BhaXJ3aXNlX3NlYXJjaCcpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdwYWlyd2lzZV90YWJsZScpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCd0ZXJtX3NlbGVjdGlvbicpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdjb250cmFzdF9zZWxlY3Rpb24nKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnc2F2ZV9zZXR0aW5ncycpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdzYXZlX2J0bicpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCd0ZXJtX2NvcHknKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnY29udHJhc3RfY29weScpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdtZWFuc19yYXcnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnbWVhbnNfc2VhcmNoJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ21lYW5zX3RhYmxlJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3NwYXRpYWxfb3B0aW9ucycpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdsb2dfc2NhbGVfb3B0JykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2ZpbHRlcl9jb2wnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnZmlsdGVyX3ZhbHMnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnc2xpZGVfc2VsZWN0aW9uJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3Rlcm1fY29weTInKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnY29udHJhc3RfY29weTInKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnYXRvbXhfemlwX2ZpbGUnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnYXRvbXhfbWV0YWRhdGEnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnbnVkZ2Vfdm9sY2FubycpIn1dfQ==
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../../bbytes/de_explorer";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "../..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/nanostring-biostats\.github\.io\/CosMx-Analysis-Scratch-Space");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="../../license.html">
<p>License</p>
</a>
  </li>  
</ul>
    <div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>

<script type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (_event) {
  if (window.bslib.Card) {
    window.bslib.Card.initializeAllCards();
  }
}); 
</script>
  



</body></html>