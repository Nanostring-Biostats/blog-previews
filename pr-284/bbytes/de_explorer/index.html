<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.30">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Differential Expression Explorer – Blog</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../assets/logo_Bruker_black.png" rel="icon" type="image/png">
<script src="../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-3a01e2046221230fdceeea94b1ec5d67.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-a4a11d514c7d463668e07712114998e6.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-27d3d13f624089e27c0f86020ba708d8.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script src="../../site_libs/quarto-dashboard/quarto-dashboard.js"></script>
<script src="../../site_libs/quarto-dashboard/stickythead.js"></script>
<script src="../../site_libs/quarto-dashboard/datatables.min.js" kdttablesentinel="true"></script>
<script src="../../site_libs/quarto-dashboard/pdfmake.min.js" kdttablesentinel="true"></script>
<script src="../../site_libs/quarto-dashboard/vfs_fonts.js" kdttablesentinel="true"></script>
<script src="../../site_libs/quarto-dashboard/web-components.js" type="module"></script>
<script src="../../site_libs/quarto-dashboard/components.js"></script>
<link href="../../site_libs/quarto-dashboard/datatables.min.css" rel="stylesheet" kdttablesentinel="true">
<script src="../../site_libs/quarto-contrib/live-runtime/live-runtime.js" type="module"></script>
<link href="../../site_libs/quarto-contrib/live-runtime/live-runtime.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-29W4MW0Y2W"></script>

<script type="text/plain" cookie-consent="tracking">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-29W4MW0Y2W', { 'anonymize_ip': true});
</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"implied",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary","functionality","tracking","targeting"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  ,
"language":"en"
  });
});
</script> 
  
<script type="module" src="../../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="../../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">


</head>

<body class="quarto-dashboard nav-fixed dashboard-fill dashboard-sidebar fullcontent">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../.././assets/logo_Bruker_white.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">Topics</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../guides/index.html"> 
<span class="menu-text">Guides (new!)</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../bbytes/index.html"> 
<span class="menu-text">Browser Bytes (new!)</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../link-to-code.html"> 
<span class="menu-text">Source Code</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Nanostring-Biostats/CosMx-Analysis-Scratch-Space"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/company/bruker-spatial"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
<header id="quarto-dashboard-header">
<nav class="navbar navbar-expand-md slim" data-bs-theme="dark">
  <div class="navbar-container container-fluid">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#dashboard-collapse" aria-controls="dashboard-collapse" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>    


    <div class="navbar-brand-container">       

      <div class="navbar-title">
        <div class="navbar-title-text"><a href="#">Differential Expression Explorer</a></div>
        
        
      </div>
    </div>
<div id="dashboard-collapse" class="navbar-collapse collapse"><ul class="navbar-nav navbar-nav-scroll me-auto" role="tablist"><li class="nav-item" role="presentation"><a id="tab-volcano-plots" class="nav-link active" data-bs-toggle="tab" role="tab" data-bs-target="#volcano-plots" data-scrolling="false" href="#volcano-plots" aria-controls="volcano-plots" aria-selected="true"><span class="nav-link-text">Volcano Plots</span></a></li><li class="nav-item" role="presentation"><a id="tab-marginal-means" class="nav-link" data-bs-toggle="tab" role="tab" data-bs-target="#marginal-means" data-scrolling="false" href="#marginal-means" aria-controls="marginal-means" aria-selected="false"><span class="nav-link-text">Marginal Means</span></a></li><li class="nav-item" role="presentation"><a id="tab-spatial-plots" class="nav-link" data-bs-toggle="tab" role="tab" data-bs-target="#spatial-plots" data-scrolling="false" href="#spatial-plots" aria-controls="spatial-plots" aria-selected="false"><span class="nav-link-text">Spatial Plots</span></a></li><li class="nav-item" role="presentation"><a id="tab-use-your-own-data" class="nav-link" data-bs-toggle="tab" role="tab" data-bs-target="#use-your-own-data" data-scrolling="true" href="#use-your-own-data" aria-controls="use-your-own-data" aria-selected="false"><span class="nav-link-text">Use Your Own Data</span></a></li><li class="nav-item" role="presentation"><a id="tab-advanced" class="nav-link" data-bs-toggle="tab" role="tab" data-bs-target="#advanced" data-scrolling="false" href="#advanced" aria-controls="advanced" aria-selected="false"><span class="nav-link-text">Advanced</span></a></li><li class="nav-item" role="presentation"><a id="tab-r-console" class="nav-link" data-bs-toggle="tab" role="tab" data-bs-target="#r-console" data-scrolling="false" href="#r-console" aria-controls="r-console" aria-selected="false"><span class="nav-link-text">R Console</span></a></li></ul></div></div>
</nav>
</header></header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-layout-custom page-navbar quarto-dashboard-content bslib-gap-spacing html-fill-container bslib-page-fill quarto-dashboard-pages dashboard-sidebar-container">
<!-- sidebar -->
<!-- margin-sidebar -->
<!-- main -->

<!-- Note: do not remove the following line. It is used when rendering. -->
<p>Welcome to the <strong>Differential Expression Explorer</strong>, a serverless dashboard for interactive analysis of CosMx SMI differential expression results. This tool utilizes WebAssembly <a href="https://docs.r-wasm.org/webr/latest/" target="_blank">(WebR)</a> and <a href="https://quarto.org/docs/interactive/ojs/" target="_blank">ObservableJS</a> to run entirely in your web browser, allowing you to visualize <strong>Volcano Plots</strong>, <strong>Marginal Means</strong>, and <strong>Spatial Mappings</strong> without uploading data to a remote server. You can explore existing DE results that we’ve added or load your own results. Advanced users should check out the <code>Advanced</code> tab if they want to customize their volcano plot even further.</p>
<div class="callout callout-style-simple callout-warning bslib-grid-item">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Beta Notice:</strong> This dashboard is currently in an <strong>experimental / beta testing phase</strong>. Features, performance, and data formats are subject to change. When you first load the site, you will see temporary <code>OJS Runtime Error</code> messages displayed until data are initialized. Please report any issues you encounter.</p>
</div>
</div>
</div>
<div class="bslib-sidebar-layout html-fill-item html-fill-container" data-bslib-sidebar-open="desktop" data-bslib-sidebar-init="true" data-bslib-sidebar-border="false" data-bslib-sidebar-border-radius="false"><div class="main html-fill-container html-fill-item"><div class="sidebar-content html-fill-item html-fill-container">
<div class="tab-content bslib-grid html-fill-item html-fill-container" style="display: grid; grid-template-columns: minmax(3em, 1fr);
grid-auto-rows: minmax(0, 1fr);">
<div id="volcano-plots" class="dashboard-page tab-pane show active html-fill-item html-fill-container" data-orientation="rows" aria-labelledby="tab-volcano-plots">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, 100fr); grid-auto-columns: minmax(0, 1fr);">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-columns: minmax(3em, 60fr) minmax(3em, 40fr);
grid-auto-rows: minmax(0, 1fr);">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, 50fr) minmax(3em, 50fr); grid-auto-columns: minmax(0, 1fr);">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-columns: minmax(3em, 50fr) minmax(3em, 50fr);
grid-auto-rows: minmax(0, 1fr);">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, 60fr) minmax(3em, 40fr); grid-auto-columns: minmax(0, 1fr);">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-columns: minmax(3em, 1fr);
grid-auto-rows: minmax(0, 1fr);">
<div class="card html-fill-item html-fill-container bslib-card" data-title="LOADED RESULTS" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-header"><div class="card-title html-fill-item html-fill-container"><span style="display: inline">
LOADED RESULTS
</span></div></div>
<div class="cell card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb13" data-startfrom="616" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 615;"><span id="cb13-616"><a href="#cb13-616" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb13-617"><a href="#cb13-617" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> study_data_payload<span class="op">;</span></span>
<span id="cb13-618"><a href="#cb13-618" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> contrast <span class="op">=</span> contrast_selection<span class="op">;</span> </span>
<span id="cb13-619"><a href="#cb13-619" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> volcano <span class="op">=</span> current_volcano_data <span class="op">||</span> []<span class="op">;</span></span>
<span id="cb13-620"><a href="#cb13-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-621"><a href="#cb13-621" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>data <span class="op">||</span> <span class="op">!</span>data<span class="op">.</span><span class="at">header_data</span> <span class="op">||</span> data<span class="op">.</span><span class="at">header_data</span><span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb13-622"><a href="#cb13-622" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">md</span><span class="vs">`_Waiting for study data..._`</span><span class="op">;</span></span>
<span id="cb13-623"><a href="#cb13-623" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-624"><a href="#cb13-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-625"><a href="#cb13-625" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> row <span class="op">=</span> data<span class="op">.</span><span class="at">header_data</span>[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb13-626"><a href="#cb13-626" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-627"><a href="#cb13-627" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pretty_contrast <span class="op">=</span> contrast </span>
<span id="cb13-628"><a href="#cb13-628" aria-hidden="true" tabindex="-1"></a>    <span class="op">?</span> contrast<span class="op">.</span><span class="fu">replace</span>(<span class="st">" / "</span><span class="op">,</span> <span class="st">" vs. "</span>) </span>
<span id="cb13-629"><a href="#cb13-629" aria-hidden="true" tabindex="-1"></a>    <span class="op">:</span> <span class="st">"None selected"</span><span class="op">;</span></span>
<span id="cb13-630"><a href="#cb13-630" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-631"><a href="#cb13-631" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> count <span class="op">=</span> volcano<span class="op">.</span><span class="at">length</span> <span class="op">?</span> volcano<span class="op">.</span><span class="at">length</span><span class="op">.</span><span class="fu">toLocaleString</span>() <span class="op">:</span> <span class="st">"0"</span><span class="op">;</span></span>
<span id="cb13-632"><a href="#cb13-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-633"><a href="#cb13-633" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">html</span><span class="vs">`</span></span>
<span id="cb13-634"><a href="#cb13-634" aria-hidden="true" tabindex="-1"></a><span class="vs">  &lt;div style="font-size: 0.9em; color: #444;"&gt;</span></span>
<span id="cb13-635"><a href="#cb13-635" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span></span>
<span id="cb13-636"><a href="#cb13-636" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;h5 style="text-transform: uppercase; color: #888; font-size: 0.8em; margin-bottom: 4px;"&gt;Study Description&lt;/h5&gt;</span></span>
<span id="cb13-637"><a href="#cb13-637" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;p style="margin-bottom: 16px;"&gt;</span><span class="sc">${</span>row<span class="op">.</span><span class="at">Description</span> <span class="op">||</span> <span class="st">"No description available."</span><span class="sc">}</span><span class="vs">&lt;/p&gt;</span></span>
<span id="cb13-638"><a href="#cb13-638" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span></span>
<span id="cb13-639"><a href="#cb13-639" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;h5 style="text-transform: uppercase; color: #888; font-size: 0.8em; margin-bottom: 4px;"&gt;Model Formula&lt;/h5&gt;</span></span>
<span id="cb13-640"><a href="#cb13-640" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;div style="background: #f4f4f4; padding: 8px; border-radius: 4px; font-family: monospace; color: #d63384; margin-bottom: 16px;"&gt;</span></span>
<span id="cb13-641"><a href="#cb13-641" aria-hidden="true" tabindex="-1"></a><span class="vs">      </span><span class="sc">${</span>row<span class="op">.</span><span class="at">Formala</span> <span class="op">||</span> <span class="st">"NA"</span><span class="sc">}</span></span>
<span id="cb13-642"><a href="#cb13-642" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/div&gt;</span></span>
<span id="cb13-643"><a href="#cb13-643" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span></span>
<span id="cb13-644"><a href="#cb13-644" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;div style="display: flex; gap: 20px; border-top: 1px solid #eee; padding-top: 12px;"&gt;</span></span>
<span id="cb13-645"><a href="#cb13-645" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div&gt;</span></span>
<span id="cb13-646"><a href="#cb13-646" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;h5 style="text-transform: uppercase; color: #888; font-size: 0.8em; margin-bottom: 4px;"&gt;Selected Contrast&lt;/h5&gt;</span></span>
<span id="cb13-647"><a href="#cb13-647" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;div style="font-weight: 500; color: #007bff;"&gt;</span><span class="sc">${</span>pretty_contrast<span class="sc">}</span><span class="vs">&lt;/div&gt;</span></span>
<span id="cb13-648"><a href="#cb13-648" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/div&gt;</span></span>
<span id="cb13-649"><a href="#cb13-649" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div&gt;</span></span>
<span id="cb13-650"><a href="#cb13-650" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;h5 style="text-transform: uppercase; color: #888; font-size: 0.8em; margin-bottom: 4px;"&gt;Targets Tested&lt;/h5&gt;</span></span>
<span id="cb13-651"><a href="#cb13-651" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;div style="font-weight: bold;"&gt;</span><span class="sc">${</span>count<span class="sc">}</span><span class="vs">&lt;/div&gt;</span></span>
<span id="cb13-652"><a href="#cb13-652" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/div&gt;</span></span>
<span id="cb13-653"><a href="#cb13-653" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/div&gt;</span></span>
<span id="cb13-654"><a href="#cb13-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-655"><a href="#cb13-655" aria-hidden="true" tabindex="-1"></a><span class="vs">  &lt;/div&gt;</span></span>
<span id="cb13-656"><a href="#cb13-656" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span><span class="op">;</span></span>
<span id="cb13-657"><a href="#cb13-657" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div id="ojs-cell-13" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div>
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-columns: minmax(3em, 1fr);
grid-auto-rows: minmax(0, 1fr);">
<div class="card html-fill-item html-fill-container bslib-card" data-title="SUMMARY STATISTICS" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-header"><div class="card-title html-fill-item html-fill-container"><span style="display: inline">
SUMMARY STATISTICS
</span></div></div>
<div class="cell card-body html-fill-item html-fill-container" data-autorun="true" data-input="vplot_stats">
<div class="html-fill-item html-fill-container">
<div id="webr-6" class="exercise-cell html-fill-item html-fill-container">

</div>
<script type="webr-6-contents">
eyJhdHRyIjp7ImF1dG9ydW4iOnRydWUsImVjaG8iOmZhbHNlLCJlZGl0IjpmYWxzZSwiZXZhbCI6dHJ1ZSwiaW5wdXQiOlsidnBsb3Rfc3RhdHMiXSwicmVzdWx0cyI6ImFzaXMifSwiY29kZSI6IlxuaWYgKGluaGVyaXRzKHZwbG90X3N0YXRzLCBcImRhdGEuZnJhbWVcIikpIHtcbiAga25pdHI6OmthYmxlKHZwbG90X3N0YXRzLCBmb3JtYXQgPSBcImh0bWxcIiwgXG4gICAgICAgICAgICAgICBjb2wubmFtZXMgPSBjKFwiXCIsIFwiXCIpLCAjIEhpZGUgaGVhZGVycyBpZiBzZWxmLWV4cGxhbmF0b3J5XG4gICAgICAgICAgICAgICB0YWJsZS5hdHRyID0gXCJzdHlsZT0nd2lkdGg6MTAwJTsgZm9udC1zaXplOiAwLjllbTsgYm9yZGVyLWNvbGxhcHNlOiBjb2xsYXBzZTsnXCIpXG59IGVsc2Uge1xuICBjYXQoXCI8c3BhbiBzdHlsZT0nY29sb3I6I2NjYyc+V2FpdGluZyBmb3IgZGF0YS4uLjwvc3Bhbj5cIilcbn0ifQ==
</script>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div>
</div><div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, 1fr); grid-auto-columns: minmax(0, 1fr);">
<div class="card cell html-fill-item html-fill-container bslib-card" data-title="ADJUST IMAGE AESTHETICS" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-header"><div class="card-title html-fill-item html-fill-container"><span style="display: inline">
ADJUST IMAGE AESTHETICS
</span></div></div>
<div class="card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb14" data-startfrom="694" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 693;"><span id="cb14-694"><a href="#cb14-694" aria-hidden="true" tabindex="-1"></a>viewof aesthetics_raw <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">form</span>({</span>
<span id="cb14-695"><a href="#cb14-695" aria-hidden="true" tabindex="-1"></a>  <span class="dt">volcano_fc_range</span><span class="op">:</span>      Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>]<span class="op">,</span> {<span class="dt">step</span><span class="op">:</span> <span class="fl">0.001</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Abs. log2FC"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">1</span>})<span class="op">,</span></span>
<span id="cb14-696"><a href="#cb14-696" aria-hidden="true" tabindex="-1"></a>  <span class="dt">volcano_pval_threshold</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {<span class="dt">step</span><span class="op">:</span> <span class="fl">0.00001</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"P-value threshold"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">0.05</span>})<span class="op">,</span></span>
<span id="cb14-697"><a href="#cb14-697" aria-hidden="true" tabindex="-1"></a>  <span class="dt">volcano_pt_size</span><span class="op">:</span>       Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.1</span><span class="op">,</span> <span class="dv">5</span>]<span class="op">,</span> {<span class="dt">step</span><span class="op">:</span> <span class="fl">0.1</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Pt. Size"</span>})<span class="op">,</span></span>
<span id="cb14-698"><a href="#cb14-698" aria-hidden="true" tabindex="-1"></a>  <span class="dt">volcano_alpha</span><span class="op">:</span>         Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {<span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Pt. Alpha"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">1.0</span>})<span class="op">,</span></span>
<span id="cb14-699"><a href="#cb14-699" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-700"><a href="#cb14-700" aria-hidden="true" tabindex="-1"></a>  <span class="dt">volcano_pt_color</span><span class="op">:</span>      Inputs<span class="op">.</span><span class="fu">color</span>({<span class="dt">label</span><span class="op">:</span> <span class="st">"Pt. Color"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="st">"#3C3F40"</span>})<span class="op">,</span></span>
<span id="cb14-701"><a href="#cb14-701" aria-hidden="true" tabindex="-1"></a>  <span class="dt">volcano_sig_color</span><span class="op">:</span>     Inputs<span class="op">.</span><span class="fu">color</span>({<span class="dt">label</span><span class="op">:</span> <span class="st">"Significant targets"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="st">"#b44697"</span>})<span class="op">,</span></span>
<span id="cb14-702"><a href="#cb14-702" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-703"><a href="#cb14-703" aria-hidden="true" tabindex="-1"></a>  <span class="dt">volcano_high_fc_label</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>]<span class="op">,</span> {<span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Label high FC"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">3</span>})<span class="op">,</span></span>
<span id="cb14-704"><a href="#cb14-704" aria-hidden="true" tabindex="-1"></a>  <span class="dt">volcano_low_fc_label</span><span class="op">:</span>  Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>]<span class="op">,</span> {<span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Label low FC"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">3</span>})<span class="op">,</span></span>
<span id="cb14-705"><a href="#cb14-705" aria-hidden="true" tabindex="-1"></a>  <span class="dt">volcano_pval_label</span><span class="op">:</span>    Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>]<span class="op">,</span> {<span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Label Sig."</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">3</span>})<span class="op">,</span></span>
<span id="cb14-706"><a href="#cb14-706" aria-hidden="true" tabindex="-1"></a>  <span class="dt">volcano_include_selected_genes</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">radio</span>([<span class="st">"Yes"</span><span class="op">,</span> <span class="st">"No"</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Label selected?"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="st">"Yes"</span>})</span>
<span id="cb14-707"><a href="#cb14-707" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb14-708"><a href="#cb14-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-709"><a href="#cb14-709" aria-hidden="true" tabindex="-1"></a>aesthetics_debounced <span class="op">=</span> {</span>
<span id="cb14-710"><a href="#cb14-710" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> raw <span class="op">=</span> aesthetics_raw<span class="op">;</span></span>
<span id="cb14-711"><a href="#cb14-711" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="kw">new</span> <span class="bu">Promise</span>(resolve <span class="kw">=&gt;</span> {</span>
<span id="cb14-712"><a href="#cb14-712" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> timer <span class="op">=</span> <span class="pp">setTimeout</span>(() <span class="kw">=&gt;</span> <span class="fu">resolve</span>(raw)<span class="op">,</span> <span class="dv">600</span>)<span class="op">;</span> </span>
<span id="cb14-713"><a href="#cb14-713" aria-hidden="true" tabindex="-1"></a>    invalidation<span class="op">.</span><span class="fu">then</span>(() <span class="kw">=&gt;</span> <span class="pp">clearTimeout</span>(timer))<span class="op">;</span></span>
<span id="cb14-714"><a href="#cb14-714" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb14-715"><a href="#cb14-715" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-716"><a href="#cb14-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-717"><a href="#cb14-717" aria-hidden="true" tabindex="-1"></a>volcano_fc_range      <span class="op">=</span> aesthetics_debounced<span class="op">.</span><span class="at">volcano_fc_range</span></span>
<span id="cb14-718"><a href="#cb14-718" aria-hidden="true" tabindex="-1"></a>volcano_pval_threshold <span class="op">=</span> aesthetics_debounced<span class="op">.</span><span class="at">volcano_pval_threshold</span></span>
<span id="cb14-719"><a href="#cb14-719" aria-hidden="true" tabindex="-1"></a>volcano_pt_size       <span class="op">=</span> aesthetics_debounced<span class="op">.</span><span class="at">volcano_pt_size</span></span>
<span id="cb14-720"><a href="#cb14-720" aria-hidden="true" tabindex="-1"></a>volcano_alpha         <span class="op">=</span> aesthetics_debounced<span class="op">.</span><span class="at">volcano_alpha</span></span>
<span id="cb14-721"><a href="#cb14-721" aria-hidden="true" tabindex="-1"></a>volcano_pt_color      <span class="op">=</span> aesthetics_debounced<span class="op">.</span><span class="at">volcano_pt_color</span></span>
<span id="cb14-722"><a href="#cb14-722" aria-hidden="true" tabindex="-1"></a>volcano_sig_color     <span class="op">=</span> aesthetics_debounced<span class="op">.</span><span class="at">volcano_sig_color</span></span>
<span id="cb14-723"><a href="#cb14-723" aria-hidden="true" tabindex="-1"></a>volcano_high_fc_label <span class="op">=</span> aesthetics_debounced<span class="op">.</span><span class="at">volcano_high_fc_label</span></span>
<span id="cb14-724"><a href="#cb14-724" aria-hidden="true" tabindex="-1"></a>volcano_low_fc_label  <span class="op">=</span> aesthetics_debounced<span class="op">.</span><span class="at">volcano_low_fc_label</span></span>
<span id="cb14-725"><a href="#cb14-725" aria-hidden="true" tabindex="-1"></a>volcano_pval_label    <span class="op">=</span> aesthetics_debounced<span class="op">.</span><span class="at">volcano_pval_label</span></span>
<span id="cb14-726"><a href="#cb14-726" aria-hidden="true" tabindex="-1"></a>volcano_include_selected_genes <span class="op">=</span> aesthetics_debounced<span class="op">.</span><span class="at">volcano_include_selected_genes</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-1" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-2" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-3" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-4" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-5" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-6" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-7" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-8" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-9" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-10" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-11" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-12" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div>
</div>
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-columns: minmax(3em, 100fr);
grid-auto-rows: minmax(0, 1fr);">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, 1fr); grid-auto-columns: minmax(0, 1fr);">
<div class="card hidden html-fill-item html-fill-container bslib-card" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="cell hidden card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb15" data-startfrom="739" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 738;"><span id="cb15-739"><a href="#cb15-739" aria-hidden="true" tabindex="-1"></a>volcano_data_js <span class="op">=</span> {</span>
<span id="cb15-740"><a href="#cb15-740" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> payload <span class="op">=</span> study_data_payload<span class="op">;</span></span>
<span id="cb15-741"><a href="#cb15-741" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> contrast <span class="op">=</span> contrast_selection<span class="op">;</span></span>
<span id="cb15-742"><a href="#cb15-742" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> term <span class="op">=</span> term_selection<span class="op">;</span></span>
<span id="cb15-743"><a href="#cb15-743" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-744"><a href="#cb15-744" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>payload <span class="op">||</span> <span class="op">!</span>contrast <span class="op">||</span> <span class="op">!</span>term <span class="op">||</span> payload<span class="op">.</span><span class="at">mode</span> <span class="op">===</span> <span class="st">"local"</span>) <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb15-745"><a href="#cb15-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-746"><a href="#cb15-746" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (payload<span class="op">.</span><span class="at">mode</span> <span class="op">===</span> <span class="st">"remote_js_bridge"</span>) {</span>
<span id="cb15-747"><a href="#cb15-747" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-748"><a href="#cb15-748" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb15-749"><a href="#cb15-749" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> conn <span class="op">=</span> <span class="cf">await</span> duck_db_client<span class="op">;</span></span>
<span id="cb15-750"><a href="#cb15-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-751"><a href="#cb15-751" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> query <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb15-752"><a href="#cb15-752" aria-hidden="true" tabindex="-1"></a><span class="vs">        SELECT term, contrast, target, log2fc, "p.value", ncells_1, ncells_2</span></span>
<span id="cb15-753"><a href="#cb15-753" aria-hidden="true" tabindex="-1"></a><span class="vs">        FROM '</span><span class="sc">${</span>payload<span class="op">.</span><span class="at">url_pairwise</span><span class="sc">}</span><span class="vs">' </span></span>
<span id="cb15-754"><a href="#cb15-754" aria-hidden="true" tabindex="-1"></a><span class="vs">        WHERE contrast = '</span><span class="sc">${</span>contrast<span class="sc">}</span><span class="vs">' AND term = '</span><span class="sc">${</span>term<span class="sc">}</span><span class="vs">'</span></span>
<span id="cb15-755"><a href="#cb15-755" aria-hidden="true" tabindex="-1"></a><span class="vs">      `</span><span class="op">;</span></span>
<span id="cb15-756"><a href="#cb15-756" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb15-757"><a href="#cb15-757" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> result <span class="op">=</span> <span class="cf">await</span> conn<span class="op">.</span><span class="fu">query</span>(query)<span class="op">;</span></span>
<span id="cb15-758"><a href="#cb15-758" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> data <span class="op">=</span> result<span class="op">.</span><span class="fu">toArray</span>()<span class="op">.</span><span class="fu">map</span>(row <span class="kw">=&gt;</span> row<span class="op">.</span><span class="fu">toJSON</span>())<span class="op">;</span></span>
<span id="cb15-759"><a href="#cb15-759" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb15-760"><a href="#cb15-760" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="vs">`✅ Volcano data fetched (</span><span class="sc">${</span>data<span class="op">.</span><span class="at">length</span><span class="sc">}</span><span class="vs"> rows)`</span>)<span class="op">;</span></span>
<span id="cb15-761"><a href="#cb15-761" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> data<span class="op">;</span></span>
<span id="cb15-762"><a href="#cb15-762" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb15-763"><a href="#cb15-763" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (e) {</span>
<span id="cb15-764"><a href="#cb15-764" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(<span class="st">"❌ Failed to fetch volcano data:"</span><span class="op">,</span> e)<span class="op">;</span></span>
<span id="cb15-765"><a href="#cb15-765" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> []<span class="op">;</span></span>
<span id="cb15-766"><a href="#cb15-766" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-767"><a href="#cb15-767" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-768"><a href="#cb15-768" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div id="ojs-cell-15" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell card-body html-fill-item html-fill-container" data-autorun="true" data-input="[&quot;study_data_payload&quot;,&quot;volcano_data_js&quot;,&quot;contrast_selection&quot;,&quot;term_selection&quot;]" data-define="current_volcano_data">
<div class="html-fill-item html-fill-container">
<div id="webr-7" class="exercise-cell html-fill-item html-fill-container">

</div>
<script type="webr-7-contents">
eyJhdHRyIjp7ImF1dG9ydW4iOnRydWUsImRlZmluZSI6WyJjdXJyZW50X3ZvbGNhbm9fZGF0YSJdLCJlY2hvIjpmYWxzZSwiZWRpdCI6ZmFsc2UsImV2YWwiOnRydWUsImlucHV0IjpbInN0dWR5X2RhdGFfcGF5bG9hZCIsInZvbGNhbm9fZGF0YV9qcyIsImNvbnRyYXN0X3NlbGVjdGlvbiIsInRlcm1fc2VsZWN0aW9uIl0sIm91dHB1dCI6ZmFsc2V9LCJjb2RlIjoiXG5jdXJyZW50X3ZvbGNhbm9fZGF0YSA8LSBkYXRhLmZyYW1lKCd0ZXJtJz0ndW5rbm93bicsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY29udHJhc3QnID0gJ0IgLyBBJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3RhcmdldCcgPSAnTkEnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbG9nMmZjJyA9IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwLnZhbHVlJyA9IDEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICduY2VsbHNfMScgPSAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbmNlbGxzXzInID0gMClcblxuaWYgKCFpcy5udWxsKHN0dWR5X2RhdGFfcGF5bG9hZCkgJiYgIWlzLm51bGwoY29udHJhc3Rfc2VsZWN0aW9uKSkge1xuXG4gIGlmIChzdHVkeV9kYXRhX3BheWxvYWQkbW9kZSA9PSBcInJlbW90ZV9qc19icmlkZ2VcIikge1xuICAgIGlmICghaXMubnVsbCh2b2xjYW5vX2RhdGFfanMpKSB7XG4gICAgICAganNvbl9zdHIgPC0ganNvbmxpdGU6OnRvSlNPTih2b2xjYW5vX2RhdGFfanMpXG4gICAgICAgY3VycmVudF92b2xjYW5vX2RhdGEgPC0ganNvbmxpdGU6OmZyb21KU09OKGpzb25fc3RyKVxuICAgICAgIFxuICAgICAgIGNhdChwYXN0ZTAoXCJSOiBSZWNlaXZlZCBcIiwgbnJvdyhjdXJyZW50X3ZvbGNhbm9fZGF0YSksIFwiIHJvd3MgZnJvbSBSZW1vdGUuXFxuXCIpKVxuICAgIH1cbiAgICBcbiAgfSBlbHNlIHtcbiAgICBcbiAgICBjYXQocGFzdGUwKFwiUjogUXVlcnlpbmcgTG9jYWwgREIgZm9yOiBcIiwgY29udHJhc3Rfc2VsZWN0aW9uLCBcIlxcblwiKSlcblxuICAgIGlmIChkYkV4aXN0c1RhYmxlKGNvbiwgXCJkZV9yZXN1bHRzXCIpKSB7XG4gICAgICAgIHF1ZXJ5IDwtIHNwcmludGYoXG4gICAgICAgICAgXCJTRUxFQ1QgdGVybSwgY29udHJhc3QsIHRhcmdldCwgbG9nMmZjLCBcXFwicC52YWx1ZVxcXCIsIG5jZWxsc18xLCBuY2VsbHNfMiBcbiAgICAgICAgICAgRlJPTSBkZV9yZXN1bHRzIFxuICAgICAgICAgICBXSEVSRSBjb250cmFzdCA9ICclcycgQU5EIHRlcm0gPSAnJXMnXCIsIFxuICAgICAgICAgIGNvbnRyYXN0X3NlbGVjdGlvbiwgXG4gICAgICAgICAgdGVybV9zZWxlY3Rpb25cbiAgICAgICAgKVxuXG4gICAgICAgY3VycmVudF92b2xjYW5vX2RhdGEgPC0gZGJHZXRRdWVyeShjb24sIHF1ZXJ5KVxuICAgICAgIGNhdChwYXN0ZTAoXCJSOiBMb2FkZWQgXCIsIG5yb3coY3VycmVudF92b2xjYW5vX2RhdGEpLCBcIiByb3dzIGZyb20gTG9jYWwuXFxuXCIpKVxuICAgIH1cbiAgfVxuICBcbiAgY3VycmVudF92b2xjYW5vX2RhdGEgPC0gY3VycmVudF92b2xjYW5vX2RhdGEgJT4lIG11dGF0ZShsb2cyZmMgPSBsb2cyKGZvbGRfY2hhbmdlKSwgcGFkaiA9IHAuYWRqdXN0KHAudmFsdWUsIG1ldGhvZD1cIkJIXCIpKSAlPiVcbiAgICBzZWxlY3QodGFyZ2V0LCBsb2cyZmMsIHAudmFsdWUsIHBhZGosIG5jZWxsc18xLCBuY2VsbHNfMiwgdGVybSwgY29udHJhc3QpXG59In0=
</script>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
<div class="card html-fill-item html-fill-container bslib-card" data-title="PAIRWISE DETAILS" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-header"><div class="card-toolbar html-fill-item html-fill-container" data-target-element="next" data-target-position="header"><div class="card-title html-fill-item html-fill-container"><span style="display: inline">
PAIRWISE DETAILS

</span></div>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb16" data-startfrom="831" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 830;"><span id="cb16-831"><a href="#cb16-831" aria-hidden="true" tabindex="-1"></a>viewof pairwise_search <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">search</span>(current_volcano_data<span class="op">,</span> {<span class="dt">placeholder</span><span class="op">:</span> <span class="st">"Search Results"</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div id="ojs-cell-16" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div></div>
<div class="cell card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb17" data-startfrom="840" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 839;"><span id="cb17-840"><a href="#cb17-840" aria-hidden="true" tabindex="-1"></a>viewof pairwise_table <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">table</span>(pairwise_search<span class="op">,</span> {</span>
<span id="cb17-841"><a href="#cb17-841" aria-hidden="true" tabindex="-1"></a>  <span class="dt">multiple</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb17-842"><a href="#cb17-842" aria-hidden="true" tabindex="-1"></a>  <span class="dt">rows</span><span class="op">:</span> <span class="dv">20</span><span class="op">,</span></span>
<span id="cb17-843"><a href="#cb17-843" aria-hidden="true" tabindex="-1"></a>  <span class="dt">format</span><span class="op">:</span> {</span>
<span id="cb17-844"><a href="#cb17-844" aria-hidden="true" tabindex="-1"></a>    <span class="dt">log2fc</span><span class="op">:</span> <span class="fu">sparkbar</span>(d3<span class="op">.</span><span class="fu">max</span>(pairwise_search<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">log2fc</span>))</span>
<span id="cb17-845"><a href="#cb17-845" aria-hidden="true" tabindex="-1"></a>  }})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div id="ojs-cell-17" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
<!-- ```{ojs} -->
<!-- selected_genes -->
<!-- ``` -->
</div>
<div class="cell hidden card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb18" data-startfrom="861" data-source-offset="-43"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 860;"><span id="cb18-861"><a href="#cb18-861" aria-hidden="true" tabindex="-1"></a>selected_genes <span class="op">=</span> {</span>
<span id="cb18-862"><a href="#cb18-862" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>current_volcano_data <span class="op">||</span> <span class="op">!</span>pairwise_table) <span class="cf">return</span> [<span class="st">'notagene'</span>]<span class="op">;</span></span>
<span id="cb18-863"><a href="#cb18-863" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (pairwise_table<span class="op">.</span><span class="at">length</span> <span class="op">===</span> current_volcano_data) {</span>
<span id="cb18-864"><a href="#cb18-864" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [<span class="st">'notagene'</span>]<span class="op">;</span></span>
<span id="cb18-865"><a href="#cb18-865" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-866"><a href="#cb18-866" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (pairwise_table<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">30</span>) {</span>
<span id="cb18-867"><a href="#cb18-867" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [<span class="st">'notagene'</span>]<span class="op">;</span></span>
<span id="cb18-868"><a href="#cb18-868" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-869"><a href="#cb18-869" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> pairwise_table<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">target</span>)<span class="op">;</span></span>
<span id="cb18-870"><a href="#cb18-870" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-871"><a href="#cb18-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-872"><a href="#cb18-872" aria-hidden="true" tabindex="-1"></a>selectionWarning <span class="op">=</span> {</span>
<span id="cb18-873"><a href="#cb18-873" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 1. Wait for data</span></span>
<span id="cb18-874"><a href="#cb18-874" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>pairwise_table <span class="op">||</span> <span class="op">!</span>current_volcano_data) <span class="cf">return</span> <span class="vs">`Select between 1 and 30 genes to label.`</span><span class="op">;</span></span>
<span id="cb18-875"><a href="#cb18-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-876"><a href="#cb18-876" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> count <span class="op">=</span> pairwise_table<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb18-877"><a href="#cb18-877" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> total <span class="op">=</span> current_volcano_data<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb18-878"><a href="#cb18-878" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> isSelectAll <span class="op">=</span> (count <span class="op">===</span> total)<span class="op">;</span></span>
<span id="cb18-879"><a href="#cb18-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-880"><a href="#cb18-880" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(isSelectAll){</span>
<span id="cb18-881"><a href="#cb18-881" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="vs">`Select up to 30 genes to label in the volcano plot.`</span><span class="op">;</span></span>
<span id="cb18-882"><a href="#cb18-882" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-883"><a href="#cb18-883" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (count <span class="op">&gt;</span> <span class="dv">30</span>) {</span>
<span id="cb18-884"><a href="#cb18-884" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="vs">`⚠️ Too many targets selected (</span><span class="sc">${</span>count<span class="sc">}</span><span class="vs">). Limit is 30.`</span><span class="op">;</span></span>
<span id="cb18-885"><a href="#cb18-885" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-886"><a href="#cb18-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-887"><a href="#cb18-887" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="vs">`Currently selected: </span><span class="sc">${</span>count<span class="sc">}</span><span class="vs"> gene</span><span class="sc">${</span>count <span class="op">===</span> <span class="dv">1</span> <span class="op">?</span> <span class="st">''</span> <span class="op">:</span> <span class="st">'s'</span><span class="sc">}</span><span class="vs">.`</span><span class="op">;</span></span>
<span id="cb18-888"><a href="#cb18-888" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-18-1" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-18-2" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
</div>
<div class="card-body html-fill-item html-fill-container">
<span><span id="ojs-element-id-1"></span></span>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div>
</div>
</div><div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-columns: minmax(3em, 1fr);
grid-auto-rows: minmax(0, 1fr);">
<div class="card html-fill-item html-fill-container bslib-card" data-title="VOLCANO PLOT" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-header"><div class="card-toolbar html-fill-item html-fill-container" data-target-element="next" data-target-position="header"><div class="card-title html-fill-item html-fill-container"><span style="display: inline">
VOLCANO PLOT

</span></div>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb19" data-startfrom="904" data-source-offset="-40"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 903;"><span id="cb19-904"><a href="#cb19-904" aria-hidden="true" tabindex="-1"></a>viewof term_selection <span class="op">=</span> {</span>
<span id="cb19-905"><a href="#cb19-905" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>available_terms <span class="op">||</span> available_terms<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) <span class="cf">return</span> <span class="fu">md</span><span class="vs">`_Loading terms..._`</span><span class="op">;</span></span>
<span id="cb19-906"><a href="#cb19-906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-907"><a href="#cb19-907" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">select</span>(available_terms<span class="op">,</span> {</span>
<span id="cb19-908"><a href="#cb19-908" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Available Terms:"</span><span class="op">,</span></span>
<span id="cb19-909"><a href="#cb19-909" aria-hidden="true" tabindex="-1"></a>    <span class="dt">multiple</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb19-910"><a href="#cb19-910" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size</span><span class="op">:</span> <span class="dv">3</span></span>
<span id="cb19-911"><a href="#cb19-911" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb19-912"><a href="#cb19-912" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-913"><a href="#cb19-913" aria-hidden="true" tabindex="-1"></a>viewof contrast_selection <span class="op">=</span> {</span>
<span id="cb19-914"><a href="#cb19-914" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>available_contrasts <span class="op">||</span> available_contrasts<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) <span class="cf">return</span> <span class="fu">md</span><span class="vs">`_Loading contrasts..._`</span><span class="op">;</span></span>
<span id="cb19-915"><a href="#cb19-915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-916"><a href="#cb19-916" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">select</span>(available_contrasts<span class="op">,</span> {</span>
<span id="cb19-917"><a href="#cb19-917" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Available Contrasts:"</span><span class="op">,</span></span>
<span id="cb19-918"><a href="#cb19-918" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="fu">replace</span>(<span class="st">" / "</span><span class="op">,</span> <span class="st">" vs. "</span>)<span class="op">,</span></span>
<span id="cb19-919"><a href="#cb19-919" aria-hidden="true" tabindex="-1"></a>    <span class="dt">multiple</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb19-920"><a href="#cb19-920" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size</span><span class="op">:</span> <span class="dv">3</span></span>
<span id="cb19-921"><a href="#cb19-921" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb19-922"><a href="#cb19-922" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-19-1" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-19-2" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
</div></div>
<div class="cell card-body html-fill-item html-fill-container" data-autorun="true" data-input="[&quot;volcano_plot_emit&quot;,&quot;argsVolcano&quot;,&quot;current_volcano_data&quot;]" data-define="[&quot;vplot_stats&quot;,&quot;vplot_plot&quot;,&quot;vplot_labels&quot;]">
<div class="html-fill-item html-fill-container">
<div id="webr-8" class="exercise-cell html-fill-item html-fill-container">

</div>
<script type="webr-8-contents">
eyJhdHRyIjp7ImF1dG9ydW4iOnRydWUsImRlZmluZSI6WyJ2cGxvdF9zdGF0cyIsInZwbG90X3Bsb3QiLCJ2cGxvdF9sYWJlbHMiXSwiZWNobyI6ZmFsc2UsImVkaXQiOmZhbHNlLCJldmFsIjp0cnVlLCJpbnB1dCI6WyJ2b2xjYW5vX3Bsb3RfZW1pdCIsImFyZ3NWb2xjYW5vIiwiY3VycmVudF92b2xjYW5vX2RhdGEiXSwid2FybmluZyI6ZmFsc2V9LCJjb2RlIjoiXG5pZighaW5oZXJpdHMoY3VycmVudF92b2xjYW5vX2RhdGEsIFwiZGF0YS5mcmFtZVwiKSAmJiBpcy5uYShjdXJyZW50X3ZvbGNhbm9fZGF0YSkpe1xuICAgIGNhdChcIldhaXRpbmcgb24gY29udHJhc3Qgc2VsZWN0aW9uLlwiKVxuICB2cGxvdF9zdGF0cyA8LSBcIlwiXG4gIHZwbG90X2xhYmVscyA8LSBjKClcbn0gZWxzZSB7XG4gIGFyZ3NDb21iaW5lZCA8LSBjKGxpc3QoZGY9Y3VycmVudF92b2xjYW5vX2RhdGEgJT4lIHNlbGVjdCh0YXJnZXQsIGxvZzJmYywgcC52YWx1ZSkpLCBhcmdzVm9sY2FubylcbiAgdnBsb3RfcmVzdWx0IDwtIHJsYW5nOjpleGVjKFwicGxvdFZvbGNhbm9cIiwgISEhYXJnc0NvbWJpbmVkKVxuICB2cGxvdF9zdGF0cyA8LSB2cGxvdF9yZXN1bHRbWzJdXVxuICB2cGxvdF9wbG90IDwtIHZwbG90X3Jlc3VsdFtbMV1dXG4gIHZwbG90X2xhYmVscyA8LSB2cGxvdF9yZXN1bHRbWzNdXVxuICB2cGxvdF9wbG90XG59XG5cbiMgcHJpbnQoU3lzLnRpbWUoKSkifQ==
</script>
</div>
<!-- Save Image -->
</div>
<div class="cell card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb20" data-startfrom="964" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 963;"><span id="cb20-964"><a href="#cb20-964" aria-hidden="true" tabindex="-1"></a>viewof save_settings <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">form</span>({</span>
<span id="cb20-965"><a href="#cb20-965" aria-hidden="true" tabindex="-1"></a>  <span class="dt">width</span><span class="op">:</span>  Inputs<span class="op">.</span><span class="fu">number</span>({<span class="dt">label</span><span class="op">:</span> <span class="st">"Width"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">6</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="fl">0.5</span>})<span class="op">,</span></span>
<span id="cb20-966"><a href="#cb20-966" aria-hidden="true" tabindex="-1"></a>  <span class="dt">height</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">number</span>({<span class="dt">label</span><span class="op">:</span> <span class="st">"Height"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="fl">0.5</span>})<span class="op">,</span></span>
<span id="cb20-967"><a href="#cb20-967" aria-hidden="true" tabindex="-1"></a>  <span class="dt">units</span><span class="op">:</span>  Inputs<span class="op">.</span><span class="fu">select</span>([<span class="st">"in"</span><span class="op">,</span> <span class="st">"cm"</span><span class="op">,</span> <span class="st">"mm"</span><span class="op">,</span> <span class="st">"px"</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Units"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="st">"in"</span>})<span class="op">,</span></span>
<span id="cb20-968"><a href="#cb20-968" aria-hidden="true" tabindex="-1"></a>  <span class="dt">format</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">select</span>([<span class="st">"png"</span><span class="op">,</span> <span class="st">"svg"</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Format"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="st">"png"</span>})</span>
<span id="cb20-969"><a href="#cb20-969" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb20-970"><a href="#cb20-970" aria-hidden="true" tabindex="-1"></a>viewof save_btn <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">button</span>(<span class="st">"Download Plot"</span><span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">color</span><span class="op">:</span> <span class="st">"#2C3E50"</span>})</span>
<span id="cb20-971"><a href="#cb20-971" aria-hidden="true" tabindex="-1"></a>save_request <span class="op">=</span> {</span>
<span id="cb20-972"><a href="#cb20-972" aria-hidden="true" tabindex="-1"></a>  save_btn<span class="op">;</span> </span>
<span id="cb20-973"><a href="#cb20-973" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> save_settings<span class="op">;</span></span>
<span id="cb20-974"><a href="#cb20-974" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-20-1" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-20-2" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-20-3" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
</div>
<div class="cell card-body html-fill-item html-fill-container" data-autorun="true" data-input="[&quot;save_btn&quot;,&quot;save_request&quot;]" data-define="downloaded_file">
<div class="html-fill-item html-fill-container">
<div id="webr-9" class="exercise-cell html-fill-item html-fill-container">

</div>
<script type="webr-9-contents">
eyJhdHRyIjp7ImF1dG9ydW4iOnRydWUsImRlZmluZSI6WyJkb3dubG9hZGVkX2ZpbGUiXSwiZWNobyI6ZmFsc2UsImVkaXQiOmZhbHNlLCJldmFsIjp0cnVlLCJpbnB1dCI6WyJzYXZlX2J0biIsInNhdmVfcmVxdWVzdCJdfSwiY29kZSI6IlxuaWYoc2F2ZV9idG4+MCl7XG4gIGNhdCgnc2F2aW5nJylcbiAgZm5hbWUgPC0gcGFzdGUwKFwidm9sY2Fub19wbG90LlwiLCBzYXZlX3JlcXVlc3QkZm9ybWF0KVxuICBnZ3NhdmUoXG4gICAgZmlsZW5hbWUgPSBmbmFtZSwgXG4gICAgcGxvdCA9IHZwbG90X3Bsb3QsIFxuICAgIGRldmljZSA9IHNhdmVfcmVxdWVzdCRmb3JtYXQsXG4gICAgd2lkdGggPSBhcy5udW1lcmljKHNhdmVfcmVxdWVzdCR3aWR0aCksXG4gICAgaGVpZ2h0ID0gYXMubnVtZXJpYyhzYXZlX3JlcXVlc3QkaGVpZ2h0KSxcbiAgICB1bml0cyA9IHNhdmVfcmVxdWVzdCR1bml0c1xuICApXG4gIGlmKGZpbGUuZXhpc3RzKGZuYW1lKSl7XG4gICAgIyBjYXQocGFzdGUwKFwiZmlsZSBjcmVhdGVkOiBcIiwgZm5hbWUpKVxuICAgIGZpbGVfYnl0ZXMgPC0gcmVhZEJpbihmbmFtZSwgXCJyYXdcIiwgbiA9IGZpbGUuaW5mbyhmbmFtZSkkc2l6ZSlcbiAgICBkb3dubG9hZGVkX2ZpbGUgPC0gbGlzdChcbiAgICAgIGRhdGEgPSBmaWxlX2J5dGVzLFxuICAgICAgZmlsZW5hbWUgPSBmbmFtZSxcbiAgICAgIG1pbWUgPSBpZmVsc2Uoc2F2ZV9yZXF1ZXN0JGZvcm1hdCA9PSBcInN2Z1wiLCBcImltYWdlL3N2Zyt4bWxcIiwgXCJpbWFnZS9wbmdcIiksXG4gICAgICB0cyA9IGFzLmNoYXJhY3RlcihTeXMudGltZSgpKSAjIFRpbWVzdGFtcCB0byBmb3JjZSBPSlMgdXBkYXRlXG4gICAgKVxuICB9XG59In0=
</script>
</div>
</div>
<div class="cell hidden card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb21" data-startfrom="1013" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1012;"><span id="cb21-1013"><a href="#cb21-1013" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb21-1014"><a href="#cb21-1014" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (downloaded_file) {</span>
<span id="cb21-1015"><a href="#cb21-1015" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> blob <span class="op">=</span> <span class="kw">new</span> <span class="bu">Blob</span>([<span class="kw">new</span> <span class="bu">Uint8Array</span>(downloaded_file<span class="op">.</span><span class="at">data</span>)]<span class="op">,</span> { <span class="dt">type</span><span class="op">:</span> downloaded_file<span class="op">.</span><span class="at">mime</span> })<span class="op">;</span></span>
<span id="cb21-1016"><a href="#cb21-1016" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-1017"><a href="#cb21-1017" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> url <span class="op">=</span> URL<span class="op">.</span><span class="fu">createObjectURL</span>(blob)<span class="op">;</span></span>
<span id="cb21-1018"><a href="#cb21-1018" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> a <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"a"</span>)<span class="op">;</span></span>
<span id="cb21-1019"><a href="#cb21-1019" aria-hidden="true" tabindex="-1"></a>    a<span class="op">.</span><span class="at">href</span> <span class="op">=</span> url<span class="op">;</span></span>
<span id="cb21-1020"><a href="#cb21-1020" aria-hidden="true" tabindex="-1"></a>    a<span class="op">.</span><span class="at">download</span> <span class="op">=</span> downloaded_file<span class="op">.</span><span class="at">filename</span><span class="op">;</span></span>
<span id="cb21-1021"><a href="#cb21-1021" aria-hidden="true" tabindex="-1"></a>    <span class="bu">document</span><span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="fu">appendChild</span>(a)<span class="op">;</span></span>
<span id="cb21-1022"><a href="#cb21-1022" aria-hidden="true" tabindex="-1"></a>    a<span class="op">.</span><span class="fu">click</span>()<span class="op">;</span></span>
<span id="cb21-1023"><a href="#cb21-1023" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-1024"><a href="#cb21-1024" aria-hidden="true" tabindex="-1"></a>    <span class="bu">document</span><span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="fu">removeChild</span>(a)<span class="op">;</span></span>
<span id="cb21-1025"><a href="#cb21-1025" aria-hidden="true" tabindex="-1"></a>    URL<span class="op">.</span><span class="fu">revokeObjectURL</span>(url)<span class="op">;</span></span>
<span id="cb21-1026"><a href="#cb21-1026" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-1027"><a href="#cb21-1027" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div id="ojs-cell-21" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div>
</div>
</div>
</div><div id="marginal-means" class="dashboard-page tab-pane grid-skip html-fill-item html-fill-container" data-orientation="rows" aria-labelledby="tab-marginal-means">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, 40fr) minmax(3em, 60fr); grid-auto-columns: minmax(0, 1fr);">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-columns: minmax(3em, 50fr) minmax(3em, 50fr);
grid-auto-rows: minmax(0, 1fr);">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, 1fr); grid-auto-columns: minmax(0, 1fr);">
<div class="card html-fill-item html-fill-container bslib-card" data-title="Description" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-header"><div class="card-title html-fill-item html-fill-container"><span style="display: inline">
Description
</span></div></div>
<div class="card-body html-fill-item html-fill-container">
<p>This plot shows the estimated mean expression of a gene (<em>i.e.</em>, marginal means) between the pairwise contrast that is currently selected. This can help you gauge the magnitude of the difference between the two groups after accounting for any other variables in the model.</p>
<p>Like the volcano plot, the x-axis shows the log2 fold change. The y-axis shows marginal mean response (log2 transformed). Each gene is represented by up to two points (one for each level of the contrast) with error bars. When “vs rest” or “vs all” is selected, only a single level is shown.</p>
</div>
<div class="cell hidden card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb22" data-startfrom="1054" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1053;"><span id="cb22-1054"><a href="#cb22-1054" aria-hidden="true" tabindex="-1"></a>available_levels <span class="op">=</span> {</span>
<span id="cb22-1055"><a href="#cb22-1055" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> payload <span class="op">=</span> study_data_payload<span class="op">;</span></span>
<span id="cb22-1056"><a href="#cb22-1056" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>payload <span class="op">||</span> payload<span class="op">.</span><span class="at">mode</span> <span class="op">===</span> <span class="st">"local"</span>) <span class="cf">return</span> []<span class="op">;</span></span>
<span id="cb22-1057"><a href="#cb22-1057" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-1058"><a href="#cb22-1058" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (payload<span class="op">.</span><span class="at">mode</span> <span class="op">===</span> <span class="st">"remote_js_bridge"</span>) {</span>
<span id="cb22-1059"><a href="#cb22-1059" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb22-1060"><a href="#cb22-1060" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> conn <span class="op">=</span> <span class="cf">await</span> duck_db_client<span class="op">;</span></span>
<span id="cb22-1061"><a href="#cb22-1061" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> query <span class="op">=</span> <span class="vs">`SELECT DISTINCT level FROM '</span><span class="sc">${</span>payload<span class="op">.</span><span class="at">url_emmeans</span><span class="sc">}</span><span class="vs">' ORDER BY level`</span><span class="op">;</span></span>
<span id="cb22-1062"><a href="#cb22-1062" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> result <span class="op">=</span> <span class="cf">await</span> conn<span class="op">.</span><span class="fu">query</span>(query)<span class="op">;</span></span>
<span id="cb22-1063"><a href="#cb22-1063" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> result<span class="op">.</span><span class="fu">toArray</span>()<span class="op">.</span><span class="fu">map</span>(row <span class="kw">=&gt;</span> row<span class="op">.</span><span class="at">level</span>)<span class="op">.</span><span class="fu">filter</span>(t <span class="kw">=&gt;</span> <span class="op">!</span>t<span class="op">.</span><span class="fu">startsWith</span>(<span class="st">"otherct_"</span>))<span class="op">;</span></span>
<span id="cb22-1064"><a href="#cb22-1064" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (e) {</span>
<span id="cb22-1065"><a href="#cb22-1065" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> []<span class="op">;</span></span>
<span id="cb22-1066"><a href="#cb22-1066" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb22-1067"><a href="#cb22-1067" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb22-1068"><a href="#cb22-1068" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div id="ojs-cell-22" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell card-body html-fill-item html-fill-container" data-autorun="true" data-input="[&quot;study_data_payload&quot;,&quot;available_levels&quot;]" data-define="r_available_levels">
<div class="html-fill-item html-fill-container">
<div id="webr-10" class="exercise-cell html-fill-item html-fill-container">

</div>
<script type="webr-10-contents">
eyJhdHRyIjp7ImF1dG9ydW4iOnRydWUsImRlZmluZSI6WyJyX2F2YWlsYWJsZV9sZXZlbHMiXSwiZWNobyI6ZmFsc2UsImVkaXQiOmZhbHNlLCJldmFsIjp0cnVlLCJpbnB1dCI6WyJzdHVkeV9kYXRhX3BheWxvYWQiLCJhdmFpbGFibGVfbGV2ZWxzIl19LCJjb2RlIjoiXG5yX2F2YWlsYWJsZV9sZXZlbHMgPC0gTlVMTFxuaWYgKCFpcy5udWxsKHN0dWR5X2RhdGFfcGF5bG9hZCkpIHtcbiAgaWYgKHN0dWR5X2RhdGFfcGF5bG9hZCRtb2RlID09IFwicmVtb3RlX2pzX2JyaWRnZVwiKSB7XG4gICAgcl9hdmFpbGFibGVfbGV2ZWxzIDwtIGF2YWlsYWJsZV9sZXZlbHNcbiAgfSBlbHNlIHtcbiAgICBpZiAoZGJFeGlzdHNUYWJsZShjb24sIFwiZW1tZWFuc19kYXRhXCIpKSB7XG4gICAgICAgIGRmIDwtIGRiR2V0UXVlcnkoY29uLCBcIlNFTEVDVCBESVNUSU5DVCBsZXZlbCBGUk9NIGVtbWVhbnNfZGF0YSBPUkRFUiBCWSBsZXZlbFwiKVxuICAgICAgICByX2F2YWlsYWJsZV9sZXZlbHMgPC0gZGYkbGV2ZWxbIWdyZXBsKFwiXm90aGVyY3RfXCIsIGRmJGxldmVsKV1cbiAgICB9XG4gIH1cbn0ifQ==
</script>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div><div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, 1fr); grid-auto-columns: minmax(0, 1fr);">
<div class="card html-fill-item html-fill-container bslib-card" data-title="Controls" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-header"><div class="card-toolbar html-fill-item html-fill-container" data-target-element="next" data-target-position="header"><div class="card-title html-fill-item html-fill-container"><span style="display: inline">
Controls

</span></div>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb23" data-startfrom="1102" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1101;"><span id="cb23-1102"><a href="#cb23-1102" aria-hidden="true" tabindex="-1"></a>viewof term_copy <span class="op">=</span> {</span>
<span id="cb23-1103"><a href="#cb23-1103" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-1104"><a href="#cb23-1104" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>available_terms <span class="op">||</span> available_terms<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) <span class="cf">return</span> <span class="fu">md</span><span class="vs">`_Loading..._`</span><span class="op">;</span></span>
<span id="cb23-1105"><a href="#cb23-1105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-1106"><a href="#cb23-1106" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> mirror_input <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(available_terms<span class="op">,</span> {</span>
<span id="cb23-1107"><a href="#cb23-1107" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Available Terms:"</span><span class="op">,</span></span>
<span id="cb23-1108"><a href="#cb23-1108" aria-hidden="true" tabindex="-1"></a>    <span class="dt">multiple</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb23-1109"><a href="#cb23-1109" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size</span><span class="op">:</span> <span class="dv">3</span></span>
<span id="cb23-1110"><a href="#cb23-1110" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb23-1111"><a href="#cb23-1111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-1112"><a href="#cb23-1112" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">bind</span>(mirror_input<span class="op">,</span> viewof term_selection)<span class="op">;</span></span>
<span id="cb23-1113"><a href="#cb23-1113" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-1114"><a href="#cb23-1114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-1115"><a href="#cb23-1115" aria-hidden="true" tabindex="-1"></a>viewof contrast_copy <span class="op">=</span> {</span>
<span id="cb23-1116"><a href="#cb23-1116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-1117"><a href="#cb23-1117" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>available_contrasts <span class="op">||</span> available_contrasts<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) <span class="cf">return</span> <span class="fu">md</span><span class="vs">`_Loading..._`</span><span class="op">;</span></span>
<span id="cb23-1118"><a href="#cb23-1118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-1119"><a href="#cb23-1119" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> mirror_input <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(available_contrasts<span class="op">,</span> {</span>
<span id="cb23-1120"><a href="#cb23-1120" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Available Contrasts:"</span><span class="op">,</span></span>
<span id="cb23-1121"><a href="#cb23-1121" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="fu">replace</span>(<span class="st">" / "</span><span class="op">,</span> <span class="st">" vs. "</span>)<span class="op">,</span></span>
<span id="cb23-1122"><a href="#cb23-1122" aria-hidden="true" tabindex="-1"></a>    <span class="dt">multiple</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb23-1123"><a href="#cb23-1123" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size</span><span class="op">:</span> <span class="dv">3</span></span>
<span id="cb23-1124"><a href="#cb23-1124" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb23-1125"><a href="#cb23-1125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-1126"><a href="#cb23-1126" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">bind</span>(mirror_input<span class="op">,</span> viewof contrast_selection)<span class="op">;</span></span>
<span id="cb23-1127"><a href="#cb23-1127" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-23-1" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-23-2" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
</div></div>
<div class="cell card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb24" data-startfrom="1135" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1134;"><span id="cb24-1135"><a href="#cb24-1135" aria-hidden="true" tabindex="-1"></a>viewof means_raw <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">form</span>({</span>
<span id="cb24-1136"><a href="#cb24-1136" aria-hidden="true" tabindex="-1"></a>  <span class="dt">means_highlight</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">text</span>({<span class="dt">label</span><span class="op">:</span> <span class="st">"Highlight Target:"</span><span class="op">,</span> <span class="dt">placeholder</span><span class="op">:</span> <span class="st">"e.g. A1BG,A1CF"</span>})<span class="op">,</span></span>
<span id="cb24-1137"><a href="#cb24-1137" aria-hidden="true" tabindex="-1"></a>  <span class="dt">means_show_labeled</span><span class="op">:</span>       Inputs<span class="op">.</span><span class="fu">toggle</span>({<span class="dt">label</span><span class="op">:</span> <span class="st">"Also highlight Volcano-labeled Genes"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="kw">true</span>})<span class="op">,</span></span>
<span id="cb24-1138"><a href="#cb24-1138" aria-hidden="true" tabindex="-1"></a>  <span class="dt">means_alpha</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.1</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="fl">0.8</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="fl">0.1</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Dot Transparency"</span>})<span class="op">,</span></span>
<span id="cb24-1139"><a href="#cb24-1139" aria-hidden="true" tabindex="-1"></a>  <span class="dt">means_color_1</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">color</span>({<span class="dt">label</span><span class="op">:</span> <span class="st">"Level 1 Color"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="st">"#e15759"</span>})<span class="op">,</span></span>
<span id="cb24-1140"><a href="#cb24-1140" aria-hidden="true" tabindex="-1"></a>  <span class="dt">means_color_2</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">color</span>({<span class="dt">label</span><span class="op">:</span> <span class="st">"Level 2 Color"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="st">"#4e79a7"</span>})</span>
<span id="cb24-1141"><a href="#cb24-1141" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb24-1142"><a href="#cb24-1142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1143"><a href="#cb24-1143" aria-hidden="true" tabindex="-1"></a>means_debounced <span class="op">=</span> {</span>
<span id="cb24-1144"><a href="#cb24-1144" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> raw <span class="op">=</span> means_raw<span class="op">;</span></span>
<span id="cb24-1145"><a href="#cb24-1145" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="kw">new</span> <span class="bu">Promise</span>(resolve <span class="kw">=&gt;</span> {</span>
<span id="cb24-1146"><a href="#cb24-1146" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> timer <span class="op">=</span> <span class="pp">setTimeout</span>(() <span class="kw">=&gt;</span> <span class="fu">resolve</span>(raw)<span class="op">,</span> <span class="dv">600</span>)<span class="op">;</span> </span>
<span id="cb24-1147"><a href="#cb24-1147" aria-hidden="true" tabindex="-1"></a>    invalidation<span class="op">.</span><span class="fu">then</span>(() <span class="kw">=&gt;</span> <span class="pp">clearTimeout</span>(timer))<span class="op">;</span></span>
<span id="cb24-1148"><a href="#cb24-1148" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb24-1149"><a href="#cb24-1149" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-1150"><a href="#cb24-1150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1151"><a href="#cb24-1151" aria-hidden="true" tabindex="-1"></a>means_highlight       <span class="op">=</span> means_debounced<span class="op">.</span><span class="at">means_highlight</span></span>
<span id="cb24-1152"><a href="#cb24-1152" aria-hidden="true" tabindex="-1"></a>means_show_labeled    <span class="op">=</span> means_debounced<span class="op">.</span><span class="at">means_show_labeled</span></span>
<span id="cb24-1153"><a href="#cb24-1153" aria-hidden="true" tabindex="-1"></a>means_alpha           <span class="op">=</span> means_debounced<span class="op">.</span><span class="at">means_alpha</span></span>
<span id="cb24-1154"><a href="#cb24-1154" aria-hidden="true" tabindex="-1"></a>means_color_1         <span class="op">=</span> means_debounced<span class="op">.</span><span class="at">means_color_1</span></span>
<span id="cb24-1155"><a href="#cb24-1155" aria-hidden="true" tabindex="-1"></a>means_color_2         <span class="op">=</span> means_debounced<span class="op">.</span><span class="at">means_color_2</span></span>
<span id="cb24-1156"><a href="#cb24-1156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1157"><a href="#cb24-1157" aria-hidden="true" tabindex="-1"></a>combined_selection <span class="op">=</span> {</span>
<span id="cb24-1158"><a href="#cb24-1158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1159"><a href="#cb24-1159" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> manual <span class="op">=</span> means_highlight </span>
<span id="cb24-1160"><a href="#cb24-1160" aria-hidden="true" tabindex="-1"></a>    <span class="op">?</span> means_highlight<span class="op">.</span><span class="fu">toUpperCase</span>()<span class="op">.</span><span class="fu">split</span>(<span class="st">','</span>)<span class="op">.</span><span class="fu">map</span>(s <span class="kw">=&gt;</span> s<span class="op">.</span><span class="fu">trim</span>())<span class="op">.</span><span class="fu">filter</span>(s <span class="kw">=&gt;</span> s<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span>) </span>
<span id="cb24-1161"><a href="#cb24-1161" aria-hidden="true" tabindex="-1"></a>    <span class="op">:</span> []<span class="op">;</span></span>
<span id="cb24-1162"><a href="#cb24-1162" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-1163"><a href="#cb24-1163" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> from_volcano <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb24-1164"><a href="#cb24-1164" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (means_show_labeled <span class="op">&amp;&amp;</span> <span class="kw">typeof</span> vplot_labels <span class="op">!==</span> <span class="st">"undefined"</span>) {</span>
<span id="cb24-1165"><a href="#cb24-1165" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="bu">Array</span><span class="op">.</span><span class="fu">isArray</span>(vplot_labels)) {</span>
<span id="cb24-1166"><a href="#cb24-1166" aria-hidden="true" tabindex="-1"></a>        from_volcano <span class="op">=</span> vplot_labels<span class="op">;</span></span>
<span id="cb24-1167"><a href="#cb24-1167" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (<span class="kw">typeof</span> vplot_labels <span class="op">===</span> <span class="st">'string'</span>) {</span>
<span id="cb24-1168"><a href="#cb24-1168" aria-hidden="true" tabindex="-1"></a>        from_volcano <span class="op">=</span> [vplot_labels]<span class="op">;</span></span>
<span id="cb24-1169"><a href="#cb24-1169" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb24-1170"><a href="#cb24-1170" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-1171"><a href="#cb24-1171" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-1172"><a href="#cb24-1172" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(<span class="kw">new</span> <span class="bu">Set</span>([<span class="op">...</span>manual<span class="op">,</span> <span class="op">...</span>from_volcano]))<span class="op">;</span></span>
<span id="cb24-1173"><a href="#cb24-1173" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-1174"><a href="#cb24-1174" aria-hidden="true" tabindex="-1"></a>means_level <span class="op">=</span> {</span>
<span id="cb24-1175"><a href="#cb24-1175" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> contrast <span class="op">=</span> contrast_selection<span class="op">;</span></span>
<span id="cb24-1176"><a href="#cb24-1176" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>contrast) <span class="cf">return</span> []<span class="op">;</span></span>
<span id="cb24-1177"><a href="#cb24-1177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1178"><a href="#cb24-1178" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> contrast<span class="op">.</span><span class="fu">split</span>(<span class="ss">/</span><span class="sc">\/|</span><span class="ss">vs</span><span class="sc">\.</span><span class="ss">/</span>)<span class="op">.</span><span class="fu">map</span>(s <span class="kw">=&gt;</span> s<span class="op">.</span><span class="fu">trim</span>())<span class="op">;</span></span>
<span id="cb24-1179"><a href="#cb24-1179" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-24-1" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-24-2" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-24-3" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-24-4" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-24-5" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-24-6" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-24-7" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-24-8" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-24-9" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div>
</div>
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-columns: minmax(3em, 50fr) minmax(3em, 50fr);
grid-auto-rows: minmax(0, 1fr);">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, 1fr); grid-auto-columns: minmax(0, 1fr);">
<div class="card html-fill-item html-fill-container bslib-card" data-title="Marginal Means Plot" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-header"><div class="card-title html-fill-item html-fill-container"><span style="display: inline">
Marginal Means Plot
</span></div></div>
<div class="cell card-body html-fill-item html-fill-container" data-input="means_search">
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb25" data-startfrom="1192" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1191;"><span id="cb25-1192"><a href="#cb25-1192" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb25-1193"><a href="#cb25-1193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1194"><a href="#cb25-1194" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>means_search <span class="op">||</span> means_search<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb25-1195"><a href="#cb25-1195" aria-hidden="true" tabindex="-1"></a>    <span class="kw">yield</span> <span class="fu">html</span><span class="vs">`&lt;div style="height:400px; display:flex; align-items:center; justify-content:center; background:#f9f9f9; border:1px border-radius:8px;"&gt;</span></span>
<span id="cb25-1196"><a href="#cb25-1196" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;p style="color:#888;"&gt;Select levels in the sidebar to visualize...&lt;/p&gt;</span></span>
<span id="cb25-1197"><a href="#cb25-1197" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/div&gt;`</span><span class="op">;</span></span>
<span id="cb25-1198"><a href="#cb25-1198" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb25-1199"><a href="#cb25-1199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1200"><a href="#cb25-1200" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> colorScale <span class="op">=</span> d3<span class="op">.</span><span class="at">schemeTableau10</span><span class="op">;</span></span>
<span id="cb25-1201"><a href="#cb25-1201" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-1202"><a href="#cb25-1202" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> table_targets <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb25-1203"><a href="#cb25-1203" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-1204"><a href="#cb25-1204" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="kw">typeof</span> means_table <span class="op">!==</span> <span class="st">"undefined"</span> <span class="op">&amp;&amp;</span> means_table <span class="op">&amp;&amp;</span> means_search) {</span>
<span id="cb25-1205"><a href="#cb25-1205" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (means_table<span class="op">.</span><span class="at">length</span> <span class="op">!==</span> means_search<span class="op">.</span><span class="at">length</span>) {</span>
<span id="cb25-1206"><a href="#cb25-1206" aria-hidden="true" tabindex="-1"></a>          table_targets <span class="op">=</span> means_table<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">target</span>)<span class="op">;</span></span>
<span id="cb25-1207"><a href="#cb25-1207" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb25-1208"><a href="#cb25-1208" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb25-1209"><a href="#cb25-1209" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-1210"><a href="#cb25-1210" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> manual_targets <span class="op">=</span> combined_selection <span class="op">||</span> []<span class="op">;</span></span>
<span id="cb25-1211"><a href="#cb25-1211" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-1212"><a href="#cb25-1212" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> highlight_list <span class="op">=</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(<span class="kw">new</span> <span class="bu">Set</span>([<span class="op">...</span>table_targets<span class="op">,</span> <span class="op">...</span>manual_targets]))<span class="op">;</span></span>
<span id="cb25-1213"><a href="#cb25-1213" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-1214"><a href="#cb25-1214" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> targetGroups <span class="op">=</span> d3<span class="op">.</span><span class="fu">groups</span>(means_search<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">target</span>)<span class="op">;</span></span>
<span id="cb25-1215"><a href="#cb25-1215" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-1216"><a href="#cb25-1216" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> levels <span class="op">=</span> [<span class="op">...</span><span class="kw">new</span> <span class="bu">Set</span>(means_search<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">level</span>))]<span class="op">.</span><span class="fu">sort</span>()<span class="op">;</span></span>
<span id="cb25-1217"><a href="#cb25-1217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1218"><a href="#cb25-1218" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> traces <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb25-1219"><a href="#cb25-1219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1220"><a href="#cb25-1220" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> alpha_scaler <span class="op">=</span> means_alpha<span class="op">;</span></span>
<span id="cb25-1221"><a href="#cb25-1221" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> line_segments_high <span class="op">=</span> { <span class="dt">x</span><span class="op">:</span> []<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> []<span class="op">,</span> <span class="dt">hoverinfo</span><span class="op">:</span> <span class="st">'skip'</span><span class="op">,</span> <span class="dt">showlegend</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span> <span class="dt">mode</span><span class="op">:</span> <span class="st">'lines'</span><span class="op">,</span> <span class="dt">line</span><span class="op">:</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">'#888'</span><span class="op">,</span> <span class="dt">width</span><span class="op">:</span> <span class="fl">1.5</span>}<span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> <span class="fl">0.8</span> <span class="op">*</span> alpha_scaler<span class="op">,</span> <span class="dt">type</span><span class="op">:</span> <span class="st">'scatter'</span> }<span class="op">;</span> </span>
<span id="cb25-1222"><a href="#cb25-1222" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> line_segments_med  <span class="op">=</span> { <span class="dt">x</span><span class="op">:</span> []<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> []<span class="op">,</span> <span class="dt">hoverinfo</span><span class="op">:</span> <span class="st">'skip'</span><span class="op">,</span> <span class="dt">showlegend</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span> <span class="dt">mode</span><span class="op">:</span> <span class="st">'lines'</span><span class="op">,</span> <span class="dt">line</span><span class="op">:</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">'#888'</span><span class="op">,</span> <span class="dt">width</span><span class="op">:</span> <span class="dv">1</span>}<span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> <span class="fl">0.4</span> <span class="op">*</span> alpha_scaler<span class="op">,</span> <span class="dt">type</span><span class="op">:</span> <span class="st">'scatter'</span> }<span class="op">;</span></span>
<span id="cb25-1223"><a href="#cb25-1223" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> line_segments_low  <span class="op">=</span> { <span class="dt">x</span><span class="op">:</span> []<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> []<span class="op">,</span> <span class="dt">hoverinfo</span><span class="op">:</span> <span class="st">'skip'</span><span class="op">,</span> <span class="dt">showlegend</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span> <span class="dt">mode</span><span class="op">:</span> <span class="st">'lines'</span><span class="op">,</span> <span class="dt">line</span><span class="op">:</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">'#ccc'</span><span class="op">,</span> <span class="dt">width</span><span class="op">:</span> <span class="dv">1</span>}<span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> <span class="fl">0.3</span> <span class="op">*</span> alpha_scaler<span class="op">,</span> <span class="dt">type</span><span class="op">:</span> <span class="st">'scatter'</span> }<span class="op">;</span></span>
<span id="cb25-1224"><a href="#cb25-1224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1225"><a href="#cb25-1225" aria-hidden="true" tabindex="-1"></a>    targetGroups<span class="op">.</span><span class="fu">forEach</span>(([target<span class="op">,</span> values]) <span class="kw">=&gt;</span> {</span>
<span id="cb25-1226"><a href="#cb25-1226" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(values<span class="op">.</span><span class="at">length</span> <span class="op">&lt;</span> <span class="dv">2</span>) <span class="cf">return</span><span class="op">;</span></span>
<span id="cb25-1227"><a href="#cb25-1227" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb25-1228"><a href="#cb25-1228" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> v1 <span class="op">=</span> values[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb25-1229"><a href="#cb25-1229" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> x <span class="op">=</span> v1<span class="op">.</span><span class="at">log2fc</span><span class="op">;</span></span>
<span id="cb25-1230"><a href="#cb25-1230" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(x <span class="op">==</span> <span class="kw">null</span> <span class="op">||</span> <span class="pp">isNaN</span>(x)) <span class="cf">return</span><span class="op">;</span></span>
<span id="cb25-1231"><a href="#cb25-1231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1232"><a href="#cb25-1232" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Transform Response to Log2 for Y-axis</span></span>
<span id="cb25-1233"><a href="#cb25-1233" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> ys <span class="op">=</span> values<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log2</span>(d<span class="op">.</span><span class="at">response</span>))<span class="op">;</span> </span>
<span id="cb25-1234"><a href="#cb25-1234" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb25-1235"><a href="#cb25-1235" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> min_y <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="op">...</span>ys)<span class="op">;</span></span>
<span id="cb25-1236"><a href="#cb25-1236" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> max_y <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="op">...</span>ys)<span class="op">;</span></span>
<span id="cb25-1237"><a href="#cb25-1237" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb25-1238"><a href="#cb25-1238" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> val_p <span class="op">=</span> v1[<span class="st">"p.value"</span>]<span class="op">;</span></span>
<span id="cb25-1239"><a href="#cb25-1239" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> p <span class="op">=</span> val_p <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> val_p <span class="op">:</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb25-1240"><a href="#cb25-1240" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb25-1241"><a href="#cb25-1241" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> seg <span class="op">=</span> line_segments_low<span class="op">;</span></span>
<span id="cb25-1242"><a href="#cb25-1242" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(p <span class="op">&lt;</span> <span class="fl">0.001</span>) seg <span class="op">=</span> line_segments_high<span class="op">;</span></span>
<span id="cb25-1243"><a href="#cb25-1243" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> <span class="cf">if</span>(p <span class="op">&lt;</span> <span class="fl">0.05</span>) seg <span class="op">=</span> line_segments_med<span class="op">;</span></span>
<span id="cb25-1244"><a href="#cb25-1244" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb25-1245"><a href="#cb25-1245" aria-hidden="true" tabindex="-1"></a>      seg<span class="op">.</span><span class="at">x</span><span class="op">.</span><span class="fu">push</span>(x<span class="op">,</span> x<span class="op">,</span> <span class="kw">null</span>)<span class="op">;</span></span>
<span id="cb25-1246"><a href="#cb25-1246" aria-hidden="true" tabindex="-1"></a>      seg<span class="op">.</span><span class="at">y</span><span class="op">.</span><span class="fu">push</span>(min_y<span class="op">,</span> max_y<span class="op">,</span> <span class="kw">null</span>)<span class="op">;</span></span>
<span id="cb25-1247"><a href="#cb25-1247" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb25-1248"><a href="#cb25-1248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1249"><a href="#cb25-1249" aria-hidden="true" tabindex="-1"></a>    traces<span class="op">.</span><span class="fu">push</span>(line_segments_low<span class="op">,</span> line_segments_med<span class="op">,</span> line_segments_high)<span class="op">;</span></span>
<span id="cb25-1250"><a href="#cb25-1250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1251"><a href="#cb25-1251" aria-hidden="true" tabindex="-1"></a>    levels<span class="op">.</span><span class="fu">forEach</span>((lvl<span class="op">,</span> i) <span class="kw">=&gt;</span> {</span>
<span id="cb25-1252"><a href="#cb25-1252" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> color <span class="op">=</span> (i <span class="op">===</span> <span class="dv">0</span>) <span class="op">?</span> means_color_1 <span class="op">:</span> means_color_2<span class="op">;</span> </span>
<span id="cb25-1253"><a href="#cb25-1253" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-1254"><a href="#cb25-1254" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> lvl_trace <span class="op">=</span> {</span>
<span id="cb25-1255"><a href="#cb25-1255" aria-hidden="true" tabindex="-1"></a>          <span class="dt">x</span><span class="op">:</span> []<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> []<span class="op">,</span> <span class="dt">text</span><span class="op">:</span> []<span class="op">,</span> <span class="dt">ids</span><span class="op">:</span> []<span class="op">,</span></span>
<span id="cb25-1256"><a href="#cb25-1256" aria-hidden="true" tabindex="-1"></a>          <span class="dt">mode</span><span class="op">:</span> <span class="st">'markers'</span><span class="op">,</span></span>
<span id="cb25-1257"><a href="#cb25-1257" aria-hidden="true" tabindex="-1"></a>          <span class="dt">type</span><span class="op">:</span> <span class="st">'scatter'</span><span class="op">,</span></span>
<span id="cb25-1258"><a href="#cb25-1258" aria-hidden="true" tabindex="-1"></a>          <span class="dt">name</span><span class="op">:</span> lvl<span class="op">,</span> </span>
<span id="cb25-1259"><a href="#cb25-1259" aria-hidden="true" tabindex="-1"></a>          <span class="dt">marker</span><span class="op">:</span> { <span class="dt">color</span><span class="op">:</span> color<span class="op">,</span> <span class="dt">size</span><span class="op">:</span> <span class="dv">6</span><span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> means_alpha }<span class="op">,</span></span>
<span id="cb25-1260"><a href="#cb25-1260" aria-hidden="true" tabindex="-1"></a>          <span class="dt">error_y</span><span class="op">:</span> {</span>
<span id="cb25-1261"><a href="#cb25-1261" aria-hidden="true" tabindex="-1"></a>            <span class="dt">type</span><span class="op">:</span> <span class="st">'data'</span><span class="op">,</span> <span class="dt">symmetric</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span> <span class="dt">array</span><span class="op">:</span> []<span class="op">,</span> <span class="dt">arrayminus</span><span class="op">:</span> []<span class="op">,</span></span>
<span id="cb25-1262"><a href="#cb25-1262" aria-hidden="true" tabindex="-1"></a>            <span class="dt">visible</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">color</span><span class="op">:</span> color<span class="op">,</span> <span class="dt">thickness</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">width</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> <span class="fl">0.6</span></span>
<span id="cb25-1263"><a href="#cb25-1263" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb25-1264"><a href="#cb25-1264" aria-hidden="true" tabindex="-1"></a>        }<span class="op">;</span></span>
<span id="cb25-1265"><a href="#cb25-1265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1266"><a href="#cb25-1266" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> lvlData <span class="op">=</span> means_search<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">level</span> <span class="op">===</span> lvl)<span class="op">;</span></span>
<span id="cb25-1267"><a href="#cb25-1267" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-1268"><a href="#cb25-1268" aria-hidden="true" tabindex="-1"></a>        lvlData<span class="op">.</span><span class="fu">forEach</span>(d <span class="kw">=&gt;</span> {</span>
<span id="cb25-1269"><a href="#cb25-1269" aria-hidden="true" tabindex="-1"></a>           <span class="cf">if</span> (d<span class="op">.</span><span class="at">log2fc</span> <span class="op">==</span> <span class="kw">null</span> <span class="op">||</span> <span class="pp">isNaN</span>(d<span class="op">.</span><span class="at">log2fc</span>)) <span class="cf">return</span><span class="op">;</span></span>
<span id="cb25-1270"><a href="#cb25-1270" aria-hidden="true" tabindex="-1"></a>           </span>
<span id="cb25-1271"><a href="#cb25-1271" aria-hidden="true" tabindex="-1"></a>           <span class="co">// Log2 Transformation</span></span>
<span id="cb25-1272"><a href="#cb25-1272" aria-hidden="true" tabindex="-1"></a>           <span class="kw">const</span> y_log <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log2</span>(d<span class="op">.</span><span class="at">response</span>)<span class="op">;</span></span>
<span id="cb25-1273"><a href="#cb25-1273" aria-hidden="true" tabindex="-1"></a>           <span class="kw">const</span> ucl_log <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log2</span>(d<span class="op">.</span><span class="at">UCL</span>)<span class="op">;</span></span>
<span id="cb25-1274"><a href="#cb25-1274" aria-hidden="true" tabindex="-1"></a>           <span class="kw">const</span> lcl_log <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log2</span>(d<span class="op">.</span><span class="at">LCL</span>)<span class="op">;</span></span>
<span id="cb25-1275"><a href="#cb25-1275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1276"><a href="#cb25-1276" aria-hidden="true" tabindex="-1"></a>           lvl_trace<span class="op">.</span><span class="at">x</span><span class="op">.</span><span class="fu">push</span>(d<span class="op">.</span><span class="at">log2fc</span>)<span class="op">;</span></span>
<span id="cb25-1277"><a href="#cb25-1277" aria-hidden="true" tabindex="-1"></a>           lvl_trace<span class="op">.</span><span class="at">y</span><span class="op">.</span><span class="fu">push</span>(y_log)<span class="op">;</span></span>
<span id="cb25-1278"><a href="#cb25-1278" aria-hidden="true" tabindex="-1"></a>           lvl_trace<span class="op">.</span><span class="at">text</span><span class="op">.</span><span class="fu">push</span>(<span class="vs">`&lt;b&gt;</span><span class="sc">${</span>d<span class="op">.</span><span class="at">target</span><span class="sc">}</span><span class="vs">&lt;/b&gt;&lt;br&gt;Level: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">level</span><span class="sc">}</span><span class="vs">&lt;br&gt;Log2 Resp: </span><span class="sc">${</span>y_log<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs">&lt;br&gt;FC: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">log2fc</span><span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb25-1279"><a href="#cb25-1279" aria-hidden="true" tabindex="-1"></a>           lvl_trace<span class="op">.</span><span class="at">ids</span><span class="op">.</span><span class="fu">push</span>(<span class="vs">`</span><span class="sc">${</span>d<span class="op">.</span><span class="at">target</span><span class="sc">}</span><span class="vs">_</span><span class="sc">${</span>d<span class="op">.</span><span class="at">level</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb25-1280"><a href="#cb25-1280" aria-hidden="true" tabindex="-1"></a>           </span>
<span id="cb25-1281"><a href="#cb25-1281" aria-hidden="true" tabindex="-1"></a>           lvl_trace<span class="op">.</span><span class="at">error_y</span><span class="op">.</span><span class="at">array</span><span class="op">.</span><span class="fu">push</span>(ucl_log <span class="op">-</span> y_log)<span class="op">;</span></span>
<span id="cb25-1282"><a href="#cb25-1282" aria-hidden="true" tabindex="-1"></a>           lvl_trace<span class="op">.</span><span class="at">error_y</span><span class="op">.</span><span class="at">arrayminus</span><span class="op">.</span><span class="fu">push</span>(y_log <span class="op">-</span> lcl_log)<span class="op">;</span></span>
<span id="cb25-1283"><a href="#cb25-1283" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb25-1284"><a href="#cb25-1284" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-1285"><a href="#cb25-1285" aria-hidden="true" tabindex="-1"></a>        traces<span class="op">.</span><span class="fu">push</span>(lvl_trace)<span class="op">;</span></span>
<span id="cb25-1286"><a href="#cb25-1286" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb25-1287"><a href="#cb25-1287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1288"><a href="#cb25-1288" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(highlight_list<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb25-1289"><a href="#cb25-1289" aria-hidden="true" tabindex="-1"></a>       <span class="kw">const</span> highlightData <span class="op">=</span> means_search<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> highlight_list<span class="op">.</span><span class="fu">includes</span>(d<span class="op">.</span><span class="at">target</span>) <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">log2fc</span> <span class="op">!=</span> <span class="kw">null</span>)<span class="op">;</span></span>
<span id="cb25-1290"><a href="#cb25-1290" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb25-1291"><a href="#cb25-1291" aria-hidden="true" tabindex="-1"></a>        traces<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb25-1292"><a href="#cb25-1292" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> highlightData<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">log2fc</span>)<span class="op">,</span></span>
<span id="cb25-1293"><a href="#cb25-1293" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> highlightData<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log2</span>(d<span class="op">.</span><span class="at">response</span>))<span class="op">,</span></span>
<span id="cb25-1294"><a href="#cb25-1294" aria-hidden="true" tabindex="-1"></a>        <span class="dt">mode</span><span class="op">:</span> <span class="st">'markers+text'</span><span class="op">,</span></span>
<span id="cb25-1295"><a href="#cb25-1295" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">'scatter'</span><span class="op">,</span> </span>
<span id="cb25-1296"><a href="#cb25-1296" aria-hidden="true" tabindex="-1"></a>        <span class="dt">name</span><span class="op">:</span> <span class="st">'Highlights'</span><span class="op">,</span></span>
<span id="cb25-1297"><a href="#cb25-1297" aria-hidden="true" tabindex="-1"></a>        <span class="dt">text</span><span class="op">:</span> highlightData<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">target</span>)<span class="op">,</span></span>
<span id="cb25-1298"><a href="#cb25-1298" aria-hidden="true" tabindex="-1"></a>        <span class="dt">textposition</span><span class="op">:</span> <span class="st">'top center'</span><span class="op">,</span></span>
<span id="cb25-1299"><a href="#cb25-1299" aria-hidden="true" tabindex="-1"></a>        <span class="dt">textfont</span><span class="op">:</span> { <span class="dt">color</span><span class="op">:</span> <span class="st">'black'</span><span class="op">,</span> <span class="dt">size</span><span class="op">:</span> <span class="dv">11</span><span class="op">,</span> <span class="dt">weight</span><span class="op">:</span> <span class="st">'bold'</span> }<span class="op">,</span></span>
<span id="cb25-1300"><a href="#cb25-1300" aria-hidden="true" tabindex="-1"></a>        <span class="dt">marker</span><span class="op">:</span> { <span class="dt">color</span><span class="op">:</span> <span class="st">'black'</span><span class="op">,</span> <span class="dt">size</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dt">symbol</span><span class="op">:</span> <span class="st">'circle-open'</span><span class="op">,</span> <span class="dt">line</span><span class="op">:</span> {<span class="dt">width</span><span class="op">:</span> <span class="dv">2</span>} }<span class="op">,</span></span>
<span id="cb25-1301"><a href="#cb25-1301" aria-hidden="true" tabindex="-1"></a>        <span class="dt">hoverinfo</span><span class="op">:</span> <span class="st">'skip'</span><span class="op">,</span></span>
<span id="cb25-1302"><a href="#cb25-1302" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cliponaxis</span><span class="op">:</span> <span class="kw">false</span></span>
<span id="cb25-1303"><a href="#cb25-1303" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb25-1304"><a href="#cb25-1304" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb25-1305"><a href="#cb25-1305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1306"><a href="#cb25-1306" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> layout <span class="op">=</span> {</span>
<span id="cb25-1307"><a href="#cb25-1307" aria-hidden="true" tabindex="-1"></a>      <span class="dt">height</span><span class="op">:</span> <span class="dv">500</span><span class="op">,</span></span>
<span id="cb25-1308"><a href="#cb25-1308" aria-hidden="true" tabindex="-1"></a>      <span class="dt">margin</span><span class="op">:</span> { <span class="dt">t</span><span class="op">:</span> <span class="dv">30</span><span class="op">,</span> <span class="dt">b</span><span class="op">:</span> <span class="dv">50</span><span class="op">,</span> <span class="dt">l</span><span class="op">:</span> <span class="dv">60</span><span class="op">,</span> <span class="dt">r</span><span class="op">:</span> <span class="dv">20</span> }<span class="op">,</span></span>
<span id="cb25-1309"><a href="#cb25-1309" aria-hidden="true" tabindex="-1"></a>      <span class="dt">hovermode</span><span class="op">:</span> <span class="st">'closest'</span><span class="op">,</span></span>
<span id="cb25-1310"><a href="#cb25-1310" aria-hidden="true" tabindex="-1"></a>      <span class="dt">title</span><span class="op">:</span> { <span class="dt">text</span><span class="op">:</span> <span class="st">'Marginal Means vs Fold Change'</span><span class="op">,</span> <span class="dt">font</span><span class="op">:</span> {<span class="dt">size</span><span class="op">:</span> <span class="dv">14</span>} }<span class="op">,</span></span>
<span id="cb25-1311"><a href="#cb25-1311" aria-hidden="true" tabindex="-1"></a>      <span class="dt">xaxis</span><span class="op">:</span> { </span>
<span id="cb25-1312"><a href="#cb25-1312" aria-hidden="true" tabindex="-1"></a>        <span class="dt">title</span><span class="op">:</span> <span class="st">'Log2 Fold Change (Contrast)'</span><span class="op">,</span> </span>
<span id="cb25-1313"><a href="#cb25-1313" aria-hidden="true" tabindex="-1"></a>        <span class="dt">zeroline</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> </span>
<span id="cb25-1314"><a href="#cb25-1314" aria-hidden="true" tabindex="-1"></a>        <span class="dt">zerolinecolor</span><span class="op">:</span> <span class="st">'#eee'</span><span class="op">,</span></span>
<span id="cb25-1315"><a href="#cb25-1315" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gridcolor</span><span class="op">:</span> <span class="st">'#f9f9f9'</span></span>
<span id="cb25-1316"><a href="#cb25-1316" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb25-1317"><a href="#cb25-1317" aria-hidden="true" tabindex="-1"></a>      <span class="dt">yaxis</span><span class="op">:</span> { </span>
<span id="cb25-1318"><a href="#cb25-1318" aria-hidden="true" tabindex="-1"></a>        <span class="dt">title</span><span class="op">:</span> <span class="st">'Log2 Expression (Response)'</span><span class="op">,</span> </span>
<span id="cb25-1319"><a href="#cb25-1319" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gridcolor</span><span class="op">:</span> <span class="st">'#f9f9f9'</span><span class="op">,</span></span>
<span id="cb25-1320"><a href="#cb25-1320" aria-hidden="true" tabindex="-1"></a>        <span class="dt">zeroline</span><span class="op">:</span> <span class="kw">false</span></span>
<span id="cb25-1321"><a href="#cb25-1321" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb25-1322"><a href="#cb25-1322" aria-hidden="true" tabindex="-1"></a>      <span class="dt">legend</span><span class="op">:</span> { <span class="dt">orientation</span><span class="op">:</span> <span class="st">'h'</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="op">-</span><span class="fl">0.15</span> }<span class="op">,</span></span>
<span id="cb25-1323"><a href="#cb25-1323" aria-hidden="true" tabindex="-1"></a>      <span class="dt">showlegend</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb25-1324"><a href="#cb25-1324" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb25-1325"><a href="#cb25-1325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1326"><a href="#cb25-1326" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> div <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb25-1327"><a href="#cb25-1327" aria-hidden="true" tabindex="-1"></a>    Plotly<span class="op">.</span><span class="fu">newPlot</span>(div<span class="op">,</span> traces<span class="op">,</span> layout<span class="op">,</span> { <span class="dt">responsive</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">displayModeBar</span><span class="op">:</span> <span class="kw">true</span> })<span class="op">;</span></span>
<span id="cb25-1328"><a href="#cb25-1328" aria-hidden="true" tabindex="-1"></a>    <span class="kw">yield</span> div<span class="op">;</span></span>
<span id="cb25-1329"><a href="#cb25-1329" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb25-1330"><a href="#cb25-1330" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div id="ojs-cell-25" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div><div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, 1fr); grid-auto-columns: minmax(0, 1fr);">
<div class="card html-fill-item html-fill-container bslib-card" data-title="Details" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-header"><div class="card-toolbar html-fill-item html-fill-container" data-target-element="next" data-target-position="header"><div class="card-title html-fill-item html-fill-container"><span style="display: inline">
Details

</span></div>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb26" data-startfrom="1343" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1342;"><span id="cb26-1343"><a href="#cb26-1343" aria-hidden="true" tabindex="-1"></a>viewof means_search <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">search</span>(current_means_data<span class="op">,</span> {<span class="dt">placeholder</span><span class="op">:</span> <span class="st">"Additional Target Filtering"</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div id="ojs-cell-26" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div></div>
<div class="cell card-body html-fill-item html-fill-container" data-input="current_means_data">
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb27" data-startfrom="1352" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1351;"><span id="cb27-1352"><a href="#cb27-1352" aria-hidden="true" tabindex="-1"></a>viewof means_table <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">table</span>(means_search<span class="op">,</span> {</span>
<span id="cb27-1353"><a href="#cb27-1353" aria-hidden="true" tabindex="-1"></a>  <span class="dt">multiple</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb27-1354"><a href="#cb27-1354" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> combined_selection<span class="op">,</span> <span class="co">// Pre-check the combined selection</span></span>
<span id="cb27-1355"><a href="#cb27-1355" aria-hidden="true" tabindex="-1"></a>  <span class="dt">rows</span><span class="op">:</span> <span class="dv">20</span><span class="op">,</span></span>
<span id="cb27-1356"><a href="#cb27-1356" aria-hidden="true" tabindex="-1"></a>  <span class="dt">format</span><span class="op">:</span> {</span>
<span id="cb27-1357"><a href="#cb27-1357" aria-hidden="true" tabindex="-1"></a>    <span class="dt">response</span><span class="op">:</span> <span class="fu">sparkbar</span>(d3<span class="op">.</span><span class="fu">max</span>(means_search<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">response</span>))</span>
<span id="cb27-1358"><a href="#cb27-1358" aria-hidden="true" tabindex="-1"></a>  }})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div id="ojs-cell-27" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell hidden card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb28" data-startfrom="1367" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1366;"><span id="cb28-1367"><a href="#cb28-1367" aria-hidden="true" tabindex="-1"></a>means_data_js <span class="op">=</span> {</span>
<span id="cb28-1368"><a href="#cb28-1368" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> payload <span class="op">=</span> study_data_payload<span class="op">;</span></span>
<span id="cb28-1369"><a href="#cb28-1369" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> lvl <span class="op">=</span> means_level<span class="op">;</span> </span>
<span id="cb28-1370"><a href="#cb28-1370" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-1371"><a href="#cb28-1371" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>payload <span class="op">||</span> <span class="op">!</span>lvl <span class="op">||</span> lvl<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span> <span class="op">||</span> payload<span class="op">.</span><span class="at">mode</span> <span class="op">===</span> <span class="st">"local"</span>) <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb28-1372"><a href="#cb28-1372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-1373"><a href="#cb28-1373" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (payload<span class="op">.</span><span class="at">mode</span> <span class="op">===</span> <span class="st">"remote_js_bridge"</span>) {</span>
<span id="cb28-1374"><a href="#cb28-1374" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb28-1375"><a href="#cb28-1375" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> conn <span class="op">=</span> <span class="cf">await</span> duck_db_client<span class="op">;</span></span>
<span id="cb28-1376"><a href="#cb28-1376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-1377"><a href="#cb28-1377" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> formattedLevels <span class="op">=</span> lvl<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> <span class="vs">`'</span><span class="sc">${</span>d<span class="sc">}</span><span class="vs">'`</span>)<span class="op">.</span><span class="fu">join</span>(<span class="st">','</span>)<span class="op">;</span></span>
<span id="cb28-1378"><a href="#cb28-1378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-1379"><a href="#cb28-1379" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> query <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb28-1380"><a href="#cb28-1380" aria-hidden="true" tabindex="-1"></a><span class="vs">        SELECT level, target, response, "asymp.LCL" as LCL, "asymp.UCL" as UCL</span></span>
<span id="cb28-1381"><a href="#cb28-1381" aria-hidden="true" tabindex="-1"></a><span class="vs">        FROM '</span><span class="sc">${</span>payload<span class="op">.</span><span class="at">url_emmeans</span><span class="sc">}</span><span class="vs">' </span></span>
<span id="cb28-1382"><a href="#cb28-1382" aria-hidden="true" tabindex="-1"></a><span class="vs">        WHERE level IN (</span><span class="sc">${</span>formattedLevels<span class="sc">}</span><span class="vs">)</span></span>
<span id="cb28-1383"><a href="#cb28-1383" aria-hidden="true" tabindex="-1"></a><span class="vs">      `</span><span class="op">;</span></span>
<span id="cb28-1384"><a href="#cb28-1384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-1385"><a href="#cb28-1385" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> result <span class="op">=</span> <span class="cf">await</span> conn<span class="op">.</span><span class="fu">query</span>(query)<span class="op">;</span></span>
<span id="cb28-1386"><a href="#cb28-1386" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> result<span class="op">.</span><span class="fu">toArray</span>()<span class="op">.</span><span class="fu">map</span>(row <span class="kw">=&gt;</span> row<span class="op">.</span><span class="fu">toJSON</span>())<span class="op">;</span></span>
<span id="cb28-1387"><a href="#cb28-1387" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (e) {</span>
<span id="cb28-1388"><a href="#cb28-1388" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(<span class="st">"Mean Fetch Error:"</span><span class="op">,</span> e)<span class="op">;</span></span>
<span id="cb28-1389"><a href="#cb28-1389" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> []<span class="op">;</span></span>
<span id="cb28-1390"><a href="#cb28-1390" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb28-1391"><a href="#cb28-1391" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-1392"><a href="#cb28-1392" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div id="ojs-cell-28" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell card-body html-fill-item html-fill-container" data-autorun="true" data-input="[&quot;study_data_payload&quot;,&quot;means_data_js&quot;,&quot;means_level&quot;,&quot;means_highlight&quot;,&quot;means_show_labeled&quot;,&quot;selected_genes&quot;]" data-define="current_means_data">
<div class="html-fill-item html-fill-container">
<div id="webr-11" class="exercise-cell html-fill-item html-fill-container">

</div>
<script type="webr-11-contents">
eyJhdHRyIjp7ImF1dG9ydW4iOnRydWUsImRlZmluZSI6WyJjdXJyZW50X21lYW5zX2RhdGEiXSwiZWNobyI6ZmFsc2UsImVkaXQiOmZhbHNlLCJldmFsIjp0cnVlLCJpbnB1dCI6WyJzdHVkeV9kYXRhX3BheWxvYWQiLCJtZWFuc19kYXRhX2pzIiwibWVhbnNfbGV2ZWwiLCJtZWFuc19oaWdobGlnaHQiLCJtZWFuc19zaG93X2xhYmVsZWQiLCJzZWxlY3RlZF9nZW5lcyJdfSwiY29kZSI6IlxuaWYgKCFpcy5udWxsKHN0dWR5X2RhdGFfcGF5bG9hZCkgJiYgIWlzLm51bGwobWVhbnNfbGV2ZWwpKSB7XG4gIGN1cnJlbnRfbWVhbnNfZGF0YSA8LSBOVUxMXG4gIFxuICBpZiAoc3R1ZHlfZGF0YV9wYXlsb2FkJG1vZGUgPT0gXCJyZW1vdGVfanNfYnJpZGdlXCIpIHtcbiAgICAgaWYoIWlzLm51bGwobWVhbnNfZGF0YV9qcykpe1xuICAgICAgIGN1cnJlbnRfbWVhbnNfZGF0YSA8LSBqc29ubGl0ZTo6ZnJvbUpTT04oanNvbmxpdGU6OnRvSlNPTihtZWFuc19kYXRhX2pzKSlcbiAgICAgICBjdXJyZW50X21lYW5zX2RhdGEgPC0gYXMuZGF0YS5mcmFtZShjdXJyZW50X21lYW5zX2RhdGEpXG4gICAgIH1cbiAgfSBlbHNlIHtcbiAgICBpZiAoZGJFeGlzdHNUYWJsZShjb24sIFwiZW1tZWFuc19kYXRhXCIpKSB7XG5cbiAgICAgICAgbHZsX2luX2NsYXVzZSA8LSBwYXN0ZTAoXCInXCIsIG1lYW5zX2xldmVsLCBcIidcIiwgY29sbGFwc2UgPSBcIiwgXCIpXG4gICAgICAgIFxuICAgICAgICBxdWVyeSA8LSBwYXN0ZTAoXG4gICAgICAgICAgXCJTRUxFQ1QgbGV2ZWwsIHRhcmdldCwgcmVzcG9uc2UsIFxcXCJhc3ltcC5MQ0xcXFwiIGFzIExDTCwgXFxcImFzeW1wLlVDTFxcXCIgYXMgVUNMIFwiLFxuICAgICAgICAgIFwiRlJPTSBlbW1lYW5zX2RhdGEgV0hFUkUgbGV2ZWwgSU4gKFwiLCBsdmxfaW5fY2xhdXNlLCBcIilcIlxuICAgICAgICApXG4gICAgICAgIFxuICAgICAgICBjdXJyZW50X21lYW5zX2RhdGEgPC0gZGJHZXRRdWVyeShjb24sIHF1ZXJ5KVxuICAgICAgfVxuICB9XG4gIFxuICBpZighaXMubnVsbChjdXJyZW50X21lYW5zX2RhdGEpKXtcbiAgICAjIDEuIEpvaW4gd2l0aCBWb2xjYW5vIERhdGEgdG8gZ2V0IGxvZzJmYyBBTkQgcC52YWx1ZSAoRklYRUQ6IFVzZSBwLnZhbHVlKVxuICAgIGlmKGV4aXN0cyhcImN1cnJlbnRfdm9sY2Fub19kYXRhXCIpICYmICFpcy5udWxsKGN1cnJlbnRfdm9sY2Fub19kYXRhKSAmJiBucm93KGN1cnJlbnRfdm9sY2Fub19kYXRhKSA+IDApe1xuXG4gICAgICAgdm9sY2Fub19jb2xzIDwtIGN1cnJlbnRfdm9sY2Fub19kYXRhICU+JSBcbiAgICAgICAgICBzZWxlY3QodGFyZ2V0LCBsb2cyZmMsIHAudmFsdWUpICU+JSBcbiAgICAgICAgICBkaXN0aW5jdCh0YXJnZXQsIC5rZWVwX2FsbCA9IFRSVUUpXG4gICAgICAgICAgXG4gICAgICAgY3VycmVudF9tZWFuc19kYXRhIDwtIGN1cnJlbnRfbWVhbnNfZGF0YSAlPiUgXG4gICAgICAgICAgbGVmdF9qb2luKHZvbGNhbm9fY29scywgYnk9XCJ0YXJnZXRcIilcbiAgICB9IGVsc2Uge1xuICAgICAgIGN1cnJlbnRfbWVhbnNfZGF0YSRsb2cyZmMgPC0gTkFfcmVhbF9cbiAgICAgICBjdXJyZW50X21lYW5zX2RhdGEkcC52YWx1ZSA8LSBOQV9yZWFsX1xuICAgIH1cblxuICAgIHRhcmdldF9vcmRlciA8LSBjdXJyZW50X21lYW5zX2RhdGEgJT4lXG4gICAgICBncm91cF9ieSh0YXJnZXQpICU+JVxuICAgICAgc3VtbWFyaXNlKGF2Z19yZXNwID0gbWVhbihyZXNwb25zZSwgbmEucm0gPSBUUlVFKSkgJT4lXG4gICAgICBhcnJhbmdlKGF2Z19yZXNwKSAlPiVcbiAgICAgIG11dGF0ZShpZHggPSByb3dfbnVtYmVyKCkpICU+JVxuICAgICAgc2VsZWN0KHRhcmdldCwgaWR4KVxuXG4gICAgY3VycmVudF9tZWFuc19kYXRhIDwtIGN1cnJlbnRfbWVhbnNfZGF0YSAlPiVcbiAgICAgIGxlZnRfam9pbih0YXJnZXRfb3JkZXIsIGJ5ID0gXCJ0YXJnZXRcIilcbiAgXG4gIH1cbn0ifQ==
</script>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div>
</div>
</div>
</div><div id="spatial-plots" class="dashboard-page tab-pane grid-skip html-fill-item html-fill-container" data-orientation="rows" aria-labelledby="tab-spatial-plots">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, 100fr); grid-auto-columns: minmax(0, 1fr);">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-columns: minmax(3em, 25fr) minmax(3em, 75fr);
grid-auto-rows: minmax(0, 1fr);">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, 1fr); grid-auto-columns: minmax(0, 1fr);">
<div class="card html-fill-item html-fill-container bslib-card" data-title="Spatial Controls" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-header"><div class="card-title html-fill-item html-fill-container"><span style="display: inline">
Spatial Controls
</span></div></div>
<div class="cell card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb29" data-startfrom="1472" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1471;"><span id="cb29-1472"><a href="#cb29-1472" aria-hidden="true" tabindex="-1"></a>viewof spatial_options <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">form</span>({</span>
<span id="cb29-1473"><a href="#cb29-1473" aria-hidden="true" tabindex="-1"></a>  <span class="dt">pt_size</span><span class="op">:</span>    Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.5</span><span class="op">,</span> <span class="dv">10</span>]<span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Point Size"</span>})<span class="op">,</span></span>
<span id="cb29-1474"><a href="#cb29-1474" aria-hidden="true" tabindex="-1"></a>  <span class="dt">pt_opacity</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.1</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="fl">0.7</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="fl">0.1</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Opacity"</span>})<span class="op">,</span></span>
<span id="cb29-1475"><a href="#cb29-1475" aria-hidden="true" tabindex="-1"></a>  <span class="dt">bg_color</span><span class="op">:</span>   Inputs<span class="op">.</span><span class="fu">color</span>({<span class="dt">label</span><span class="op">:</span> <span class="st">"Background Color"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="st">"#e0e0e0"</span>})<span class="op">,</span></span>
<span id="cb29-1476"><a href="#cb29-1476" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-1477"><a href="#cb29-1477" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Scale Bar</span></span>
<span id="cb29-1478"><a href="#cb29-1478" aria-hidden="true" tabindex="-1"></a>  <span class="dt">scale_len</span><span class="op">:</span>   Inputs<span class="op">.</span><span class="fu">number</span>({<span class="dt">label</span><span class="op">:</span> <span class="st">"Scale Bar (mm)"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="fl">0.1</span>})<span class="op">,</span></span>
<span id="cb29-1479"><a href="#cb29-1479" aria-hidden="true" tabindex="-1"></a>  <span class="dt">scale_color</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">color</span>({<span class="dt">label</span><span class="op">:</span> <span class="st">"Scale Color"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="st">"#000000"</span>})<span class="op">,</span></span>
<span id="cb29-1480"><a href="#cb29-1480" aria-hidden="true" tabindex="-1"></a>  <span class="dt">show_scale</span><span class="op">:</span>  Inputs<span class="op">.</span><span class="fu">toggle</span>({<span class="dt">label</span><span class="op">:</span> <span class="st">"Show Scale Bar"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="kw">true</span>})</span>
<span id="cb29-1481"><a href="#cb29-1481" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb29-1482"><a href="#cb29-1482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1483"><a href="#cb29-1483" aria-hidden="true" tabindex="-1"></a>viewof log_scale_opt <span class="op">=</span> {</span>
<span id="cb29-1484"><a href="#cb29-1484" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="op">!</span>spatial_data <span class="op">||</span> spatial_data<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) <span class="cf">return</span> <span class="fu">md</span><span class="vs">``</span><span class="op">;</span></span>
<span id="cb29-1485"><a href="#cb29-1485" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-1486"><a href="#cb29-1486" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> val <span class="op">=</span> spatial_data[<span class="dv">0</span>]<span class="op">.</span><span class="at">group_id</span><span class="op">;</span></span>
<span id="cb29-1487"><a href="#cb29-1487" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-1488"><a href="#cb29-1488" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="kw">typeof</span> val <span class="op">===</span> <span class="st">'number'</span>) {</span>
<span id="cb29-1489"><a href="#cb29-1489" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">toggle</span>({<span class="dt">label</span><span class="op">:</span> <span class="st">"Log Scale Color (n+1)"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="kw">false</span>})<span class="op">;</span></span>
<span id="cb29-1490"><a href="#cb29-1490" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb29-1491"><a href="#cb29-1491" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">toggle</span>({<span class="dt">label</span><span class="op">:</span> <span class="st">"Log Scale Color (n+1)"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span> <span class="dt">disabled</span><span class="op">:</span> <span class="kw">true</span>})<span class="op">;</span></span>
<span id="cb29-1492"><a href="#cb29-1492" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb29-1493"><a href="#cb29-1493" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-1494"><a href="#cb29-1494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1495"><a href="#cb29-1495" aria-hidden="true" tabindex="-1"></a>spatial_colors <span class="op">=</span> {</span>
<span id="cb29-1496"><a href="#cb29-1496" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> {</span>
<span id="cb29-1497"><a href="#cb29-1497" aria-hidden="true" tabindex="-1"></a>     <span class="dt">l1</span><span class="op">:</span> means_color_1 <span class="op">||</span> <span class="st">"#e15759"</span><span class="op">,</span></span>
<span id="cb29-1498"><a href="#cb29-1498" aria-hidden="true" tabindex="-1"></a>     <span class="dt">l2</span><span class="op">:</span> means_color_2 <span class="op">||</span> <span class="st">"#4e79a7"</span><span class="op">,</span></span>
<span id="cb29-1499"><a href="#cb29-1499" aria-hidden="true" tabindex="-1"></a>     <span class="dt">other</span><span class="op">:</span> spatial_options<span class="op">.</span><span class="at">bg_color</span></span>
<span id="cb29-1500"><a href="#cb29-1500" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb29-1501"><a href="#cb29-1501" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-29-1" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-29-2" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-29-3" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
</div>
<div class="card-body html-fill-item html-fill-container">
<br>
<strong>Metadata Filtering</strong>
</div>
<div class="cell card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb30" data-startfrom="1510" data-source-offset="-23"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1509;"><span id="cb30-1510"><a href="#cb30-1510" aria-hidden="true" tabindex="-1"></a>viewof filter_col <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(spatial_meta_columns<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Filter By:"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">multiple</span><span class="op">:</span> <span class="kw">false</span>})</span>
<span id="cb30-1511"><a href="#cb30-1511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1512"><a href="#cb30-1512" aria-hidden="true" tabindex="-1"></a>is_numeric_filter <span class="op">=</span> {</span>
<span id="cb30-1513"><a href="#cb30-1513" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="op">!</span>spatial_data <span class="op">||</span> <span class="op">!</span>filter_col) <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb30-1514"><a href="#cb30-1514" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> val <span class="op">=</span> spatial_data[<span class="dv">0</span>][filter_col]<span class="op">;</span></span>
<span id="cb30-1515"><a href="#cb30-1515" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="kw">typeof</span> val <span class="op">===</span> <span class="st">'number'</span><span class="op">;</span></span>
<span id="cb30-1516"><a href="#cb30-1516" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-1517"><a href="#cb30-1517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1518"><a href="#cb30-1518" aria-hidden="true" tabindex="-1"></a>viewof filter_vals <span class="op">=</span> {</span>
<span id="cb30-1519"><a href="#cb30-1519" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="op">!</span>filter_col <span class="op">||</span> <span class="op">!</span>spatial_data) <span class="cf">return</span> <span class="fu">md</span><span class="vs">`_Select a column..._`</span><span class="op">;</span></span>
<span id="cb30-1520"><a href="#cb30-1520" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-1521"><a href="#cb30-1521" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (is_numeric_filter) {</span>
<span id="cb30-1522"><a href="#cb30-1522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1523"><a href="#cb30-1523" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> extent <span class="op">=</span> d3<span class="op">.</span><span class="fu">extent</span>(spatial_data<span class="op">,</span> d <span class="kw">=&gt;</span> d[filter_col])<span class="op">;</span></span>
<span id="cb30-1524"><a href="#cb30-1524" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-1525"><a href="#cb30-1525" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">form</span>({</span>
<span id="cb30-1526"><a href="#cb30-1526" aria-hidden="true" tabindex="-1"></a>      <span class="dt">min</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">number</span>({<span class="dt">label</span><span class="op">:</span> <span class="st">"Min"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> extent[<span class="dv">0</span>]})<span class="op">,</span></span>
<span id="cb30-1527"><a href="#cb30-1527" aria-hidden="true" tabindex="-1"></a>      <span class="dt">max</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">number</span>({<span class="dt">label</span><span class="op">:</span> <span class="st">"Max"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> extent[<span class="dv">1</span>]})</span>
<span id="cb30-1528"><a href="#cb30-1528" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb30-1529"><a href="#cb30-1529" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-1530"><a href="#cb30-1530" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb30-1531"><a href="#cb30-1531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1532"><a href="#cb30-1532" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> unique_vals <span class="op">=</span> [<span class="op">...</span><span class="kw">new</span> <span class="bu">Set</span>(spatial_data<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d[filter_col]))]<span class="op">.</span><span class="fu">sort</span>()<span class="op">;</span></span>
<span id="cb30-1533"><a href="#cb30-1533" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-1534"><a href="#cb30-1534" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">select</span>(unique_vals<span class="op">,</span> {</span>
<span id="cb30-1535"><a href="#cb30-1535" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"Include Values:"</span><span class="op">,</span> </span>
<span id="cb30-1536"><a href="#cb30-1536" aria-hidden="true" tabindex="-1"></a>      <span class="dt">multiple</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb30-1537"><a href="#cb30-1537" aria-hidden="true" tabindex="-1"></a>      <span class="dt">sort</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb30-1538"><a href="#cb30-1538" aria-hidden="true" tabindex="-1"></a>      <span class="dt">unique</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb30-1539"><a href="#cb30-1539" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb30-1540"><a href="#cb30-1540" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb30-1541"><a href="#cb30-1541" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-30-1" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-30-2" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-30-3" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
</div>
<div class="card-body html-fill-item html-fill-container">
<p><br> <strong>Stats</strong></p>
</div>
<div class="cell card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb31" data-startfrom="1547" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1546;"><span id="cb31-1547"><a href="#cb31-1547" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`</span></span>
<span id="cb31-1548"><a href="#cb31-1548" aria-hidden="true" tabindex="-1"></a><span class="vs">- **Total Loaded**: </span><span class="sc">${</span>spatial_data <span class="op">?</span> spatial_data<span class="op">.</span><span class="at">length</span><span class="op">.</span><span class="fu">toLocaleString</span>() <span class="op">:</span> <span class="st">"..."</span><span class="sc">}</span></span>
<span id="cb31-1549"><a href="#cb31-1549" aria-hidden="true" tabindex="-1"></a><span class="vs">- **Visible**: </span><span class="sc">${</span>spatial_filtered <span class="op">?</span> spatial_filtered<span class="op">.</span><span class="at">length</span><span class="op">.</span><span class="fu">toLocaleString</span>() <span class="op">:</span> <span class="st">"..."</span><span class="sc">}</span></span>
<span id="cb31-1550"><a href="#cb31-1550" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div id="ojs-cell-31" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div><div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, 1fr); grid-auto-columns: minmax(0, 1fr);">
<div class="cell hidden html-fill-item html-fill-container">
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb32" data-startfrom="1604" data-source-offset="-45"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1603;"><span id="cb32-1604"><a href="#cb32-1604" aria-hidden="true" tabindex="-1"></a>spatial_data <span class="op">=</span> {</span>
<span id="cb32-1605"><a href="#cb32-1605" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> payload <span class="op">=</span> study_data_payload<span class="op">;</span></span>
<span id="cb32-1606"><a href="#cb32-1606" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> term <span class="op">=</span> term_selection<span class="op">;</span></span>
<span id="cb32-1607"><a href="#cb32-1607" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> slide <span class="op">=</span> slide_selection<span class="op">;</span> </span>
<span id="cb32-1608"><a href="#cb32-1608" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-1609"><a href="#cb32-1609" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>payload <span class="op">||</span> <span class="op">!</span>term <span class="op">||</span> slide <span class="op">===</span> <span class="kw">null</span> <span class="op">||</span> <span class="kw">typeof</span> slide <span class="op">===</span> <span class="st">"undefined"</span>) <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb32-1610"><a href="#cb32-1610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-1611"><a href="#cb32-1611" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (payload<span class="op">.</span><span class="at">mode</span> <span class="op">===</span> <span class="st">"remote_js_bridge"</span>) {</span>
<span id="cb32-1612"><a href="#cb32-1612" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb32-1613"><a href="#cb32-1613" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> conn <span class="op">=</span> <span class="cf">await</span> duck_db_client<span class="op">;</span></span>
<span id="cb32-1614"><a href="#cb32-1614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-1615"><a href="#cb32-1615" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> check <span class="op">=</span> <span class="cf">await</span> conn<span class="op">.</span><span class="fu">query</span>(<span class="vs">`SELECT count(*) as n FROM '</span><span class="sc">${</span>payload<span class="op">.</span><span class="at">url_meta</span><span class="sc">}</span><span class="vs">' WHERE slide_id_numeric = </span><span class="sc">${</span>slide<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb32-1616"><a href="#cb32-1616" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (check<span class="op">.</span><span class="fu">toArray</span>()[<span class="dv">0</span>]<span class="op">.</span><span class="at">n</span> <span class="op">===</span> <span class="dv">0</span>) <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb32-1617"><a href="#cb32-1617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-1618"><a href="#cb32-1618" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> result <span class="op">=</span> <span class="cf">await</span> conn<span class="op">.</span><span class="fu">query</span>(<span class="vs">`SELECT * FROM '</span><span class="sc">${</span>payload<span class="op">.</span><span class="at">url_meta</span><span class="sc">}</span><span class="vs">' WHERE slide_id_numeric = </span><span class="sc">${</span>slide<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb32-1619"><a href="#cb32-1619" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> rows <span class="op">=</span> result<span class="op">.</span><span class="fu">toArray</span>()<span class="op">.</span><span class="fu">map</span>(row <span class="kw">=&gt;</span> row<span class="op">.</span><span class="fu">toJSON</span>())<span class="op">;</span></span>
<span id="cb32-1620"><a href="#cb32-1620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-1621"><a href="#cb32-1621" aria-hidden="true" tabindex="-1"></a>      rows<span class="op">.</span><span class="fu">forEach</span>(r <span class="kw">=&gt;</span> { r<span class="op">.</span><span class="at">group_id</span> <span class="op">=</span> r[term]<span class="op">;</span> })<span class="op">;</span></span>
<span id="cb32-1622"><a href="#cb32-1622" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> rows<span class="op">;</span></span>
<span id="cb32-1623"><a href="#cb32-1623" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (e) {</span>
<span id="cb32-1624"><a href="#cb32-1624" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(<span class="st">"Spatial Fetch Error:"</span><span class="op">,</span> e)<span class="op">;</span></span>
<span id="cb32-1625"><a href="#cb32-1625" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb32-1626"><a href="#cb32-1626" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb32-1627"><a href="#cb32-1627" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb32-1628"><a href="#cb32-1628" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-1629"><a href="#cb32-1629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-1630"><a href="#cb32-1630" aria-hidden="true" tabindex="-1"></a>spatial_meta_columns <span class="op">=</span> {</span>
<span id="cb32-1631"><a href="#cb32-1631" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="op">!</span>spatial_data <span class="op">||</span> spatial_data<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) <span class="cf">return</span> []<span class="op">;</span></span>
<span id="cb32-1632"><a href="#cb32-1632" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> keys <span class="op">=</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">keys</span>(spatial_data[<span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb32-1633"><a href="#cb32-1633" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> keys<span class="op">.</span><span class="fu">filter</span>(k <span class="kw">=&gt;</span> <span class="op">!</span>[<span class="st">"x_slide_mm"</span><span class="op">,</span> <span class="st">"y_slide_mm"</span><span class="op">,</span> <span class="st">"group_id"</span><span class="op">,</span> <span class="st">"__index_level_0__"</span>]<span class="op">.</span><span class="fu">includes</span>(k))<span class="op">;</span></span>
<span id="cb32-1634"><a href="#cb32-1634" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-1635"><a href="#cb32-1635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-1636"><a href="#cb32-1636" aria-hidden="true" tabindex="-1"></a>spatial_filtered <span class="op">=</span> {</span>
<span id="cb32-1637"><a href="#cb32-1637" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="op">!</span>spatial_data) <span class="cf">return</span> []<span class="op">;</span></span>
<span id="cb32-1638"><a href="#cb32-1638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-1639"><a href="#cb32-1639" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="op">!</span>filter_col <span class="op">||</span> <span class="op">!</span>filter_vals) <span class="cf">return</span> spatial_data<span class="op">;</span></span>
<span id="cb32-1640"><a href="#cb32-1640" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-1641"><a href="#cb32-1641" aria-hidden="true" tabindex="-1"></a>  <span class="co">// LOGIC SWITCH:</span></span>
<span id="cb32-1642"><a href="#cb32-1642" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(is_numeric_filter) {</span>
<span id="cb32-1643"><a href="#cb32-1643" aria-hidden="true" tabindex="-1"></a>     <span class="co">// Numeric Filter: filter_vals is an object {min: x, max: y}</span></span>
<span id="cb32-1644"><a href="#cb32-1644" aria-hidden="true" tabindex="-1"></a>     <span class="kw">const</span> { min<span class="op">,</span> max } <span class="op">=</span> filter_vals<span class="op">;</span></span>
<span id="cb32-1645"><a href="#cb32-1645" aria-hidden="true" tabindex="-1"></a>     <span class="cf">return</span> spatial_data<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d[filter_col] <span class="op">&gt;=</span> min <span class="op">&amp;&amp;</span> d[filter_col] <span class="op">&lt;=</span> max)<span class="op">;</span></span>
<span id="cb32-1646"><a href="#cb32-1646" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb32-1647"><a href="#cb32-1647" aria-hidden="true" tabindex="-1"></a>     <span class="co">// Categorical Filter: filter_vals is an array of selected strings</span></span>
<span id="cb32-1648"><a href="#cb32-1648" aria-hidden="true" tabindex="-1"></a>     <span class="cf">if</span>(filter_vals<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) <span class="cf">return</span> spatial_data<span class="op">;</span></span>
<span id="cb32-1649"><a href="#cb32-1649" aria-hidden="true" tabindex="-1"></a>     <span class="cf">return</span> spatial_data<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> filter_vals<span class="op">.</span><span class="fu">includes</span>(d[filter_col]))<span class="op">;</span></span>
<span id="cb32-1650"><a href="#cb32-1650" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb32-1651"><a href="#cb32-1651" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-33-1" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-33-2" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-33-3" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
</div>
<div class="card cell html-fill-item html-fill-container bslib-card" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-header"><div class="card-toolbar html-fill-item html-fill-container" data-target-element="next" data-target-position="header"><div class="card-title html-fill-item html-fill-container"><span style="display: inline">

</span></div>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb33" data-startfrom="1562" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1561;"><span id="cb33-1562"><a href="#cb33-1562" aria-hidden="true" tabindex="-1"></a>viewof slide_selection <span class="op">=</span> {</span>
<span id="cb33-1563"><a href="#cb33-1563" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>available_slides <span class="op">||</span> available_slides<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) <span class="cf">return</span> <span class="fu">md</span><span class="vs">`_Loading slides..._`</span><span class="op">;</span></span>
<span id="cb33-1564"><a href="#cb33-1564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1565"><a href="#cb33-1565" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">select</span>(available_slides<span class="op">,</span> {</span>
<span id="cb33-1566"><a href="#cb33-1566" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Available Slides:"</span><span class="op">,</span></span>
<span id="cb33-1567"><a href="#cb33-1567" aria-hidden="true" tabindex="-1"></a>    <span class="dt">multiple</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb33-1568"><a href="#cb33-1568" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size</span><span class="op">:</span> <span class="dv">3</span></span>
<span id="cb33-1569"><a href="#cb33-1569" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb33-1570"><a href="#cb33-1570" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-1571"><a href="#cb33-1571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1572"><a href="#cb33-1572" aria-hidden="true" tabindex="-1"></a>viewof term_copy2 <span class="op">=</span> {</span>
<span id="cb33-1573"><a href="#cb33-1573" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-1574"><a href="#cb33-1574" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>available_terms <span class="op">||</span> available_terms<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) <span class="cf">return</span> <span class="fu">md</span><span class="vs">`_Loading..._`</span><span class="op">;</span></span>
<span id="cb33-1575"><a href="#cb33-1575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1576"><a href="#cb33-1576" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> mirror_input3 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(available_terms<span class="op">,</span> {</span>
<span id="cb33-1577"><a href="#cb33-1577" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Available Terms:"</span><span class="op">,</span></span>
<span id="cb33-1578"><a href="#cb33-1578" aria-hidden="true" tabindex="-1"></a>    <span class="dt">multiple</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb33-1579"><a href="#cb33-1579" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size</span><span class="op">:</span> <span class="dv">3</span></span>
<span id="cb33-1580"><a href="#cb33-1580" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb33-1581"><a href="#cb33-1581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1582"><a href="#cb33-1582" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">bind</span>(mirror_input3<span class="op">,</span> viewof term_selection)<span class="op">;</span></span>
<span id="cb33-1583"><a href="#cb33-1583" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-1584"><a href="#cb33-1584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1585"><a href="#cb33-1585" aria-hidden="true" tabindex="-1"></a>viewof contrast_copy2 <span class="op">=</span> {</span>
<span id="cb33-1586"><a href="#cb33-1586" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>available_contrasts <span class="op">||</span> available_contrasts<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) <span class="cf">return</span> <span class="fu">md</span><span class="vs">`_Loading..._`</span><span class="op">;</span></span>
<span id="cb33-1587"><a href="#cb33-1587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1588"><a href="#cb33-1588" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> mirror_input2 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(available_contrasts<span class="op">,</span> {</span>
<span id="cb33-1589"><a href="#cb33-1589" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Available Contrasts:"</span><span class="op">,</span></span>
<span id="cb33-1590"><a href="#cb33-1590" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="fu">replace</span>(<span class="st">" / "</span><span class="op">,</span> <span class="st">" vs. "</span>)<span class="op">,</span></span>
<span id="cb33-1591"><a href="#cb33-1591" aria-hidden="true" tabindex="-1"></a>    <span class="dt">multiple</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb33-1592"><a href="#cb33-1592" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size</span><span class="op">:</span> <span class="dv">3</span></span>
<span id="cb33-1593"><a href="#cb33-1593" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb33-1594"><a href="#cb33-1594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1595"><a href="#cb33-1595" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">bind</span>(mirror_input2<span class="op">,</span> viewof contrast_selection)<span class="op">;</span></span>
<span id="cb33-1596"><a href="#cb33-1596" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-32-1" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-32-2" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-32-3" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
</div></div>
<div class="card-body html-fill-item html-fill-container" style="padding: 0px;">
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb34" data-startfrom="1657" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1656;"><span id="cb34-1657"><a href="#cb34-1657" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb34-1658"><a href="#cb34-1658" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> spatial_filtered<span class="op">;</span></span>
<span id="cb34-1659"><a href="#cb34-1659" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> levels <span class="op">=</span> means_level<span class="op">;</span> </span>
<span id="cb34-1660"><a href="#cb34-1660" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> opts <span class="op">=</span> spatial_options<span class="op">;</span></span>
<span id="cb34-1661"><a href="#cb34-1661" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> colors <span class="op">=</span> spatial_colors<span class="op">;</span></span>
<span id="cb34-1662"><a href="#cb34-1662" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> width <span class="op">=</span> <span class="dv">1200</span><span class="op">;</span> </span>
<span id="cb34-1663"><a href="#cb34-1663" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> height <span class="op">=</span> <span class="dv">900</span><span class="op">;</span> </span>
<span id="cb34-1664"><a href="#cb34-1664" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-1665"><a href="#cb34-1665" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> useLog <span class="op">=</span> log_scale_opt <span class="op">===</span> <span class="kw">true</span><span class="op">;</span> </span>
<span id="cb34-1666"><a href="#cb34-1666" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-1667"><a href="#cb34-1667" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>data <span class="op">||</span> data<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) <span class="cf">return</span> <span class="fu">md</span><span class="vs">`_Loading spatial data..._`</span><span class="op">;</span></span>
<span id="cb34-1668"><a href="#cb34-1668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1669"><a href="#cb34-1669" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> isContinuous <span class="op">=</span> <span class="kw">typeof</span> data[<span class="dv">0</span>]<span class="op">.</span><span class="at">group_id</span> <span class="op">===</span> <span class="st">'number'</span><span class="op">;</span></span>
<span id="cb34-1670"><a href="#cb34-1670" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-1671"><a href="#cb34-1671" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> colorScale <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb34-1672"><a href="#cb34-1672" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> termExtent <span class="op">=</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb34-1673"><a href="#cb34-1673" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-1674"><a href="#cb34-1674" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(isContinuous) {</span>
<span id="cb34-1675"><a href="#cb34-1675" aria-hidden="true" tabindex="-1"></a>     termExtent <span class="op">=</span> d3<span class="op">.</span><span class="fu">extent</span>(data<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">group_id</span>)<span class="op">;</span></span>
<span id="cb34-1676"><a href="#cb34-1676" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb34-1677"><a href="#cb34-1677" aria-hidden="true" tabindex="-1"></a>     <span class="cf">if</span> (useLog) {</span>
<span id="cb34-1678"><a href="#cb34-1678" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Log Scale: Map Log(Min+1) -&gt; Log(Max+1)</span></span>
<span id="cb34-1679"><a href="#cb34-1679" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> logMin <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(termExtent[<span class="dv">0</span>] <span class="op">+</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb34-1680"><a href="#cb34-1680" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> logMax <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(termExtent[<span class="dv">1</span>] <span class="op">+</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb34-1681"><a href="#cb34-1681" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb34-1682"><a href="#cb34-1682" aria-hidden="true" tabindex="-1"></a>        colorScale <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleSequential</span>(d3<span class="op">.</span><span class="fu">interpolateRgb</span>(colors<span class="op">.</span><span class="at">l2</span><span class="op">,</span> colors<span class="op">.</span><span class="at">l1</span>))</span>
<span id="cb34-1683"><a href="#cb34-1683" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">domain</span>([logMin<span class="op">,</span> logMax])<span class="op">;</span></span>
<span id="cb34-1684"><a href="#cb34-1684" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb34-1685"><a href="#cb34-1685" aria-hidden="true" tabindex="-1"></a>     } <span class="cf">else</span> {</span>
<span id="cb34-1686"><a href="#cb34-1686" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Linear Scale</span></span>
<span id="cb34-1687"><a href="#cb34-1687" aria-hidden="true" tabindex="-1"></a>        colorScale <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb34-1688"><a href="#cb34-1688" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">domain</span>(termExtent)</span>
<span id="cb34-1689"><a href="#cb34-1689" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">range</span>([colors<span class="op">.</span><span class="at">l2</span><span class="op">,</span> colors<span class="op">.</span><span class="at">l1</span>])<span class="op">;</span></span>
<span id="cb34-1690"><a href="#cb34-1690" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb34-1691"><a href="#cb34-1691" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-1692"><a href="#cb34-1692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1693"><a href="#cb34-1693" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xExtent <span class="op">=</span> d3<span class="op">.</span><span class="fu">extent</span>(data<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x_slide_mm</span>)<span class="op">;</span></span>
<span id="cb34-1694"><a href="#cb34-1694" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yExtent <span class="op">=</span> d3<span class="op">.</span><span class="fu">extent</span>(data<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">y_slide_mm</span>)<span class="op">;</span></span>
<span id="cb34-1695"><a href="#cb34-1695" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-1696"><a href="#cb34-1696" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xMin <span class="op">=</span> xExtent[<span class="dv">0</span>]<span class="op">,</span> xMax <span class="op">=</span> xExtent[<span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb34-1697"><a href="#cb34-1697" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yMin <span class="op">=</span> yExtent[<span class="dv">0</span>]<span class="op">,</span> yMax <span class="op">=</span> yExtent[<span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb34-1698"><a href="#cb34-1698" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-1699"><a href="#cb34-1699" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dataWidth <span class="op">=</span> xMax <span class="op">-</span> xMin<span class="op">;</span></span>
<span id="cb34-1700"><a href="#cb34-1700" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dataHeight <span class="op">=</span> yMax <span class="op">-</span> yMin<span class="op">;</span></span>
<span id="cb34-1701"><a href="#cb34-1701" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-1702"><a href="#cb34-1702" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xScaleFactor <span class="op">=</span> width <span class="op">/</span> dataWidth<span class="op">;</span></span>
<span id="cb34-1703"><a href="#cb34-1703" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScaleFactor <span class="op">=</span> height <span class="op">/</span> dataHeight<span class="op">;</span></span>
<span id="cb34-1704"><a href="#cb34-1704" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> scale <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(xScaleFactor<span class="op">,</span> yScaleFactor) <span class="op">*</span> <span class="fl">0.95</span><span class="op">;</span> </span>
<span id="cb34-1705"><a href="#cb34-1705" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-1706"><a href="#cb34-1706" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cx <span class="op">=</span> width <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb34-1707"><a href="#cb34-1707" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cy <span class="op">=</span> height <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb34-1708"><a href="#cb34-1708" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dx <span class="op">=</span> (xMin <span class="op">+</span> xMax) <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb34-1709"><a href="#cb34-1709" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dy <span class="op">=</span> (yMin <span class="op">+</span> yMax) <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb34-1710"><a href="#cb34-1710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1711"><a href="#cb34-1711" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> project <span class="op">=</span> (x<span class="op">,</span> y) <span class="kw">=&gt;</span> {</span>
<span id="cb34-1712"><a href="#cb34-1712" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [</span>
<span id="cb34-1713"><a href="#cb34-1713" aria-hidden="true" tabindex="-1"></a>      cx <span class="op">+</span> (x <span class="op">-</span> dx) <span class="op">*</span> scale<span class="op">,</span></span>
<span id="cb34-1714"><a href="#cb34-1714" aria-hidden="true" tabindex="-1"></a>      cy <span class="op">-</span> (y <span class="op">-</span> dy) <span class="op">*</span> scale </span>
<span id="cb34-1715"><a href="#cb34-1715" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">;</span></span>
<span id="cb34-1716"><a href="#cb34-1716" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-1717"><a href="#cb34-1717" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-1718"><a href="#cb34-1718" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pixelsPerMm <span class="op">=</span> scale<span class="op">;</span></span>
<span id="cb34-1719"><a href="#cb34-1719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1720"><a href="#cb34-1720" aria-hidden="true" tabindex="-1"></a>  <span class="co">// --- 3. DOM Setup ---</span></span>
<span id="cb34-1721"><a href="#cb34-1721" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> div <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb34-1722"><a href="#cb34-1722" aria-hidden="true" tabindex="-1"></a>  div<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">position</span> <span class="op">=</span> <span class="st">"relative"</span><span class="op">;</span></span>
<span id="cb34-1723"><a href="#cb34-1723" aria-hidden="true" tabindex="-1"></a>  div<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">width</span> <span class="op">=</span> <span class="st">"100%"</span><span class="op">;</span></span>
<span id="cb34-1724"><a href="#cb34-1724" aria-hidden="true" tabindex="-1"></a>  div<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">maxWidth</span> <span class="op">=</span> <span class="st">"100%"</span><span class="op">;</span></span>
<span id="cb34-1725"><a href="#cb34-1725" aria-hidden="true" tabindex="-1"></a>  div<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">height</span> <span class="op">=</span> <span class="st">"auto"</span><span class="op">;</span></span>
<span id="cb34-1726"><a href="#cb34-1726" aria-hidden="true" tabindex="-1"></a>  div<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">border</span> <span class="op">=</span> <span class="st">"1px solid #eee"</span><span class="op">;</span></span>
<span id="cb34-1727"><a href="#cb34-1727" aria-hidden="true" tabindex="-1"></a>  div<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">background</span> <span class="op">=</span> <span class="st">"#fff"</span><span class="op">;</span></span>
<span id="cb34-1728"><a href="#cb34-1728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1729"><a href="#cb34-1729" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> canvas <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"canvas"</span>)<span class="op">;</span></span>
<span id="cb34-1730"><a href="#cb34-1730" aria-hidden="true" tabindex="-1"></a>  canvas<span class="op">.</span><span class="at">width</span> <span class="op">=</span> width<span class="op">;</span></span>
<span id="cb34-1731"><a href="#cb34-1731" aria-hidden="true" tabindex="-1"></a>  canvas<span class="op">.</span><span class="at">height</span> <span class="op">=</span> height<span class="op">;</span></span>
<span id="cb34-1732"><a href="#cb34-1732" aria-hidden="true" tabindex="-1"></a>  canvas<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">width</span> <span class="op">=</span> <span class="st">"100%"</span><span class="op">;</span> <span class="co">// Responsive CSS</span></span>
<span id="cb34-1733"><a href="#cb34-1733" aria-hidden="true" tabindex="-1"></a>  canvas<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">height</span> <span class="op">=</span> <span class="st">"auto"</span><span class="op">;</span></span>
<span id="cb34-1734"><a href="#cb34-1734" aria-hidden="true" tabindex="-1"></a>  canvas<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">"block"</span><span class="op">;</span></span>
<span id="cb34-1735"><a href="#cb34-1735" aria-hidden="true" tabindex="-1"></a>  div<span class="op">.</span><span class="fu">appendChild</span>(canvas)<span class="op">;</span></span>
<span id="cb34-1736"><a href="#cb34-1736" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-1737"><a href="#cb34-1737" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Legend </span></span>
<span id="cb34-1738"><a href="#cb34-1738" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> legend <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb34-1739"><a href="#cb34-1739" aria-hidden="true" tabindex="-1"></a>  legend<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">position</span> <span class="op">=</span> <span class="st">"absolute"</span><span class="op">;</span></span>
<span id="cb34-1740"><a href="#cb34-1740" aria-hidden="true" tabindex="-1"></a>  legend<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">top</span> <span class="op">=</span> <span class="st">"10px"</span><span class="op">;</span></span>
<span id="cb34-1741"><a href="#cb34-1741" aria-hidden="true" tabindex="-1"></a>  legend<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">right</span> <span class="op">=</span> <span class="st">"10px"</span><span class="op">;</span></span>
<span id="cb34-1742"><a href="#cb34-1742" aria-hidden="true" tabindex="-1"></a>  legend<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">background</span> <span class="op">=</span> <span class="st">"rgba(255, 255, 255, 0.9)"</span><span class="op">;</span></span>
<span id="cb34-1743"><a href="#cb34-1743" aria-hidden="true" tabindex="-1"></a>  legend<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">padding</span> <span class="op">=</span> <span class="st">"8px"</span><span class="op">;</span></span>
<span id="cb34-1744"><a href="#cb34-1744" aria-hidden="true" tabindex="-1"></a>  legend<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">borderRadius</span> <span class="op">=</span> <span class="st">"4px"</span><span class="op">;</span></span>
<span id="cb34-1745"><a href="#cb34-1745" aria-hidden="true" tabindex="-1"></a>  legend<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">border</span> <span class="op">=</span> <span class="st">"1px solid #ccc"</span><span class="op">;</span></span>
<span id="cb34-1746"><a href="#cb34-1746" aria-hidden="true" tabindex="-1"></a>  legend<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">fontSize</span> <span class="op">=</span> <span class="st">"12px"</span><span class="op">;</span></span>
<span id="cb34-1747"><a href="#cb34-1747" aria-hidden="true" tabindex="-1"></a>  legend<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">fontFamily</span> <span class="op">=</span> <span class="st">"sans-serif"</span><span class="op">;</span></span>
<span id="cb34-1748"><a href="#cb34-1748" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-1749"><a href="#cb34-1749" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (isContinuous) {</span>
<span id="cb34-1750"><a href="#cb34-1750" aria-hidden="true" tabindex="-1"></a>     <span class="kw">const</span> label <span class="op">=</span> useLog <span class="op">?</span> <span class="vs">`Log(</span><span class="sc">${</span>term_selection<span class="sc">}</span><span class="vs"> + 1)`</span> <span class="op">:</span> term_selection<span class="op">;</span></span>
<span id="cb34-1751"><a href="#cb34-1751" aria-hidden="true" tabindex="-1"></a>     <span class="kw">const</span> minLabel <span class="op">=</span> useLog <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(termExtent[<span class="dv">0</span>] <span class="op">+</span> <span class="dv">1</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>) <span class="op">:</span> termExtent[<span class="dv">0</span>]<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb34-1752"><a href="#cb34-1752" aria-hidden="true" tabindex="-1"></a>     <span class="kw">const</span> maxLabel <span class="op">=</span> useLog <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(termExtent[<span class="dv">1</span>] <span class="op">+</span> <span class="dv">1</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>) <span class="op">:</span> termExtent[<span class="dv">1</span>]<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb34-1753"><a href="#cb34-1753" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb34-1754"><a href="#cb34-1754" aria-hidden="true" tabindex="-1"></a>     legend<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb34-1755"><a href="#cb34-1755" aria-hidden="true" tabindex="-1"></a><span class="vs">       &lt;strong&gt;</span><span class="sc">${</span>label<span class="sc">}</span><span class="vs">&lt;/strong&gt;&lt;br&gt;</span></span>
<span id="cb34-1756"><a href="#cb34-1756" aria-hidden="true" tabindex="-1"></a><span class="vs">       &lt;div style="display:flex; align-items:center; gap:5px; margin-top:4px;"&gt;</span></span>
<span id="cb34-1757"><a href="#cb34-1757" aria-hidden="true" tabindex="-1"></a><span class="vs">         &lt;span&gt;</span><span class="sc">${</span>minLabel<span class="sc">}</span><span class="vs">&lt;/span&gt;</span></span>
<span id="cb34-1758"><a href="#cb34-1758" aria-hidden="true" tabindex="-1"></a><span class="vs">         &lt;div style="width:60px; height:10px; background: linear-gradient(to right, </span><span class="sc">${</span>colors<span class="op">.</span><span class="at">l2</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>colors<span class="op">.</span><span class="at">l1</span><span class="sc">}</span><span class="vs">);"&gt;&lt;/div&gt;</span></span>
<span id="cb34-1759"><a href="#cb34-1759" aria-hidden="true" tabindex="-1"></a><span class="vs">         &lt;span&gt;</span><span class="sc">${</span>maxLabel<span class="sc">}</span><span class="vs">&lt;/span&gt;</span></span>
<span id="cb34-1760"><a href="#cb34-1760" aria-hidden="true" tabindex="-1"></a><span class="vs">       &lt;/div&gt;</span></span>
<span id="cb34-1761"><a href="#cb34-1761" aria-hidden="true" tabindex="-1"></a><span class="vs">     `</span><span class="op">;</span></span>
<span id="cb34-1762"><a href="#cb34-1762" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb34-1763"><a href="#cb34-1763" aria-hidden="true" tabindex="-1"></a>     <span class="kw">const</span> L1 <span class="op">=</span> (levels <span class="op">&amp;&amp;</span> levels<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">?</span> levels[<span class="dv">0</span>] <span class="op">:</span> <span class="st">"Level 1"</span><span class="op">;</span></span>
<span id="cb34-1764"><a href="#cb34-1764" aria-hidden="true" tabindex="-1"></a>     <span class="kw">const</span> L2 <span class="op">=</span> (levels <span class="op">&amp;&amp;</span> levels<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">1</span>) <span class="op">?</span> levels[<span class="dv">1</span>] <span class="op">:</span> <span class="st">"Level 2"</span><span class="op">;</span></span>
<span id="cb34-1765"><a href="#cb34-1765" aria-hidden="true" tabindex="-1"></a>     legend<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb34-1766"><a href="#cb34-1766" aria-hidden="true" tabindex="-1"></a><span class="vs">       &lt;strong&gt;</span><span class="sc">${</span>term_selection<span class="sc">}</span><span class="vs">&lt;/strong&gt;&lt;br&gt;</span></span>
<span id="cb34-1767"><a href="#cb34-1767" aria-hidden="true" tabindex="-1"></a><span class="vs">       &lt;div style="display:flex; align-items:center; gap:5px; margin-top:2px;"&gt;</span></span>
<span id="cb34-1768"><a href="#cb34-1768" aria-hidden="true" tabindex="-1"></a><span class="vs">         &lt;span style="display:inline-block; width:10px; height:10px; background:</span><span class="sc">${</span>colors<span class="op">.</span><span class="at">l1</span><span class="sc">}</span><span class="vs">;"&gt;&lt;/span&gt; </span><span class="sc">${</span>L1<span class="sc">}</span><span class="vs">&lt;br&gt;</span></span>
<span id="cb34-1769"><a href="#cb34-1769" aria-hidden="true" tabindex="-1"></a><span class="vs">       &lt;/div&gt;</span></span>
<span id="cb34-1770"><a href="#cb34-1770" aria-hidden="true" tabindex="-1"></a><span class="vs">       &lt;div style="display:flex; align-items:center; gap:5px; margin-top:2px;"&gt;</span></span>
<span id="cb34-1771"><a href="#cb34-1771" aria-hidden="true" tabindex="-1"></a><span class="vs">         &lt;span style="display:inline-block; width:10px; height:10px; background:</span><span class="sc">${</span>colors<span class="op">.</span><span class="at">l2</span><span class="sc">}</span><span class="vs">;"&gt;&lt;/span&gt; </span><span class="sc">${</span>L2<span class="sc">}</span></span>
<span id="cb34-1772"><a href="#cb34-1772" aria-hidden="true" tabindex="-1"></a><span class="vs">       &lt;/div&gt;</span></span>
<span id="cb34-1773"><a href="#cb34-1773" aria-hidden="true" tabindex="-1"></a><span class="vs">     `</span><span class="op">;</span></span>
<span id="cb34-1774"><a href="#cb34-1774" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-1775"><a href="#cb34-1775" aria-hidden="true" tabindex="-1"></a>  div<span class="op">.</span><span class="fu">appendChild</span>(legend)<span class="op">;</span></span>
<span id="cb34-1776"><a href="#cb34-1776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1777"><a href="#cb34-1777" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ctx <span class="op">=</span> canvas<span class="op">.</span><span class="fu">getContext</span>(<span class="st">"2d"</span>)<span class="op">;</span></span>
<span id="cb34-1778"><a href="#cb34-1778" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> transform <span class="op">=</span> d3<span class="op">.</span><span class="at">zoomIdentity</span><span class="op">;</span></span>
<span id="cb34-1779"><a href="#cb34-1779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1780"><a href="#cb34-1780" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">draw</span>() {</span>
<span id="cb34-1781"><a href="#cb34-1781" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">save</span>()<span class="op">;</span></span>
<span id="cb34-1782"><a href="#cb34-1782" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">clearRect</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width<span class="op">,</span> height)<span class="op">;</span></span>
<span id="cb34-1783"><a href="#cb34-1783" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-1784"><a href="#cb34-1784" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">translate</span>(transform<span class="op">.</span><span class="at">x</span><span class="op">,</span> transform<span class="op">.</span><span class="at">y</span>)<span class="op">;</span></span>
<span id="cb34-1785"><a href="#cb34-1785" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">scale</span>(transform<span class="op">.</span><span class="at">k</span><span class="op">,</span> transform<span class="op">.</span><span class="at">k</span>)<span class="op">;</span></span>
<span id="cb34-1786"><a href="#cb34-1786" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-1787"><a href="#cb34-1787" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> radius <span class="op">=</span> opts<span class="op">.</span><span class="at">pt_size</span> <span class="op">/</span> transform<span class="op">.</span><span class="at">k</span><span class="op">;</span></span>
<span id="cb34-1788"><a href="#cb34-1788" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">globalAlpha</span> <span class="op">=</span> opts<span class="op">.</span><span class="at">pt_opacity</span><span class="op">;</span></span>
<span id="cb34-1789"><a href="#cb34-1789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1790"><a href="#cb34-1790" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> cOther <span class="op">=</span> colors<span class="op">.</span><span class="at">other</span><span class="op">;</span></span>
<span id="cb34-1791"><a href="#cb34-1791" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> cL1 <span class="op">=</span> colors<span class="op">.</span><span class="at">l1</span><span class="op">;</span></span>
<span id="cb34-1792"><a href="#cb34-1792" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> cL2 <span class="op">=</span> colors<span class="op">.</span><span class="at">l2</span><span class="op">;</span></span>
<span id="cb34-1793"><a href="#cb34-1793" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> L1 <span class="op">=</span> (levels <span class="op">&amp;&amp;</span> levels<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">?</span> levels[<span class="dv">0</span>] <span class="op">:</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb34-1794"><a href="#cb34-1794" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> L2 <span class="op">=</span> (levels <span class="op">&amp;&amp;</span> levels<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">1</span>) <span class="op">?</span> levels[<span class="dv">1</span>] <span class="op">:</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb34-1795"><a href="#cb34-1795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1796"><a href="#cb34-1796" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> data<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb34-1797"><a href="#cb34-1797" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> d <span class="op">=</span> data[i]<span class="op">;</span></span>
<span id="cb34-1798"><a href="#cb34-1798" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> fill <span class="op">=</span> cOther<span class="op">;</span></span>
<span id="cb34-1799"><a href="#cb34-1799" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb34-1800"><a href="#cb34-1800" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (isContinuous) {</span>
<span id="cb34-1801"><a href="#cb34-1801" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> (d<span class="op">.</span><span class="at">group_id</span> <span class="op">!=</span> <span class="kw">null</span>) {</span>
<span id="cb34-1802"><a href="#cb34-1802" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> val <span class="op">=</span> useLog <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(d<span class="op">.</span><span class="at">group_id</span> <span class="op">+</span> <span class="dv">1</span>) <span class="op">:</span> d<span class="op">.</span><span class="at">group_id</span><span class="op">;</span></span>
<span id="cb34-1803"><a href="#cb34-1803" aria-hidden="true" tabindex="-1"></a>            fill <span class="op">=</span> <span class="fu">colorScale</span>(val)<span class="op">;</span></span>
<span id="cb34-1804"><a href="#cb34-1804" aria-hidden="true" tabindex="-1"></a>         }</span>
<span id="cb34-1805"><a href="#cb34-1805" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb34-1806"><a href="#cb34-1806" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> (L1 <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">group_id</span> <span class="op">===</span> L1) fill <span class="op">=</span> cL1<span class="op">;</span></span>
<span id="cb34-1807"><a href="#cb34-1807" aria-hidden="true" tabindex="-1"></a>         <span class="cf">else</span> <span class="cf">if</span> (L2 <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">group_id</span> <span class="op">===</span> L2) fill <span class="op">=</span> cL2<span class="op">;</span></span>
<span id="cb34-1808"><a href="#cb34-1808" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb34-1809"><a href="#cb34-1809" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb34-1810"><a href="#cb34-1810" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> xy <span class="op">=</span> <span class="fu">project</span>(d<span class="op">.</span><span class="at">x_slide_mm</span><span class="op">,</span> d<span class="op">.</span><span class="at">y_slide_mm</span>)<span class="op">;</span></span>
<span id="cb34-1811"><a href="#cb34-1811" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb34-1812"><a href="#cb34-1812" aria-hidden="true" tabindex="-1"></a>      ctx<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb34-1813"><a href="#cb34-1813" aria-hidden="true" tabindex="-1"></a>      ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> fill<span class="op">;</span></span>
<span id="cb34-1814"><a href="#cb34-1814" aria-hidden="true" tabindex="-1"></a>      ctx<span class="op">.</span><span class="fu">fillRect</span>(xy[<span class="dv">0</span>] <span class="op">-</span> radius<span class="op">,</span> xy[<span class="dv">1</span>] <span class="op">-</span> radius<span class="op">,</span> radius<span class="op">*</span><span class="dv">2</span><span class="op">,</span> radius<span class="op">*</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb34-1815"><a href="#cb34-1815" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb34-1816"><a href="#cb34-1816" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-1817"><a href="#cb34-1817" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">restore</span>()<span class="op">;</span></span>
<span id="cb34-1818"><a href="#cb34-1818" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-1819"><a href="#cb34-1819" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (opts<span class="op">.</span><span class="at">show_scale</span>) {</span>
<span id="cb34-1820"><a href="#cb34-1820" aria-hidden="true" tabindex="-1"></a>       <span class="kw">const</span> barLenMm <span class="op">=</span> opts<span class="op">.</span><span class="at">scale_len</span><span class="op">;</span></span>
<span id="cb34-1821"><a href="#cb34-1821" aria-hidden="true" tabindex="-1"></a>       <span class="kw">const</span> barLenPx <span class="op">=</span> barLenMm <span class="op">*</span> pixelsPerMm <span class="op">*</span> transform<span class="op">.</span><span class="at">k</span><span class="op">;</span> </span>
<span id="cb34-1822"><a href="#cb34-1822" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb34-1823"><a href="#cb34-1823" aria-hidden="true" tabindex="-1"></a>       <span class="kw">const</span> margin <span class="op">=</span> <span class="dv">20</span><span class="op">;</span></span>
<span id="cb34-1824"><a href="#cb34-1824" aria-hidden="true" tabindex="-1"></a>       <span class="kw">const</span> barX <span class="op">=</span> width <span class="op">-</span> margin <span class="op">-</span> barLenPx<span class="op">;</span></span>
<span id="cb34-1825"><a href="#cb34-1825" aria-hidden="true" tabindex="-1"></a>       <span class="kw">const</span> barY <span class="op">=</span> height <span class="op">-</span> margin<span class="op">;</span></span>
<span id="cb34-1826"><a href="#cb34-1826" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb34-1827"><a href="#cb34-1827" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">save</span>()<span class="op">;</span></span>
<span id="cb34-1828"><a href="#cb34-1828" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb34-1829"><a href="#cb34-1829" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> opts<span class="op">.</span><span class="at">scale_color</span><span class="op">;</span></span>
<span id="cb34-1830"><a href="#cb34-1830" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="at">lineWidth</span> <span class="op">=</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="cb34-1831"><a href="#cb34-1831" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">moveTo</span>(barX<span class="op">,</span> barY)<span class="op">;</span></span>
<span id="cb34-1832"><a href="#cb34-1832" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">lineTo</span>(barX <span class="op">+</span> barLenPx<span class="op">,</span> barY)<span class="op">;</span></span>
<span id="cb34-1833"><a href="#cb34-1833" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb34-1834"><a href="#cb34-1834" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb34-1835"><a href="#cb34-1835" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> opts<span class="op">.</span><span class="at">scale_color</span><span class="op">;</span></span>
<span id="cb34-1836"><a href="#cb34-1836" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="at">font</span> <span class="op">=</span> <span class="st">"bold 14px sans-serif"</span><span class="op">;</span></span>
<span id="cb34-1837"><a href="#cb34-1837" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="at">textAlign</span> <span class="op">=</span> <span class="st">"center"</span><span class="op">;</span></span>
<span id="cb34-1838"><a href="#cb34-1838" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="at">textBaseline</span> <span class="op">=</span> <span class="st">"bottom"</span><span class="op">;</span></span>
<span id="cb34-1839"><a href="#cb34-1839" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">fillText</span>(<span class="vs">`</span><span class="sc">${</span>barLenMm<span class="sc">}</span><span class="vs"> mm`</span><span class="op">,</span> barX <span class="op">+</span> barLenPx<span class="op">/</span><span class="dv">2</span><span class="op">,</span> barY <span class="op">-</span> <span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb34-1840"><a href="#cb34-1840" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">restore</span>()<span class="op">;</span></span>
<span id="cb34-1841"><a href="#cb34-1841" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb34-1842"><a href="#cb34-1842" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-1843"><a href="#cb34-1843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1844"><a href="#cb34-1844" aria-hidden="true" tabindex="-1"></a>  <span class="fu">draw</span>()<span class="op">;</span></span>
<span id="cb34-1845"><a href="#cb34-1845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1846"><a href="#cb34-1846" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> zoom <span class="op">=</span> d3<span class="op">.</span><span class="fu">zoom</span>()</span>
<span id="cb34-1847"><a href="#cb34-1847" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">scaleExtent</span>([<span class="fl">0.5</span><span class="op">,</span> <span class="dv">50</span>]) </span>
<span id="cb34-1848"><a href="#cb34-1848" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"zoom"</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb34-1849"><a href="#cb34-1849" aria-hidden="true" tabindex="-1"></a>      transform <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">transform</span><span class="op">;</span></span>
<span id="cb34-1850"><a href="#cb34-1850" aria-hidden="true" tabindex="-1"></a>      <span class="fu">requestAnimationFrame</span>(draw)<span class="op">;</span></span>
<span id="cb34-1851"><a href="#cb34-1851" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb34-1852"><a href="#cb34-1852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1853"><a href="#cb34-1853" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">select</span>(canvas)<span class="op">.</span><span class="fu">call</span>(zoom)<span class="op">;</span></span>
<span id="cb34-1854"><a href="#cb34-1854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1855"><a href="#cb34-1855" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> div<span class="op">;</span></span>
<span id="cb34-1856"><a href="#cb34-1856" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div id="ojs-cell-34" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div>
</div>
</div>
</div><div id="use-your-own-data" class="dashboard-page tab-pane grid-skip html-fill-item html-fill-container" data-orientation="rows" data-scrolling="true" aria-labelledby="tab-use-your-own-data">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, 1fr); grid-auto-columns: minmax(0, 1fr);">
<div class="card html-fill-item html-fill-container bslib-card" data-title="How to use this dashboard with your own data" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-header"><div class="card-title html-fill-item html-fill-container"><span style="display: inline">
How to use this dashboard with your own data
</span></div></div>
<div class="card-body html-fill-item html-fill-container">
<p>You can use this dashboard to explore your own <code>smiDE</code> results. For now this dashboard only works using differential expression results obtained directly from the <code>smiDE</code> R package. So far I have tested it with two cases: a discrete/ categorical grouping variable and a continuous one.</p>
<p>Let’s say you have a differential expression object obtained from calling the <code>smiDE::smi_de</code> function:</p>
</div>
<div class="cell card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code html-fill-item html-fill-container" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(smiDE)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Example function call below that examines tumor cell expression across</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co"># different spatial domains (annotated_domains). </span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>de_obj <span class="ot">&lt;-</span> </span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">smi_de</span>(<span class="at">assay_matrix =</span> assay_matrix_use</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>          ,<span class="at">metadata =</span> meta_use</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>          ,<span class="at">formula =</span> <span class="sc">~</span><span class="fu">RankNorm</span>(otherct_expr) <span class="sc">+</span> annotated_domain <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(nCount_RNA)) </span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>          ,<span class="at">pre_de_obj =</span> pre_de_obj</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>          ,<span class="at">neighbor_expr_cell_type_metadata_colname =</span> <span class="st">"celltype_broad"</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>          ,<span class="at">neighbor_expr_overlap_weight_colname =</span> <span class="cn">NULL</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>          ,<span class="at">neighbor_expr_overlap_agg =</span><span class="st">"sum"</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>          ,<span class="at">neighbor_expr_totalcount_normalize =</span> <span class="cn">TRUE</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>          ,<span class="at">neighbor_expr_totalcount_scalefactor =</span>  tc_scalefactors </span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>          ,<span class="at">family=</span><span class="st">"nbinom2"</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>          ,<span class="at">cellid_colname =</span> <span class="st">"cell_id_numeric"</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>          ,<span class="at">targets=</span>genes_to_analyze,</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>          <span class="at">nCores=</span><span class="dv">30</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>   ) </span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>res_list <span class="ot">&lt;-</span> <span class="fu">results</span>(de_obj)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="card-body html-fill-item html-fill-container">
<p>Since the output structure differs slighlty depending on whether your DE results are based on discrete or continous terms, we’ll use this harmonizing function to format the results into a single format that the dashboard can understand. Specifically, the function below converts the <em>pairwise results</em> and the <em>emmeans results</em>.</p>
</div>
<div class="cell card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code html-fill-item html-fill-container" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' Harmonize smiDE Results for Dashboard</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param res_list The output list directly from smiDE::results(de_obj)</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return A list containing 'pairwise' and 'emmeans' data.frames with synchronized continuous labels</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>harmonize_de_results <span class="ot">&lt;-</span> <span class="cf">function</span>(res_list) {</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  emmeans_raw <span class="ot">&lt;-</span> res_list<span class="sc">$</span>emmeans</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"term"</span> <span class="sc">%in%</span> <span class="fu">names</span>(emmeans_raw)) {</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>    emmeans_raw <span class="ot">&lt;-</span> emmeans_raw[term <span class="sc">!=</span> <span class="st">"otherct_expr"</span>]</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>  emmeans_processed <span class="ot">&lt;-</span> emmeans_raw <span class="sc">%&gt;%</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Extract numeric suffix from level (e.g., "term42.697" -&gt; "42.697")</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">suffix_str =</span> <span class="fu">str_remove</span>(level, <span class="fu">fixed</span>(term)),</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">suffix_val =</span> <span class="fu">suppressWarnings</span>(<span class="fu">as.numeric</span>(suffix_str)),</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">is_continuous =</span> <span class="sc">!</span><span class="fu">is.na</span>(suffix_val) <span class="sc">&amp;</span> <span class="fu">str_starts</span>(level, <span class="fu">fixed</span>(term))</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">clean_level =</span> <span class="fu">case_when</span>(</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>        is_continuous <span class="sc">~</span> {</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>          direction <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>            category <span class="sc">==</span> <span class="st">"c1"</span> <span class="sc">~</span> <span class="st">"+ 1SD"</span>,</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>            category <span class="sc">==</span> <span class="st">"c2"</span> <span class="sc">~</span> <span class="st">"- 1SD"</span>,</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>            <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">""</span></span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>          <span class="fu">paste0</span>(<span class="st">"mean "</span>, direction, <span class="st">" ("</span>, <span class="fu">sprintf</span>(<span class="st">"%.2f"</span>, suffix_val), <span class="st">")"</span>)</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> level</span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">lookup_key =</span> <span class="fu">ifelse</span>(is_continuous, </span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">paste0</span>(term, <span class="st">"_"</span>, <span class="fu">sprintf</span>(<span class="st">"%.2f"</span>, suffix_val)), </span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">NA_character_</span>)</span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a>  continuous_map <span class="ot">&lt;-</span> emmeans_processed <span class="sc">%&gt;%</span></span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(is_continuous) <span class="sc">%&gt;%</span></span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(lookup_key, clean_level) <span class="sc">%&gt;%</span></span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb36-46"><a href="#cb36-46" aria-hidden="true" tabindex="-1"></a>    tibble<span class="sc">::</span><span class="fu">deframe</span>() </span>
<span id="cb36-47"><a href="#cb36-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-48"><a href="#cb36-48" aria-hidden="true" tabindex="-1"></a>  emmeans_out <span class="ot">&lt;-</span> emmeans_processed <span class="sc">%&gt;%</span></span>
<span id="cb36-49"><a href="#cb36-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(term, <span class="at">level =</span> clean_level, target, response, asymp.LCL, asymp.UCL) <span class="sc">%&gt;%</span></span>
<span id="cb36-50"><a href="#cb36-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>()</span>
<span id="cb36-51"><a href="#cb36-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-52"><a href="#cb36-52" aria-hidden="true" tabindex="-1"></a>  pairwise_combined <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(</span>
<span id="cb36-53"><a href="#cb36-53" aria-hidden="true" tabindex="-1"></a>    res_list[<span class="fu">c</span>(<span class="st">"pairwise"</span>, <span class="st">"one.vs.rest"</span>, <span class="st">"one.vs.all"</span>)], </span>
<span id="cb36-54"><a href="#cb36-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">idcol =</span> <span class="st">"contrast_type"</span>, </span>
<span id="cb36-55"><a href="#cb36-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">use.names =</span> <span class="cn">TRUE</span>, </span>
<span id="cb36-56"><a href="#cb36-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="cn">TRUE</span> </span>
<span id="cb36-57"><a href="#cb36-57" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-58"><a href="#cb36-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-59"><a href="#cb36-59" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"term"</span> <span class="sc">%in%</span> <span class="fu">names</span>(pairwise_combined)) {</span>
<span id="cb36-60"><a href="#cb36-60" aria-hidden="true" tabindex="-1"></a>    pairwise_combined <span class="ot">&lt;-</span> pairwise_combined[term <span class="sc">!=</span> <span class="st">"otherct_expr"</span>]</span>
<span id="cb36-61"><a href="#cb36-61" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-62"><a href="#cb36-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-63"><a href="#cb36-63" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="st">"ncells_1"</span> <span class="sc">%in%</span> <span class="fu">names</span>(pairwise_combined)) pairwise_combined[, ncells_1 <span class="sc">:</span><span class="er">=</span> <span class="cn">NA</span>]</span>
<span id="cb36-64"><a href="#cb36-64" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="st">"ncells_2"</span> <span class="sc">%in%</span> <span class="fu">names</span>(pairwise_combined)) pairwise_combined[, ncells_2 <span class="sc">:</span><span class="er">=</span> <span class="cn">NA</span>]</span>
<span id="cb36-65"><a href="#cb36-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-66"><a href="#cb36-66" aria-hidden="true" tabindex="-1"></a>  pairwise_out <span class="ot">&lt;-</span> pairwise_combined <span class="sc">%&gt;%</span></span>
<span id="cb36-67"><a href="#cb36-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb36-68"><a href="#cb36-68" aria-hidden="true" tabindex="-1"></a>      <span class="at">log2fc =</span> <span class="fu">log2</span>(fold_change),</span>
<span id="cb36-69"><a href="#cb36-69" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-70"><a href="#cb36-70" aria-hidden="true" tabindex="-1"></a>      <span class="at">is_continuous_row =</span> <span class="fu">is.na</span>(ncells_1) <span class="sc">&amp;</span> <span class="fu">is.na</span>(ncells_2)</span>
<span id="cb36-71"><a href="#cb36-71" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb36-72"><a href="#cb36-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb36-73"><a href="#cb36-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb36-74"><a href="#cb36-74" aria-hidden="true" tabindex="-1"></a>      <span class="at">contrast =</span> <span class="cf">if</span> (is_continuous_row) {</span>
<span id="cb36-75"><a href="#cb36-75" aria-hidden="true" tabindex="-1"></a>        parts <span class="ot">&lt;-</span> <span class="fu">str_split</span>(contrast, <span class="st">" / "</span>, <span class="at">simplify =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-76"><a href="#cb36-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-77"><a href="#cb36-77" aria-hidden="true" tabindex="-1"></a>        val1 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove</span>(parts[<span class="dv">1</span>], <span class="fu">fixed</span>(term)))</span>
<span id="cb36-78"><a href="#cb36-78" aria-hidden="true" tabindex="-1"></a>        val2 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove</span>(parts[<span class="dv">2</span>], <span class="fu">fixed</span>(term)))</span>
<span id="cb36-79"><a href="#cb36-79" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-80"><a href="#cb36-80" aria-hidden="true" tabindex="-1"></a>        key1 <span class="ot">&lt;-</span> <span class="fu">paste0</span>(term, <span class="st">"_"</span>, <span class="fu">sprintf</span>(<span class="st">"%.2f"</span>, val1))</span>
<span id="cb36-81"><a href="#cb36-81" aria-hidden="true" tabindex="-1"></a>        key2 <span class="ot">&lt;-</span> <span class="fu">paste0</span>(term, <span class="st">"_"</span>, <span class="fu">sprintf</span>(<span class="st">"%.2f"</span>, val2))</span>
<span id="cb36-82"><a href="#cb36-82" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-83"><a href="#cb36-83" aria-hidden="true" tabindex="-1"></a>        label1 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(key1 <span class="sc">%in%</span> <span class="fu">names</span>(continuous_map), continuous_map[key1], parts[<span class="dv">1</span>])</span>
<span id="cb36-84"><a href="#cb36-84" aria-hidden="true" tabindex="-1"></a>        label2 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(key2 <span class="sc">%in%</span> <span class="fu">names</span>(continuous_map), continuous_map[key2], parts[<span class="dv">2</span>])</span>
<span id="cb36-85"><a href="#cb36-85" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-86"><a href="#cb36-86" aria-hidden="true" tabindex="-1"></a>        <span class="fu">paste0</span>(label1, <span class="st">" / "</span>, label2)</span>
<span id="cb36-87"><a href="#cb36-87" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-88"><a href="#cb36-88" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb36-89"><a href="#cb36-89" aria-hidden="true" tabindex="-1"></a>        contrast</span>
<span id="cb36-90"><a href="#cb36-90" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb36-91"><a href="#cb36-91" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb36-92"><a href="#cb36-92" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb36-93"><a href="#cb36-93" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(term, contrast, target, log2fc, p.value, ncells_1, ncells_2) <span class="sc">%&gt;%</span></span>
<span id="cb36-94"><a href="#cb36-94" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>()</span>
<span id="cb36-95"><a href="#cb36-95" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-96"><a href="#cb36-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">pairwise =</span> pairwise_out, <span class="at">emmeans =</span> emmeans_out))</span>
<span id="cb36-97"><a href="#cb36-97" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="card-body html-fill-item html-fill-container">
<p>Now convert the <code>res_list</code> into the formatted parts.</p>
</div>
<div class="cell card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code html-fill-item html-fill-container" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>res_formatted <span class="ot">&lt;-</span> <span class="fu">harmonize_de_results</span>(res_list)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>pairwise <span class="ot">&lt;-</span> res_formatted<span class="sc">$</span>pairwise</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>emmeans <span class="ot">&lt;-</span> res_formatted<span class="sc">$</span>emmeans</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="card-body html-fill-item html-fill-container">
<p>The <code>pairwise</code> table and the <code>emmeans</code> table two of the four required components. To create the <code>study_header</code> – which is simply a description data set that helps provide a little more context to the data displayed on the dashboard itself, we’ll create it like this:</p>
</div>
<div class="cell card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code html-fill-item html-fill-container" id="annotated-cell-38"><pre class="sourceCode r code-annotation-code code-with-copy"><code class="sourceCode r"><span id="annotated-cell-38-1"><a href="#annotated-cell-38-1" aria-hidden="true" tabindex="-1"></a>study_header <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="annotated-cell-38-2"><a href="#annotated-cell-38-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Name</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Tumor cells across spatial domains"</span>,</span>
<span id="annotated-cell-38-3"><a href="#annotated-cell-38-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Description</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Colon Cancer WTX sample"</span>,</span>
<span id="annotated-cell-38-4"><a href="#annotated-cell-38-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Formala</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"~RankNorm(otherct_expr) + annotated_domain + offset(log(nCount_RNA))"</span>,</span>
<span id="annotated-cell-38-5"><a href="#annotated-cell-38-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Targets tested</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">length</span>(genes_to_analyze)</span>
<span id="annotated-cell-38-6"><a href="#annotated-cell-38-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="card-body html-fill-item html-fill-container">
<p>Note: The column names must <strong>match exactly</strong> as given.</p>
<p>And finally, it can be useful view the cells in space to get a sense of the spatial structure of groupings. We’ll do this by selecting columns within our cell-level metadata object. Keep in mind that this dataset is loaded fully in your browser’s memory and so very large dataframes might slow down or even crash your browser.</p>
<p>In the code snippet below, I’m interested in looking at the broad cell types and the annotated domain. Note that there are three required columns, <code>x_slide_mm</code>, <code>y_slide_mm</code>, and <code>slide_id_numeric</code>. The first two columns represent the xy position of the cells (in mm) and the last one is used to split cells into different samples.</p>
</div>
<div class="cell card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code html-fill-item html-fill-container" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># meta_df == the full cell-level metadata (i.e., obs)</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>meta_display <span class="ot">&lt;-</span> <span class="fu">data.table</span>(meta_df)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>meta_display <span class="ot">&lt;-</span> meta_display[, .(</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x_slide_mm =</span> sdimx, </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_slide_mm =</span> sdimy, </span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  celltype_broad,</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  annotated_domain</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>)]</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="st">'slide_id_numeric'</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(meta_df)){</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  meta_display<span class="sc">$</span>slide_id_numeric <span class="ot">&lt;-</span> meta_df<span class="sc">$</span>slide_id_numeric</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>  meta_display<span class="sc">$</span>slide_id_numeric <span class="ot">&lt;-</span> <span class="dv">1</span>L</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="card-body html-fill-item html-fill-container">
<p>At this point we are ready to package these four components so they can be loaded in your browser’s tab (specifically, in the virtual file system [VFS] that webR uses). The two steps to this procedure is:</p>
<ol type="1">
<li>convert data to parquet.</li>
<li>zip up all parquet files into a single zip file.</li>
</ol>
<p>When converting data to parquet, we’ll use this function. It’s just a wrapper function for writing to parquet but, to save memory, one could reduce the numeric precision of columns from R’s float64 to either 32 bit or 16 bit, if desired. Keep in mind that things like p-values will likely need greater precision.</p>
</div>
<div class="cell card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code html-fill-item html-fill-container" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(arrow)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>write_opt_parquet <span class="ot">&lt;-</span> <span class="cf">function</span>(df, filename, <span class="at">f32_cols =</span> <span class="cn">NULL</span>, <span class="at">f16_cols =</span> <span class="cn">NULL</span>) {</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert to Arrow Table</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  arrow_table <span class="ot">&lt;-</span> <span class="fu">as_arrow_table</span>(df)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cast Float32 columns</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(f32_cols)) {</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check which requested columns actually exist in this dataframe</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>    valid_cols <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">names</span>(df), f32_cols)</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(valid_cols) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>      arrow_table <span class="ot">&lt;-</span> arrow_table <span class="sc">%&gt;%</span> </span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(valid_cols), <span class="sc">~</span> <span class="fu">cast</span>(.x, <span class="fu">float32</span>())))</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cast Float16 columns</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(f16_cols)) {</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>    valid_cols <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">names</span>(df), f16_cols)</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(valid_cols) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>      arrow_table <span class="ot">&lt;-</span> arrow_table <span class="sc">%&gt;%</span> </span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(valid_cols), <span class="sc">~</span> <span class="fu">cast</span>(.x, <span class="fu">float16</span>())))</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Write to disk</span></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_parquet</span>(arrow_table, filename)</span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="card-body html-fill-item html-fill-container">
<p>Write the parquet files to disk. (the file names must match exactly)</p>
</div>
<div class="cell card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code html-fill-item html-fill-container" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>parquet_dir <span class="ot">&lt;-</span> <span class="st">"./your_parquet_folder"</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(parquet_dir)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="fu">write_opt_parquet</span>(study_header, <span class="fu">file.path</span>(parquet_dir, <span class="st">"study_header.parquet"</span>))</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="fu">write_opt_parquet</span>(</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  pairwise, </span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">file.path</span>(parquet_dir, <span class="st">"pairwise.parquet"</span>)</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="fu">write_opt_parquet</span>(</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>  emmeans, </span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">file.path</span>(parquet_dir, <span class="st">"emmeans.parquet"</span>)</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a><span class="fu">write_opt_parquet</span>(</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>  meta_display,</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">file.path</span>(parquet_dir, <span class="st">"cell_metadata.parquet"</span>),</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">f32_cols =</span> <span class="fu">c</span>(<span class="st">'x_slide_mm'</span>, <span class="st">'y_slide_mm'</span>),</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">f16_cols =</span> <span class="cn">NULL</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="card-body html-fill-item html-fill-container">
<p>And finally, zip it up!</p>
</div>
<div class="cell card-body html-fill-item html-fill-container">
<div class="sourceCode cell-code html-fill-item html-fill-container" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>files_to_zip <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"study_header.parquet"</span>, </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"pairwise.parquet"</span>, </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"emmeans.parquet"</span>, </span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"cell_metadata.parquet"</span>)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>zip<span class="sc">::</span><span class="fu">zip</span>(</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">zipfile =</span> <span class="st">"you_can_name_this_whatever_you_like.zip"</span>,</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">files =</span> files_to_zip, </span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">root =</span> parquet_dir </span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="card-body html-fill-item html-fill-container">
<p>And that should be it. You should be able to “upload” that zip file on the left side panel of the dashboard.</p>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div>
</div><div id="advanced" class="dashboard-page tab-pane grid-skip html-fill-item html-fill-container" data-orientation="rows" aria-labelledby="tab-advanced">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, 80fr); grid-auto-columns: minmax(0, 1fr);">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-columns: minmax(3em, 100fr);
grid-auto-rows: minmax(0, 1fr);">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, 1fr); grid-auto-columns: minmax(0, 1fr);">
<div class="card html-fill-item html-fill-container bslib-card" data-title="Description" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-header"><div class="card-title html-fill-item html-fill-container"><span style="display: inline">
Description
</span></div></div>
<div class="card-body html-fill-item html-fill-container">
<p>This is the code that generates the volcano plot. For advanced users who wish to modify the volcano plot aesthetics beyond what is available within <code>ADJUST IMAGE AESTHETICS</code>, you can adjust the code and click <code>Run Code</code>. This will, in turn, use your custom code reactively. If any errors occur, you can simply click <code>START OVER</code> or simply refresh your browser, to return the plotting function back to its original state. You can install and use additional R packages if you like if they are already <a href="https://repo.r-wasm.org/sembly" target="_blank">compiled to WebAssembly</a>.</p>
<p>. This is “living code” is used to generate the and adjustmentused to reactively generate the plots of the dashboard. You can modify them to generate completely custom aesthetics. If run into issues, you can always press ‘START OVER’ to return the plotting function back to its original form.</p>
</div>
<div class="cell card-body html-fill-item html-fill-container" data-edit="true" data-autorun="true" data-input="[&quot;volcano_fc_range&quot;,&quot;volcano_pval_threshold&quot;,&quot;volcano_pt_size&quot;,&quot;volcano_alpha&quot;,&quot;volcano_pt_color&quot;,&quot;volcano_sig_color&quot;,&quot;volcano_high_fc_label&quot;,&quot;volcano_low_fc_label&quot;,&quot;volcano_pval_label&quot;,&quot;volcano_include_selected_genes&quot;,&quot;selected_genes&quot;]" data-define="[&quot;volcano_plot_emit&quot;,&quot;plotVolcano&quot;,&quot;argsVolcano&quot;]" data-title="Volcano Plot Source Code">
<div class="html-fill-item html-fill-container">
<div id="webr-12" class="exercise-cell html-fill-item html-fill-container">

</div>
<script type="webr-12-contents">
eyJhdHRyIjp7ImF1dG9ydW4iOnRydWUsImRlZmluZSI6WyJ2b2xjYW5vX3Bsb3RfZW1pdCIsInBsb3RWb2xjYW5vIiwiYXJnc1ZvbGNhbm8iXSwiZWRpdCI6dHJ1ZSwiZXZhbCI6dHJ1ZSwiaW5wdXQiOlsidm9sY2Fub19mY19yYW5nZSIsInZvbGNhbm9fcHZhbF90aHJlc2hvbGQiLCJ2b2xjYW5vX3B0X3NpemUiLCJ2b2xjYW5vX2FscGhhIiwidm9sY2Fub19wdF9jb2xvciIsInZvbGNhbm9fc2lnX2NvbG9yIiwidm9sY2Fub19oaWdoX2ZjX2xhYmVsIiwidm9sY2Fub19sb3dfZmNfbGFiZWwiLCJ2b2xjYW5vX3B2YWxfbGFiZWwiLCJ2b2xjYW5vX2luY2x1ZGVfc2VsZWN0ZWRfZ2VuZXMiLCJzZWxlY3RlZF9nZW5lcyJdLCJvdXRwdXQiOnRydWUsInRpdGxlIjoiVm9sY2FubyBQbG90IFNvdXJjZSBDb2RlIiwid2FybmluZyI6ZmFsc2V9LCJjb2RlIjoiXG52b2xjYW5vX3Bsb3RfZW1pdCA8LSBUUlVFXG5pZihleGlzdHMoLlJhbmRvbS5zZWVkKSl7XG4gIHJtKC5SYW5kb20uc2VlZClcbn1cbnNldC5zZWVkKDQyTClcbnBsb3RWb2xjYW5vIDwtIGZ1bmN0aW9uKGRmLCB2ZmMsIHZwbCwgdnB0LCB2YWxwaGEsIHZwdGNvbG9yKXtcbiAgXG4gIGRmJGNvbG9yX2dyb3VwIDwtIGlmZWxzZShcbiAgICBkZiRwLnZhbHVlIDwgdnBsICYgYWJzKGRmJGxvZzJmYykgPiB2ZmMsIFxuICAgIFwiU2lnbmlmaWNhbnRcIiwgXG4gICAgXCJOb3QgU2lnbmlmaWNhbnRcIlxuICApXG4gIGdlbmVzX3RvX2xhYmVsIDwtIGMoKVxuICBpZihsZW5ndGgoc2VsZWN0ZWRfZ2VuZXMpPjAgJiYgdm9sY2Fub19pbmNsdWRlX3NlbGVjdGVkX2dlbmVzPT1cIlllc1wiKXtcbiAgICBnZW5lc190b19sYWJlbCA8LSBjKGdlbmVzX3RvX2xhYmVsLCBcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkX2dlbmVzKVxuICB9XG4gIGlmKHZvbGNhbm9faGlnaF9mY19sYWJlbD4wKXtcbiAgICBnZW5lc190b19sYWJlbCA8LSBjKGdlbmVzX3RvX2xhYmVsLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGYgJT4lIGFycmFuZ2UoLWxvZzJmYykgJT4lIGhlYWQodm9sY2Fub19oaWdoX2ZjX2xhYmVsKSAlPiUgc2VsZWN0KHRhcmdldCkpXG4gIH1cbiAgaWYodm9sY2Fub19sb3dfZmNfbGFiZWw+MCl7XG4gICAgZ2VuZXNfdG9fbGFiZWwgPC0gYyhnZW5lc190b19sYWJlbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRmICU+JSBhcnJhbmdlKGxvZzJmYykgJT4lIGhlYWQodm9sY2Fub19sb3dfZmNfbGFiZWwpICU+JSBzZWxlY3QodGFyZ2V0KSlcbiAgfSAgXG4gIGlmKHZvbGNhbm9fcHZhbF9sYWJlbD4wKXtcbiAgICBnZW5lc190b19sYWJlbCA8LSBjKGdlbmVzX3RvX2xhYmVsLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGYgJT4lIGFycmFuZ2UocC52YWx1ZSkgJT4lIGhlYWQodm9sY2Fub19wdmFsX2xhYmVsKSAlPiUgc2VsZWN0KHRhcmdldCkpXG4gIH0gIFxuICBnZW5lc190b19sYWJlbCA8LSB1bmlxdWUodW5saXN0KGdlbmVzX3RvX2xhYmVsKSlcbiAgXG4gIHAgPC0gZ2dwbG90KGRmLCBhZXMoeD1sb2cyZmMsIHk9LWxvZzEwKHAudmFsdWUpKSkgKyBcbiAgICAgIGdlb21fcG9pbnQoYWVzKGNvbG9yID0gY29sb3JfZ3JvdXApLCBcbiAgICAgICAgICAgICAgICAgc2l6ZT12cHQsIGFscGhhPXZhbHBoYSkgK1xuICAgICAgc2NhbGVfY29sb3JfbWFudWFsKHZhbHVlcyA9IGMoXCJTaWduaWZpY2FudFwiID0gdm9sY2Fub19zaWdfY29sb3IsIFwiTm90IFNpZ25pZmljYW50XCIgPSB2cHRjb2xvcikpICsgXG4gICAgICBnZW9tX3ZsaW5lKHhpbnRlcmNlcHQgPSBjKC12ZmMsIHZmYykpICsgXG4gICAgICBnZW9tX2hsaW5lKHlpbnRlcmNlcHQgPSAtbG9nMTAodnBsKSlcbiAgXG4gIGlmKGxlbmd0aChnZW5lc190b19sYWJlbCk+MCl7XG4gICAgcCA8LSBwICsgZ2dyZXBlbDo6Z2VvbV9sYWJlbF9yZXBlbChkYXRhPWZpbHRlcihkZiwgdGFyZ2V0ICVpbiUgZ2VuZXNfdG9fbGFiZWwpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFlcyh4PWxvZzJmYywgeT0tbG9nMTAocC52YWx1ZSksIGxhYmVsPXRhcmdldCkpXG4gIH1cbiAgc3RhdHMgPSBkYXRhLmZyYW1lKFxuICAgIGBDYXRlZ29yeWAgPSBjKHBhc3RlMChcIlNpZ25pZmljYW50IGF0IFAtdmFsdWUgXCIsIHZwbCwgXCIgdGhyZXNob2xkOiBcIiksXG4gICAgICAgICAgICAgICAgICAgcGFzdGUwKFwiTnVtYmVyIGdlbmVzIHdpdGggbG9nMkZDID49IFwiLCAgdmZjLCBcIjpcIiksXG4gICAgICAgICAgICAgICAgICAgcGFzdGUwKFwiTnVtYmVyIGdlbmVzIHdpdGggbG9nMkZDIDw9IFwiLCAgLXZmYywgXCI6XCIpLFxuICAgICAgICAgICAgICAgICAgIHBhc3RlMChcIlNpZ25pZmFudCBhbmQgaGlnaCBsb2cyRkM6XCIpLFxuICAgICAgICAgICAgICAgICAgIHBhc3RlMChcIlNpZ25pZmFudCBhbmQgbG93IGxvZzJGQzpcIilcbiAgICAgICAgICAgICAgICAgICApLFxuICAgIGBWYWx1ZWAgPSBjKGZpbHRlcihkZiwgcC52YWx1ZSA8PSB2cGwpICU+JSBucm93KCksXG4gICAgICAgICAgICAgICAgZmlsdGVyKGRmLCBsb2cyZmMgPj0gdmZjKSAlPiUgbnJvdygpLFxuICAgICAgICAgICAgICAgIGZpbHRlcihkZiwgbG9nMmZjIDw9IC12ZmMpICU+JSBucm93KCksXG4gICAgICAgICAgICAgICAgZmlsdGVyKGRmLCBsb2cyZmMgPj0gdmZjLCBwLnZhbHVlIDw9IHZwbCkgJT4lIG5yb3coKSxcbiAgICAgICAgICAgICAgICBmaWx0ZXIoZGYsIGxvZzJmYyA8PSAtdmZjLCBwLnZhbHVlIDw9IHZwbCkgJT4lIG5yb3coKVxuICAgICAgICAgICAgICAgIClcbiAgKVxuICByZXR1cm4obGlzdChwLCBzdGF0cywgZ2VuZXNfdG9fbGFiZWwpKSAjIFJldHVybiBsYWJlbGVkIGdlbmVzIGFzIHRoZSAzcmQgZWxlbWVudFxufVxuXG5hcmdzVm9sY2FubyA8LSBsaXN0KHZmYz12b2xjYW5vX2ZjX3JhbmdlLCBcbiAgICAgICAgICAgICAgICAgICAgdnBsPXZvbGNhbm9fcHZhbF90aHJlc2hvbGQsXG4gICAgICAgICAgICAgICAgICAgIHZwdD12b2xjYW5vX3B0X3NpemUsXG4gICAgICAgICAgICAgICAgICAgIHZhbHBoYT12b2xjYW5vX2FscGhhLFxuICAgICAgICAgICAgICAgICAgICB2cHRjb2xvcj12b2xjYW5vX3B0X2NvbG9yKSJ9
</script>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div>
</div>
</div>
</div><div id="r-console" class="dashboard-page tab-pane grid-skip html-fill-item html-fill-container" data-orientation="rows" aria-labelledby="tab-r-console">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, max-content) minmax(3em, 1fr) minmax(3em, max-content); grid-auto-columns: minmax(0, 1fr);">
<div class="card html-fill-item html-fill-container bslib-card" data-fill="false" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-body html-fill-item html-fill-container">
<p>This <code>webR</code> console is available for anything from quick calculations to creating additional plots. For a list of pre-compiled R packages that are available take a look at <a href="https://repo.r-wasm.org/" target="_blank">https://repo.r-wasm.org/</a>.</p>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
<div class="card cell html-fill-item html-fill-container bslib-card" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-body html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="webr-13" class="exercise-cell html-fill-item html-fill-container">

</div>
<script type="webr-13-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiXG5scygpIn0=
</script>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>


<div id="3ade8a4a-fb1d-4a6c-8409-ac45482d5fc9" class="hidden html-fill-item html-fill-container">

</div>
<div class="card html-fill-item html-fill-container bslib-card" data-fill="false" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-body html-fill-item html-fill-container">
<script type="webr-data">
eyJvcHRpb25zIjp7ImJhc2VVcmwiOiJodHRwczovL3dlYnIuci13YXNtLm9yZy92MC41LjgvIn0sInBhY2thZ2VzIjp7InBrZ3MiOlsiZXZhbHVhdGUiLCJrbml0ciIsImh0bWx0b29scyIsImRwbHlyIiwiZGJwbHlyIiwiREJJIiwiZHVja2RiIiwiZ2dwbG90MiIsImdncmVwZWwiLCJzdmdsaXRlIiwianNvbmxpdGUiLCJwbG90bHkiXSwicmVwb3MiOlsiaHR0cHM6Ly9yLWxpYi5yLXVuaXZlcnNlLmRldiJdfSwicmVuZGVyX2RmIjoiZGVmYXVsdCJ9
</script>
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3siY2VsbE5hbWUiOiJ3ZWJyLXdpZGdldC0xMyIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6IntcbiAgLy8gV2FpdCBmb3Igb3V0cHV0IHRvIGJlIHdyaXR0ZW4gdG8gdGhlIERPTSwgdGhlbiB0cmlnZ2VyIHdpZGdldCByZW5kZXJpbmdcbiAgYXdhaXQgX3dlYnJfdmFsdWVfMTM7XG4gIGlmICh3aW5kb3cuSFRNTFdpZGdldHMpIHtcbiAgICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKCk7XG4gIH1cbiAgaWYgKHdpbmRvdy5QYWdlZFRhYmxlRG9jKSB7XG4gICAgd2luZG93LlBhZ2VkVGFibGVEb2MuaW5pdEFsbCgpO1xuICB9XG59XG4ifSx7ImNlbGxOYW1lIjoid2Vici0xMyIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJzb3VyY2UiOiJ2aWV3b2YgX3dlYnJfZWRpdG9yXzEzID0ge1xuICBjb25zdCB7IFdlYlJFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuICBjb25zdCBzY3JpcHRDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihgc2NyaXB0W3R5cGU9XFxcIndlYnItMTMtY29udGVudHNcXFwiXWApLnRleHRDb250ZW50O1xuICBjb25zdCBibG9jayA9IEpTT04ucGFyc2UoYjY0RGVjb2RlKHNjcmlwdENvbnRlbnQpKTtcblxuICBjb25zdCBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7IGlkOiBgd2Vici0xMy1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBXZWJSRXhlcmNpc2VFZGl0b3Iod2ViUk9qcy53ZWJSUHJvbWlzZSwgYmxvY2suY29kZSwgb3B0aW9ucyk7XG5cbiAgcmV0dXJuIGVkaXRvci5jb250YWluZXI7XG59XG5fd2Vicl92YWx1ZV8xMyA9IHdlYlJPanMucHJvY2Vzcyhfd2Vicl9lZGl0b3JfMTMsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLXdpZGdldC0xMiIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6IntcbiAgLy8gV2FpdCBmb3Igb3V0cHV0IHRvIGJlIHdyaXR0ZW4gdG8gdGhlIERPTSwgdGhlbiB0cmlnZ2VyIHdpZGdldCByZW5kZXJpbmdcbiAgYXdhaXQgX3dlYnJfdmFsdWVfMTI7XG4gIGlmICh3aW5kb3cuSFRNTFdpZGdldHMpIHtcbiAgICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKCk7XG4gIH1cbiAgaWYgKHdpbmRvdy5QYWdlZFRhYmxlRG9jKSB7XG4gICAgd2luZG93LlBhZ2VkVGFibGVEb2MuaW5pdEFsbCgpO1xuICB9XG59XG4ifSx7ImNlbGxOYW1lIjoid2Vici0xMiIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJzb3VyY2UiOiJ2aWV3b2YgX3dlYnJfZWRpdG9yXzEyID0ge1xuICBjb25zdCB7IFdlYlJFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuICBjb25zdCBzY3JpcHRDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihgc2NyaXB0W3R5cGU9XFxcIndlYnItMTItY29udGVudHNcXFwiXWApLnRleHRDb250ZW50O1xuICBjb25zdCBibG9jayA9IEpTT04ucGFyc2UoYjY0RGVjb2RlKHNjcmlwdENvbnRlbnQpKTtcblxuICBjb25zdCBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7IGlkOiBgd2Vici0xMi1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBXZWJSRXhlcmNpc2VFZGl0b3Iod2ViUk9qcy53ZWJSUHJvbWlzZSwgYmxvY2suY29kZSwgb3B0aW9ucyk7XG5cbiAgcmV0dXJuIGVkaXRvci5jb250YWluZXI7XG59XG5fd2Vicl92YWx1ZV8xMiA9IHdlYlJPanMucHJvY2Vzcyhfd2Vicl9lZGl0b3JfMTIsIHt2b2xjYW5vX2ZjX3JhbmdlLCB2b2xjYW5vX3B2YWxfdGhyZXNob2xkLCB2b2xjYW5vX3B0X3NpemUsIHZvbGNhbm9fYWxwaGEsIHZvbGNhbm9fcHRfY29sb3IsIHZvbGNhbm9fc2lnX2NvbG9yLCB2b2xjYW5vX2hpZ2hfZmNfbGFiZWwsIHZvbGNhbm9fbG93X2ZjX2xhYmVsLCB2b2xjYW5vX3B2YWxfbGFiZWwsIHZvbGNhbm9faW5jbHVkZV9zZWxlY3RlZF9nZW5lcywgc2VsZWN0ZWRfZ2VuZXN9KTtcbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLXdpZGdldC0xMSIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6IntcbiAgLy8gV2FpdCBmb3Igb3V0cHV0IHRvIGJlIHdyaXR0ZW4gdG8gdGhlIERPTSwgdGhlbiB0cmlnZ2VyIHdpZGdldCByZW5kZXJpbmdcbiAgYXdhaXQgX3dlYnJfdmFsdWVfMTE7XG4gIGlmICh3aW5kb3cuSFRNTFdpZGdldHMpIHtcbiAgICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKCk7XG4gIH1cbiAgaWYgKHdpbmRvdy5QYWdlZFRhYmxlRG9jKSB7XG4gICAgd2luZG93LlBhZ2VkVGFibGVEb2MuaW5pdEFsbCgpO1xuICB9XG59XG4ifSx7ImNlbGxOYW1lIjoid2Vici0xMSIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJzb3VyY2UiOiJfd2Vicl92YWx1ZV8xMSA9IHtcbiAgY29uc3QgeyBoaWdobGlnaHRSLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici0xMS1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIC8vIERlZmF1bHQgZXZhbHVhdGlvbiBjb25maWd1cmF0aW9uXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHtcbiAgICBpZDogXCJ3ZWJyLTExLWNvbnRlbnRzXCIsXG4gICAgZWNobzogdHJ1ZSxcbiAgICBvdXRwdXQ6IHRydWVcbiAgfSwgYmxvY2suYXR0cik7XG5cbiAgLy8gRXZhbHVhdGUgdGhlIHByb3ZpZGVkIFIgY29kZVxuICBjb25zdCByZXN1bHQgPSB3ZWJST2pzLnByb2Nlc3Moe2NvZGU6IGJsb2NrLmNvZGUsIG9wdGlvbnN9LCB7c3R1ZHlfZGF0YV9wYXlsb2FkLCBtZWFuc19kYXRhX2pzLCBtZWFuc19sZXZlbCwgbWVhbnNfaGlnaGxpZ2h0LCBtZWFuc19zaG93X2xhYmVsZWQsIHNlbGVjdGVkX2dlbmVzfSk7XG5cbiAgLy8gRWFybHkgeWllbGQgd2hpbGUgd2Ugd2FpdCBmb3IgdGhlIGZpcnN0IGV2YWx1YXRpb24gYW5kIHJlbmRlclxuICBpZiAob3B0aW9ucy5vdXRwdXQgJiYgIShcIjExXCIgaW4gd2ViUk9qcy5yZW5kZXJlZE9qcykpIHtcbiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIGNvbnN0IHNwaW5uZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXG4gICAgaWYgKG9wdGlvbnMuZWNobykge1xuICAgICAgLy8gU2hvdyBvdXRwdXQgYXMgaGlnaGxpZ2h0ZWQgc291cmNlXG4gICAgICBjb25zdCBwcmVFbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInByZVwiKTtcbiAgICAgIGNvbnRhaW5lci5jbGFzc05hbWUgPSBcInNvdXJjZUNvZGVcIjtcbiAgICAgIHByZUVsZW0uY2xhc3NOYW1lID0gXCJzb3VyY2VDb2RlIHJcIjtcbiAgICAgIHByZUVsZW0uYXBwZW5kQ2hpbGQoaGlnaGxpZ2h0UihibG9jay5jb2RlKSk7XG4gICAgICBzcGlubmVyLmNsYXNzTmFtZSA9IFwic3Bpbm5lci1ncm93IHNwaW5uZXItZ3Jvdy1zbSBtLTIgcG9zaXRpb24tYWJzb2x1dGUgdG9wLTAgZW5kLTBcIjtcbiAgICAgIHByZUVsZW0uYXBwZW5kQ2hpbGQoc3Bpbm5lcik7XG4gICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQocHJlRWxlbSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNwaW5uZXIuY2xhc3NOYW1lID0gXCJzcGlubmVyLWJvcmRlciBzcGlubmVyLWJvcmRlci1zbVwiO1xuICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHNwaW5uZXIpO1xuICAgIH1cblxuICAgIHlpZWxkIGNvbnRhaW5lcjtcbiAgfVxuXG4gIHdlYlJPanMucmVuZGVyZWRPanNbXCIxMVwiXSA9IHRydWU7XG4gIHlpZWxkIGF3YWl0IHJlc3VsdDtcbn1cbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLXdpZGdldC0xMCIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6IntcbiAgLy8gV2FpdCBmb3Igb3V0cHV0IHRvIGJlIHdyaXR0ZW4gdG8gdGhlIERPTSwgdGhlbiB0cmlnZ2VyIHdpZGdldCByZW5kZXJpbmdcbiAgYXdhaXQgX3dlYnJfdmFsdWVfMTA7XG4gIGlmICh3aW5kb3cuSFRNTFdpZGdldHMpIHtcbiAgICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKCk7XG4gIH1cbiAgaWYgKHdpbmRvdy5QYWdlZFRhYmxlRG9jKSB7XG4gICAgd2luZG93LlBhZ2VkVGFibGVEb2MuaW5pdEFsbCgpO1xuICB9XG59XG4ifSx7ImNlbGxOYW1lIjoid2Vici0xMCIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJzb3VyY2UiOiJfd2Vicl92YWx1ZV8xMCA9IHtcbiAgY29uc3QgeyBoaWdobGlnaHRSLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici0xMC1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIC8vIERlZmF1bHQgZXZhbHVhdGlvbiBjb25maWd1cmF0aW9uXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHtcbiAgICBpZDogXCJ3ZWJyLTEwLWNvbnRlbnRzXCIsXG4gICAgZWNobzogdHJ1ZSxcbiAgICBvdXRwdXQ6IHRydWVcbiAgfSwgYmxvY2suYXR0cik7XG5cbiAgLy8gRXZhbHVhdGUgdGhlIHByb3ZpZGVkIFIgY29kZVxuICBjb25zdCByZXN1bHQgPSB3ZWJST2pzLnByb2Nlc3Moe2NvZGU6IGJsb2NrLmNvZGUsIG9wdGlvbnN9LCB7c3R1ZHlfZGF0YV9wYXlsb2FkLCBhdmFpbGFibGVfbGV2ZWxzfSk7XG5cbiAgLy8gRWFybHkgeWllbGQgd2hpbGUgd2Ugd2FpdCBmb3IgdGhlIGZpcnN0IGV2YWx1YXRpb24gYW5kIHJlbmRlclxuICBpZiAob3B0aW9ucy5vdXRwdXQgJiYgIShcIjEwXCIgaW4gd2ViUk9qcy5yZW5kZXJlZE9qcykpIHtcbiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIGNvbnN0IHNwaW5uZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXG4gICAgaWYgKG9wdGlvbnMuZWNobykge1xuICAgICAgLy8gU2hvdyBvdXRwdXQgYXMgaGlnaGxpZ2h0ZWQgc291cmNlXG4gICAgICBjb25zdCBwcmVFbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInByZVwiKTtcbiAgICAgIGNvbnRhaW5lci5jbGFzc05hbWUgPSBcInNvdXJjZUNvZGVcIjtcbiAgICAgIHByZUVsZW0uY2xhc3NOYW1lID0gXCJzb3VyY2VDb2RlIHJcIjtcbiAgICAgIHByZUVsZW0uYXBwZW5kQ2hpbGQoaGlnaGxpZ2h0UihibG9jay5jb2RlKSk7XG4gICAgICBzcGlubmVyLmNsYXNzTmFtZSA9IFwic3Bpbm5lci1ncm93IHNwaW5uZXItZ3Jvdy1zbSBtLTIgcG9zaXRpb24tYWJzb2x1dGUgdG9wLTAgZW5kLTBcIjtcbiAgICAgIHByZUVsZW0uYXBwZW5kQ2hpbGQoc3Bpbm5lcik7XG4gICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQocHJlRWxlbSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNwaW5uZXIuY2xhc3NOYW1lID0gXCJzcGlubmVyLWJvcmRlciBzcGlubmVyLWJvcmRlci1zbVwiO1xuICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHNwaW5uZXIpO1xuICAgIH1cblxuICAgIHlpZWxkIGNvbnRhaW5lcjtcbiAgfVxuXG4gIHdlYlJPanMucmVuZGVyZWRPanNbXCIxMFwiXSA9IHRydWU7XG4gIHlpZWxkIGF3YWl0IHJlc3VsdDtcbn1cbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLXdpZGdldC05IiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV85O1xuICBpZiAod2luZG93LkhUTUxXaWRnZXRzKSB7XG4gICAgd2luZG93LkhUTUxXaWRnZXRzLnN0YXRpY1JlbmRlcigpO1xuICB9XG4gIGlmICh3aW5kb3cuUGFnZWRUYWJsZURvYykge1xuICAgIHdpbmRvdy5QYWdlZFRhYmxlRG9jLmluaXRBbGwoKTtcbiAgfVxufVxuIn0seyJjZWxsTmFtZSI6IndlYnItOSIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJzb3VyY2UiOiJfd2Vicl92YWx1ZV85ID0ge1xuICBjb25zdCB7IGhpZ2hsaWdodFIsIGI2NERlY29kZSB9ID0gd2luZG93Ll9leGVyY2lzZV9vanNfcnVudGltZTtcbiAgY29uc3Qgc2NyaXB0Q29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYHNjcmlwdFt0eXBlPVxcXCJ3ZWJyLTktY29udGVudHNcXFwiXWApLnRleHRDb250ZW50O1xuICBjb25zdCBibG9jayA9IEpTT04ucGFyc2UoYjY0RGVjb2RlKHNjcmlwdENvbnRlbnQpKTtcblxuICAvLyBEZWZhdWx0IGV2YWx1YXRpb24gY29uZmlndXJhdGlvblxuICBjb25zdCBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7XG4gICAgaWQ6IFwid2Vici05LWNvbnRlbnRzXCIsXG4gICAgZWNobzogdHJ1ZSxcbiAgICBvdXRwdXQ6IHRydWVcbiAgfSwgYmxvY2suYXR0cik7XG5cbiAgLy8gRXZhbHVhdGUgdGhlIHByb3ZpZGVkIFIgY29kZVxuICBjb25zdCByZXN1bHQgPSB3ZWJST2pzLnByb2Nlc3Moe2NvZGU6IGJsb2NrLmNvZGUsIG9wdGlvbnN9LCB7c2F2ZV9idG4sIHNhdmVfcmVxdWVzdH0pO1xuXG4gIC8vIEVhcmx5IHlpZWxkIHdoaWxlIHdlIHdhaXQgZm9yIHRoZSBmaXJzdCBldmFsdWF0aW9uIGFuZCByZW5kZXJcbiAgaWYgKG9wdGlvbnMub3V0cHV0ICYmICEoXCI5XCIgaW4gd2ViUk9qcy5yZW5kZXJlZE9qcykpIHtcbiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIGNvbnN0IHNwaW5uZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXG4gICAgaWYgKG9wdGlvbnMuZWNobykge1xuICAgICAgLy8gU2hvdyBvdXRwdXQgYXMgaGlnaGxpZ2h0ZWQgc291cmNlXG4gICAgICBjb25zdCBwcmVFbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInByZVwiKTtcbiAgICAgIGNvbnRhaW5lci5jbGFzc05hbWUgPSBcInNvdXJjZUNvZGVcIjtcbiAgICAgIHByZUVsZW0uY2xhc3NOYW1lID0gXCJzb3VyY2VDb2RlIHJcIjtcbiAgICAgIHByZUVsZW0uYXBwZW5kQ2hpbGQoaGlnaGxpZ2h0UihibG9jay5jb2RlKSk7XG4gICAgICBzcGlubmVyLmNsYXNzTmFtZSA9IFwic3Bpbm5lci1ncm93IHNwaW5uZXItZ3Jvdy1zbSBtLTIgcG9zaXRpb24tYWJzb2x1dGUgdG9wLTAgZW5kLTBcIjtcbiAgICAgIHByZUVsZW0uYXBwZW5kQ2hpbGQoc3Bpbm5lcik7XG4gICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQocHJlRWxlbSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNwaW5uZXIuY2xhc3NOYW1lID0gXCJzcGlubmVyLWJvcmRlciBzcGlubmVyLWJvcmRlci1zbVwiO1xuICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHNwaW5uZXIpO1xuICAgIH1cblxuICAgIHlpZWxkIGNvbnRhaW5lcjtcbiAgfVxuXG4gIHdlYlJPanMucmVuZGVyZWRPanNbXCI5XCJdID0gdHJ1ZTtcbiAgeWllbGQgYXdhaXQgcmVzdWx0O1xufVxuIn0seyJjZWxsTmFtZSI6IndlYnItd2lkZ2V0LTgiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJ7XG4gIC8vIFdhaXQgZm9yIG91dHB1dCB0byBiZSB3cml0dGVuIHRvIHRoZSBET00sIHRoZW4gdHJpZ2dlciB3aWRnZXQgcmVuZGVyaW5nXG4gIGF3YWl0IF93ZWJyX3ZhbHVlXzg7XG4gIGlmICh3aW5kb3cuSFRNTFdpZGdldHMpIHtcbiAgICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKCk7XG4gIH1cbiAgaWYgKHdpbmRvdy5QYWdlZFRhYmxlRG9jKSB7XG4gICAgd2luZG93LlBhZ2VkVGFibGVEb2MuaW5pdEFsbCgpO1xuICB9XG59XG4ifSx7ImNlbGxOYW1lIjoid2Vici04IiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCIsInNvdXJjZSI6Il93ZWJyX3ZhbHVlXzggPSB7XG4gIGNvbnN0IHsgaGlnaGxpZ2h0UiwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuICBjb25zdCBzY3JpcHRDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihgc2NyaXB0W3R5cGU9XFxcIndlYnItOC1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIC8vIERlZmF1bHQgZXZhbHVhdGlvbiBjb25maWd1cmF0aW9uXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHtcbiAgICBpZDogXCJ3ZWJyLTgtY29udGVudHNcIixcbiAgICBlY2hvOiB0cnVlLFxuICAgIG91dHB1dDogdHJ1ZVxuICB9LCBibG9jay5hdHRyKTtcblxuICAvLyBFdmFsdWF0ZSB0aGUgcHJvdmlkZWQgUiBjb2RlXG4gIGNvbnN0IHJlc3VsdCA9IHdlYlJPanMucHJvY2Vzcyh7Y29kZTogYmxvY2suY29kZSwgb3B0aW9uc30sIHt2b2xjYW5vX3Bsb3RfZW1pdCwgYXJnc1ZvbGNhbm8sIGN1cnJlbnRfdm9sY2Fub19kYXRhfSk7XG5cbiAgLy8gRWFybHkgeWllbGQgd2hpbGUgd2Ugd2FpdCBmb3IgdGhlIGZpcnN0IGV2YWx1YXRpb24gYW5kIHJlbmRlclxuICBpZiAob3B0aW9ucy5vdXRwdXQgJiYgIShcIjhcIiBpbiB3ZWJST2pzLnJlbmRlcmVkT2pzKSkge1xuICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgY29uc3Qgc3Bpbm5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cbiAgICBpZiAob3B0aW9ucy5lY2hvKSB7XG4gICAgICAvLyBTaG93IG91dHB1dCBhcyBoaWdobGlnaHRlZCBzb3VyY2VcbiAgICAgIGNvbnN0IHByZUVsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicHJlXCIpO1xuICAgICAgY29udGFpbmVyLmNsYXNzTmFtZSA9IFwic291cmNlQ29kZVwiO1xuICAgICAgcHJlRWxlbS5jbGFzc05hbWUgPSBcInNvdXJjZUNvZGUgclwiO1xuICAgICAgcHJlRWxlbS5hcHBlbmRDaGlsZChoaWdobGlnaHRSKGJsb2NrLmNvZGUpKTtcbiAgICAgIHNwaW5uZXIuY2xhc3NOYW1lID0gXCJzcGlubmVyLWdyb3cgc3Bpbm5lci1ncm93LXNtIG0tMiBwb3NpdGlvbi1hYnNvbHV0ZSB0b3AtMCBlbmQtMFwiO1xuICAgICAgcHJlRWxlbS5hcHBlbmRDaGlsZChzcGlubmVyKTtcbiAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChwcmVFbGVtKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3Bpbm5lci5jbGFzc05hbWUgPSBcInNwaW5uZXItYm9yZGVyIHNwaW5uZXItYm9yZGVyLXNtXCI7XG4gICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoc3Bpbm5lcik7XG4gICAgfVxuXG4gICAgeWllbGQgY29udGFpbmVyO1xuICB9XG5cbiAgd2ViUk9qcy5yZW5kZXJlZE9qc1tcIjhcIl0gPSB0cnVlO1xuICB5aWVsZCBhd2FpdCByZXN1bHQ7XG59XG4ifSx7ImNlbGxOYW1lIjoid2Vici13aWRnZXQtNyIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6IntcbiAgLy8gV2FpdCBmb3Igb3V0cHV0IHRvIGJlIHdyaXR0ZW4gdG8gdGhlIERPTSwgdGhlbiB0cmlnZ2VyIHdpZGdldCByZW5kZXJpbmdcbiAgYXdhaXQgX3dlYnJfdmFsdWVfNztcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLTciLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoiX3dlYnJfdmFsdWVfNyA9IHtcbiAgY29uc3QgeyBoaWdobGlnaHRSLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici03LWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgLy8gRGVmYXVsdCBldmFsdWF0aW9uIGNvbmZpZ3VyYXRpb25cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe1xuICAgIGlkOiBcIndlYnItNy1jb250ZW50c1wiLFxuICAgIGVjaG86IHRydWUsXG4gICAgb3V0cHV0OiB0cnVlXG4gIH0sIGJsb2NrLmF0dHIpO1xuXG4gIC8vIEV2YWx1YXRlIHRoZSBwcm92aWRlZCBSIGNvZGVcbiAgY29uc3QgcmVzdWx0ID0gd2ViUk9qcy5wcm9jZXNzKHtjb2RlOiBibG9jay5jb2RlLCBvcHRpb25zfSwge3N0dWR5X2RhdGFfcGF5bG9hZCwgdm9sY2Fub19kYXRhX2pzLCBjb250cmFzdF9zZWxlY3Rpb24sIHRlcm1fc2VsZWN0aW9ufSk7XG5cbiAgLy8gRWFybHkgeWllbGQgd2hpbGUgd2Ugd2FpdCBmb3IgdGhlIGZpcnN0IGV2YWx1YXRpb24gYW5kIHJlbmRlclxuICBpZiAob3B0aW9ucy5vdXRwdXQgJiYgIShcIjdcIiBpbiB3ZWJST2pzLnJlbmRlcmVkT2pzKSkge1xuICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgY29uc3Qgc3Bpbm5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cbiAgICBpZiAob3B0aW9ucy5lY2hvKSB7XG4gICAgICAvLyBTaG93IG91dHB1dCBhcyBoaWdobGlnaHRlZCBzb3VyY2VcbiAgICAgIGNvbnN0IHByZUVsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicHJlXCIpO1xuICAgICAgY29udGFpbmVyLmNsYXNzTmFtZSA9IFwic291cmNlQ29kZVwiO1xuICAgICAgcHJlRWxlbS5jbGFzc05hbWUgPSBcInNvdXJjZUNvZGUgclwiO1xuICAgICAgcHJlRWxlbS5hcHBlbmRDaGlsZChoaWdobGlnaHRSKGJsb2NrLmNvZGUpKTtcbiAgICAgIHNwaW5uZXIuY2xhc3NOYW1lID0gXCJzcGlubmVyLWdyb3cgc3Bpbm5lci1ncm93LXNtIG0tMiBwb3NpdGlvbi1hYnNvbHV0ZSB0b3AtMCBlbmQtMFwiO1xuICAgICAgcHJlRWxlbS5hcHBlbmRDaGlsZChzcGlubmVyKTtcbiAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChwcmVFbGVtKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3Bpbm5lci5jbGFzc05hbWUgPSBcInNwaW5uZXItYm9yZGVyIHNwaW5uZXItYm9yZGVyLXNtXCI7XG4gICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoc3Bpbm5lcik7XG4gICAgfVxuXG4gICAgeWllbGQgY29udGFpbmVyO1xuICB9XG5cbiAgd2ViUk9qcy5yZW5kZXJlZE9qc1tcIjdcIl0gPSB0cnVlO1xuICB5aWVsZCBhd2FpdCByZXN1bHQ7XG59XG4ifSx7ImNlbGxOYW1lIjoid2Vici13aWRnZXQtNiIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6IntcbiAgLy8gV2FpdCBmb3Igb3V0cHV0IHRvIGJlIHdyaXR0ZW4gdG8gdGhlIERPTSwgdGhlbiB0cmlnZ2VyIHdpZGdldCByZW5kZXJpbmdcbiAgYXdhaXQgX3dlYnJfdmFsdWVfNjtcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLTYiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoiX3dlYnJfdmFsdWVfNiA9IHtcbiAgY29uc3QgeyBoaWdobGlnaHRSLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici02LWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgLy8gRGVmYXVsdCBldmFsdWF0aW9uIGNvbmZpZ3VyYXRpb25cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe1xuICAgIGlkOiBcIndlYnItNi1jb250ZW50c1wiLFxuICAgIGVjaG86IHRydWUsXG4gICAgb3V0cHV0OiB0cnVlXG4gIH0sIGJsb2NrLmF0dHIpO1xuXG4gIC8vIEV2YWx1YXRlIHRoZSBwcm92aWRlZCBSIGNvZGVcbiAgY29uc3QgcmVzdWx0ID0gd2ViUk9qcy5wcm9jZXNzKHtjb2RlOiBibG9jay5jb2RlLCBvcHRpb25zfSwge3ZwbG90X3N0YXRzfSk7XG5cbiAgLy8gRWFybHkgeWllbGQgd2hpbGUgd2Ugd2FpdCBmb3IgdGhlIGZpcnN0IGV2YWx1YXRpb24gYW5kIHJlbmRlclxuICBpZiAob3B0aW9ucy5vdXRwdXQgJiYgIShcIjZcIiBpbiB3ZWJST2pzLnJlbmRlcmVkT2pzKSkge1xuICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgY29uc3Qgc3Bpbm5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cbiAgICBpZiAob3B0aW9ucy5lY2hvKSB7XG4gICAgICAvLyBTaG93IG91dHB1dCBhcyBoaWdobGlnaHRlZCBzb3VyY2VcbiAgICAgIGNvbnN0IHByZUVsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicHJlXCIpO1xuICAgICAgY29udGFpbmVyLmNsYXNzTmFtZSA9IFwic291cmNlQ29kZVwiO1xuICAgICAgcHJlRWxlbS5jbGFzc05hbWUgPSBcInNvdXJjZUNvZGUgclwiO1xuICAgICAgcHJlRWxlbS5hcHBlbmRDaGlsZChoaWdobGlnaHRSKGJsb2NrLmNvZGUpKTtcbiAgICAgIHNwaW5uZXIuY2xhc3NOYW1lID0gXCJzcGlubmVyLWdyb3cgc3Bpbm5lci1ncm93LXNtIG0tMiBwb3NpdGlvbi1hYnNvbHV0ZSB0b3AtMCBlbmQtMFwiO1xuICAgICAgcHJlRWxlbS5hcHBlbmRDaGlsZChzcGlubmVyKTtcbiAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChwcmVFbGVtKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3Bpbm5lci5jbGFzc05hbWUgPSBcInNwaW5uZXItYm9yZGVyIHNwaW5uZXItYm9yZGVyLXNtXCI7XG4gICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoc3Bpbm5lcik7XG4gICAgfVxuXG4gICAgeWllbGQgY29udGFpbmVyO1xuICB9XG5cbiAgd2ViUk9qcy5yZW5kZXJlZE9qc1tcIjZcIl0gPSB0cnVlO1xuICB5aWVsZCBhd2FpdCByZXN1bHQ7XG59XG4ifSx7ImNlbGxOYW1lIjoid2Vici13aWRnZXQtNSIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6IntcbiAgLy8gV2FpdCBmb3Igb3V0cHV0IHRvIGJlIHdyaXR0ZW4gdG8gdGhlIERPTSwgdGhlbiB0cmlnZ2VyIHdpZGdldCByZW5kZXJpbmdcbiAgYXdhaXQgX3dlYnJfdmFsdWVfNTtcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLTUiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoiX3dlYnJfdmFsdWVfNSA9IHtcbiAgY29uc3QgeyBoaWdobGlnaHRSLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici01LWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgLy8gRGVmYXVsdCBldmFsdWF0aW9uIGNvbmZpZ3VyYXRpb25cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe1xuICAgIGlkOiBcIndlYnItNS1jb250ZW50c1wiLFxuICAgIGVjaG86IHRydWUsXG4gICAgb3V0cHV0OiB0cnVlXG4gIH0sIGJsb2NrLmF0dHIpO1xuXG4gIC8vIEV2YWx1YXRlIHRoZSBwcm92aWRlZCBSIGNvZGVcbiAgY29uc3QgcmVzdWx0ID0gd2ViUk9qcy5wcm9jZXNzKHtjb2RlOiBibG9jay5jb2RlLCBvcHRpb25zfSwge3N0dWR5X2RhdGFfcGF5bG9hZCwgY29udHJhc3RzX2Zyb21fanMsIHRlcm1zX2Zyb21fanMsIHNsaWRlc19mcm9tX2pzfSk7XG5cbiAgLy8gRWFybHkgeWllbGQgd2hpbGUgd2Ugd2FpdCBmb3IgdGhlIGZpcnN0IGV2YWx1YXRpb24gYW5kIHJlbmRlclxuICBpZiAob3B0aW9ucy5vdXRwdXQgJiYgIShcIjVcIiBpbiB3ZWJST2pzLnJlbmRlcmVkT2pzKSkge1xuICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgY29uc3Qgc3Bpbm5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cbiAgICBpZiAob3B0aW9ucy5lY2hvKSB7XG4gICAgICAvLyBTaG93IG91dHB1dCBhcyBoaWdobGlnaHRlZCBzb3VyY2VcbiAgICAgIGNvbnN0IHByZUVsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicHJlXCIpO1xuICAgICAgY29udGFpbmVyLmNsYXNzTmFtZSA9IFwic291cmNlQ29kZVwiO1xuICAgICAgcHJlRWxlbS5jbGFzc05hbWUgPSBcInNvdXJjZUNvZGUgclwiO1xuICAgICAgcHJlRWxlbS5hcHBlbmRDaGlsZChoaWdobGlnaHRSKGJsb2NrLmNvZGUpKTtcbiAgICAgIHNwaW5uZXIuY2xhc3NOYW1lID0gXCJzcGlubmVyLWdyb3cgc3Bpbm5lci1ncm93LXNtIG0tMiBwb3NpdGlvbi1hYnNvbHV0ZSB0b3AtMCBlbmQtMFwiO1xuICAgICAgcHJlRWxlbS5hcHBlbmRDaGlsZChzcGlubmVyKTtcbiAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChwcmVFbGVtKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3Bpbm5lci5jbGFzc05hbWUgPSBcInNwaW5uZXItYm9yZGVyIHNwaW5uZXItYm9yZGVyLXNtXCI7XG4gICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoc3Bpbm5lcik7XG4gICAgfVxuXG4gICAgeWllbGQgY29udGFpbmVyO1xuICB9XG5cbiAgd2ViUk9qcy5yZW5kZXJlZE9qc1tcIjVcIl0gPSB0cnVlO1xuICB5aWVsZCBhd2FpdCByZXN1bHQ7XG59XG4ifSx7ImNlbGxOYW1lIjoid2Vici13aWRnZXQtNCIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6IntcbiAgLy8gV2FpdCBmb3Igb3V0cHV0IHRvIGJlIHdyaXR0ZW4gdG8gdGhlIERPTSwgdGhlbiB0cmlnZ2VyIHdpZGdldCByZW5kZXJpbmdcbiAgYXdhaXQgX3dlYnJfdmFsdWVfNDtcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLTQiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoiX3dlYnJfdmFsdWVfNCA9IHtcbiAgY29uc3QgeyBoaWdobGlnaHRSLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici00LWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgLy8gRGVmYXVsdCBldmFsdWF0aW9uIGNvbmZpZ3VyYXRpb25cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe1xuICAgIGlkOiBcIndlYnItNC1jb250ZW50c1wiLFxuICAgIGVjaG86IHRydWUsXG4gICAgb3V0cHV0OiB0cnVlXG4gIH0sIGJsb2NrLmF0dHIpO1xuXG4gIC8vIEV2YWx1YXRlIHRoZSBwcm92aWRlZCBSIGNvZGVcbiAgY29uc3QgcmVzdWx0ID0gd2ViUk9qcy5wcm9jZXNzKHtjb2RlOiBibG9jay5jb2RlLCBvcHRpb25zfSwge3N0dWR5X2RhdGFfcGF5bG9hZH0pO1xuXG4gIC8vIEVhcmx5IHlpZWxkIHdoaWxlIHdlIHdhaXQgZm9yIHRoZSBmaXJzdCBldmFsdWF0aW9uIGFuZCByZW5kZXJcbiAgaWYgKG9wdGlvbnMub3V0cHV0ICYmICEoXCI0XCIgaW4gd2ViUk9qcy5yZW5kZXJlZE9qcykpIHtcbiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIGNvbnN0IHNwaW5uZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXG4gICAgaWYgKG9wdGlvbnMuZWNobykge1xuICAgICAgLy8gU2hvdyBvdXRwdXQgYXMgaGlnaGxpZ2h0ZWQgc291cmNlXG4gICAgICBjb25zdCBwcmVFbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInByZVwiKTtcbiAgICAgIGNvbnRhaW5lci5jbGFzc05hbWUgPSBcInNvdXJjZUNvZGVcIjtcbiAgICAgIHByZUVsZW0uY2xhc3NOYW1lID0gXCJzb3VyY2VDb2RlIHJcIjtcbiAgICAgIHByZUVsZW0uYXBwZW5kQ2hpbGQoaGlnaGxpZ2h0UihibG9jay5jb2RlKSk7XG4gICAgICBzcGlubmVyLmNsYXNzTmFtZSA9IFwic3Bpbm5lci1ncm93IHNwaW5uZXItZ3Jvdy1zbSBtLTIgcG9zaXRpb24tYWJzb2x1dGUgdG9wLTAgZW5kLTBcIjtcbiAgICAgIHByZUVsZW0uYXBwZW5kQ2hpbGQoc3Bpbm5lcik7XG4gICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQocHJlRWxlbSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNwaW5uZXIuY2xhc3NOYW1lID0gXCJzcGlubmVyLWJvcmRlciBzcGlubmVyLWJvcmRlci1zbVwiO1xuICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHNwaW5uZXIpO1xuICAgIH1cblxuICAgIHlpZWxkIGNvbnRhaW5lcjtcbiAgfVxuXG4gIHdlYlJPanMucmVuZGVyZWRPanNbXCI0XCJdID0gdHJ1ZTtcbiAgeWllbGQgYXdhaXQgcmVzdWx0O1xufVxuIn0seyJjZWxsTmFtZSI6IndlYnItd2lkZ2V0LTMiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJ7XG4gIC8vIFdhaXQgZm9yIG91dHB1dCB0byBiZSB3cml0dGVuIHRvIHRoZSBET00sIHRoZW4gdHJpZ2dlciB3aWRnZXQgcmVuZGVyaW5nXG4gIGF3YWl0IF93ZWJyX3ZhbHVlXzM7XG4gIGlmICh3aW5kb3cuSFRNTFdpZGdldHMpIHtcbiAgICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKCk7XG4gIH1cbiAgaWYgKHdpbmRvdy5QYWdlZFRhYmxlRG9jKSB7XG4gICAgd2luZG93LlBhZ2VkVGFibGVEb2MuaW5pdEFsbCgpO1xuICB9XG59XG4ifSx7ImNlbGxOYW1lIjoid2Vici0zIiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCIsInNvdXJjZSI6Il93ZWJyX3ZhbHVlXzMgPSB7XG4gIGNvbnN0IHsgaGlnaGxpZ2h0UiwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuICBjb25zdCBzY3JpcHRDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihgc2NyaXB0W3R5cGU9XFxcIndlYnItMy1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIC8vIERlZmF1bHQgZXZhbHVhdGlvbiBjb25maWd1cmF0aW9uXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHtcbiAgICBpZDogXCJ3ZWJyLTMtY29udGVudHNcIixcbiAgICBlY2hvOiB0cnVlLFxuICAgIG91dHB1dDogdHJ1ZVxuICB9LCBibG9jay5hdHRyKTtcblxuICAvLyBFdmFsdWF0ZSB0aGUgcHJvdmlkZWQgUiBjb2RlXG4gIGNvbnN0IHJlc3VsdCA9IHdlYlJPanMucHJvY2Vzcyh7Y29kZTogYmxvY2suY29kZSwgb3B0aW9uc30sIHtuZXdfemlwX2RhdGF9KTtcblxuICAvLyBFYXJseSB5aWVsZCB3aGlsZSB3ZSB3YWl0IGZvciB0aGUgZmlyc3QgZXZhbHVhdGlvbiBhbmQgcmVuZGVyXG4gIGlmIChvcHRpb25zLm91dHB1dCAmJiAhKFwiM1wiIGluIHdlYlJPanMucmVuZGVyZWRPanMpKSB7XG4gICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBjb25zdCBzcGlubmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblxuICAgIGlmIChvcHRpb25zLmVjaG8pIHtcbiAgICAgIC8vIFNob3cgb3V0cHV0IGFzIGhpZ2hsaWdodGVkIHNvdXJjZVxuICAgICAgY29uc3QgcHJlRWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJwcmVcIik7XG4gICAgICBjb250YWluZXIuY2xhc3NOYW1lID0gXCJzb3VyY2VDb2RlXCI7XG4gICAgICBwcmVFbGVtLmNsYXNzTmFtZSA9IFwic291cmNlQ29kZSByXCI7XG4gICAgICBwcmVFbGVtLmFwcGVuZENoaWxkKGhpZ2hsaWdodFIoYmxvY2suY29kZSkpO1xuICAgICAgc3Bpbm5lci5jbGFzc05hbWUgPSBcInNwaW5uZXItZ3JvdyBzcGlubmVyLWdyb3ctc20gbS0yIHBvc2l0aW9uLWFic29sdXRlIHRvcC0wIGVuZC0wXCI7XG4gICAgICBwcmVFbGVtLmFwcGVuZENoaWxkKHNwaW5uZXIpO1xuICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHByZUVsZW0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBzcGlubmVyLmNsYXNzTmFtZSA9IFwic3Bpbm5lci1ib3JkZXIgc3Bpbm5lci1ib3JkZXItc21cIjtcbiAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChzcGlubmVyKTtcbiAgICB9XG5cbiAgICB5aWVsZCBjb250YWluZXI7XG4gIH1cblxuICB3ZWJST2pzLnJlbmRlcmVkT2pzW1wiM1wiXSA9IHRydWU7XG4gIHlpZWxkIGF3YWl0IHJlc3VsdDtcbn1cbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLXdpZGdldC0yIiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV8yO1xuICBpZiAod2luZG93LkhUTUxXaWRnZXRzKSB7XG4gICAgd2luZG93LkhUTUxXaWRnZXRzLnN0YXRpY1JlbmRlcigpO1xuICB9XG4gIGlmICh3aW5kb3cuUGFnZWRUYWJsZURvYykge1xuICAgIHdpbmRvdy5QYWdlZFRhYmxlRG9jLmluaXRBbGwoKTtcbiAgfVxufVxuIn0seyJjZWxsTmFtZSI6IndlYnItMiIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJzb3VyY2UiOiJfd2Vicl92YWx1ZV8yID0ge1xuICBjb25zdCB7IGhpZ2hsaWdodFIsIGI2NERlY29kZSB9ID0gd2luZG93Ll9leGVyY2lzZV9vanNfcnVudGltZTtcbiAgY29uc3Qgc2NyaXB0Q29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYHNjcmlwdFt0eXBlPVxcXCJ3ZWJyLTItY29udGVudHNcXFwiXWApLnRleHRDb250ZW50O1xuICBjb25zdCBibG9jayA9IEpTT04ucGFyc2UoYjY0RGVjb2RlKHNjcmlwdENvbnRlbnQpKTtcblxuICAvLyBEZWZhdWx0IGV2YWx1YXRpb24gY29uZmlndXJhdGlvblxuICBjb25zdCBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7XG4gICAgaWQ6IFwid2Vici0yLWNvbnRlbnRzXCIsXG4gICAgZWNobzogdHJ1ZSxcbiAgICBvdXRwdXQ6IHRydWVcbiAgfSwgYmxvY2suYXR0cik7XG5cbiAgLy8gRXZhbHVhdGUgdGhlIHByb3ZpZGVkIFIgY29kZVxuICBjb25zdCByZXN1bHQgPSB3ZWJST2pzLnByb2Nlc3Moe2NvZGU6IGJsb2NrLmNvZGUsIG9wdGlvbnN9LCB7fSk7XG5cbiAgLy8gRWFybHkgeWllbGQgd2hpbGUgd2Ugd2FpdCBmb3IgdGhlIGZpcnN0IGV2YWx1YXRpb24gYW5kIHJlbmRlclxuICBpZiAob3B0aW9ucy5vdXRwdXQgJiYgIShcIjJcIiBpbiB3ZWJST2pzLnJlbmRlcmVkT2pzKSkge1xuICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgY29uc3Qgc3Bpbm5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cbiAgICBpZiAob3B0aW9ucy5lY2hvKSB7XG4gICAgICAvLyBTaG93IG91dHB1dCBhcyBoaWdobGlnaHRlZCBzb3VyY2VcbiAgICAgIGNvbnN0IHByZUVsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicHJlXCIpO1xuICAgICAgY29udGFpbmVyLmNsYXNzTmFtZSA9IFwic291cmNlQ29kZVwiO1xuICAgICAgcHJlRWxlbS5jbGFzc05hbWUgPSBcInNvdXJjZUNvZGUgclwiO1xuICAgICAgcHJlRWxlbS5hcHBlbmRDaGlsZChoaWdobGlnaHRSKGJsb2NrLmNvZGUpKTtcbiAgICAgIHNwaW5uZXIuY2xhc3NOYW1lID0gXCJzcGlubmVyLWdyb3cgc3Bpbm5lci1ncm93LXNtIG0tMiBwb3NpdGlvbi1hYnNvbHV0ZSB0b3AtMCBlbmQtMFwiO1xuICAgICAgcHJlRWxlbS5hcHBlbmRDaGlsZChzcGlubmVyKTtcbiAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChwcmVFbGVtKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3Bpbm5lci5jbGFzc05hbWUgPSBcInNwaW5uZXItYm9yZGVyIHNwaW5uZXItYm9yZGVyLXNtXCI7XG4gICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoc3Bpbm5lcik7XG4gICAgfVxuXG4gICAgeWllbGQgY29udGFpbmVyO1xuICB9XG5cbiAgd2ViUk9qcy5yZW5kZXJlZE9qc1tcIjJcIl0gPSB0cnVlO1xuICB5aWVsZCBhd2FpdCByZXN1bHQ7XG59XG4ifSx7ImNlbGxOYW1lIjoid2Vici13aWRnZXQtMSIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6IntcbiAgLy8gV2FpdCBmb3Igb3V0cHV0IHRvIGJlIHdyaXR0ZW4gdG8gdGhlIERPTSwgdGhlbiB0cmlnZ2VyIHdpZGdldCByZW5kZXJpbmdcbiAgYXdhaXQgX3dlYnJfdmFsdWVfMTtcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLTEiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoiX3dlYnJfdmFsdWVfMSA9IHtcbiAgY29uc3QgeyBoaWdobGlnaHRSLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici0xLWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgLy8gRGVmYXVsdCBldmFsdWF0aW9uIGNvbmZpZ3VyYXRpb25cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe1xuICAgIGlkOiBcIndlYnItMS1jb250ZW50c1wiLFxuICAgIGVjaG86IHRydWUsXG4gICAgb3V0cHV0OiB0cnVlXG4gIH0sIGJsb2NrLmF0dHIpO1xuXG4gIC8vIEV2YWx1YXRlIHRoZSBwcm92aWRlZCBSIGNvZGVcbiAgY29uc3QgcmVzdWx0ID0gd2ViUk9qcy5wcm9jZXNzKHtjb2RlOiBibG9jay5jb2RlLCBvcHRpb25zfSwge3NlbGVjdGVkX3N0dWR5fSk7XG5cbiAgLy8gRWFybHkgeWllbGQgd2hpbGUgd2Ugd2FpdCBmb3IgdGhlIGZpcnN0IGV2YWx1YXRpb24gYW5kIHJlbmRlclxuICBpZiAob3B0aW9ucy5vdXRwdXQgJiYgIShcIjFcIiBpbiB3ZWJST2pzLnJlbmRlcmVkT2pzKSkge1xuICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgY29uc3Qgc3Bpbm5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cbiAgICBpZiAob3B0aW9ucy5lY2hvKSB7XG4gICAgICAvLyBTaG93IG91dHB1dCBhcyBoaWdobGlnaHRlZCBzb3VyY2VcbiAgICAgIGNvbnN0IHByZUVsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicHJlXCIpO1xuICAgICAgY29udGFpbmVyLmNsYXNzTmFtZSA9IFwic291cmNlQ29kZVwiO1xuICAgICAgcHJlRWxlbS5jbGFzc05hbWUgPSBcInNvdXJjZUNvZGUgclwiO1xuICAgICAgcHJlRWxlbS5hcHBlbmRDaGlsZChoaWdobGlnaHRSKGJsb2NrLmNvZGUpKTtcbiAgICAgIHNwaW5uZXIuY2xhc3NOYW1lID0gXCJzcGlubmVyLWdyb3cgc3Bpbm5lci1ncm93LXNtIG0tMiBwb3NpdGlvbi1hYnNvbHV0ZSB0b3AtMCBlbmQtMFwiO1xuICAgICAgcHJlRWxlbS5hcHBlbmRDaGlsZChzcGlubmVyKTtcbiAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChwcmVFbGVtKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3Bpbm5lci5jbGFzc05hbWUgPSBcInNwaW5uZXItYm9yZGVyIHNwaW5uZXItYm9yZGVyLXNtXCI7XG4gICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoc3Bpbm5lcik7XG4gICAgfVxuXG4gICAgeWllbGQgY29udGFpbmVyO1xuICB9XG5cbiAgd2ViUk9qcy5yZW5kZXJlZE9qc1tcIjFcIl0gPSB0cnVlO1xuICB5aWVsZCBhd2FpdCByZXN1bHQ7XG59XG4ifSx7ImNlbGxOYW1lIjoid2Vici1wcmVsdWRlIiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoid2ViUk9qcyA9IHtcbiAgY29uc3QgeyBXZWJSLCBDaGFubmVsVHlwZSB9ID0gd2luZG93Ll9leGVyY2lzZV9vanNfcnVudGltZS5XZWJSO1xuICBjb25zdCB7XG4gICAgV2ViUkV2YWx1YXRvcixcbiAgICBXZWJSRW52aXJvbm1lbnRNYW5hZ2VyLFxuICAgIHNldHVwUixcbiAgICBiNjREZWNvZGUsXG4gICAgY29sbGFwc2VQYXRoXG4gIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuXG4gIGNvbnN0IHN0YXR1c0NvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZXhlcmNpc2UtbG9hZGluZy1zdGF0dXNcIik7XG4gIGNvbnN0IGluZGljYXRvckNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZXhlcmNpc2UtbG9hZGluZy1pbmRpY2F0b3JcIik7XG4gIGluZGljYXRvckNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKFwiZC1ub25lXCIpO1xuXG4gIGxldCBzdGF0dXNUZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKVxuICBzdGF0dXNUZXh0LmNsYXNzTGlzdCA9IFwiZXhlcmNpc2UtbG9hZGluZy1kZXRhaWxzXCI7XG4gIHN0YXR1c1RleHQgPSBzdGF0dXNDb250YWluZXIuYXBwZW5kQ2hpbGQoc3RhdHVzVGV4dCk7XG4gIHN0YXR1c1RleHQudGV4dENvbnRlbnQgPSBgSW5pdGlhbGlzZWA7XG5cbiAgLy8gSG9pc3QgaW5kaWNhdG9yIG91dCBmcm9tIGZpbmFsIHNsaWRlIHdoZW4gcnVubmluZyB1bmRlciByZXZlYWxcbiAgY29uc3QgcmV2ZWFsU3RhdHVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5yZXZlYWwgLmV4ZXJjaXNlLWxvYWRpbmctaW5kaWNhdG9yXCIpO1xuICBpZiAocmV2ZWFsU3RhdHVzKSB7XG4gICAgcmV2ZWFsU3RhdHVzLnJlbW92ZSgpO1xuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucmV2ZWFsID4gLnNsaWRlc1wiKS5hcHBlbmRDaGlsZChyZXZlYWxTdGF0dXMpO1xuICB9XG5cbiAgLy8gTWFrZSBhbnkgcmV2ZWFsIHNsaWRlcyB3aXRoIGxpdmUgY2VsbHMgc2Nyb2xsYWJsZVxuICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnJldmVhbCAuZXhlcmNpc2UtY2VsbFwiKS5mb3JFYWNoKChlbCkgPT4ge1xuICAgIGVsLmNsb3Nlc3QoJ3NlY3Rpb24uc2xpZGUnKS5jbGFzc0xpc3QuYWRkKFwic2Nyb2xsYWJsZVwiKTtcbiAgfSlcblxuICAvLyB3ZWJSIHN1cHBsZW1lbnRhbCBkYXRhIGFuZCBvcHRpb25zXG4gIGNvbnN0IGRhdGFDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihgc2NyaXB0W3R5cGU9XFxcIndlYnItZGF0YVxcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGRhdGEgPSBKU09OLnBhcnNlKGI2NERlY29kZShkYXRhQ29udGVudCkpO1xuXG4gIC8vIEdyYWIgbGlzdCBvZiByZXNvdXJjZXMgdG8gYmUgZG93bmxvYWRlZFxuICBjb25zdCBmaWxlc0NvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwidmZzLWZpbGVcXFwiXWApLnRleHRDb250ZW50O1xuICBjb25zdCBmaWxlcyA9IEpTT04ucGFyc2UoYjY0RGVjb2RlKGZpbGVzQ29udGVudCkpO1xuXG4gIC8vIEluaXRpYWxpc2Ugd2ViUiBhbmQgc2V0dXAgZm9yIFIgY29kZSBldmFsdWF0aW9uXG4gIGxldCB3ZWJSUHJvbWlzZSA9IChhc3luYyAod2ViUikgPT4ge1xuICAgIHN0YXR1c1RleHQudGV4dENvbnRlbnQgPSBgRG93bmxvYWRpbmcgd2ViUmA7XG4gICAgYXdhaXQgd2ViUi5pbml0KCk7XG5cbiAgICAvLyBJbnN0YWxsIHByb3ZpZGVkIGxpc3Qgb2YgcGFja2FnZXNcbiAgICAvLyBFbnN1cmUgd2ViUiBkZWZhdWx0IHJlcG8gaXMgaW5jbHVkZWRcbiAgICBkYXRhLnBhY2thZ2VzLnJlcG9zLnB1c2goXCJodHRwczovL3JlcG8uci13YXNtLm9yZ1wiKVxuICAgIGF3YWl0IGRhdGEucGFja2FnZXMucGtncy5tYXAoKHBrZykgPT4gKCkgPT4ge1xuICAgICAgc3RhdHVzVGV4dC50ZXh0Q29udGVudCA9IGBEb3dubG9hZGluZyBwYWNrYWdlOiAke3BrZ31gO1xuICAgICAgcmV0dXJuIHdlYlIuZXZhbFJWb2lkKGBcbiAgICAgICAgd2Vicjo6aW5zdGFsbChwa2csIHJlcG9zID0gcmVwb3MpXG4gICAgICAgIGxpYnJhcnkocGtnLCBjaGFyYWN0ZXIub25seSA9IFRSVUUpXG4gICAgICBgLCB7IGVudjoge1xuICAgICAgICBwa2c6IHBrZyxcbiAgICAgICAgcmVwb3M6IGRhdGEucGFja2FnZXMucmVwb3MsXG4gICAgICB9fSk7XG4gICAgfSkucmVkdWNlKChjdXIsIG5leHQpID0+IGN1ci50aGVuKG5leHQpLCBQcm9taXNlLnJlc29sdmUoKSk7XG5cbiAgICAvLyBEb3dubG9hZCBhbmQgaW5zdGFsbCByZXNvdXJjZXNcbiAgICBhd2FpdCBmaWxlcy5tYXAoKGZpbGUpID0+IGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG5hbWUgPSBmaWxlLnN1YnN0cmluZyhmaWxlLmxhc3RJbmRleE9mKCcvJykgKyAxKTtcbiAgICAgIHN0YXR1c1RleHQudGV4dENvbnRlbnQgPSBgRG93bmxvYWRpbmcgcmVzb3VyY2U6ICR7bmFtZX1gO1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChmaWxlKTtcbiAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW4ndCBkb3dubG9hZCBcXGAke2ZpbGV9XFxgLiBFcnJvciAke3Jlc3BvbnNlLnN0YXR1c306IFwiJHtyZXNwb25zZS5zdGF0dXNUZXh0fVwiLmApO1xuICAgICAgfVxuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmFycmF5QnVmZmVyKCk7XG5cbiAgICAgIC8vIFN0b3JlIFVSTHMgaW4gdGhlIGN3ZCB3aXRob3V0IGFueSBzdWJkaXJlY3Rvcnkgc3RydWN0dXJlXG4gICAgICBpZiAoZmlsZS5pbmNsdWRlcyhcIjovL1wiKSkge1xuICAgICAgICBmaWxlID0gbmFtZTtcbiAgICAgIH1cblxuICAgICAgLy8gQ29sbGFwc2UgaGlnaGVyIGRpcmVjdG9yeSBzdHJ1Y3R1cmVcbiAgICAgIGZpbGUgPSBjb2xsYXBzZVBhdGgoZmlsZSk7XG5cbiAgICAgIC8vIENyZWF0ZSBkaXJlY3RvcnkgdHJlZSwgaWdub3JpbmcgXCJkaXJlY3RvcnkgZXhpc3RzXCIgVkZTIGVycm9yc1xuICAgICAgY29uc3QgcGFydHMgPSBmaWxlLnNwbGl0KCcvJykuc2xpY2UoMCwgLTEpO1xuICAgICAgbGV0IHBhdGggPSAnJztcbiAgICAgIHdoaWxlIChwYXJ0cy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHBhdGggKz0gcGFydHMuc2hpZnQoKSArICcvJztcbiAgICAgICAgY29uc3QgYW5hbHlzaXMgPSBhd2FpdCB3ZWJSLkZTLmFuYWx5emVQYXRoKHBhdGgpO1xuICAgICAgICBpZiAoIWFuYWx5c2lzLmV4aXN0cykge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCB3ZWJSLkZTLm1rZGlyKHBhdGgpO1xuICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRmlsZXN5c3RlbSBFcnJvcjogXCIke2UubWVzc2FnZX1cIi5gKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gV3JpdGUgdGhpcyBmaWxlIHRvIHRoZSBWRlNcbiAgICAgIHJldHVybiBhd2FpdCB3ZWJSLkZTLndyaXRlRmlsZShmaWxlLCBuZXcgVWludDhBcnJheShkYXRhKSk7XG4gICAgfSkucmVkdWNlKChjdXIsIG5leHQpID0+IGN1ci50aGVuKG5leHQpLCBQcm9taXNlLnJlc29sdmUoKSk7XG5cbiAgICBzdGF0dXNUZXh0LnRleHRDb250ZW50ID0gYEluc3RhbGxpbmcgd2ViUiBzaGltc2A7XG4gICAgYXdhaXQgd2ViUi5ldmFsUlZvaWQoYHdlYnI6OnNoaW1faW5zdGFsbCgpYCk7XG5cbiAgICBzdGF0dXNUZXh0LnRleHRDb250ZW50ID0gYFdlYlIgZW52aXJvbm1lbnQgc2V0dXBgO1xuICAgIGF3YWl0IHNldHVwUih3ZWJSLCBkYXRhKTtcblxuICAgIHN0YXR1c1RleHQucmVtb3ZlKCk7XG4gICAgaWYgKHN0YXR1c0NvbnRhaW5lci5jaGlsZHJlbi5sZW5ndGggPT0gMCkge1xuICAgICAgc3RhdHVzQ29udGFpbmVyLnBhcmVudE5vZGUucmVtb3ZlKCk7XG4gICAgfVxuICAgIHJldHVybiB3ZWJSO1xuICB9KShuZXcgV2ViUihkYXRhLm9wdGlvbnMpKTtcblxuICAvLyBLZWVwIHRyYWNrIG9mIGluaXRpYWwgT0pTIGJsb2NrIHJlbmRlclxuICBjb25zdCByZW5kZXJlZE9qcyA9IHt9O1xuXG4gIGNvbnN0IHByb2Nlc3MgPSBhc3luYyAoY29udGV4dCwgaW5wdXRzKSA9PiB7XG4gICAgY29uc3Qgd2ViUiA9IGF3YWl0IHdlYlJQcm9taXNlO1xuICAgIGNvbnN0IGV2YWx1YXRvciA9IG5ldyBXZWJSRXZhbHVhdG9yKHdlYlIsIGNvbnRleHQpXG4gICAgYXdhaXQgZXZhbHVhdG9yLnByb2Nlc3MoaW5wdXRzKTtcbiAgICByZXR1cm4gZXZhbHVhdG9yLmNvbnRhaW5lcjtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgcHJvY2VzcyxcbiAgICB3ZWJSUHJvbWlzZSxcbiAgICByZW5kZXJlZE9qcyxcbiAgfTtcbn1cbiJ9XX0=
</script>
<div id="exercise-loading-indicator" class="exercise-loading-indicator d-none d-flex align-items-center gap-2 html-fill-item html-fill-container">
<div id="exercise-loading-status" class="d-flex gap-2 html-fill-item html-fill-container">

</div>
<div class="spinner-grow spinner-grow-sm html-fill-item html-fill-container">

</div>
</div>
<script type="vfs-file">
W10=
</script>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div>
</div>
</div>
</div></div><aside id="bslib-sidebar-1" class="sidebar html-fill-container html-fill-item"><div class="html-fill-container html-fill-item">
<div class="sourceCode cell-code hidden" id="cb1" data-startfrom="44" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 43;"><span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>duck_db_client <span class="op">=</span> {</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> duckdb <span class="op">=</span> <span class="cf">await</span> <span class="im">import</span>(<span class="st">"https://cdn.jsdelivr.net/npm/@duckdb/duckdb-wasm@1.28.0/+esm"</span>)<span class="op">;</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"🔧 Initializing DuckDB-Wasm Client..."</span>)<span class="op">;</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> JSDELIVR_BUNDLES <span class="op">=</span> duckdb<span class="op">.</span><span class="fu">getJsDelivrBundles</span>()<span class="op">;</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> bundle <span class="op">=</span> <span class="cf">await</span> duckdb<span class="op">.</span><span class="fu">selectBundle</span>(JSDELIVR_BUNDLES)<span class="op">;</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> worker_url <span class="op">=</span> URL<span class="op">.</span><span class="fu">createObjectURL</span>(</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="bu">Blob</span>([<span class="vs">`importScripts("</span><span class="sc">${</span>bundle<span class="op">.</span><span class="at">mainWorker</span><span class="sc">}</span><span class="vs">");`</span>]<span class="op">,</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"text/javascript"</span> })</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> worker <span class="op">=</span> <span class="kw">new</span> <span class="bu">Worker</span>(worker_url)<span class="op">;</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> logger <span class="op">=</span> <span class="kw">new</span> duckdb<span class="op">.</span><span class="fu">ConsoleLogger</span>()<span class="op">;</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> db <span class="op">=</span> <span class="kw">new</span> duckdb<span class="op">.</span><span class="fu">AsyncDuckDB</span>(logger<span class="op">,</span> worker)<span class="op">;</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>  <span class="cf">await</span> db<span class="op">.</span><span class="fu">instantiate</span>(bundle<span class="op">.</span><span class="at">mainModule</span><span class="op">,</span> bundle<span class="op">.</span><span class="at">pthreadWorker</span>)<span class="op">;</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> conn <span class="op">=</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">connect</span>()<span class="op">;</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"✅ DuckDB-Wasm Ready!"</span>)<span class="op">;</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> conn<span class="op">;</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-1" data-nodetype="declaration">

</div>
</div>
<div>
<div id="webr-1" class="exercise-cell">

</div>
<script type="webr-1-contents">
eyJhdHRyIjp7ImF1dG9ydW4iOnRydWUsImVjaG8iOmZhbHNlLCJlZGl0IjpmYWxzZSwiZXZhbCI6dHJ1ZSwiaW5wdXQiOlsic2VsZWN0ZWRfc3R1ZHkiXSwib3V0cHV0IjpmYWxzZX0sImNvZGUiOiJcbmlmKGV4aXN0cyhcImNvblwiKSAmJiBkYklzVmFsaWQoY29uKSl7XG4gIGNhdChcIkNsb3NpbmcgcHJldmlvdXMgY29ubmVjdGlvbiFcIilcbiAgZGJEaXNjb25uZWN0KGNvbilcbn0gXG5jYXQoXCJcXG5DcmVhdGluZyBuZXcgY29ubmVjdGlvbi5cIilcbmNvbiA8LSBkYkNvbm5lY3QoZHVja2RiKCkpIn0=
</script>
</div>
<div>
<div id="webr-2" class="exercise-cell">

</div>
<script type="webr-2-contents">
eyJhdHRyIjp7ImF1dG9ydW4iOnRydWUsImVjaG8iOmZhbHNlLCJlZGl0IjpmYWxzZSwiZXZhbCI6dHJ1ZX0sImNvZGUiOiJcbiMgZnVuY3Rpb24gdG8gZG9lcyBhIHF1aWNrIHZlcmlmaWNhdGlvbiBvZiB1c2VyIGRhdGFcbnZlcmlmeSA8LSBmdW5jdGlvbih2ZnNfZGlyKXtcbiAgdmFsaWQgPC0gVFJVRVxuICBmaWxlcyA8LSBsaXN0LmZpbGVzKHZmc19kaXIpXG4gIHJlcXVpcmVkX2ZpbGVzIDwtIGMoXG4gICAgXCJjZWxsX21ldGFkYXRhLnBhcnF1ZXRcIiwgXCJlbW1lYW5zLnBhcnF1ZXRcIixcbiAgICBcInBhaXJ3aXNlLnBhcnF1ZXRcIiwgXCJzdHVkeV9oZWFkZXIucGFycXVldFwiXG4gIClcbiAgaWYoIWFsbChyZXF1aXJlZF9maWxlcyAlaW4lIGZpbGVzKSl7XG4gICAgY2F0KHBhc3RlMChcIlRoZSB6aXAgZmlsZSBtdXN0IGNvbnRhaW4gdGhlIGZvbGxvd2luZzogXCIsIHBhc3RlMChcbiAgICAgIHJlcXVpcmVkX2ZpbGVzLCBjb2xsYXBzZT1cIiwgXCIpLCBcIi5cIikpXG4gICAgdmFsaWQgPC0gRkFMU0VcbiAgfVxuICByZXR1cm4odmFsaWQpXG59In0=
</script>
</div>
<div class="sourceCode cell-code hidden" id="cb2" data-startfrom="109" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 108;"><span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a>sparkbar <span class="op">=</span> (max) <span class="kw">=&gt;</span> {</span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (x) <span class="kw">=&gt;</span> {</span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 1. Create container</span></span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> div <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"div"</span>)</span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"flex"</span>)</span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"align-items"</span><span class="op">,</span> <span class="st">"center"</span>)</span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span> <span class="st">"100%"</span>)<span class="op">;</span> <span class="co">// Let it fill the cell</span></span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> color <span class="op">=</span> x <span class="op">&gt;=</span> <span class="dv">0</span> <span class="op">?</span> <span class="st">"#E41A1C"</span> <span class="op">:</span> <span class="st">"#377EB8"</span><span class="op">;</span> </span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> widthPercent <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>((<span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(x) <span class="op">/</span> max) <span class="op">*</span> <span class="dv">100</span><span class="op">,</span> <span class="dv">100</span>)<span class="op">;</span></span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>    div<span class="op">.</span><span class="fu">append</span>(<span class="st">"span"</span>)</span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>       <span class="op">.</span><span class="fu">text</span>(x<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>))</span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a>       <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"0.85em"</span>)</span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a>       <span class="op">.</span><span class="fu">style</span>(<span class="st">"color"</span><span class="op">,</span> <span class="st">"#666"</span>)</span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>       <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span> <span class="st">"35px"</span>)         <span class="co">// Fixed width for alignment</span></span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a>       <span class="op">.</span><span class="fu">style</span>(<span class="st">"text-align"</span><span class="op">,</span> <span class="st">"right"</span>)   <span class="co">// Align numbers to the right</span></span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a>       <span class="op">.</span><span class="fu">style</span>(<span class="st">"margin-right"</span><span class="op">,</span> <span class="st">"8px"</span>)<span class="op">;</span>  <span class="co">// Space between number and bar</span></span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>    div<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>widthPercent<span class="sc">}</span><span class="vs">%`</span>)</span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"height"</span><span class="op">,</span> <span class="st">"12px"</span>)</span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"background-color"</span><span class="op">,</span> color)</span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"border-radius"</span><span class="op">,</span> <span class="st">"2px"</span>)<span class="op">;</span></span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> div<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-2" data-nodetype="declaration">

</div>
</div>
<div class="sourceCode cell-code hidden" id="cb3" data-startfrom="145" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 144;"><span id="cb3-145"><a href="#cb3-145" aria-hidden="true" tabindex="-1"></a>d3 <span class="op">=</span> <span class="pp">require</span>(<span class="st">"d3@7"</span>)</span>
<span id="cb3-146"><a href="#cb3-146" aria-hidden="true" tabindex="-1"></a>Plotly <span class="op">=</span> <span class="pp">require</span>(<span class="st">"https://cdn.plot.ly/plotly-2.24.1.min.js"</span>)</span>
<span id="cb3-147"><a href="#cb3-147" aria-hidden="true" tabindex="-1"></a>manifest_raw <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"https://raw.githubusercontent.com/Nanostring-Biostats/ScratchSpaceDatasets/refs/heads/main/browser_bytes/manifest.tsv"</span>)<span class="op">.</span><span class="fu">tsv</span>({<span class="dt">typed</span><span class="op">:</span> <span class="kw">true</span>})</span>
<span id="cb3-148"><a href="#cb3-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-149"><a href="#cb3-149" aria-hidden="true" tabindex="-1"></a>mutable available_studies <span class="op">=</span> {</span>
<span id="cb3-150"><a href="#cb3-150" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>manifest_raw) <span class="cf">return</span> []<span class="op">;</span></span>
<span id="cb3-151"><a href="#cb3-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-152"><a href="#cb3-152" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> manifest_raw<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> ({</span>
<span id="cb3-153"><a href="#cb3-153" aria-hidden="true" tabindex="-1"></a>    <span class="dt">id</span><span class="op">:</span> d<span class="op">.</span><span class="at">id</span><span class="op">,</span></span>
<span id="cb3-154"><a href="#cb3-154" aria-hidden="true" tabindex="-1"></a>    <span class="dt">name</span><span class="op">:</span> d<span class="op">.</span><span class="at">name</span><span class="op">,</span></span>
<span id="cb3-155"><a href="#cb3-155" aria-hidden="true" tabindex="-1"></a>    <span class="dt">description</span><span class="op">:</span> d<span class="op">.</span><span class="at">description</span><span class="op">,</span></span>
<span id="cb3-156"><a href="#cb3-156" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-157"><a href="#cb3-157" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Direct mapping of your TSV columns</span></span>
<span id="cb3-158"><a href="#cb3-158" aria-hidden="true" tabindex="-1"></a>    <span class="dt">url_header</span><span class="op">:</span>   d<span class="op">.</span><span class="at">url_header</span><span class="op">,</span></span>
<span id="cb3-159"><a href="#cb3-159" aria-hidden="true" tabindex="-1"></a>    <span class="dt">url_pairwise</span><span class="op">:</span> d<span class="op">.</span><span class="at">url_pairwise</span><span class="op">,</span></span>
<span id="cb3-160"><a href="#cb3-160" aria-hidden="true" tabindex="-1"></a>    <span class="dt">url_meta</span><span class="op">:</span>     d<span class="op">.</span><span class="at">url_meta</span><span class="op">,</span></span>
<span id="cb3-161"><a href="#cb3-161" aria-hidden="true" tabindex="-1"></a>    <span class="dt">url_emmeans</span><span class="op">:</span>  d<span class="op">.</span><span class="at">url_emmeans</span><span class="op">,</span></span>
<span id="cb3-162"><a href="#cb3-162" aria-hidden="true" tabindex="-1"></a>    <span class="dt">url_overlap</span><span class="op">:</span> d<span class="op">.</span><span class="at">url_overlap</span><span class="op">,</span></span>
<span id="cb3-163"><a href="#cb3-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-164"><a href="#cb3-164" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">'remote'</span><span class="op">,</span></span>
<span id="cb3-165"><a href="#cb3-165" aria-hidden="true" tabindex="-1"></a>    <span class="dt">valid</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb3-166"><a href="#cb3-166" aria-hidden="true" tabindex="-1"></a>  }))<span class="op">;</span></span>
<span id="cb3-167"><a href="#cb3-167" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="sourceCode cell-code hidden" id="cb4" data-startfrom="174" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 173;"><span id="cb4-174"><a href="#cb4-174" aria-hidden="true" tabindex="-1"></a>viewof selected_study <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(available_studies<span class="op">,</span> {</span>
<span id="cb4-175"><a href="#cb4-175" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">"Select Study:"</span><span class="op">,</span></span>
<span id="cb4-176"><a href="#cb4-176" aria-hidden="true" tabindex="-1"></a>  <span class="dt">format</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">name</span><span class="op">,</span></span>
<span id="cb4-177"><a href="#cb4-177" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> latest_upload <span class="op">||</span> available_studies[<span class="dv">0</span>] </span>
<span id="cb4-178"><a href="#cb4-178" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-4" data-nodetype="declaration">

</div>
</div>
<div class="sourceCode cell-code hidden" id="cb5" data-startfrom="185" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 184;"><span id="cb5-185"><a href="#cb5-185" aria-hidden="true" tabindex="-1"></a>viewof new_zip_file <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">file</span>({</span>
<span id="cb5-186"><a href="#cb5-186" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">"Import your own study (.zip):"</span><span class="op">,</span></span>
<span id="cb5-187"><a href="#cb5-187" aria-hidden="true" tabindex="-1"></a>  <span class="dt">accept</span><span class="op">:</span> <span class="st">".zip"</span><span class="op">,</span></span>
<span id="cb5-188"><a href="#cb5-188" aria-hidden="true" tabindex="-1"></a>  <span class="dt">multiple</span><span class="op">:</span> <span class="kw">false</span></span>
<span id="cb5-189"><a href="#cb5-189" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-5" data-nodetype="declaration">

</div>
</div>
<div class="sourceCode cell-code hidden" id="cb6" data-startfrom="198" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 197;"><span id="cb6-198"><a href="#cb6-198" aria-hidden="true" tabindex="-1"></a>new_zip_data <span class="op">=</span> {</span>
<span id="cb6-199"><a href="#cb6-199" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>new_zip_file) <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb6-200"><a href="#cb6-200" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-201"><a href="#cb6-201" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> buf <span class="op">=</span> <span class="cf">await</span> new_zip_file<span class="op">.</span><span class="fu">arrayBuffer</span>()<span class="op">;</span></span>
<span id="cb6-202"><a href="#cb6-202" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-203"><a href="#cb6-203" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb6-204"><a href="#cb6-204" aria-hidden="true" tabindex="-1"></a>    <span class="dt">id</span><span class="op">:</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>()<span class="op">,</span></span>
<span id="cb6-205"><a href="#cb6-205" aria-hidden="true" tabindex="-1"></a>    <span class="dt">filename</span><span class="op">:</span> new_zip_file<span class="op">.</span><span class="at">name</span><span class="op">,</span></span>
<span id="cb6-206"><a href="#cb6-206" aria-hidden="true" tabindex="-1"></a>    <span class="dt">data</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Uint8Array</span>(buf)</span>
<span id="cb6-207"><a href="#cb6-207" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb6-208"><a href="#cb6-208" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-6" data-nodetype="declaration">

</div>
</div>
<div>
<div id="webr-3" class="exercise-cell">

</div>
<script type="webr-3-contents">
eyJhdHRyIjp7ImF1dG9ydW4iOnRydWUsImRlZmluZSI6WyJwcm9jZXNzZWRfbmV3X3N0dWR5Il0sImVjaG8iOmZhbHNlLCJlZGl0IjpmYWxzZSwiZXZhbCI6dHJ1ZSwiaW5wdXQiOlsibmV3X3ppcF9kYXRhIl0sIm91dHB1dCI6ZmFsc2V9LCJjb2RlIjoiXG5wcm9jZXNzZWRfbmV3X3N0dWR5IDwtIE5VTExcblxuaWYobGVuZ3RoKG5ld196aXBfZGF0YSkgPiAxKXtcbiAgY2F0KHBhc3RlMChcIlByb2Nlc3NpbmcgbmV3IHVzZXIgZGF0YS4gVGltZXN0YW1wOiBcIiwgU3lzLnRpbWUoKSkpXG5cbiAgemlwX2ZpbGVfbmFtZSA8LSBhcy5jaGFyYWN0ZXIobmV3X3ppcF9kYXRhJGZpbGVuYW1lKVxuICB0YXJnZXRfZGlyIDwtIGFzLmNoYXJhY3RlcihuZXdfemlwX2RhdGEkaWQpXG5cbiAgd3JpdGVCaW4oYXMucmF3KG5ld196aXBfZGF0YSRkYXRhKSwgemlwX2ZpbGVfbmFtZSlcbiAgaWYoZGlyLmV4aXN0cyh0YXJnZXRfZGlyKSkgdW5saW5rKHRhcmdldF9kaXIsIHJlY3Vyc2l2ZT1UUlVFKVxuICB1dGlsczo6dW56aXAoemlwX2ZpbGVfbmFtZSwgZXhkaXIgPSB0YXJnZXRfZGlyLCBqdW5rcGF0aHMgPSBUUlVFKVxuICBpZihmaWxlLmV4aXN0cyh6aXBfZmlsZV9uYW1lKSkgdW5saW5rKHppcF9maWxlX25hbWUsIHJlY3Vyc2l2ZT1UUlVFKVxuXG4gIGlzVmFsaWQgPC0gdmVyaWZ5KHRhcmdldF9kaXIpXG4gIFxuICBpZighaXNWYWxpZCl7XG4gICAgY2F0KFwiXFxu4p2MIFZhbGlkYXRpb24gRmFpbGVkLlwiKVxuICB9IGVsc2Uge1xuICAgIGhlYWRlcl9wYXRoIDwtIGZpbGUucGF0aCh0YXJnZXRfZGlyLCBcInN0dWR5X2hlYWRlci5wYXJxdWV0XCIpXG4gICAgc3R1ZHlfbmFtZSA8LSBwYXN0ZTAoXCJDdXN0b206IFwiLCB6aXBfZmlsZV9uYW1lKSBcbiAgICBoZWFkZXJfZGYgPC0gZGF0YS5mcmFtZShOYW1lID0gc3R1ZHlfbmFtZSwgRGVzY3JpcHRpb24gPSBcIlVzZXIgRGF0YVwiLCBGb3JtYWxhID0gXCJOQVwiKSAjIEZhbGxiYWNrXG5cbiAgICB0cnlDYXRjaCh7XG4gICAgICAgY29uX3BlZWsgPC0gZGJDb25uZWN0KGR1Y2tkYigpKVxuICAgICAgIGRmIDwtIGRiR2V0UXVlcnkoY29uX3BlZWssIHBhc3RlMChcIlNFTEVDVCAqIEZST00gJ1wiLCBoZWFkZXJfcGF0aCwgXCInIExJTUlUIDFcIikpXG4gICAgICAgXG4gICAgICAgaWYobnJvdyhkZikgPiAwKSB7XG4gICAgICAgICBoZWFkZXJfZGYgPC0gZGZcbiAgICAgICAgIGlmKFwiTmFtZVwiICVpbiUgbmFtZXMoZGYpKSBzdHVkeV9uYW1lIDwtIGFzLmNoYXJhY3RlcihkZiROYW1lWzFdKVxuICAgICAgIH1cbiAgICAgICBkYkRpc2Nvbm5lY3QoY29uX3BlZWssIHNodXRkb3duPVRSVUUpXG4gICAgfSwgZXJyb3IgPSBmdW5jdGlvbihlKSB7XG4gICAgICAgaWYoZXhpc3RzKFwiY29uX3BlZWtcIikgJiYgZGJJc1ZhbGlkKGNvbl9wZWVrKSkgZGJEaXNjb25uZWN0KGNvbl9wZWVrLCBzaHV0ZG93bj1UUlVFKVxuICAgICAgIGNhdChcIldhcm5pbmc6IENvdWxkIG5vdCByZWFkIGhlYWRlciBmaWxlLiBVc2luZyBkZWZhdWx0cy5cXG5cIilcbiAgICB9KVxuICAgIFxuICAgIGNhdChwYXN0ZTAoXCJcXG7inIUgVmFsaWRhdGVkOiBcIiwgc3R1ZHlfbmFtZSkpXG5cbiAgICBuZXdfc3R1ZHlfbGlzdCA8LSBsaXN0KFxuICAgICAgaWQgPSB0YXJnZXRfZGlyLFxuICAgICAgbmFtZSA9IHN0dWR5X25hbWUsXG4gICAgICBkZXNjcmlwdGlvbiA9IFwiVXNlciBVcGxvYWRlZCBEYXRhXCIsIFxuICAgICAgXG4gICAgICBoZWFkZXJfZGF0YSA9IGhlYWRlcl9kZiwgXG4gICAgICBcbiAgICAgIHVybF9oZWFkZXIgICA9IGhlYWRlcl9wYXRoLFxuICAgICAgdXJsX3BhaXJ3aXNlID0gZmlsZS5wYXRoKHRhcmdldF9kaXIsIFwicGFpcndpc2UucGFycXVldFwiKSxcbiAgICAgIHVybF9tZXRhICAgICA9IGZpbGUucGF0aCh0YXJnZXRfZGlyLCBcImNlbGxfbWV0YWRhdGEucGFycXVldFwiKSxcbiAgICAgIHVybF9lbW1lYW5zICA9IGZpbGUucGF0aCh0YXJnZXRfZGlyLCBcImVtbWVhbnMucGFycXVldFwiKSxcbiAgICAgIHVybF9vdmVybGFwID0gZmlsZS5wYXRoKHRhcmdldF9kaXIsIFwib3ZlcmxhcC5wYXJxdWV0XCIpLFxuICAgICAgdHlwZSA9IFwibG9jYWxcIixcbiAgICAgIHZhbGlkID0gVFJVRVxuICAgIClcbiAgICBcbiAgICBwcm9jZXNzZWRfbmV3X3N0dWR5IDwtIGFzLmNoYXJhY3Rlcihqc29ubGl0ZTo6dG9KU09OKG5ld19zdHVkeV9saXN0LCBhdXRvX3VuYm94ID0gVFJVRSkpXG4gIH1cbiAgXG59IGVsc2Uge1xuICBjYXQocGFzdGUwKFwibmV3X3ppcF9kYXRhIGlzIE5BLiBUaW1lc3RhbXA6IFwiLCBTeXMudGltZSgpKSlcbn0ifQ==
</script>
</div>
<div class="sourceCode cell-code hidden" id="cb7" data-startfrom="286" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 285;"><span id="cb7-286"><a href="#cb7-286" aria-hidden="true" tabindex="-1"></a>mutable latest_upload <span class="op">=</span> <span class="kw">null</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-7" data-nodetype="declaration">

</div>
</div>
<div class="sourceCode cell-code hidden" id="cb8" data-startfrom="293" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 292;"><span id="cb8-293"><a href="#cb8-293" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb8-294"><a href="#cb8-294" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (processed_new_study) {</span>
<span id="cb8-295"><a href="#cb8-295" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> new_record <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">parse</span>(processed_new_study)<span class="op">;</span></span>
<span id="cb8-296"><a href="#cb8-296" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-297"><a href="#cb8-297" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (new_record <span class="op">&amp;&amp;</span> new_record<span class="op">.</span><span class="at">valid</span>) {</span>
<span id="cb8-298"><a href="#cb8-298" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> exists <span class="op">=</span> available_studies<span class="op">.</span><span class="fu">find</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">id</span> <span class="op">===</span> new_record<span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb8-299"><a href="#cb8-299" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb8-300"><a href="#cb8-300" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="op">!</span>exists) {</span>
<span id="cb8-301"><a href="#cb8-301" aria-hidden="true" tabindex="-1"></a>         <span class="co">// 1. Update the list</span></span>
<span id="cb8-302"><a href="#cb8-302" aria-hidden="true" tabindex="-1"></a>         mutable available_studies<span class="op">.</span><span class="fu">push</span>(new_record)<span class="op">;</span></span>
<span id="cb8-303"><a href="#cb8-303" aria-hidden="true" tabindex="-1"></a>         mutable available_studies <span class="op">=</span> mutable available_studies<span class="op">;</span></span>
<span id="cb8-304"><a href="#cb8-304" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb8-305"><a href="#cb8-305" aria-hidden="true" tabindex="-1"></a>         mutable latest_upload <span class="op">=</span> new_record<span class="op">;</span> </span>
<span id="cb8-306"><a href="#cb8-306" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb8-307"><a href="#cb8-307" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"✅ Loaded:"</span><span class="op">,</span> new_record<span class="op">.</span><span class="at">name</span>)<span class="op">;</span></span>
<span id="cb8-308"><a href="#cb8-308" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-309"><a href="#cb8-309" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-310"><a href="#cb8-310" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-8" data-nodetype="expression">

</div>
</div>
<div class="sourceCode cell-code hidden" id="cb9" data-startfrom="317" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 316;"><span id="cb9-317"><a href="#cb9-317" aria-hidden="true" tabindex="-1"></a>study_data_payload <span class="op">=</span> {</span>
<span id="cb9-318"><a href="#cb9-318" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> selection <span class="op">=</span> selected_study<span class="op">;</span></span>
<span id="cb9-319"><a href="#cb9-319" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>selection) <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb9-320"><a href="#cb9-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-321"><a href="#cb9-321" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"🔄 Processing selection:"</span><span class="op">,</span> selection<span class="op">.</span><span class="at">name</span>)<span class="op">;</span></span>
<span id="cb9-322"><a href="#cb9-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-323"><a href="#cb9-323" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (selection<span class="op">.</span><span class="at">type</span> <span class="op">===</span> <span class="st">"local"</span>) {</span>
<span id="cb9-324"><a href="#cb9-324" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"👉 Mode: Local"</span>)<span class="op">;</span></span>
<span id="cb9-325"><a href="#cb9-325" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb9-326"><a href="#cb9-326" aria-hidden="true" tabindex="-1"></a>      <span class="dt">mode</span><span class="op">:</span> <span class="st">"local"</span><span class="op">,</span></span>
<span id="cb9-327"><a href="#cb9-327" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span>selection</span>
<span id="cb9-328"><a href="#cb9-328" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb9-329"><a href="#cb9-329" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-330"><a href="#cb9-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-331"><a href="#cb9-331" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (selection<span class="op">.</span><span class="at">type</span> <span class="op">===</span> <span class="st">"remote"</span>) {</span>
<span id="cb9-332"><a href="#cb9-332" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"👉 Mode: Remote (JS Bridge)"</span>)<span class="op">;</span></span>
<span id="cb9-333"><a href="#cb9-333" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-334"><a href="#cb9-334" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb9-335"><a href="#cb9-335" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> conn <span class="op">=</span> <span class="cf">await</span> duck_db_client<span class="op">;</span></span>
<span id="cb9-336"><a href="#cb9-336" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb9-337"><a href="#cb9-337" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> header_table <span class="op">=</span> <span class="cf">await</span> conn<span class="op">.</span><span class="fu">query</span>(<span class="vs">`SELECT * FROM '</span><span class="sc">${</span>selection<span class="op">.</span><span class="at">url_header</span><span class="sc">}</span><span class="vs">'`</span>)<span class="op">;</span></span>
<span id="cb9-338"><a href="#cb9-338" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb9-339"><a href="#cb9-339" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> header_json <span class="op">=</span> header_table<span class="op">.</span><span class="fu">toArray</span>()<span class="op">.</span><span class="fu">map</span>(row <span class="kw">=&gt;</span> row<span class="op">.</span><span class="fu">toJSON</span>())<span class="op">;</span></span>
<span id="cb9-340"><a href="#cb9-340" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb9-341"><a href="#cb9-341" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"✅ Header received:"</span><span class="op">,</span> header_json)<span class="op">;</span></span>
<span id="cb9-342"><a href="#cb9-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-343"><a href="#cb9-343" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> {</span>
<span id="cb9-344"><a href="#cb9-344" aria-hidden="true" tabindex="-1"></a>        <span class="dt">mode</span><span class="op">:</span> <span class="st">"remote_js_bridge"</span><span class="op">,</span></span>
<span id="cb9-345"><a href="#cb9-345" aria-hidden="true" tabindex="-1"></a>        <span class="dt">id</span><span class="op">:</span> selection<span class="op">.</span><span class="at">id</span><span class="op">,</span></span>
<span id="cb9-346"><a href="#cb9-346" aria-hidden="true" tabindex="-1"></a>        <span class="dt">name</span><span class="op">:</span> selection<span class="op">.</span><span class="at">name</span><span class="op">,</span></span>
<span id="cb9-347"><a href="#cb9-347" aria-hidden="true" tabindex="-1"></a>        <span class="dt">header_data</span><span class="op">:</span> header_json<span class="op">,</span></span>
<span id="cb9-348"><a href="#cb9-348" aria-hidden="true" tabindex="-1"></a>        <span class="dt">url_pairwise</span><span class="op">:</span> selection<span class="op">.</span><span class="at">url_pairwise</span><span class="op">,</span></span>
<span id="cb9-349"><a href="#cb9-349" aria-hidden="true" tabindex="-1"></a>        <span class="dt">url_meta</span><span class="op">:</span> selection<span class="op">.</span><span class="at">url_meta</span><span class="op">,</span></span>
<span id="cb9-350"><a href="#cb9-350" aria-hidden="true" tabindex="-1"></a>        <span class="dt">url_emmeans</span><span class="op">:</span> selection<span class="op">.</span><span class="at">url_emmeans</span><span class="op">,</span></span>
<span id="cb9-351"><a href="#cb9-351" aria-hidden="true" tabindex="-1"></a>        <span class="dt">url_overlap</span><span class="op">:</span> selection<span class="op">.</span><span class="at">url_overlap</span></span>
<span id="cb9-352"><a href="#cb9-352" aria-hidden="true" tabindex="-1"></a>      }<span class="op">;</span></span>
<span id="cb9-353"><a href="#cb9-353" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb9-354"><a href="#cb9-354" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (e) {</span>
<span id="cb9-355"><a href="#cb9-355" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(<span class="st">"❌ JS Bridge Error:"</span><span class="op">,</span> e)<span class="op">;</span></span>
<span id="cb9-356"><a href="#cb9-356" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb9-357"><a href="#cb9-357" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-358"><a href="#cb9-358" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-359"><a href="#cb9-359" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-9" data-nodetype="declaration">

</div>
</div>
<div>
<div id="webr-4" class="exercise-cell">

</div>
<script type="webr-4-contents">
eyJhdHRyIjp7ImF1dG9ydW4iOnRydWUsImRlZmluZSI6WyJkYl9yZWFkeSIsInJfc3RhdHVzX3Byb3h5Il0sImVjaG8iOmZhbHNlLCJlZGl0IjpmYWxzZSwiZXZhbCI6dHJ1ZSwiaW5wdXQiOlsic3R1ZHlfZGF0YV9wYXlsb2FkIl0sIm91dHB1dCI6ZmFsc2V9LCJjb2RlIjoiXG5kYl9yZWFkeSA8LSBGQUxTRVxucl9zdGF0dXNfcHJveHkgPC0gXCJXYWl0aW5nIGZvciBkYXRhLi4uXCJcbnByaW50KGNvbilcblxuaWYgKCFpcy5udWxsKHN0dWR5X2RhdGFfcGF5bG9hZCkpIHtcbiAgXG4gIGNhdChwYXN0ZTAoXCJSOiBSZWNlaXZlZCBwYXlsb2FkIG1vZGU6IFwiLCBzdHVkeV9kYXRhX3BheWxvYWQkbW9kZSwgXCJcXG5cIikpXG5cbiAgaWYgKHN0dWR5X2RhdGFfcGF5bG9hZCRtb2RlID09IFwicmVtb3RlX2pzX2JyaWRnZVwiKSB7XG4gICAgXG4gICAgaWYgKCFpcy5udWxsKHN0dWR5X2RhdGFfcGF5bG9hZCRoZWFkZXJfZGF0YSkpIHtcbiAgICAgICBoZWFkZXJfanNvbl9zdHIgPC0ganNvbmxpdGU6OnRvSlNPTihzdHVkeV9kYXRhX3BheWxvYWQkaGVhZGVyX2RhdGEpXG4gICAgICAgaGVhZGVyX2RmIDwtIGpzb25saXRlOjpmcm9tSlNPTihoZWFkZXJfanNvbl9zdHIpXG5cbiAgICAgICBkYldyaXRlVGFibGUoY29uLCBcInN0dWR5X21ldGFcIiwgaGVhZGVyX2RmLCBvdmVyd3JpdGUgPSBUUlVFKVxuICAgICAgIGNhdChcIlI6IEhlYWRlciB0YWJsZSB3cml0dGVuIHN1Y2Nlc3NmdWxseS5cXG5cIilcbiAgICB9XG4gICAgXG4gIH0gZWxzZSB7XG5cbiAgICBpZiAoIWlzLm5hKHN0dWR5X2RhdGFfcGF5bG9hZCR1cmxfaGVhZGVyKSkge1xuICAgICAgIGRiRXhlY3V0ZShjb24sIHBhc3RlMChcIkNSRUFURSBPUiBSRVBMQUNFIFZJRVcgc3R1ZHlfbWV0YSBBUyBTRUxFQ1QgKiBGUk9NICdcIiwgc3R1ZHlfZGF0YV9wYXlsb2FkJHVybF9oZWFkZXIsIFwiJ1wiKSlcbiAgICB9XG5cbiAgICBpZiAoIWlzLm5hKHN0dWR5X2RhdGFfcGF5bG9hZCR1cmxfcGFpcndpc2UpKSB7XG4gICAgICAgZGJFeGVjdXRlKGNvbiwgcGFzdGUwKFwiQ1JFQVRFIE9SIFJFUExBQ0UgVklFVyBkZV9yZXN1bHRzIEFTIFNFTEVDVCAqIEZST00gJ1wiLCBzdHVkeV9kYXRhX3BheWxvYWQkdXJsX3BhaXJ3aXNlLCBcIidcIikpXG4gICAgfVxuXG4gICAgaWYgKCFpcy5uYShzdHVkeV9kYXRhX3BheWxvYWQkdXJsX21ldGEpKSB7XG4gICAgICAgZGJFeGVjdXRlKGNvbiwgcGFzdGUwKFwiQ1JFQVRFIE9SIFJFUExBQ0UgVklFVyBjZWxsX21ldGEgQVMgU0VMRUNUICogRlJPTSAnXCIsIHN0dWR5X2RhdGFfcGF5bG9hZCR1cmxfbWV0YSwgXCInXCIpKVxuICAgIH1cblxuICAgIGlmICghaXMubmEoc3R1ZHlfZGF0YV9wYXlsb2FkJHVybF9lbW1lYW5zKSkge1xuICAgICAgIGRiRXhlY3V0ZShjb24sIHBhc3RlMChcIkNSRUFURSBPUiBSRVBMQUNFIFZJRVcgZW1tZWFuc19kYXRhIEFTIFNFTEVDVCAqIEZST00gJ1wiLCBzdHVkeV9kYXRhX3BheWxvYWQkdXJsX2VtbWVhbnMsIFwiJ1wiKSlcbiAgICB9XG4gICAgIyBPdmVybGFwIChmdXJ0dXJlIGZlYXR1cmUpXG4gICAgaWYgKCFpcy5uYShzdHVkeV9kYXRhX3BheWxvYWQkdXJsX292ZXJsYXApKSB7XG4gICAgICAgZGJFeGVjdXRlKGNvbiwgcGFzdGUwKFwiQ1JFQVRFIE9SIFJFUExBQ0UgVklFVyBvdmVybGFwX2RhdGEgQVMgU0VMRUNUICogRlJPTSAnXCIsIHN0dWR5X2RhdGFfcGF5bG9hZCR1cmxfb3ZlcmxhcCwgXCInXCIpKVxuICAgIH1cbiAgICAgIH1cbiAgXG4gIHJfc3RhdHVzX3Byb3h5IDwtIHBhc3RlKFwiQWN0aXZlOlwiLCBzdHVkeV9kYXRhX3BheWxvYWQkbmFtZSlcbiAgZGJfcmVhZHkgPC0gVFJVRVxufSJ9
</script>
</div>
<div class="sourceCode cell-code hidden" id="cb10" data-startfrom="425" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 424;"><span id="cb10-425"><a href="#cb10-425" aria-hidden="true" tabindex="-1"></a>contrasts_from_js <span class="op">=</span> {</span>
<span id="cb10-426"><a href="#cb10-426" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> payload <span class="op">=</span> study_data_payload<span class="op">;</span></span>
<span id="cb10-427"><a href="#cb10-427" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>payload <span class="op">||</span> payload<span class="op">.</span><span class="at">mode</span> <span class="op">===</span> <span class="st">"local"</span>) <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb10-428"><a href="#cb10-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-429"><a href="#cb10-429" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (payload<span class="op">.</span><span class="at">mode</span> <span class="op">===</span> <span class="st">"remote_js_bridge"</span>) {</span>
<span id="cb10-430"><a href="#cb10-430" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb10-431"><a href="#cb10-431" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> conn <span class="op">=</span> <span class="cf">await</span> duck_db_client<span class="op">;</span></span>
<span id="cb10-432"><a href="#cb10-432" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb10-433"><a href="#cb10-433" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> query <span class="op">=</span> <span class="vs">`SELECT DISTINCT "contrast" FROM '</span><span class="sc">${</span>payload<span class="op">.</span><span class="at">url_pairwise</span><span class="sc">}</span><span class="vs">' ORDER BY "contrast"`</span><span class="op">;</span></span>
<span id="cb10-434"><a href="#cb10-434" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> result <span class="op">=</span> <span class="cf">await</span> conn<span class="op">.</span><span class="fu">query</span>(query)<span class="op">;</span></span>
<span id="cb10-435"><a href="#cb10-435" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> raw_list <span class="op">=</span> result<span class="op">.</span><span class="fu">toArray</span>()<span class="op">.</span><span class="fu">map</span>(row <span class="kw">=&gt;</span> row<span class="op">.</span><span class="at">contrast</span>)<span class="op">;</span></span>
<span id="cb10-436"><a href="#cb10-436" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb10-437"><a href="#cb10-437" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> clean_list <span class="op">=</span> raw_list<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> <span class="op">!</span>d<span class="op">.</span><span class="fu">includes</span>(<span class="st">"otherct_expr"</span>))<span class="op">;</span></span>
<span id="cb10-438"><a href="#cb10-438" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb10-439"><a href="#cb10-439" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"✅ Contrasts fetched (filtered):"</span><span class="op">,</span> clean_list)<span class="op">;</span></span>
<span id="cb10-440"><a href="#cb10-440" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> clean_list<span class="op">;</span></span>
<span id="cb10-441"><a href="#cb10-441" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb10-442"><a href="#cb10-442" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (e) {</span>
<span id="cb10-443"><a href="#cb10-443" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(<span class="st">"❌ Failed to fetch contrasts:"</span><span class="op">,</span> e)<span class="op">;</span></span>
<span id="cb10-444"><a href="#cb10-444" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> []<span class="op">;</span></span>
<span id="cb10-445"><a href="#cb10-445" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-446"><a href="#cb10-446" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-447"><a href="#cb10-447" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-10" data-nodetype="declaration">

</div>
</div>
<div class="sourceCode cell-code hidden" id="cb11" data-startfrom="455" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 454;"><span id="cb11-455"><a href="#cb11-455" aria-hidden="true" tabindex="-1"></a>terms_from_js <span class="op">=</span> {</span>
<span id="cb11-456"><a href="#cb11-456" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> payload <span class="op">=</span> study_data_payload<span class="op">;</span></span>
<span id="cb11-457"><a href="#cb11-457" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>payload <span class="op">||</span> payload<span class="op">.</span><span class="at">mode</span> <span class="op">===</span> <span class="st">"local"</span>) <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb11-458"><a href="#cb11-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-459"><a href="#cb11-459" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (payload<span class="op">.</span><span class="at">mode</span> <span class="op">===</span> <span class="st">"remote_js_bridge"</span>) {</span>
<span id="cb11-460"><a href="#cb11-460" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb11-461"><a href="#cb11-461" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> conn <span class="op">=</span> <span class="cf">await</span> duck_db_client<span class="op">;</span></span>
<span id="cb11-462"><a href="#cb11-462" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb11-463"><a href="#cb11-463" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> query <span class="op">=</span> <span class="vs">`SELECT DISTINCT "term" FROM '</span><span class="sc">${</span>payload<span class="op">.</span><span class="at">url_pairwise</span><span class="sc">}</span><span class="vs">' ORDER BY "term"`</span><span class="op">;</span></span>
<span id="cb11-464"><a href="#cb11-464" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> result <span class="op">=</span> <span class="cf">await</span> conn<span class="op">.</span><span class="fu">query</span>(query)<span class="op">;</span></span>
<span id="cb11-465"><a href="#cb11-465" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> raw_list <span class="op">=</span> result<span class="op">.</span><span class="fu">toArray</span>()<span class="op">.</span><span class="fu">map</span>(row <span class="kw">=&gt;</span> row<span class="op">.</span><span class="at">term</span>)<span class="op">;</span></span>
<span id="cb11-466"><a href="#cb11-466" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb11-467"><a href="#cb11-467" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> clean_list <span class="op">=</span> raw_list<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> <span class="op">!</span>d<span class="op">.</span><span class="fu">includes</span>(<span class="st">"otherct_expr"</span>))<span class="op">;</span></span>
<span id="cb11-468"><a href="#cb11-468" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb11-469"><a href="#cb11-469" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"✅ Terms fetched (filtered):"</span><span class="op">,</span> clean_list)<span class="op">;</span></span>
<span id="cb11-470"><a href="#cb11-470" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> clean_list<span class="op">;</span></span>
<span id="cb11-471"><a href="#cb11-471" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb11-472"><a href="#cb11-472" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (e) {</span>
<span id="cb11-473"><a href="#cb11-473" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(<span class="st">"❌ Failed to fetch terms:"</span><span class="op">,</span> e)<span class="op">;</span></span>
<span id="cb11-474"><a href="#cb11-474" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> []<span class="op">;</span></span>
<span id="cb11-475"><a href="#cb11-475" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-476"><a href="#cb11-476" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-477"><a href="#cb11-477" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-11" data-nodetype="declaration">

</div>
</div>
<div class="sourceCode cell-code hidden" id="cb12" data-startfrom="484" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 483;"><span id="cb12-484"><a href="#cb12-484" aria-hidden="true" tabindex="-1"></a>slides_from_js <span class="op">=</span> {</span>
<span id="cb12-485"><a href="#cb12-485" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> payload <span class="op">=</span> study_data_payload<span class="op">;</span></span>
<span id="cb12-486"><a href="#cb12-486" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>payload <span class="op">||</span> payload<span class="op">.</span><span class="at">mode</span> <span class="op">===</span> <span class="st">"local"</span>) <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb12-487"><a href="#cb12-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-488"><a href="#cb12-488" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (payload<span class="op">.</span><span class="at">mode</span> <span class="op">===</span> <span class="st">"remote_js_bridge"</span>) {</span>
<span id="cb12-489"><a href="#cb12-489" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb12-490"><a href="#cb12-490" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> conn <span class="op">=</span> <span class="cf">await</span> duck_db_client<span class="op">;</span></span>
<span id="cb12-491"><a href="#cb12-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-492"><a href="#cb12-492" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> query <span class="op">=</span> <span class="vs">`SELECT DISTINCT "slide_id_numeric" FROM '</span><span class="sc">${</span>payload<span class="op">.</span><span class="at">url_meta</span><span class="sc">}</span><span class="vs">' ORDER BY "slide_id_numeric"`</span><span class="op">;</span></span>
<span id="cb12-493"><a href="#cb12-493" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> result <span class="op">=</span> <span class="cf">await</span> conn<span class="op">.</span><span class="fu">query</span>(query)<span class="op">;</span></span>
<span id="cb12-494"><a href="#cb12-494" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> raw_list <span class="op">=</span> result<span class="op">.</span><span class="fu">toArray</span>()<span class="op">.</span><span class="fu">map</span>(row <span class="kw">=&gt;</span> row<span class="op">.</span><span class="at">slide_id_numeric</span>)<span class="op">;</span></span>
<span id="cb12-495"><a href="#cb12-495" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb12-496"><a href="#cb12-496" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"✅ Slides fetched "</span><span class="op">,</span> raw_list)<span class="op">;</span></span>
<span id="cb12-497"><a href="#cb12-497" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> raw_list<span class="op">;</span></span>
<span id="cb12-498"><a href="#cb12-498" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb12-499"><a href="#cb12-499" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (e) {</span>
<span id="cb12-500"><a href="#cb12-500" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(<span class="st">"❌ Failed to fetch slides:"</span><span class="op">,</span> e)<span class="op">;</span></span>
<span id="cb12-501"><a href="#cb12-501" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> []<span class="op">;</span></span>
<span id="cb12-502"><a href="#cb12-502" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb12-503"><a href="#cb12-503" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-504"><a href="#cb12-504" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-12" data-nodetype="declaration">

</div>
</div>
<div>
<div id="webr-5" class="exercise-cell">

</div>
<script type="webr-5-contents">
eyJhdHRyIjp7ImF1dG9ydW4iOnRydWUsImRlZmluZSI6WyJhdmFpbGFibGVfY29udHJhc3RzIiwiYXZhaWxhYmxlX3Rlcm1zIiwiYXZhaWxhYmxlX3NsaWRlcyJdLCJlY2hvIjpmYWxzZSwiZWRpdCI6ZmFsc2UsImV2YWwiOnRydWUsImlucHV0IjpbInN0dWR5X2RhdGFfcGF5bG9hZCIsImNvbnRyYXN0c19mcm9tX2pzIiwidGVybXNfZnJvbV9qcyIsInNsaWRlc19mcm9tX2pzIl0sIm91dHB1dCI6ZmFsc2V9LCJjb2RlIjoiXG5hdmFpbGFibGVfY29udHJhc3RzIDwtIGlmKGV4aXN0cyhcImF2YWlsYWJsZV9jb250cmFzdHNcIikpIGF2YWlsYWJsZV9jb250cmFzdHMgZWxzZSBOVUxMXG5hdmFpbGFibGVfdGVybXMgPC0gaWYoZXhpc3RzKFwiYXZhaWxhYmxlX3Rlcm1zXCIpKSBhdmFpbGFibGVfdGVybXMgZWxzZSBOVUxMXG5hdmFpbGFibGVfc2xpZGVzIDwtIGlmKGV4aXN0cyhcImF2YWlsYWJsZV9zbGlkZXNcIikpIGF2YWlsYWJsZV9zbGlkZXMgZWxzZSAxXG5cbmlmICghaXMubnVsbChzdHVkeV9kYXRhX3BheWxvYWQpKSB7XG4gICMgUkVNT1RFIE1PREVcbiAgaWYgKHN0dWR5X2RhdGFfcGF5bG9hZCRtb2RlID09IFwicmVtb3RlX2pzX2JyaWRnZVwiKSB7XG4gICAgaWYgKCFpcy5udWxsKGNvbnRyYXN0c19mcm9tX2pzKSkgYXZhaWxhYmxlX2NvbnRyYXN0cyA8LSB1bmxpc3QoY29udHJhc3RzX2Zyb21fanMpXG4gICAgaWYgKCFpcy5udWxsKHRlcm1zX2Zyb21fanMpKSBhdmFpbGFibGVfdGVybXMgPC0gdW5saXN0KHRlcm1zX2Zyb21fanMpXG4gICAgaWYgKCFpcy5udWxsKHNsaWRlc19mcm9tX2pzKSkgYXZhaWxhYmxlX3NsaWRlcyA8LSB1bmxpc3Qoc2xpZGVzX2Zyb21fanMpXG4gICAgXG4gICMgTE9DQUwgTU9ERVxuICB9IGVsc2UgaWYgKGRiRXhpc3RzVGFibGUoY29uLCBcImRlX3Jlc3VsdHNcIikpIHtcbiAgICBhdmFpbGFibGVfY29udHJhc3RzIDwtIGRiR2V0UXVlcnkoY29uLCBcIlNFTEVDVCBESVNUSU5DVCBjb250cmFzdCBGUk9NIGRlX3Jlc3VsdHNcIikkY29udHJhc3RcbiAgICBhdmFpbGFibGVfY29udHJhc3RzIDwtIGF2YWlsYWJsZV9jb250cmFzdHNbIWdyZXBsKFwib3RoZXJjdF9leHByXCIsIGF2YWlsYWJsZV9jb250cmFzdHMpXVxuICAgIGF2YWlsYWJsZV90ZXJtcyA8LSBkYkdldFF1ZXJ5KGNvbiwgXCJTRUxFQ1QgRElTVElOQ1QgdGVybSBGUk9NIGRlX3Jlc3VsdHNcIikkdGVybVxuICAgIFxuICAgIGlmIChkYkV4aXN0c1RhYmxlKGNvbiwgXCJjZWxsX21ldGFcIikpIHtcbiAgICAgIGF2YWlsYWJsZV9zbGlkZXMgPC0gZGJHZXRRdWVyeShjb24sIFwiU0VMRUNUIERJU1RJTkNUIHNsaWRlX2lkX251bWVyaWMgRlJPTSBjZWxsX21ldGFcIikkc2xpZGVfaWRfbnVtZXJpY1xuICAgIH1cbiAgfVxufSJ9
</script>
</div>
<p><br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br></p>
<p>Tool Version: 1.0</p>
<p>Tool Type: Serverless (OJS + webr)</p>
<p>Source Code Available: Yes</p>
<p>Ways to generate your own data:</p>
<ul>
<li>Via AtoMx SIP: No</li>
<li>Via smiDE: Yes</li>
</ul>
</div></aside>
<button class="collapse-toggle" type="button" title="Toggle sidebar" aria-expanded="true" aria-controls="bslib-sidebar-1">
    <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 16 16" class="bi bi-chevron-left collapse-icon" style="fill:currentColor;" aria-hidden="true" role="img">
      <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"></path>
    </svg>
</button>
<script data-bslib-sidebar-init="">
bslib.Sidebar.initCollapsibleAll()
</script>
</div>
<div class="ojs-auto-generated hidden bslib-grid-item html-fill-item">
<script type="ojs-module-contents">
eyJjb250ZW50cyI6WyAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7c2VsZWN0aW9uV2FybmluZ308L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTEifV19
</script>
</div>


<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlxuZHVja19kYl9jbGllbnQgPSB7XG4gIGNvbnN0IGR1Y2tkYiA9IGF3YWl0IGltcG9ydChcImh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vQGR1Y2tkYi9kdWNrZGItd2FzbUAxLjI4LjAvK2VzbVwiKTtcbiAgXG4gIGNvbnNvbGUubG9nKFwi8J+UpyBJbml0aWFsaXppbmcgRHVja0RCLVdhc20gQ2xpZW50Li4uXCIpO1xuICBcbiAgY29uc3QgSlNERUxJVlJfQlVORExFUyA9IGR1Y2tkYi5nZXRKc0RlbGl2ckJ1bmRsZXMoKTtcbiAgY29uc3QgYnVuZGxlID0gYXdhaXQgZHVja2RiLnNlbGVjdEJ1bmRsZShKU0RFTElWUl9CVU5ETEVTKTtcbiAgXG4gIGNvbnN0IHdvcmtlcl91cmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKFxuICAgIG5ldyBCbG9iKFtgaW1wb3J0U2NyaXB0cyhcIiR7YnVuZGxlLm1haW5Xb3JrZXJ9XCIpO2BdLCB7IHR5cGU6IFwidGV4dC9qYXZhc2NyaXB0XCIgfSlcbiAgKTtcblxuICBjb25zdCB3b3JrZXIgPSBuZXcgV29ya2VyKHdvcmtlcl91cmwpO1xuICBjb25zdCBsb2dnZXIgPSBuZXcgZHVja2RiLkNvbnNvbGVMb2dnZXIoKTtcbiAgY29uc3QgZGIgPSBuZXcgZHVja2RiLkFzeW5jRHVja0RCKGxvZ2dlciwgd29ya2VyKTtcbiAgXG4gIGF3YWl0IGRiLmluc3RhbnRpYXRlKGJ1bmRsZS5tYWluTW9kdWxlLCBidW5kbGUucHRocmVhZFdvcmtlcik7XG4gIFxuICBjb25zdCBjb25uID0gYXdhaXQgZGIuY29ubmVjdCgpO1xuICBjb25zb2xlLmxvZyhcIuKchSBEdWNrREItV2FzbSBSZWFkeSFcIik7XG4gIHJldHVybiBjb25uO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiXG5zcGFya2JhciA9IChtYXgpID0+IHtcbiAgcmV0dXJuICh4KSA9PiB7XG4gICAgLy8gMS4gQ3JlYXRlIGNvbnRhaW5lclxuICAgIGNvbnN0IGRpdiA9IGQzLmNyZWF0ZShcImRpdlwiKVxuICAgICAgLnN0eWxlKFwiZGlzcGxheVwiLCBcImZsZXhcIilcbiAgICAgIC5zdHlsZShcImFsaWduLWl0ZW1zXCIsIFwiY2VudGVyXCIpXG4gICAgICAuc3R5bGUoXCJ3aWR0aFwiLCBcIjEwMCVcIik7IC8vIExldCBpdCBmaWxsIHRoZSBjZWxsXG5cbiAgICBjb25zdCBjb2xvciA9IHggPj0gMCA/IFwiI0U0MUExQ1wiIDogXCIjMzc3RUI4XCI7IFxuICAgIGNvbnN0IHdpZHRoUGVyY2VudCA9IE1hdGgubWluKChNYXRoLmFicyh4KSAvIG1heCkgKiAxMDAsIDEwMCk7XG5cbiAgICBkaXYuYXBwZW5kKFwic3BhblwiKVxuICAgICAgIC50ZXh0KHgudG9GaXhlZCgyKSlcbiAgICAgICAuc3R5bGUoXCJmb250LXNpemVcIiwgXCIwLjg1ZW1cIilcbiAgICAgICAuc3R5bGUoXCJjb2xvclwiLCBcIiM2NjZcIilcbiAgICAgICAuc3R5bGUoXCJ3aWR0aFwiLCBcIjM1cHhcIikgICAgICAgICAvLyBGaXhlZCB3aWR0aCBmb3IgYWxpZ25tZW50XG4gICAgICAgLnN0eWxlKFwidGV4dC1hbGlnblwiLCBcInJpZ2h0XCIpICAgLy8gQWxpZ24gbnVtYmVycyB0byB0aGUgcmlnaHRcbiAgICAgICAuc3R5bGUoXCJtYXJnaW4tcmlnaHRcIiwgXCI4cHhcIik7ICAvLyBTcGFjZSBiZXR3ZWVuIG51bWJlciBhbmQgYmFyXG5cbiAgICBkaXYuYXBwZW5kKFwiZGl2XCIpXG4gICAgICAuc3R5bGUoXCJ3aWR0aFwiLCBgJHt3aWR0aFBlcmNlbnR9JWApXG4gICAgICAuc3R5bGUoXCJoZWlnaHRcIiwgXCIxMnB4XCIpXG4gICAgICAuc3R5bGUoXCJiYWNrZ3JvdW5kLWNvbG9yXCIsIGNvbG9yKVxuICAgICAgLnN0eWxlKFwiYm9yZGVyLXJhZGl1c1wiLCBcIjJweFwiKTtcblxuICAgIHJldHVybiBkaXYubm9kZSgpO1xuICB9XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTMiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJcbmQzID0gcmVxdWlyZShcImQzQDdcIilcblBsb3RseSA9IHJlcXVpcmUoXCJodHRwczovL2Nkbi5wbG90Lmx5L3Bsb3RseS0yLjI0LjEubWluLmpzXCIpXG5tYW5pZmVzdF9yYXcgPSBGaWxlQXR0YWNobWVudChcImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9OYW5vc3RyaW5nLUJpb3N0YXRzL1NjcmF0Y2hTcGFjZURhdGFzZXRzL3JlZnMvaGVhZHMvbWFpbi9icm93c2VyX2J5dGVzL21hbmlmZXN0LnRzdlwiKS50c3Yoe3R5cGVkOiB0cnVlfSlcblxubXV0YWJsZSBhdmFpbGFibGVfc3R1ZGllcyA9IHtcbiAgaWYgKCFtYW5pZmVzdF9yYXcpIHJldHVybiBbXTtcblxuICByZXR1cm4gbWFuaWZlc3RfcmF3Lm1hcChkID0+ICh7XG4gICAgaWQ6IGQuaWQsXG4gICAgbmFtZTogZC5uYW1lLFxuICAgIGRlc2NyaXB0aW9uOiBkLmRlc2NyaXB0aW9uLFxuICAgIFxuICAgIC8vIERpcmVjdCBtYXBwaW5nIG9mIHlvdXIgVFNWIGNvbHVtbnNcbiAgICB1cmxfaGVhZGVyOiAgIGQudXJsX2hlYWRlcixcbiAgICB1cmxfcGFpcndpc2U6IGQudXJsX3BhaXJ3aXNlLFxuICAgIHVybF9tZXRhOiAgICAgZC51cmxfbWV0YSxcbiAgICB1cmxfZW1tZWFuczogIGQudXJsX2VtbWVhbnMsXG4gICAgdXJsX292ZXJsYXA6IGQudXJsX292ZXJsYXAsXG5cbiAgICB0eXBlOiAncmVtb3RlJyxcbiAgICB2YWxpZDogdHJ1ZVxuICB9KSk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJcbnZpZXdvZiBzZWxlY3RlZF9zdHVkeSA9IElucHV0cy5zZWxlY3QoYXZhaWxhYmxlX3N0dWRpZXMsIHtcbiAgbGFiZWw6IFwiU2VsZWN0IFN0dWR5OlwiLFxuICBmb3JtYXQ6IGQgPT4gZC5uYW1lLFxuICB2YWx1ZTogbGF0ZXN0X3VwbG9hZCB8fCBhdmFpbGFibGVfc3R1ZGllc1swXSBcbn0pXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTUiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJcbnZpZXdvZiBuZXdfemlwX2ZpbGUgPSBJbnB1dHMuZmlsZSh7XG4gIGxhYmVsOiBcIkltcG9ydCB5b3VyIG93biBzdHVkeSAoLnppcCk6XCIsXG4gIGFjY2VwdDogXCIuemlwXCIsXG4gIG11bHRpcGxlOiBmYWxzZVxufSlcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlxubmV3X3ppcF9kYXRhID0ge1xuICBpZiAoIW5ld196aXBfZmlsZSkgcmV0dXJuIG51bGw7XG4gIFxuICBjb25zdCBidWYgPSBhd2FpdCBuZXdfemlwX2ZpbGUuYXJyYXlCdWZmZXIoKTtcbiAgXG4gIHJldHVybiB7XG4gICAgaWQ6IERhdGUubm93KCksXG4gICAgZmlsZW5hbWU6IG5ld196aXBfZmlsZS5uYW1lLFxuICAgIGRhdGE6IG5ldyBVaW50OEFycmF5KGJ1ZilcbiAgfTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlxubXV0YWJsZSBsYXRlc3RfdXBsb2FkID0gbnVsbFxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC04IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiXG57XG4gIGlmIChwcm9jZXNzZWRfbmV3X3N0dWR5KSB7XG4gICAgY29uc3QgbmV3X3JlY29yZCA9IEpTT04ucGFyc2UocHJvY2Vzc2VkX25ld19zdHVkeSk7XG4gICAgXG4gICAgaWYgKG5ld19yZWNvcmQgJiYgbmV3X3JlY29yZC52YWxpZCkge1xuICAgICAgY29uc3QgZXhpc3RzID0gYXZhaWxhYmxlX3N0dWRpZXMuZmluZChkID0+IGQuaWQgPT09IG5ld19yZWNvcmQuaWQpO1xuICAgICAgXG4gICAgICBpZiAoIWV4aXN0cykge1xuICAgICAgICAgLy8gMS4gVXBkYXRlIHRoZSBsaXN0XG4gICAgICAgICBtdXRhYmxlIGF2YWlsYWJsZV9zdHVkaWVzLnB1c2gobmV3X3JlY29yZCk7XG4gICAgICAgICBtdXRhYmxlIGF2YWlsYWJsZV9zdHVkaWVzID0gbXV0YWJsZSBhdmFpbGFibGVfc3R1ZGllcztcbiAgICAgICAgIFxuICAgICAgICAgbXV0YWJsZSBsYXRlc3RfdXBsb2FkID0gbmV3X3JlY29yZDsgXG4gICAgICB9XG4gICAgICBjb25zb2xlLmxvZyhcIuKchSBMb2FkZWQ6XCIsIG5ld19yZWNvcmQubmFtZSk7XG4gICAgfVxuICB9XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTkiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJcbnN0dWR5X2RhdGFfcGF5bG9hZCA9IHtcbiAgY29uc3Qgc2VsZWN0aW9uID0gc2VsZWN0ZWRfc3R1ZHk7XG4gIGlmICghc2VsZWN0aW9uKSByZXR1cm4gbnVsbDtcblxuICBjb25zb2xlLmxvZyhcIvCflIQgUHJvY2Vzc2luZyBzZWxlY3Rpb246XCIsIHNlbGVjdGlvbi5uYW1lKTtcblxuICBpZiAoc2VsZWN0aW9uLnR5cGUgPT09IFwibG9jYWxcIikge1xuICAgIGNvbnNvbGUubG9nKFwi8J+RiSBNb2RlOiBMb2NhbFwiKTtcbiAgICByZXR1cm4ge1xuICAgICAgbW9kZTogXCJsb2NhbFwiLFxuICAgICAgLi4uc2VsZWN0aW9uXG4gICAgfTtcbiAgfVxuXG4gIGlmIChzZWxlY3Rpb24udHlwZSA9PT0gXCJyZW1vdGVcIikge1xuICAgIGNvbnNvbGUubG9nKFwi8J+RiSBNb2RlOiBSZW1vdGUgKEpTIEJyaWRnZSlcIik7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGNvbm4gPSBhd2FpdCBkdWNrX2RiX2NsaWVudDtcbiAgICAgIFxuICAgICAgY29uc3QgaGVhZGVyX3RhYmxlID0gYXdhaXQgY29ubi5xdWVyeShgU0VMRUNUICogRlJPTSAnJHtzZWxlY3Rpb24udXJsX2hlYWRlcn0nYCk7XG4gICAgICBcbiAgICAgIGNvbnN0IGhlYWRlcl9qc29uID0gaGVhZGVyX3RhYmxlLnRvQXJyYXkoKS5tYXAocm93ID0+IHJvdy50b0pTT04oKSk7XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKFwi4pyFIEhlYWRlciByZWNlaXZlZDpcIiwgaGVhZGVyX2pzb24pO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBtb2RlOiBcInJlbW90ZV9qc19icmlkZ2VcIixcbiAgICAgICAgaWQ6IHNlbGVjdGlvbi5pZCxcbiAgICAgICAgbmFtZTogc2VsZWN0aW9uLm5hbWUsXG4gICAgICAgIGhlYWRlcl9kYXRhOiBoZWFkZXJfanNvbixcbiAgICAgICAgdXJsX3BhaXJ3aXNlOiBzZWxlY3Rpb24udXJsX3BhaXJ3aXNlLFxuICAgICAgICB1cmxfbWV0YTogc2VsZWN0aW9uLnVybF9tZXRhLFxuICAgICAgICB1cmxfZW1tZWFuczogc2VsZWN0aW9uLnVybF9lbW1lYW5zLFxuICAgICAgICB1cmxfb3ZlcmxhcDogc2VsZWN0aW9uLnVybF9vdmVybGFwXG4gICAgICB9O1xuICAgICAgXG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgY29uc29sZS5lcnJvcihcIuKdjCBKUyBCcmlkZ2UgRXJyb3I6XCIsIGUpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEwIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiXG5jb250cmFzdHNfZnJvbV9qcyA9IHtcbiAgY29uc3QgcGF5bG9hZCA9IHN0dWR5X2RhdGFfcGF5bG9hZDtcbiAgaWYgKCFwYXlsb2FkIHx8IHBheWxvYWQubW9kZSA9PT0gXCJsb2NhbFwiKSByZXR1cm4gbnVsbDtcblxuICBpZiAocGF5bG9hZC5tb2RlID09PSBcInJlbW90ZV9qc19icmlkZ2VcIikge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjb25uID0gYXdhaXQgZHVja19kYl9jbGllbnQ7XG4gICAgICBcbiAgICAgIGNvbnN0IHF1ZXJ5ID0gYFNFTEVDVCBESVNUSU5DVCBcImNvbnRyYXN0XCIgRlJPTSAnJHtwYXlsb2FkLnVybF9wYWlyd2lzZX0nIE9SREVSIEJZIFwiY29udHJhc3RcImA7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb25uLnF1ZXJ5KHF1ZXJ5KTtcbiAgICAgIGNvbnN0IHJhd19saXN0ID0gcmVzdWx0LnRvQXJyYXkoKS5tYXAocm93ID0+IHJvdy5jb250cmFzdCk7XG4gICAgICBcbiAgICAgIGNvbnN0IGNsZWFuX2xpc3QgPSByYXdfbGlzdC5maWx0ZXIoZCA9PiAhZC5pbmNsdWRlcyhcIm90aGVyY3RfZXhwclwiKSk7XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKFwi4pyFIENvbnRyYXN0cyBmZXRjaGVkIChmaWx0ZXJlZCk6XCIsIGNsZWFuX2xpc3QpO1xuICAgICAgcmV0dXJuIGNsZWFuX2xpc3Q7XG4gICAgICBcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwi4p2MIEZhaWxlZCB0byBmZXRjaCBjb250cmFzdHM6XCIsIGUpO1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgfVxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlxudGVybXNfZnJvbV9qcyA9IHtcbiAgY29uc3QgcGF5bG9hZCA9IHN0dWR5X2RhdGFfcGF5bG9hZDtcbiAgaWYgKCFwYXlsb2FkIHx8IHBheWxvYWQubW9kZSA9PT0gXCJsb2NhbFwiKSByZXR1cm4gbnVsbDtcblxuICBpZiAocGF5bG9hZC5tb2RlID09PSBcInJlbW90ZV9qc19icmlkZ2VcIikge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjb25uID0gYXdhaXQgZHVja19kYl9jbGllbnQ7XG4gICAgICBcbiAgICAgIGNvbnN0IHF1ZXJ5ID0gYFNFTEVDVCBESVNUSU5DVCBcInRlcm1cIiBGUk9NICcke3BheWxvYWQudXJsX3BhaXJ3aXNlfScgT1JERVIgQlkgXCJ0ZXJtXCJgO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29ubi5xdWVyeShxdWVyeSk7XG4gICAgICBjb25zdCByYXdfbGlzdCA9IHJlc3VsdC50b0FycmF5KCkubWFwKHJvdyA9PiByb3cudGVybSk7XG4gICAgICBcbiAgICAgIGNvbnN0IGNsZWFuX2xpc3QgPSByYXdfbGlzdC5maWx0ZXIoZCA9PiAhZC5pbmNsdWRlcyhcIm90aGVyY3RfZXhwclwiKSk7XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKFwi4pyFIFRlcm1zIGZldGNoZWQgKGZpbHRlcmVkKTpcIiwgY2xlYW5fbGlzdCk7XG4gICAgICByZXR1cm4gY2xlYW5fbGlzdDtcbiAgICAgIFxuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCLinYwgRmFpbGVkIHRvIGZldGNoIHRlcm1zOlwiLCBlKTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gIH1cbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJcbnNsaWRlc19mcm9tX2pzID0ge1xuICBjb25zdCBwYXlsb2FkID0gc3R1ZHlfZGF0YV9wYXlsb2FkO1xuICBpZiAoIXBheWxvYWQgfHwgcGF5bG9hZC5tb2RlID09PSBcImxvY2FsXCIpIHJldHVybiBudWxsO1xuXG4gIGlmIChwYXlsb2FkLm1vZGUgPT09IFwicmVtb3RlX2pzX2JyaWRnZVwiKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGNvbm4gPSBhd2FpdCBkdWNrX2RiX2NsaWVudDtcblxuICAgICAgY29uc3QgcXVlcnkgPSBgU0VMRUNUIERJU1RJTkNUIFwic2xpZGVfaWRfbnVtZXJpY1wiIEZST00gJyR7cGF5bG9hZC51cmxfbWV0YX0nIE9SREVSIEJZIFwic2xpZGVfaWRfbnVtZXJpY1wiYDtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbm4ucXVlcnkocXVlcnkpO1xuICAgICAgY29uc3QgcmF3X2xpc3QgPSByZXN1bHQudG9BcnJheSgpLm1hcChyb3cgPT4gcm93LnNsaWRlX2lkX251bWVyaWMpO1xuICAgICAgXG4gICAgICBjb25zb2xlLmxvZyhcIuKchSBTbGlkZXMgZmV0Y2hlZCBcIiwgcmF3X2xpc3QpO1xuICAgICAgcmV0dXJuIHJhd19saXN0O1xuICAgICAgXG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgY29uc29sZS5lcnJvcihcIuKdjCBGYWlsZWQgdG8gZmV0Y2ggc2xpZGVzOlwiLCBlKTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gIH1cbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTMiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJcbntcbiAgY29uc3QgZGF0YSA9IHN0dWR5X2RhdGFfcGF5bG9hZDtcbiAgY29uc3QgY29udHJhc3QgPSBjb250cmFzdF9zZWxlY3Rpb247IFxuICBjb25zdCB2b2xjYW5vID0gY3VycmVudF92b2xjYW5vX2RhdGEgfHwgW107XG5cbiAgaWYgKCFkYXRhIHx8ICFkYXRhLmhlYWRlcl9kYXRhIHx8IGRhdGEuaGVhZGVyX2RhdGEubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuIG1kYF9XYWl0aW5nIGZvciBzdHVkeSBkYXRhLi4uX2A7XG4gIH1cblxuICBjb25zdCByb3cgPSBkYXRhLmhlYWRlcl9kYXRhWzBdO1xuICBcbiAgY29uc3QgcHJldHR5X2NvbnRyYXN0ID0gY29udHJhc3QgXG4gICAgPyBjb250cmFzdC5yZXBsYWNlKFwiIC8gXCIsIFwiIHZzLiBcIikgXG4gICAgOiBcIk5vbmUgc2VsZWN0ZWRcIjtcbiAgICBcbiAgY29uc3QgY291bnQgPSB2b2xjYW5vLmxlbmd0aCA/IHZvbGNhbm8ubGVuZ3RoLnRvTG9jYWxlU3RyaW5nKCkgOiBcIjBcIjtcblxuICByZXR1cm4gaHRtbGBcbiAgPGRpdiBzdHlsZT1cImZvbnQtc2l6ZTogMC45ZW07IGNvbG9yOiAjNDQ0O1wiPlxuICAgIFxuICAgIDxoNSBzdHlsZT1cInRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7IGNvbG9yOiAjODg4OyBmb250LXNpemU6IDAuOGVtOyBtYXJnaW4tYm90dG9tOiA0cHg7XCI+U3R1ZHkgRGVzY3JpcHRpb248L2g1PlxuICAgIDxwIHN0eWxlPVwibWFyZ2luLWJvdHRvbTogMTZweDtcIj4ke3Jvdy5EZXNjcmlwdGlvbiB8fCBcIk5vIGRlc2NyaXB0aW9uIGF2YWlsYWJsZS5cIn08L3A+XG4gICAgXG4gICAgPGg1IHN0eWxlPVwidGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsgY29sb3I6ICM4ODg7IGZvbnQtc2l6ZTogMC44ZW07IG1hcmdpbi1ib3R0b206IDRweDtcIj5Nb2RlbCBGb3JtdWxhPC9oNT5cbiAgICA8ZGl2IHN0eWxlPVwiYmFja2dyb3VuZDogI2Y0ZjRmNDsgcGFkZGluZzogOHB4OyBib3JkZXItcmFkaXVzOiA0cHg7IGZvbnQtZmFtaWx5OiBtb25vc3BhY2U7IGNvbG9yOiAjZDYzMzg0OyBtYXJnaW4tYm90dG9tOiAxNnB4O1wiPlxuICAgICAgJHtyb3cuRm9ybWFsYSB8fCBcIk5BXCJ9XG4gICAgPC9kaXY+XG4gICAgXG4gICAgPGRpdiBzdHlsZT1cImRpc3BsYXk6IGZsZXg7IGdhcDogMjBweDsgYm9yZGVyLXRvcDogMXB4IHNvbGlkICNlZWU7IHBhZGRpbmctdG9wOiAxMnB4O1wiPlxuICAgICAgPGRpdj5cbiAgICAgICAgPGg1IHN0eWxlPVwidGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsgY29sb3I6ICM4ODg7IGZvbnQtc2l6ZTogMC44ZW07IG1hcmdpbi1ib3R0b206IDRweDtcIj5TZWxlY3RlZCBDb250cmFzdDwvaDU+XG4gICAgICAgIDxkaXYgc3R5bGU9XCJmb250LXdlaWdodDogNTAwOyBjb2xvcjogIzAwN2JmZjtcIj4ke3ByZXR0eV9jb250cmFzdH08L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgICAgPGRpdj5cbiAgICAgICAgPGg1IHN0eWxlPVwidGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsgY29sb3I6ICM4ODg7IGZvbnQtc2l6ZTogMC44ZW07IG1hcmdpbi1ib3R0b206IDRweDtcIj5UYXJnZXRzIFRlc3RlZDwvaDU+XG4gICAgICAgIDxkaXYgc3R5bGU9XCJmb250LXdlaWdodDogYm9sZDtcIj4ke2NvdW50fTwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG5cbiAgPC9kaXY+XG4gIGA7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE0IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiXG52aWV3b2YgYWVzdGhldGljc19yYXcgPSBJbnB1dHMuZm9ybSh7XG4gIHZvbGNhbm9fZmNfcmFuZ2U6ICAgICAgSW5wdXRzLnJhbmdlKFswLCAxMF0sIHtzdGVwOiAwLjAwMSwgbGFiZWw6IFwiQWJzLiBsb2cyRkNcIiwgdmFsdWU6IDF9KSxcbiAgdm9sY2Fub19wdmFsX3RocmVzaG9sZDogSW5wdXRzLnJhbmdlKFswLCAxXSwge3N0ZXA6IDAuMDAwMDEsIGxhYmVsOiBcIlAtdmFsdWUgdGhyZXNob2xkXCIsIHZhbHVlOiAwLjA1fSksXG4gIHZvbGNhbm9fcHRfc2l6ZTogICAgICAgSW5wdXRzLnJhbmdlKFswLjEsIDVdLCB7c3RlcDogMC4xLCBsYWJlbDogXCJQdC4gU2l6ZVwifSksXG4gIHZvbGNhbm9fYWxwaGE6ICAgICAgICAgSW5wdXRzLnJhbmdlKFswLCAxXSwge3N0ZXA6IDAuMDEsIGxhYmVsOiBcIlB0LiBBbHBoYVwiLCB2YWx1ZTogMS4wfSksXG4gIFxuICB2b2xjYW5vX3B0X2NvbG9yOiAgICAgIElucHV0cy5jb2xvcih7bGFiZWw6IFwiUHQuIENvbG9yXCIsIHZhbHVlOiBcIiMzQzNGNDBcIn0pLFxuICB2b2xjYW5vX3NpZ19jb2xvcjogICAgIElucHV0cy5jb2xvcih7bGFiZWw6IFwiU2lnbmlmaWNhbnQgdGFyZ2V0c1wiLCB2YWx1ZTogXCIjYjQ0Njk3XCJ9KSxcbiAgXG4gIHZvbGNhbm9faGlnaF9mY19sYWJlbDogSW5wdXRzLnJhbmdlKFswLCAxMF0sIHtzdGVwOiAxLCBsYWJlbDogXCJMYWJlbCBoaWdoIEZDXCIsIHZhbHVlOiAzfSksXG4gIHZvbGNhbm9fbG93X2ZjX2xhYmVsOiAgSW5wdXRzLnJhbmdlKFswLCAxMF0sIHtzdGVwOiAxLCBsYWJlbDogXCJMYWJlbCBsb3cgRkNcIiwgdmFsdWU6IDN9KSxcbiAgdm9sY2Fub19wdmFsX2xhYmVsOiAgICBJbnB1dHMucmFuZ2UoWzAsIDEwXSwge3N0ZXA6IDEsIGxhYmVsOiBcIkxhYmVsIFNpZy5cIiwgdmFsdWU6IDN9KSxcbiAgdm9sY2Fub19pbmNsdWRlX3NlbGVjdGVkX2dlbmVzOiBJbnB1dHMucmFkaW8oW1wiWWVzXCIsIFwiTm9cIl0sIHtsYWJlbDogXCJMYWJlbCBzZWxlY3RlZD9cIiwgdmFsdWU6IFwiWWVzXCJ9KVxufSlcblxuYWVzdGhldGljc19kZWJvdW5jZWQgPSB7XG4gIGNvbnN0IHJhdyA9IGFlc3RoZXRpY3NfcmF3O1xuICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgY29uc3QgdGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHJlc29sdmUocmF3KSwgNjAwKTsgXG4gICAgaW52YWxpZGF0aW9uLnRoZW4oKCkgPT4gY2xlYXJUaW1lb3V0KHRpbWVyKSk7XG4gIH0pO1xufVxuXG52b2xjYW5vX2ZjX3JhbmdlICAgICAgPSBhZXN0aGV0aWNzX2RlYm91bmNlZC52b2xjYW5vX2ZjX3JhbmdlXG52b2xjYW5vX3B2YWxfdGhyZXNob2xkID0gYWVzdGhldGljc19kZWJvdW5jZWQudm9sY2Fub19wdmFsX3RocmVzaG9sZFxudm9sY2Fub19wdF9zaXplICAgICAgID0gYWVzdGhldGljc19kZWJvdW5jZWQudm9sY2Fub19wdF9zaXplXG52b2xjYW5vX2FscGhhICAgICAgICAgPSBhZXN0aGV0aWNzX2RlYm91bmNlZC52b2xjYW5vX2FscGhhXG52b2xjYW5vX3B0X2NvbG9yICAgICAgPSBhZXN0aGV0aWNzX2RlYm91bmNlZC52b2xjYW5vX3B0X2NvbG9yXG52b2xjYW5vX3NpZ19jb2xvciAgICAgPSBhZXN0aGV0aWNzX2RlYm91bmNlZC52b2xjYW5vX3NpZ19jb2xvclxudm9sY2Fub19oaWdoX2ZjX2xhYmVsID0gYWVzdGhldGljc19kZWJvdW5jZWQudm9sY2Fub19oaWdoX2ZjX2xhYmVsXG52b2xjYW5vX2xvd19mY19sYWJlbCAgPSBhZXN0aGV0aWNzX2RlYm91bmNlZC52b2xjYW5vX2xvd19mY19sYWJlbFxudm9sY2Fub19wdmFsX2xhYmVsICAgID0gYWVzdGhldGljc19kZWJvdW5jZWQudm9sY2Fub19wdmFsX2xhYmVsXG52b2xjYW5vX2luY2x1ZGVfc2VsZWN0ZWRfZ2VuZXMgPSBhZXN0aGV0aWNzX2RlYm91bmNlZC52b2xjYW5vX2luY2x1ZGVfc2VsZWN0ZWRfZ2VuZXNcblxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ilxudm9sY2Fub19kYXRhX2pzID0ge1xuICBjb25zdCBwYXlsb2FkID0gc3R1ZHlfZGF0YV9wYXlsb2FkO1xuICBjb25zdCBjb250cmFzdCA9IGNvbnRyYXN0X3NlbGVjdGlvbjtcbiAgY29uc3QgdGVybSA9IHRlcm1fc2VsZWN0aW9uO1xuICBcbiAgaWYgKCFwYXlsb2FkIHx8ICFjb250cmFzdCB8fCAhdGVybSB8fCBwYXlsb2FkLm1vZGUgPT09IFwibG9jYWxcIikgcmV0dXJuIG51bGw7XG5cbiAgaWYgKHBheWxvYWQubW9kZSA9PT0gXCJyZW1vdGVfanNfYnJpZGdlXCIpIHtcbiAgICBcbiAgICB0cnkge1xuICAgICAgY29uc3QgY29ubiA9IGF3YWl0IGR1Y2tfZGJfY2xpZW50O1xuXG4gICAgICBjb25zdCBxdWVyeSA9IGBcbiAgICAgICAgU0VMRUNUIHRlcm0sIGNvbnRyYXN0LCB0YXJnZXQsIGxvZzJmYywgXCJwLnZhbHVlXCIsIG5jZWxsc18xLCBuY2VsbHNfMlxuICAgICAgICBGUk9NICcke3BheWxvYWQudXJsX3BhaXJ3aXNlfScgXG4gICAgICAgIFdIRVJFIGNvbnRyYXN0ID0gJyR7Y29udHJhc3R9JyBBTkQgdGVybSA9ICcke3Rlcm19J1xuICAgICAgYDtcbiAgICAgIFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29ubi5xdWVyeShxdWVyeSk7XG4gICAgICBjb25zdCBkYXRhID0gcmVzdWx0LnRvQXJyYXkoKS5tYXAocm93ID0+IHJvdy50b0pTT04oKSk7XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKGDinIUgVm9sY2FubyBkYXRhIGZldGNoZWQgKCR7ZGF0YS5sZW5ndGh9IHJvd3MpYCk7XG4gICAgICByZXR1cm4gZGF0YTtcbiAgICAgIFxuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCLinYwgRmFpbGVkIHRvIGZldGNoIHZvbGNhbm8gZGF0YTpcIiwgZSk7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICB9XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE2IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidmlld29mIHBhaXJ3aXNlX3NlYXJjaCA9IElucHV0cy5zZWFyY2goY3VycmVudF92b2xjYW5vX2RhdGEsIHtwbGFjZWhvbGRlcjogXCJTZWFyY2ggUmVzdWx0c1wifSlcblxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ilxudmlld29mIHBhaXJ3aXNlX3RhYmxlID0gSW5wdXRzLnRhYmxlKHBhaXJ3aXNlX3NlYXJjaCwge1xuICBtdWx0aXBsZTogdHJ1ZSxcbiAgcm93czogMjAsXG4gIGZvcm1hdDoge1xuICAgIGxvZzJmYzogc3BhcmtiYXIoZDMubWF4KHBhaXJ3aXNlX3NlYXJjaCwgZCA9PiBkLmxvZzJmYykpXG4gIH19KVxuXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE4IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiXG4vLyBjYXB0dXJlcyBhbnkgc2VsZWN0ZWQgZ2VuZXMgKHVwIHRvIDMwKVxuc2VsZWN0ZWRfZ2VuZXMgPSB7XG4gIGlmICghY3VycmVudF92b2xjYW5vX2RhdGEgfHwgIXBhaXJ3aXNlX3RhYmxlKSByZXR1cm4gWydub3RhZ2VuZSddO1xuICBpZiAocGFpcndpc2VfdGFibGUubGVuZ3RoID09PSBjdXJyZW50X3ZvbGNhbm9fZGF0YSkge1xuICAgIHJldHVybiBbJ25vdGFnZW5lJ107XG4gIH1cbiAgaWYgKHBhaXJ3aXNlX3RhYmxlLmxlbmd0aCA+IDMwKSB7XG4gICAgcmV0dXJuIFsnbm90YWdlbmUnXTtcbiAgfVxuICByZXR1cm4gcGFpcndpc2VfdGFibGUubWFwKGQgPT4gZC50YXJnZXQpO1xufVxuXG5zZWxlY3Rpb25XYXJuaW5nID0ge1xuICAvLyAxLiBXYWl0IGZvciBkYXRhXG4gIGlmICghcGFpcndpc2VfdGFibGUgfHwgIWN1cnJlbnRfdm9sY2Fub19kYXRhKSByZXR1cm4gYFNlbGVjdCBiZXR3ZWVuIDEgYW5kIDMwIGdlbmVzIHRvIGxhYmVsLmA7XG5cbiAgY29uc3QgY291bnQgPSBwYWlyd2lzZV90YWJsZS5sZW5ndGg7XG4gIGNvbnN0IHRvdGFsID0gY3VycmVudF92b2xjYW5vX2RhdGEubGVuZ3RoO1xuICBjb25zdCBpc1NlbGVjdEFsbCA9IChjb3VudCA9PT0gdG90YWwpO1xuXG4gIGlmKGlzU2VsZWN0QWxsKXtcbiAgICByZXR1cm4gYFNlbGVjdCB1cCB0byAzMCBnZW5lcyB0byBsYWJlbCBpbiB0aGUgdm9sY2FubyBwbG90LmA7XG4gIH1cbiAgaWYgKGNvdW50ID4gMzApIHtcbiAgICByZXR1cm4gYOKaoO+4jyBUb28gbWFueSB0YXJnZXRzIHNlbGVjdGVkICgke2NvdW50fSkuIExpbWl0IGlzIDMwLmA7XG4gIH1cblxuICByZXR1cm4gYEN1cnJlbnRseSBzZWxlY3RlZDogJHtjb3VudH0gZ2VuZSR7Y291bnQgPT09IDEgPyAnJyA6ICdzJ30uYDtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTkiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJcbi8vIG11c3Qgb2NjdXIgYmVmb3JlIHZvbGNhbm8gcGxvdCBjYXJkXG52aWV3b2YgdGVybV9zZWxlY3Rpb24gPSB7XG4gIGlmICghYXZhaWxhYmxlX3Rlcm1zIHx8IGF2YWlsYWJsZV90ZXJtcy5sZW5ndGggPT09IDApIHJldHVybiBtZGBfTG9hZGluZyB0ZXJtcy4uLl9gO1xuXG4gIHJldHVybiBJbnB1dHMuc2VsZWN0KGF2YWlsYWJsZV90ZXJtcywge1xuICAgIGxhYmVsOiBcIkF2YWlsYWJsZSBUZXJtczpcIixcbiAgICBtdWx0aXBsZTogZmFsc2UsXG4gICAgc2l6ZTogM1xuICB9KTtcbn1cbnZpZXdvZiBjb250cmFzdF9zZWxlY3Rpb24gPSB7XG4gIGlmICghYXZhaWxhYmxlX2NvbnRyYXN0cyB8fCBhdmFpbGFibGVfY29udHJhc3RzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIG1kYF9Mb2FkaW5nIGNvbnRyYXN0cy4uLl9gO1xuXG4gIHJldHVybiBJbnB1dHMuc2VsZWN0KGF2YWlsYWJsZV9jb250cmFzdHMsIHtcbiAgICBsYWJlbDogXCJBdmFpbGFibGUgQ29udHJhc3RzOlwiLFxuICAgIGZvcm1hdDogZCA9PiBkLnJlcGxhY2UoXCIgLyBcIiwgXCIgdnMuIFwiKSxcbiAgICBtdWx0aXBsZTogZmFsc2UsXG4gICAgc2l6ZTogM1xuICB9KTtcbn1cblxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yMCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiBzYXZlX3NldHRpbmdzID0gSW5wdXRzLmZvcm0oe1xuICB3aWR0aDogIElucHV0cy5udW1iZXIoe2xhYmVsOiBcIldpZHRoXCIsIHZhbHVlOiA2LCBzdGVwOiAwLjV9KSxcbiAgaGVpZ2h0OiBJbnB1dHMubnVtYmVyKHtsYWJlbDogXCJIZWlnaHRcIiwgdmFsdWU6IDQsIHN0ZXA6IDAuNX0pLFxuICB1bml0czogIElucHV0cy5zZWxlY3QoW1wiaW5cIiwgXCJjbVwiLCBcIm1tXCIsIFwicHhcIl0sIHtsYWJlbDogXCJVbml0c1wiLCB2YWx1ZTogXCJpblwifSksXG4gIGZvcm1hdDogSW5wdXRzLnNlbGVjdChbXCJwbmdcIiwgXCJzdmdcIl0sIHtsYWJlbDogXCJGb3JtYXRcIiwgdmFsdWU6IFwicG5nXCJ9KVxufSlcbnZpZXdvZiBzYXZlX2J0biA9IElucHV0cy5idXR0b24oXCJEb3dubG9hZCBQbG90XCIsIHt2YWx1ZTogMCwgY29sb3I6IFwiIzJDM0U1MFwifSlcbnNhdmVfcmVxdWVzdCA9IHtcbiAgc2F2ZV9idG47IFxuICByZXR1cm4gc2F2ZV9zZXR0aW5ncztcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjEiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ7XG4gIGlmIChkb3dubG9hZGVkX2ZpbGUpIHtcbiAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW25ldyBVaW50OEFycmF5KGRvd25sb2FkZWRfZmlsZS5kYXRhKV0sIHsgdHlwZTogZG93bmxvYWRlZF9maWxlLm1pbWUgfSk7XG4gICAgXG4gICAgY29uc3QgdXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTtcbiAgICBjb25zdCBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFcIik7XG4gICAgYS5ocmVmID0gdXJsO1xuICAgIGEuZG93bmxvYWQgPSBkb3dubG9hZGVkX2ZpbGUuZmlsZW5hbWU7XG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhKTtcbiAgICBhLmNsaWNrKCk7XG4gICAgXG4gICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChhKTtcbiAgICBVUkwucmV2b2tlT2JqZWN0VVJMKHVybCk7XG4gIH1cbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJcbmF2YWlsYWJsZV9sZXZlbHMgPSB7XG4gIGNvbnN0IHBheWxvYWQgPSBzdHVkeV9kYXRhX3BheWxvYWQ7XG4gIGlmICghcGF5bG9hZCB8fCBwYXlsb2FkLm1vZGUgPT09IFwibG9jYWxcIikgcmV0dXJuIFtdO1xuICBcbiAgaWYgKHBheWxvYWQubW9kZSA9PT0gXCJyZW1vdGVfanNfYnJpZGdlXCIpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgY29ubiA9IGF3YWl0IGR1Y2tfZGJfY2xpZW50O1xuICAgICAgY29uc3QgcXVlcnkgPSBgU0VMRUNUIERJU1RJTkNUIGxldmVsIEZST00gJyR7cGF5bG9hZC51cmxfZW1tZWFuc30nIE9SREVSIEJZIGxldmVsYDtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbm4ucXVlcnkocXVlcnkpO1xuICAgICAgcmV0dXJuIHJlc3VsdC50b0FycmF5KCkubWFwKHJvdyA9PiByb3cubGV2ZWwpLmZpbHRlcih0ID0+ICF0LnN0YXJ0c1dpdGgoXCJvdGhlcmN0X1wiKSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgfVxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yMyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ilxudmlld29mIHRlcm1fY29weSA9IHtcbiAgXG4gIGlmICghYXZhaWxhYmxlX3Rlcm1zIHx8IGF2YWlsYWJsZV90ZXJtcy5sZW5ndGggPT09IDApIHJldHVybiBtZGBfTG9hZGluZy4uLl9gO1xuXG4gIGNvbnN0IG1pcnJvcl9pbnB1dCA9IElucHV0cy5zZWxlY3QoYXZhaWxhYmxlX3Rlcm1zLCB7XG4gICAgbGFiZWw6IFwiQXZhaWxhYmxlIFRlcm1zOlwiLFxuICAgIG11bHRpcGxlOiBmYWxzZSxcbiAgICBzaXplOiAzXG4gIH0pO1xuXG4gIHJldHVybiBJbnB1dHMuYmluZChtaXJyb3JfaW5wdXQsIHZpZXdvZiB0ZXJtX3NlbGVjdGlvbik7XG59XG5cbnZpZXdvZiBjb250cmFzdF9jb3B5ID0ge1xuXG4gIGlmICghYXZhaWxhYmxlX2NvbnRyYXN0cyB8fCBhdmFpbGFibGVfY29udHJhc3RzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIG1kYF9Mb2FkaW5nLi4uX2A7XG5cbiAgY29uc3QgbWlycm9yX2lucHV0ID0gSW5wdXRzLnNlbGVjdChhdmFpbGFibGVfY29udHJhc3RzLCB7XG4gICAgbGFiZWw6IFwiQXZhaWxhYmxlIENvbnRyYXN0czpcIixcbiAgICBmb3JtYXQ6IGQgPT4gZC5yZXBsYWNlKFwiIC8gXCIsIFwiIHZzLiBcIiksXG4gICAgbXVsdGlwbGU6IGZhbHNlLFxuICAgIHNpemU6IDNcbiAgfSk7XG5cbiAgcmV0dXJuIElucHV0cy5iaW5kKG1pcnJvcl9pbnB1dCwgdmlld29mIGNvbnRyYXN0X3NlbGVjdGlvbik7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTI0IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiXG52aWV3b2YgbWVhbnNfcmF3ID0gSW5wdXRzLmZvcm0oe1xuICBtZWFuc19oaWdobGlnaHQ6IElucHV0cy50ZXh0KHtsYWJlbDogXCJIaWdobGlnaHQgVGFyZ2V0OlwiLCBwbGFjZWhvbGRlcjogXCJlLmcuIEExQkcsQTFDRlwifSksXG4gIG1lYW5zX3Nob3dfbGFiZWxlZDogICAgICAgSW5wdXRzLnRvZ2dsZSh7bGFiZWw6IFwiQWxzbyBoaWdobGlnaHQgVm9sY2Fuby1sYWJlbGVkIEdlbmVzXCIsIHZhbHVlOiB0cnVlfSksXG4gIG1lYW5zX2FscGhhOiBJbnB1dHMucmFuZ2UoWzAuMSwgMV0sIHt2YWx1ZTogMC44LCBzdGVwOiAwLjEsIGxhYmVsOiBcIkRvdCBUcmFuc3BhcmVuY3lcIn0pLFxuICBtZWFuc19jb2xvcl8xOiBJbnB1dHMuY29sb3Ioe2xhYmVsOiBcIkxldmVsIDEgQ29sb3JcIiwgdmFsdWU6IFwiI2UxNTc1OVwifSksXG4gIG1lYW5zX2NvbG9yXzI6IElucHV0cy5jb2xvcih7bGFiZWw6IFwiTGV2ZWwgMiBDb2xvclwiLCB2YWx1ZTogXCIjNGU3OWE3XCJ9KVxufSlcblxubWVhbnNfZGVib3VuY2VkID0ge1xuICBjb25zdCByYXcgPSBtZWFuc19yYXc7XG4gIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcbiAgICBjb25zdCB0aW1lciA9IHNldFRpbWVvdXQoKCkgPT4gcmVzb2x2ZShyYXcpLCA2MDApOyBcbiAgICBpbnZhbGlkYXRpb24udGhlbigoKSA9PiBjbGVhclRpbWVvdXQodGltZXIpKTtcbiAgfSk7XG59XG5cbm1lYW5zX2hpZ2hsaWdodCAgICAgICA9IG1lYW5zX2RlYm91bmNlZC5tZWFuc19oaWdobGlnaHRcbm1lYW5zX3Nob3dfbGFiZWxlZCAgICA9IG1lYW5zX2RlYm91bmNlZC5tZWFuc19zaG93X2xhYmVsZWRcbm1lYW5zX2FscGhhICAgICAgICAgICA9IG1lYW5zX2RlYm91bmNlZC5tZWFuc19hbHBoYVxubWVhbnNfY29sb3JfMSAgICAgICAgID0gbWVhbnNfZGVib3VuY2VkLm1lYW5zX2NvbG9yXzFcbm1lYW5zX2NvbG9yXzIgICAgICAgICA9IG1lYW5zX2RlYm91bmNlZC5tZWFuc19jb2xvcl8yXG5cbmNvbWJpbmVkX3NlbGVjdGlvbiA9IHtcblxuICBjb25zdCBtYW51YWwgPSBtZWFuc19oaWdobGlnaHQgXG4gICAgPyBtZWFuc19oaWdobGlnaHQudG9VcHBlckNhc2UoKS5zcGxpdCgnLCcpLm1hcChzID0+IHMudHJpbSgpKS5maWx0ZXIocyA9PiBzLmxlbmd0aCA+IDApIFxuICAgIDogW107XG4gICAgXG4gIGxldCBmcm9tX3ZvbGNhbm8gPSBbXTtcbiAgaWYgKG1lYW5zX3Nob3dfbGFiZWxlZCAmJiB0eXBlb2YgdnBsb3RfbGFiZWxzICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICBpZihBcnJheS5pc0FycmF5KHZwbG90X2xhYmVscykpIHtcbiAgICAgICAgZnJvbV92b2xjYW5vID0gdnBsb3RfbGFiZWxzO1xuICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdnBsb3RfbGFiZWxzID09PSAnc3RyaW5nJykge1xuICAgICAgICBmcm9tX3ZvbGNhbm8gPSBbdnBsb3RfbGFiZWxzXTtcbiAgICAgIH1cbiAgfVxuICBcbiAgcmV0dXJuIEFycmF5LmZyb20obmV3IFNldChbLi4ubWFudWFsLCAuLi5mcm9tX3ZvbGNhbm9dKSk7XG59XG5tZWFuc19sZXZlbCA9IHtcbiAgY29uc3QgY29udHJhc3QgPSBjb250cmFzdF9zZWxlY3Rpb247XG4gIGlmICghY29udHJhc3QpIHJldHVybiBbXTtcblxuICByZXR1cm4gY29udHJhc3Quc3BsaXQoL1xcL3x2c1xcLi8pLm1hcChzID0+IHMudHJpbSgpKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjUiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJcbntcblxuICBpZiAoIW1lYW5zX3NlYXJjaCB8fCBtZWFuc19zZWFyY2gubGVuZ3RoID09PSAwKSB7XG4gICAgeWllbGQgaHRtbGA8ZGl2IHN0eWxlPVwiaGVpZ2h0OjQwMHB4OyBkaXNwbGF5OmZsZXg7IGFsaWduLWl0ZW1zOmNlbnRlcjsganVzdGlmeS1jb250ZW50OmNlbnRlcjsgYmFja2dyb3VuZDojZjlmOWY5OyBib3JkZXI6MXB4IGJvcmRlci1yYWRpdXM6OHB4O1wiPlxuICAgICAgPHAgc3R5bGU9XCJjb2xvcjojODg4O1wiPlNlbGVjdCBsZXZlbHMgaW4gdGhlIHNpZGViYXIgdG8gdmlzdWFsaXplLi4uPC9wPlxuICAgIDwvZGl2PmA7XG4gIH0gZWxzZSB7XG5cbiAgICBjb25zdCBjb2xvclNjYWxlID0gZDMuc2NoZW1lVGFibGVhdTEwO1xuICAgIFxuICAgIGxldCB0YWJsZV90YXJnZXRzID0gW107XG4gICAgXG4gICAgaWYgKHR5cGVvZiBtZWFuc190YWJsZSAhPT0gXCJ1bmRlZmluZWRcIiAmJiBtZWFuc190YWJsZSAmJiBtZWFuc19zZWFyY2gpIHtcbiAgICAgICAgaWYgKG1lYW5zX3RhYmxlLmxlbmd0aCAhPT0gbWVhbnNfc2VhcmNoLmxlbmd0aCkge1xuICAgICAgICAgIHRhYmxlX3RhcmdldHMgPSBtZWFuc190YWJsZS5tYXAoZCA9PiBkLnRhcmdldCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgY29uc3QgbWFudWFsX3RhcmdldHMgPSBjb21iaW5lZF9zZWxlY3Rpb24gfHwgW107XG4gICAgXG4gICAgY29uc3QgaGlnaGxpZ2h0X2xpc3QgPSBBcnJheS5mcm9tKG5ldyBTZXQoWy4uLnRhYmxlX3RhcmdldHMsIC4uLm1hbnVhbF90YXJnZXRzXSkpO1xuICAgIFxuICAgIGNvbnN0IHRhcmdldEdyb3VwcyA9IGQzLmdyb3VwcyhtZWFuc19zZWFyY2gsIGQgPT4gZC50YXJnZXQpO1xuICAgIFxuICAgIGNvbnN0IGxldmVscyA9IFsuLi5uZXcgU2V0KG1lYW5zX3NlYXJjaC5tYXAoZCA9PiBkLmxldmVsKSldLnNvcnQoKTtcblxuICAgIGNvbnN0IHRyYWNlcyA9IFtdO1xuXG4gICAgY29uc3QgYWxwaGFfc2NhbGVyID0gbWVhbnNfYWxwaGE7XG4gICAgY29uc3QgbGluZV9zZWdtZW50c19oaWdoID0geyB4OiBbXSwgeTogW10sIGhvdmVyaW5mbzogJ3NraXAnLCBzaG93bGVnZW5kOiBmYWxzZSwgbW9kZTogJ2xpbmVzJywgbGluZToge2NvbG9yOiAnIzg4OCcsIHdpZHRoOiAxLjV9LCBvcGFjaXR5OiAwLjggKiBhbHBoYV9zY2FsZXIsIHR5cGU6ICdzY2F0dGVyJyB9OyBcbiAgICBjb25zdCBsaW5lX3NlZ21lbnRzX21lZCAgPSB7IHg6IFtdLCB5OiBbXSwgaG92ZXJpbmZvOiAnc2tpcCcsIHNob3dsZWdlbmQ6IGZhbHNlLCBtb2RlOiAnbGluZXMnLCBsaW5lOiB7Y29sb3I6ICcjODg4Jywgd2lkdGg6IDF9LCBvcGFjaXR5OiAwLjQgKiBhbHBoYV9zY2FsZXIsIHR5cGU6ICdzY2F0dGVyJyB9O1xuICAgIGNvbnN0IGxpbmVfc2VnbWVudHNfbG93ICA9IHsgeDogW10sIHk6IFtdLCBob3ZlcmluZm86ICdza2lwJywgc2hvd2xlZ2VuZDogZmFsc2UsIG1vZGU6ICdsaW5lcycsIGxpbmU6IHtjb2xvcjogJyNjY2MnLCB3aWR0aDogMX0sIG9wYWNpdHk6IDAuMyAqIGFscGhhX3NjYWxlciwgdHlwZTogJ3NjYXR0ZXInIH07XG5cbiAgICB0YXJnZXRHcm91cHMuZm9yRWFjaCgoW3RhcmdldCwgdmFsdWVzXSkgPT4ge1xuICAgICAgaWYodmFsdWVzLmxlbmd0aCA8IDIpIHJldHVybjtcbiAgICAgIFxuICAgICAgY29uc3QgdjEgPSB2YWx1ZXNbMF07XG4gICAgICBjb25zdCB4ID0gdjEubG9nMmZjO1xuICAgICAgaWYoeCA9PSBudWxsIHx8IGlzTmFOKHgpKSByZXR1cm47XG5cbiAgICAgIC8vIFRyYW5zZm9ybSBSZXNwb25zZSB0byBMb2cyIGZvciBZLWF4aXNcbiAgICAgIGNvbnN0IHlzID0gdmFsdWVzLm1hcChkID0+IE1hdGgubG9nMihkLnJlc3BvbnNlKSk7IFxuICAgICAgXG4gICAgICBjb25zdCBtaW5feSA9IE1hdGgubWluKC4uLnlzKTtcbiAgICAgIGNvbnN0IG1heF95ID0gTWF0aC5tYXgoLi4ueXMpO1xuICAgICAgXG4gICAgICBjb25zdCB2YWxfcCA9IHYxW1wicC52YWx1ZVwiXTtcbiAgICAgIGNvbnN0IHAgPSB2YWxfcCAhPSBudWxsID8gdmFsX3AgOiAxO1xuICAgICAgXG4gICAgICBsZXQgc2VnID0gbGluZV9zZWdtZW50c19sb3c7XG4gICAgICBpZihwIDwgMC4wMDEpIHNlZyA9IGxpbmVfc2VnbWVudHNfaGlnaDtcbiAgICAgIGVsc2UgaWYocCA8IDAuMDUpIHNlZyA9IGxpbmVfc2VnbWVudHNfbWVkO1xuICAgICAgXG4gICAgICBzZWcueC5wdXNoKHgsIHgsIG51bGwpO1xuICAgICAgc2VnLnkucHVzaChtaW5feSwgbWF4X3ksIG51bGwpO1xuICAgIH0pO1xuXG4gICAgdHJhY2VzLnB1c2gobGluZV9zZWdtZW50c19sb3csIGxpbmVfc2VnbWVudHNfbWVkLCBsaW5lX3NlZ21lbnRzX2hpZ2gpO1xuXG4gICAgbGV2ZWxzLmZvckVhY2goKGx2bCwgaSkgPT4ge1xuICAgICAgICBjb25zdCBjb2xvciA9IChpID09PSAwKSA/IG1lYW5zX2NvbG9yXzEgOiBtZWFuc19jb2xvcl8yOyBcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGx2bF90cmFjZSA9IHtcbiAgICAgICAgICB4OiBbXSwgeTogW10sIHRleHQ6IFtdLCBpZHM6IFtdLFxuICAgICAgICAgIG1vZGU6ICdtYXJrZXJzJyxcbiAgICAgICAgICB0eXBlOiAnc2NhdHRlcicsXG4gICAgICAgICAgbmFtZTogbHZsLCBcbiAgICAgICAgICBtYXJrZXI6IHsgY29sb3I6IGNvbG9yLCBzaXplOiA2LCBvcGFjaXR5OiBtZWFuc19hbHBoYSB9LFxuICAgICAgICAgIGVycm9yX3k6IHtcbiAgICAgICAgICAgIHR5cGU6ICdkYXRhJywgc3ltbWV0cmljOiBmYWxzZSwgYXJyYXk6IFtdLCBhcnJheW1pbnVzOiBbXSxcbiAgICAgICAgICAgIHZpc2libGU6IHRydWUsIGNvbG9yOiBjb2xvciwgdGhpY2tuZXNzOiAxLCB3aWR0aDogMiwgb3BhY2l0eTogMC42XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IGx2bERhdGEgPSBtZWFuc19zZWFyY2guZmlsdGVyKGQgPT4gZC5sZXZlbCA9PT0gbHZsKTtcbiAgICAgICAgXG4gICAgICAgIGx2bERhdGEuZm9yRWFjaChkID0+IHtcbiAgICAgICAgICAgaWYgKGQubG9nMmZjID09IG51bGwgfHwgaXNOYU4oZC5sb2cyZmMpKSByZXR1cm47XG4gICAgICAgICAgIFxuICAgICAgICAgICAvLyBMb2cyIFRyYW5zZm9ybWF0aW9uXG4gICAgICAgICAgIGNvbnN0IHlfbG9nID0gTWF0aC5sb2cyKGQucmVzcG9uc2UpO1xuICAgICAgICAgICBjb25zdCB1Y2xfbG9nID0gTWF0aC5sb2cyKGQuVUNMKTtcbiAgICAgICAgICAgY29uc3QgbGNsX2xvZyA9IE1hdGgubG9nMihkLkxDTCk7XG5cbiAgICAgICAgICAgbHZsX3RyYWNlLngucHVzaChkLmxvZzJmYyk7XG4gICAgICAgICAgIGx2bF90cmFjZS55LnB1c2goeV9sb2cpO1xuICAgICAgICAgICBsdmxfdHJhY2UudGV4dC5wdXNoKGA8Yj4ke2QudGFyZ2V0fTwvYj48YnI+TGV2ZWw6ICR7ZC5sZXZlbH08YnI+TG9nMiBSZXNwOiAke3lfbG9nLnRvRml4ZWQoMil9PGJyPkZDOiAke2QubG9nMmZjLnRvRml4ZWQoMil9YCk7XG4gICAgICAgICAgIGx2bF90cmFjZS5pZHMucHVzaChgJHtkLnRhcmdldH1fJHtkLmxldmVsfWApO1xuICAgICAgICAgICBcbiAgICAgICAgICAgbHZsX3RyYWNlLmVycm9yX3kuYXJyYXkucHVzaCh1Y2xfbG9nIC0geV9sb2cpO1xuICAgICAgICAgICBsdmxfdHJhY2UuZXJyb3JfeS5hcnJheW1pbnVzLnB1c2goeV9sb2cgLSBsY2xfbG9nKTtcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICB0cmFjZXMucHVzaChsdmxfdHJhY2UpO1xuICAgIH0pO1xuXG4gICAgaWYoaGlnaGxpZ2h0X2xpc3QubGVuZ3RoID4gMCkge1xuICAgICAgIGNvbnN0IGhpZ2hsaWdodERhdGEgPSBtZWFuc19zZWFyY2guZmlsdGVyKGQgPT4gaGlnaGxpZ2h0X2xpc3QuaW5jbHVkZXMoZC50YXJnZXQpICYmIGQubG9nMmZjICE9IG51bGwpO1xuICAgICAgIFxuICAgICAgICB0cmFjZXMucHVzaCh7XG4gICAgICAgIHg6IGhpZ2hsaWdodERhdGEubWFwKGQgPT4gZC5sb2cyZmMpLFxuICAgICAgICB5OiBoaWdobGlnaHREYXRhLm1hcChkID0+IE1hdGgubG9nMihkLnJlc3BvbnNlKSksXG4gICAgICAgIG1vZGU6ICdtYXJrZXJzK3RleHQnLFxuICAgICAgICB0eXBlOiAnc2NhdHRlcicsIFxuICAgICAgICBuYW1lOiAnSGlnaGxpZ2h0cycsXG4gICAgICAgIHRleHQ6IGhpZ2hsaWdodERhdGEubWFwKGQgPT4gZC50YXJnZXQpLFxuICAgICAgICB0ZXh0cG9zaXRpb246ICd0b3AgY2VudGVyJyxcbiAgICAgICAgdGV4dGZvbnQ6IHsgY29sb3I6ICdibGFjaycsIHNpemU6IDExLCB3ZWlnaHQ6ICdib2xkJyB9LFxuICAgICAgICBtYXJrZXI6IHsgY29sb3I6ICdibGFjaycsIHNpemU6IDEwLCBzeW1ib2w6ICdjaXJjbGUtb3BlbicsIGxpbmU6IHt3aWR0aDogMn0gfSxcbiAgICAgICAgaG92ZXJpbmZvOiAnc2tpcCcsXG4gICAgICAgIGNsaXBvbmF4aXM6IGZhbHNlXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBjb25zdCBsYXlvdXQgPSB7XG4gICAgICBoZWlnaHQ6IDUwMCxcbiAgICAgIG1hcmdpbjogeyB0OiAzMCwgYjogNTAsIGw6IDYwLCByOiAyMCB9LFxuICAgICAgaG92ZXJtb2RlOiAnY2xvc2VzdCcsXG4gICAgICB0aXRsZTogeyB0ZXh0OiAnTWFyZ2luYWwgTWVhbnMgdnMgRm9sZCBDaGFuZ2UnLCBmb250OiB7c2l6ZTogMTR9IH0sXG4gICAgICB4YXhpczogeyBcbiAgICAgICAgdGl0bGU6ICdMb2cyIEZvbGQgQ2hhbmdlIChDb250cmFzdCknLCBcbiAgICAgICAgemVyb2xpbmU6IHRydWUsIFxuICAgICAgICB6ZXJvbGluZWNvbG9yOiAnI2VlZScsXG4gICAgICAgIGdyaWRjb2xvcjogJyNmOWY5ZjknXG4gICAgICB9LFxuICAgICAgeWF4aXM6IHsgXG4gICAgICAgIHRpdGxlOiAnTG9nMiBFeHByZXNzaW9uIChSZXNwb25zZSknLCBcbiAgICAgICAgZ3JpZGNvbG9yOiAnI2Y5ZjlmOScsXG4gICAgICAgIHplcm9saW5lOiBmYWxzZVxuICAgICAgfSxcbiAgICAgIGxlZ2VuZDogeyBvcmllbnRhdGlvbjogJ2gnLCB5OiAtMC4xNSB9LFxuICAgICAgc2hvd2xlZ2VuZDogdHJ1ZVxuICAgIH07XG5cbiAgICBjb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIFBsb3RseS5uZXdQbG90KGRpdiwgdHJhY2VzLCBsYXlvdXQsIHsgcmVzcG9uc2l2ZTogdHJ1ZSwgZGlzcGxheU1vZGVCYXI6IHRydWUgfSk7XG4gICAgeWllbGQgZGl2O1xuICB9XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTI2IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidmlld29mIG1lYW5zX3NlYXJjaCA9IElucHV0cy5zZWFyY2goY3VycmVudF9tZWFuc19kYXRhLCB7cGxhY2Vob2xkZXI6IFwiQWRkaXRpb25hbCBUYXJnZXQgRmlsdGVyaW5nXCJ9KVxuXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTI3IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiXG52aWV3b2YgbWVhbnNfdGFibGUgPSBJbnB1dHMudGFibGUobWVhbnNfc2VhcmNoLCB7XG4gIG11bHRpcGxlOiB0cnVlLFxuICB2YWx1ZTogY29tYmluZWRfc2VsZWN0aW9uLCAvLyBQcmUtY2hlY2sgdGhlIGNvbWJpbmVkIHNlbGVjdGlvblxuICByb3dzOiAyMCxcbiAgZm9ybWF0OiB7XG4gICAgcmVzcG9uc2U6IHNwYXJrYmFyKGQzLm1heChtZWFuc19zZWFyY2gsIGQgPT4gZC5yZXNwb25zZSkpXG4gIH19KVxuXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTI4IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibWVhbnNfZGF0YV9qcyA9IHtcbiAgY29uc3QgcGF5bG9hZCA9IHN0dWR5X2RhdGFfcGF5bG9hZDtcbiAgY29uc3QgbHZsID0gbWVhbnNfbGV2ZWw7IFxuICBcbiAgaWYgKCFwYXlsb2FkIHx8ICFsdmwgfHwgbHZsLmxlbmd0aCA9PT0gMCB8fCBwYXlsb2FkLm1vZGUgPT09IFwibG9jYWxcIikgcmV0dXJuIG51bGw7XG5cbiAgaWYgKHBheWxvYWQubW9kZSA9PT0gXCJyZW1vdGVfanNfYnJpZGdlXCIpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgY29ubiA9IGF3YWl0IGR1Y2tfZGJfY2xpZW50O1xuXG4gICAgICBjb25zdCBmb3JtYXR0ZWRMZXZlbHMgPSBsdmwubWFwKGQgPT4gYCcke2R9J2ApLmpvaW4oJywnKTtcblxuICAgICAgY29uc3QgcXVlcnkgPSBgXG4gICAgICAgIFNFTEVDVCBsZXZlbCwgdGFyZ2V0LCByZXNwb25zZSwgXCJhc3ltcC5MQ0xcIiBhcyBMQ0wsIFwiYXN5bXAuVUNMXCIgYXMgVUNMXG4gICAgICAgIEZST00gJyR7cGF5bG9hZC51cmxfZW1tZWFuc30nIFxuICAgICAgICBXSEVSRSBsZXZlbCBJTiAoJHtmb3JtYXR0ZWRMZXZlbHN9KVxuICAgICAgYDtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29ubi5xdWVyeShxdWVyeSk7XG4gICAgICByZXR1cm4gcmVzdWx0LnRvQXJyYXkoKS5tYXAocm93ID0+IHJvdy50b0pTT04oKSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgY29uc29sZS5lcnJvcihcIk1lYW4gRmV0Y2ggRXJyb3I6XCIsIGUpO1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgfVxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yOSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiBzcGF0aWFsX29wdGlvbnMgPSBJbnB1dHMuZm9ybSh7XG4gIHB0X3NpemU6ICAgIElucHV0cy5yYW5nZShbMC41LCAxMF0sIHt2YWx1ZTogMiwgc3RlcDogMC41LCBsYWJlbDogXCJQb2ludCBTaXplXCJ9KSxcbiAgcHRfb3BhY2l0eTogSW5wdXRzLnJhbmdlKFswLjEsIDFdLCB7dmFsdWU6IDAuNywgc3RlcDogMC4xLCBsYWJlbDogXCJPcGFjaXR5XCJ9KSxcbiAgYmdfY29sb3I6ICAgSW5wdXRzLmNvbG9yKHtsYWJlbDogXCJCYWNrZ3JvdW5kIENvbG9yXCIsIHZhbHVlOiBcIiNlMGUwZTBcIn0pLFxuICBcbiAgLy8gU2NhbGUgQmFyXG4gIHNjYWxlX2xlbjogICBJbnB1dHMubnVtYmVyKHtsYWJlbDogXCJTY2FsZSBCYXIgKG1tKVwiLCB2YWx1ZTogMSwgc3RlcDogMC4xfSksXG4gIHNjYWxlX2NvbG9yOiBJbnB1dHMuY29sb3Ioe2xhYmVsOiBcIlNjYWxlIENvbG9yXCIsIHZhbHVlOiBcIiMwMDAwMDBcIn0pLFxuICBzaG93X3NjYWxlOiAgSW5wdXRzLnRvZ2dsZSh7bGFiZWw6IFwiU2hvdyBTY2FsZSBCYXJcIiwgdmFsdWU6IHRydWV9KVxufSlcblxudmlld29mIGxvZ19zY2FsZV9vcHQgPSB7XG4gIGlmKCFzcGF0aWFsX2RhdGEgfHwgc3BhdGlhbF9kYXRhLmxlbmd0aCA9PT0gMCkgcmV0dXJuIG1kYGA7XG4gIFxuICBjb25zdCB2YWwgPSBzcGF0aWFsX2RhdGFbMF0uZ3JvdXBfaWQ7XG4gIFxuICBpZiAodHlwZW9mIHZhbCA9PT0gJ251bWJlcicpIHtcbiAgICByZXR1cm4gSW5wdXRzLnRvZ2dsZSh7bGFiZWw6IFwiTG9nIFNjYWxlIENvbG9yIChuKzEpXCIsIHZhbHVlOiBmYWxzZX0pO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBJbnB1dHMudG9nZ2xlKHtsYWJlbDogXCJMb2cgU2NhbGUgQ29sb3IgKG4rMSlcIiwgdmFsdWU6IGZhbHNlLCBkaXNhYmxlZDogdHJ1ZX0pO1xuICB9XG59XG5cbnNwYXRpYWxfY29sb3JzID0ge1xuICAgcmV0dXJuIHtcbiAgICAgbDE6IG1lYW5zX2NvbG9yXzEgfHwgXCIjZTE1NzU5XCIsXG4gICAgIGwyOiBtZWFuc19jb2xvcl8yIHx8IFwiIzRlNzlhN1wiLFxuICAgICBvdGhlcjogc3BhdGlhbF9vcHRpb25zLmJnX2NvbG9yXG4gICB9XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTMwIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gMS4gQ29sdW1uIFNlbGVjdGlvblxudmlld29mIGZpbHRlcl9jb2wgPSBJbnB1dHMuc2VsZWN0KHNwYXRpYWxfbWV0YV9jb2x1bW5zLCB7bGFiZWw6IFwiRmlsdGVyIEJ5OlwiLCB2YWx1ZTogbnVsbCwgbXVsdGlwbGU6IGZhbHNlfSlcblxuaXNfbnVtZXJpY19maWx0ZXIgPSB7XG4gIGlmKCFzcGF0aWFsX2RhdGEgfHwgIWZpbHRlcl9jb2wpIHJldHVybiBmYWxzZTtcbiAgY29uc3QgdmFsID0gc3BhdGlhbF9kYXRhWzBdW2ZpbHRlcl9jb2xdO1xuICByZXR1cm4gdHlwZW9mIHZhbCA9PT0gJ251bWJlcic7XG59XG5cbnZpZXdvZiBmaWx0ZXJfdmFscyA9IHtcbiAgaWYoIWZpbHRlcl9jb2wgfHwgIXNwYXRpYWxfZGF0YSkgcmV0dXJuIG1kYF9TZWxlY3QgYSBjb2x1bW4uLi5fYDtcbiAgXG4gIGlmIChpc19udW1lcmljX2ZpbHRlcikge1xuXG4gICAgY29uc3QgZXh0ZW50ID0gZDMuZXh0ZW50KHNwYXRpYWxfZGF0YSwgZCA9PiBkW2ZpbHRlcl9jb2xdKTtcbiAgICBcbiAgICByZXR1cm4gSW5wdXRzLmZvcm0oe1xuICAgICAgbWluOiBJbnB1dHMubnVtYmVyKHtsYWJlbDogXCJNaW5cIiwgdmFsdWU6IGV4dGVudFswXX0pLFxuICAgICAgbWF4OiBJbnB1dHMubnVtYmVyKHtsYWJlbDogXCJNYXhcIiwgdmFsdWU6IGV4dGVudFsxXX0pXG4gICAgfSk7XG4gICAgXG4gIH0gZWxzZSB7XG5cbiAgICBjb25zdCB1bmlxdWVfdmFscyA9IFsuLi5uZXcgU2V0KHNwYXRpYWxfZGF0YS5tYXAoZCA9PiBkW2ZpbHRlcl9jb2xdKSldLnNvcnQoKTtcbiAgICBcbiAgICByZXR1cm4gSW5wdXRzLnNlbGVjdCh1bmlxdWVfdmFscywge1xuICAgICAgbGFiZWw6IFwiSW5jbHVkZSBWYWx1ZXM6XCIsIFxuICAgICAgbXVsdGlwbGU6IHRydWUsXG4gICAgICBzb3J0OiB0cnVlLFxuICAgICAgdW5pcXVlOiB0cnVlXG4gICAgfSk7XG4gIH1cbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMzEiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJtZGBcbi0gKipUb3RhbCBMb2FkZWQqKjogJHtzcGF0aWFsX2RhdGEgPyBzcGF0aWFsX2RhdGEubGVuZ3RoLnRvTG9jYWxlU3RyaW5nKCkgOiBcIi4uLlwifVxuLSAqKlZpc2libGUqKjogJHtzcGF0aWFsX2ZpbHRlcmVkID8gc3BhdGlhbF9maWx0ZXJlZC5sZW5ndGgudG9Mb2NhbGVTdHJpbmcoKSA6IFwiLi4uXCJ9XG5gXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTMyIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiXG52aWV3b2Ygc2xpZGVfc2VsZWN0aW9uID0ge1xuICBpZiAoIWF2YWlsYWJsZV9zbGlkZXMgfHwgYXZhaWxhYmxlX3NsaWRlcy5sZW5ndGggPT09IDApIHJldHVybiBtZGBfTG9hZGluZyBzbGlkZXMuLi5fYDtcblxuICByZXR1cm4gSW5wdXRzLnNlbGVjdChhdmFpbGFibGVfc2xpZGVzLCB7XG4gICAgbGFiZWw6IFwiQXZhaWxhYmxlIFNsaWRlczpcIixcbiAgICBtdWx0aXBsZTogZmFsc2UsXG4gICAgc2l6ZTogM1xuICB9KTtcbn1cblxudmlld29mIHRlcm1fY29weTIgPSB7XG4gIFxuICBpZiAoIWF2YWlsYWJsZV90ZXJtcyB8fCBhdmFpbGFibGVfdGVybXMubGVuZ3RoID09PSAwKSByZXR1cm4gbWRgX0xvYWRpbmcuLi5fYDtcblxuICBjb25zdCBtaXJyb3JfaW5wdXQzID0gSW5wdXRzLnNlbGVjdChhdmFpbGFibGVfdGVybXMsIHtcbiAgICBsYWJlbDogXCJBdmFpbGFibGUgVGVybXM6XCIsXG4gICAgbXVsdGlwbGU6IGZhbHNlLFxuICAgIHNpemU6IDNcbiAgfSk7XG5cbiAgcmV0dXJuIElucHV0cy5iaW5kKG1pcnJvcl9pbnB1dDMsIHZpZXdvZiB0ZXJtX3NlbGVjdGlvbik7XG59XG5cbnZpZXdvZiBjb250cmFzdF9jb3B5MiA9IHtcbiAgaWYgKCFhdmFpbGFibGVfY29udHJhc3RzIHx8IGF2YWlsYWJsZV9jb250cmFzdHMubGVuZ3RoID09PSAwKSByZXR1cm4gbWRgX0xvYWRpbmcuLi5fYDtcblxuICBjb25zdCBtaXJyb3JfaW5wdXQyID0gSW5wdXRzLnNlbGVjdChhdmFpbGFibGVfY29udHJhc3RzLCB7XG4gICAgbGFiZWw6IFwiQXZhaWxhYmxlIENvbnRyYXN0czpcIixcbiAgICBmb3JtYXQ6IGQgPT4gZC5yZXBsYWNlKFwiIC8gXCIsIFwiIHZzLiBcIiksXG4gICAgbXVsdGlwbGU6IGZhbHNlLFxuICAgIHNpemU6IDNcbiAgfSk7XG5cbiAgcmV0dXJuIElucHV0cy5iaW5kKG1pcnJvcl9pbnB1dDIsIHZpZXdvZiBjb250cmFzdF9zZWxlY3Rpb24pO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0zMyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIDIuIEZldGNoIFNwYXRpYWwgRGF0YSAoRmlsdGVyZWQgYnkgU2xpZGUpXG5zcGF0aWFsX2RhdGEgPSB7XG4gIGNvbnN0IHBheWxvYWQgPSBzdHVkeV9kYXRhX3BheWxvYWQ7XG4gIGNvbnN0IHRlcm0gPSB0ZXJtX3NlbGVjdGlvbjtcbiAgY29uc3Qgc2xpZGUgPSBzbGlkZV9zZWxlY3Rpb247IFxuICBcbiAgaWYgKCFwYXlsb2FkIHx8ICF0ZXJtIHx8IHNsaWRlID09PSBudWxsIHx8IHR5cGVvZiBzbGlkZSA9PT0gXCJ1bmRlZmluZWRcIikgcmV0dXJuIG51bGw7XG5cbiAgaWYgKHBheWxvYWQubW9kZSA9PT0gXCJyZW1vdGVfanNfYnJpZGdlXCIpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgY29ubiA9IGF3YWl0IGR1Y2tfZGJfY2xpZW50O1xuXG4gICAgICBjb25zdCBjaGVjayA9IGF3YWl0IGNvbm4ucXVlcnkoYFNFTEVDVCBjb3VudCgqKSBhcyBuIEZST00gJyR7cGF5bG9hZC51cmxfbWV0YX0nIFdIRVJFIHNsaWRlX2lkX251bWVyaWMgPSAke3NsaWRlfWApO1xuICAgICAgaWYgKGNoZWNrLnRvQXJyYXkoKVswXS5uID09PSAwKSByZXR1cm4gbnVsbDtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29ubi5xdWVyeShgU0VMRUNUICogRlJPTSAnJHtwYXlsb2FkLnVybF9tZXRhfScgV0hFUkUgc2xpZGVfaWRfbnVtZXJpYyA9ICR7c2xpZGV9YCk7XG4gICAgICBjb25zdCByb3dzID0gcmVzdWx0LnRvQXJyYXkoKS5tYXAocm93ID0+IHJvdy50b0pTT04oKSk7XG5cbiAgICAgIHJvd3MuZm9yRWFjaChyID0+IHsgci5ncm91cF9pZCA9IHJbdGVybV07IH0pO1xuICAgICAgcmV0dXJuIHJvd3M7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgY29uc29sZS5lcnJvcihcIlNwYXRpYWwgRmV0Y2ggRXJyb3I6XCIsIGUpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG59XG5cbnNwYXRpYWxfbWV0YV9jb2x1bW5zID0ge1xuICBpZighc3BhdGlhbF9kYXRhIHx8IHNwYXRpYWxfZGF0YS5sZW5ndGggPT09IDApIHJldHVybiBbXTtcbiAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKHNwYXRpYWxfZGF0YVswXSk7XG4gIHJldHVybiBrZXlzLmZpbHRlcihrID0+ICFbXCJ4X3NsaWRlX21tXCIsIFwieV9zbGlkZV9tbVwiLCBcImdyb3VwX2lkXCIsIFwiX19pbmRleF9sZXZlbF8wX19cIl0uaW5jbHVkZXMoaykpO1xufVxuXG5zcGF0aWFsX2ZpbHRlcmVkID0ge1xuICBpZighc3BhdGlhbF9kYXRhKSByZXR1cm4gW107XG5cbiAgaWYoIWZpbHRlcl9jb2wgfHwgIWZpbHRlcl92YWxzKSByZXR1cm4gc3BhdGlhbF9kYXRhO1xuICBcbiAgLy8gTE9HSUMgU1dJVENIOlxuICBpZihpc19udW1lcmljX2ZpbHRlcikge1xuICAgICAvLyBOdW1lcmljIEZpbHRlcjogZmlsdGVyX3ZhbHMgaXMgYW4gb2JqZWN0IHttaW46IHgsIG1heDogeX1cbiAgICAgY29uc3QgeyBtaW4sIG1heCB9ID0gZmlsdGVyX3ZhbHM7XG4gICAgIHJldHVybiBzcGF0aWFsX2RhdGEuZmlsdGVyKGQgPT4gZFtmaWx0ZXJfY29sXSA+PSBtaW4gJiYgZFtmaWx0ZXJfY29sXSA8PSBtYXgpO1xuICB9IGVsc2Uge1xuICAgICAvLyBDYXRlZ29yaWNhbCBGaWx0ZXI6IGZpbHRlcl92YWxzIGlzIGFuIGFycmF5IG9mIHNlbGVjdGVkIHN0cmluZ3NcbiAgICAgaWYoZmlsdGVyX3ZhbHMubGVuZ3RoID09PSAwKSByZXR1cm4gc3BhdGlhbF9kYXRhO1xuICAgICByZXR1cm4gc3BhdGlhbF9kYXRhLmZpbHRlcihkID0+IGZpbHRlcl92YWxzLmluY2x1ZGVzKGRbZmlsdGVyX2NvbF0pKTtcbiAgfVxufVxuXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTM0IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiXG57XG4gIGNvbnN0IGRhdGEgPSBzcGF0aWFsX2ZpbHRlcmVkO1xuICBjb25zdCBsZXZlbHMgPSBtZWFuc19sZXZlbDsgXG4gIGNvbnN0IG9wdHMgPSBzcGF0aWFsX29wdGlvbnM7XG4gIGNvbnN0IGNvbG9ycyA9IHNwYXRpYWxfY29sb3JzO1xuICBjb25zdCB3aWR0aCA9IDEyMDA7IFxuICBjb25zdCBoZWlnaHQgPSA5MDA7IFxuICBcbiAgY29uc3QgdXNlTG9nID0gbG9nX3NjYWxlX29wdCA9PT0gdHJ1ZTsgXG4gIFxuICBpZiAoIWRhdGEgfHwgZGF0YS5sZW5ndGggPT09IDApIHJldHVybiBtZGBfTG9hZGluZyBzcGF0aWFsIGRhdGEuLi5fYDtcblxuICBjb25zdCBpc0NvbnRpbnVvdXMgPSB0eXBlb2YgZGF0YVswXS5ncm91cF9pZCA9PT0gJ251bWJlcic7XG4gIFxuICBsZXQgY29sb3JTY2FsZSA9IG51bGw7XG4gIGxldCB0ZXJtRXh0ZW50ID0gWzAsIDFdO1xuICBcbiAgaWYoaXNDb250aW51b3VzKSB7XG4gICAgIHRlcm1FeHRlbnQgPSBkMy5leHRlbnQoZGF0YSwgZCA9PiBkLmdyb3VwX2lkKTtcbiAgICAgXG4gICAgIGlmICh1c2VMb2cpIHtcbiAgICAgICAgLy8gTG9nIFNjYWxlOiBNYXAgTG9nKE1pbisxKSAtPiBMb2coTWF4KzEpXG4gICAgICAgIGNvbnN0IGxvZ01pbiA9IE1hdGgubG9nKHRlcm1FeHRlbnRbMF0gKyAxKTtcbiAgICAgICAgY29uc3QgbG9nTWF4ID0gTWF0aC5sb2codGVybUV4dGVudFsxXSArIDEpO1xuICAgICAgICBcbiAgICAgICAgY29sb3JTY2FsZSA9IGQzLnNjYWxlU2VxdWVudGlhbChkMy5pbnRlcnBvbGF0ZVJnYihjb2xvcnMubDIsIGNvbG9ycy5sMSkpXG4gICAgICAgICAgLmRvbWFpbihbbG9nTWluLCBsb2dNYXhdKTtcbiAgICAgICAgICBcbiAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gTGluZWFyIFNjYWxlXG4gICAgICAgIGNvbG9yU2NhbGUgPSBkMy5zY2FsZUxpbmVhcigpXG4gICAgICAgICAgLmRvbWFpbih0ZXJtRXh0ZW50KVxuICAgICAgICAgIC5yYW5nZShbY29sb3JzLmwyLCBjb2xvcnMubDFdKTtcbiAgICAgfVxuICB9XG5cbiAgY29uc3QgeEV4dGVudCA9IGQzLmV4dGVudChkYXRhLCBkID0+IGQueF9zbGlkZV9tbSk7XG4gIGNvbnN0IHlFeHRlbnQgPSBkMy5leHRlbnQoZGF0YSwgZCA9PiBkLnlfc2xpZGVfbW0pO1xuICBcbiAgY29uc3QgeE1pbiA9IHhFeHRlbnRbMF0sIHhNYXggPSB4RXh0ZW50WzFdO1xuICBjb25zdCB5TWluID0geUV4dGVudFswXSwgeU1heCA9IHlFeHRlbnRbMV07XG4gIFxuICBjb25zdCBkYXRhV2lkdGggPSB4TWF4IC0geE1pbjtcbiAgY29uc3QgZGF0YUhlaWdodCA9IHlNYXggLSB5TWluO1xuICBcbiAgY29uc3QgeFNjYWxlRmFjdG9yID0gd2lkdGggLyBkYXRhV2lkdGg7XG4gIGNvbnN0IHlTY2FsZUZhY3RvciA9IGhlaWdodCAvIGRhdGFIZWlnaHQ7XG4gIGNvbnN0IHNjYWxlID0gTWF0aC5taW4oeFNjYWxlRmFjdG9yLCB5U2NhbGVGYWN0b3IpICogMC45NTsgXG4gIFxuICBjb25zdCBjeCA9IHdpZHRoIC8gMjtcbiAgY29uc3QgY3kgPSBoZWlnaHQgLyAyO1xuICBjb25zdCBkeCA9ICh4TWluICsgeE1heCkgLyAyO1xuICBjb25zdCBkeSA9ICh5TWluICsgeU1heCkgLyAyO1xuXG4gIGNvbnN0IHByb2plY3QgPSAoeCwgeSkgPT4ge1xuICAgIHJldHVybiBbXG4gICAgICBjeCArICh4IC0gZHgpICogc2NhbGUsXG4gICAgICBjeSAtICh5IC0gZHkpICogc2NhbGUgXG4gICAgXTtcbiAgfVxuICBcbiAgY29uc3QgcGl4ZWxzUGVyTW0gPSBzY2FsZTtcblxuICAvLyAtLS0gMy4gRE9NIFNldHVwIC0tLVxuICBjb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICBkaXYuc3R5bGUucG9zaXRpb24gPSBcInJlbGF0aXZlXCI7XG4gIGRpdi5zdHlsZS53aWR0aCA9IFwiMTAwJVwiO1xuICBkaXYuc3R5bGUubWF4V2lkdGggPSBcIjEwMCVcIjtcbiAgZGl2LnN0eWxlLmhlaWdodCA9IFwiYXV0b1wiO1xuICBkaXYuc3R5bGUuYm9yZGVyID0gXCIxcHggc29saWQgI2VlZVwiO1xuICBkaXYuc3R5bGUuYmFja2dyb3VuZCA9IFwiI2ZmZlwiO1xuXG4gIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XG4gIGNhbnZhcy53aWR0aCA9IHdpZHRoO1xuICBjYW52YXMuaGVpZ2h0ID0gaGVpZ2h0O1xuICBjYW52YXMuc3R5bGUud2lkdGggPSBcIjEwMCVcIjsgLy8gUmVzcG9uc2l2ZSBDU1NcbiAgY2FudmFzLnN0eWxlLmhlaWdodCA9IFwiYXV0b1wiO1xuICBjYW52YXMuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcbiAgZGl2LmFwcGVuZENoaWxkKGNhbnZhcyk7XG4gIFxuICAvLyBMZWdlbmQgXG4gIGNvbnN0IGxlZ2VuZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gIGxlZ2VuZC5zdHlsZS5wb3NpdGlvbiA9IFwiYWJzb2x1dGVcIjtcbiAgbGVnZW5kLnN0eWxlLnRvcCA9IFwiMTBweFwiO1xuICBsZWdlbmQuc3R5bGUucmlnaHQgPSBcIjEwcHhcIjtcbiAgbGVnZW5kLnN0eWxlLmJhY2tncm91bmQgPSBcInJnYmEoMjU1LCAyNTUsIDI1NSwgMC45KVwiO1xuICBsZWdlbmQuc3R5bGUucGFkZGluZyA9IFwiOHB4XCI7XG4gIGxlZ2VuZC5zdHlsZS5ib3JkZXJSYWRpdXMgPSBcIjRweFwiO1xuICBsZWdlbmQuc3R5bGUuYm9yZGVyID0gXCIxcHggc29saWQgI2NjY1wiO1xuICBsZWdlbmQuc3R5bGUuZm9udFNpemUgPSBcIjEycHhcIjtcbiAgbGVnZW5kLnN0eWxlLmZvbnRGYW1pbHkgPSBcInNhbnMtc2VyaWZcIjtcbiAgXG4gIGlmIChpc0NvbnRpbnVvdXMpIHtcbiAgICAgY29uc3QgbGFiZWwgPSB1c2VMb2cgPyBgTG9nKCR7dGVybV9zZWxlY3Rpb259ICsgMSlgIDogdGVybV9zZWxlY3Rpb247XG4gICAgIGNvbnN0IG1pbkxhYmVsID0gdXNlTG9nID8gTWF0aC5sb2codGVybUV4dGVudFswXSArIDEpLnRvRml4ZWQoMikgOiB0ZXJtRXh0ZW50WzBdLnRvRml4ZWQoMik7XG4gICAgIGNvbnN0IG1heExhYmVsID0gdXNlTG9nID8gTWF0aC5sb2codGVybUV4dGVudFsxXSArIDEpLnRvRml4ZWQoMikgOiB0ZXJtRXh0ZW50WzFdLnRvRml4ZWQoMik7XG4gICAgIFxuICAgICBsZWdlbmQuaW5uZXJIVE1MID0gYFxuICAgICAgIDxzdHJvbmc+JHtsYWJlbH08L3N0cm9uZz48YnI+XG4gICAgICAgPGRpdiBzdHlsZT1cImRpc3BsYXk6ZmxleDsgYWxpZ24taXRlbXM6Y2VudGVyOyBnYXA6NXB4OyBtYXJnaW4tdG9wOjRweDtcIj5cbiAgICAgICAgIDxzcGFuPiR7bWluTGFiZWx9PC9zcGFuPlxuICAgICAgICAgPGRpdiBzdHlsZT1cIndpZHRoOjYwcHg7IGhlaWdodDoxMHB4OyBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQodG8gcmlnaHQsICR7Y29sb3JzLmwyfSwgJHtjb2xvcnMubDF9KTtcIj48L2Rpdj5cbiAgICAgICAgIDxzcGFuPiR7bWF4TGFiZWx9PC9zcGFuPlxuICAgICAgIDwvZGl2PlxuICAgICBgO1xuICB9IGVsc2Uge1xuICAgICBjb25zdCBMMSA9IChsZXZlbHMgJiYgbGV2ZWxzLmxlbmd0aCA+IDApID8gbGV2ZWxzWzBdIDogXCJMZXZlbCAxXCI7XG4gICAgIGNvbnN0IEwyID0gKGxldmVscyAmJiBsZXZlbHMubGVuZ3RoID4gMSkgPyBsZXZlbHNbMV0gOiBcIkxldmVsIDJcIjtcbiAgICAgbGVnZW5kLmlubmVySFRNTCA9IGBcbiAgICAgICA8c3Ryb25nPiR7dGVybV9zZWxlY3Rpb259PC9zdHJvbmc+PGJyPlxuICAgICAgIDxkaXYgc3R5bGU9XCJkaXNwbGF5OmZsZXg7IGFsaWduLWl0ZW1zOmNlbnRlcjsgZ2FwOjVweDsgbWFyZ2luLXRvcDoycHg7XCI+XG4gICAgICAgICA8c3BhbiBzdHlsZT1cImRpc3BsYXk6aW5saW5lLWJsb2NrOyB3aWR0aDoxMHB4OyBoZWlnaHQ6MTBweDsgYmFja2dyb3VuZDoke2NvbG9ycy5sMX07XCI+PC9zcGFuPiAke0wxfTxicj5cbiAgICAgICA8L2Rpdj5cbiAgICAgICA8ZGl2IHN0eWxlPVwiZGlzcGxheTpmbGV4OyBhbGlnbi1pdGVtczpjZW50ZXI7IGdhcDo1cHg7IG1hcmdpbi10b3A6MnB4O1wiPlxuICAgICAgICAgPHNwYW4gc3R5bGU9XCJkaXNwbGF5OmlubGluZS1ibG9jazsgd2lkdGg6MTBweDsgaGVpZ2h0OjEwcHg7IGJhY2tncm91bmQ6JHtjb2xvcnMubDJ9O1wiPjwvc3Bhbj4gJHtMMn1cbiAgICAgICA8L2Rpdj5cbiAgICAgYDtcbiAgfVxuICBkaXYuYXBwZW5kQ2hpbGQobGVnZW5kKTtcblxuICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xuICBsZXQgdHJhbnNmb3JtID0gZDMuem9vbUlkZW50aXR5O1xuXG4gIGZ1bmN0aW9uIGRyYXcoKSB7XG4gICAgY3R4LnNhdmUoKTtcbiAgICBjdHguY2xlYXJSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpO1xuICAgIFxuICAgIGN0eC50cmFuc2xhdGUodHJhbnNmb3JtLngsIHRyYW5zZm9ybS55KTtcbiAgICBjdHguc2NhbGUodHJhbnNmb3JtLmssIHRyYW5zZm9ybS5rKTtcbiAgICBcbiAgICBjb25zdCByYWRpdXMgPSBvcHRzLnB0X3NpemUgLyB0cmFuc2Zvcm0uaztcbiAgICBjdHguZ2xvYmFsQWxwaGEgPSBvcHRzLnB0X29wYWNpdHk7XG5cbiAgICBjb25zdCBjT3RoZXIgPSBjb2xvcnMub3RoZXI7XG4gICAgY29uc3QgY0wxID0gY29sb3JzLmwxO1xuICAgIGNvbnN0IGNMMiA9IGNvbG9ycy5sMjtcbiAgICBjb25zdCBMMSA9IChsZXZlbHMgJiYgbGV2ZWxzLmxlbmd0aCA+IDApID8gbGV2ZWxzWzBdIDogbnVsbDtcbiAgICBjb25zdCBMMiA9IChsZXZlbHMgJiYgbGV2ZWxzLmxlbmd0aCA+IDEpID8gbGV2ZWxzWzFdIDogbnVsbDtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgZCA9IGRhdGFbaV07XG4gICAgICBsZXQgZmlsbCA9IGNPdGhlcjtcbiAgICAgIFxuICAgICAgaWYgKGlzQ29udGludW91cykge1xuICAgICAgICAgaWYgKGQuZ3JvdXBfaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgY29uc3QgdmFsID0gdXNlTG9nID8gTWF0aC5sb2coZC5ncm91cF9pZCArIDEpIDogZC5ncm91cF9pZDtcbiAgICAgICAgICAgIGZpbGwgPSBjb2xvclNjYWxlKHZhbCk7XG4gICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAgaWYgKEwxICYmIGQuZ3JvdXBfaWQgPT09IEwxKSBmaWxsID0gY0wxO1xuICAgICAgICAgZWxzZSBpZiAoTDIgJiYgZC5ncm91cF9pZCA9PT0gTDIpIGZpbGwgPSBjTDI7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGNvbnN0IHh5ID0gcHJvamVjdChkLnhfc2xpZGVfbW0sIGQueV9zbGlkZV9tbSk7XG4gICAgICBcbiAgICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICAgIGN0eC5maWxsU3R5bGUgPSBmaWxsO1xuICAgICAgY3R4LmZpbGxSZWN0KHh5WzBdIC0gcmFkaXVzLCB4eVsxXSAtIHJhZGl1cywgcmFkaXVzKjIsIHJhZGl1cyoyKTtcbiAgICB9XG4gICAgXG4gICAgY3R4LnJlc3RvcmUoKTtcbiAgICBcbiAgICBpZiAob3B0cy5zaG93X3NjYWxlKSB7XG4gICAgICAgY29uc3QgYmFyTGVuTW0gPSBvcHRzLnNjYWxlX2xlbjtcbiAgICAgICBjb25zdCBiYXJMZW5QeCA9IGJhckxlbk1tICogcGl4ZWxzUGVyTW0gKiB0cmFuc2Zvcm0uazsgXG4gICAgICAgXG4gICAgICAgY29uc3QgbWFyZ2luID0gMjA7XG4gICAgICAgY29uc3QgYmFyWCA9IHdpZHRoIC0gbWFyZ2luIC0gYmFyTGVuUHg7XG4gICAgICAgY29uc3QgYmFyWSA9IGhlaWdodCAtIG1hcmdpbjtcbiAgICAgICBcbiAgICAgICBjdHguc2F2ZSgpO1xuICAgICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSBvcHRzLnNjYWxlX2NvbG9yO1xuICAgICAgIGN0eC5saW5lV2lkdGggPSA0O1xuICAgICAgIGN0eC5tb3ZlVG8oYmFyWCwgYmFyWSk7XG4gICAgICAgY3R4LmxpbmVUbyhiYXJYICsgYmFyTGVuUHgsIGJhclkpO1xuICAgICAgIGN0eC5zdHJva2UoKTtcbiAgICAgICBcbiAgICAgICBjdHguZmlsbFN0eWxlID0gb3B0cy5zY2FsZV9jb2xvcjtcbiAgICAgICBjdHguZm9udCA9IFwiYm9sZCAxNHB4IHNhbnMtc2VyaWZcIjtcbiAgICAgICBjdHgudGV4dEFsaWduID0gXCJjZW50ZXJcIjtcbiAgICAgICBjdHgudGV4dEJhc2VsaW5lID0gXCJib3R0b21cIjtcbiAgICAgICBjdHguZmlsbFRleHQoYCR7YmFyTGVuTW19IG1tYCwgYmFyWCArIGJhckxlblB4LzIsIGJhclkgLSA1KTtcbiAgICAgICBjdHgucmVzdG9yZSgpO1xuICAgIH1cbiAgfVxuXG4gIGRyYXcoKTtcblxuICBjb25zdCB6b29tID0gZDMuem9vbSgpXG4gICAgLnNjYWxlRXh0ZW50KFswLjUsIDUwXSkgXG4gICAgLm9uKFwiem9vbVwiLCAoZXZlbnQpID0+IHtcbiAgICAgIHRyYW5zZm9ybSA9IGV2ZW50LnRyYW5zZm9ybTtcbiAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShkcmF3KTtcbiAgICB9KTtcblxuICBkMy5zZWxlY3QoY2FudmFzKS5jYWxsKHpvb20pO1xuXG4gIHJldHVybiBkaXY7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3NlbGVjdGVkX3N0dWR5JykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ25ld196aXBfZmlsZScpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdhZXN0aGV0aWNzX3JhdycpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdwYWlyd2lzZV9zZWFyY2gnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgncGFpcndpc2VfdGFibGUnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgndGVybV9zZWxlY3Rpb24nKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnY29udHJhc3Rfc2VsZWN0aW9uJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3NhdmVfc2V0dGluZ3MnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnc2F2ZV9idG4nKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgndGVybV9jb3B5JykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2NvbnRyYXN0X2NvcHknKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnbWVhbnNfcmF3JykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ21lYW5zX3NlYXJjaCcpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdtZWFuc190YWJsZScpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdzcGF0aWFsX29wdGlvbnMnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnbG9nX3NjYWxlX29wdCcpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdmaWx0ZXJfY29sJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2ZpbHRlcl92YWxzJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3NsaWRlX3NlbGVjdGlvbicpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCd0ZXJtX2NvcHkyJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2NvbnRyYXN0X2NvcHkyJykifV19
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../../bbytes/de_explorer";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "../..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/nanostring-biostats\.github\.io\/CosMx-Analysis-Scratch-Space");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="../../license.html">
<p>License</p>
</a>
  </li>  
</ul>
    <div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>

<script type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (_event) {
  if (window.bslib.Card) {
    window.bslib.Card.initializeAllCards();
  }
}); 
</script>
  



</body></html>